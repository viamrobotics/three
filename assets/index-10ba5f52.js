function R_(h,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in h)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(h,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const sd="145",bw={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ww={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},I_=0,Nf=1,D_=2,xw=3,z_=0,rd=1,Rm=2,la=3,eo=0,ks=1,qs=2,Qr=0,pa=1,Zu=2,Of=3,Ff=4,V_=5,oa=100,N_=101,O_=102,Bf=103,Uf=104,F_=200,B_=201,U_=202,H_=203,Im=204,Dm=205,G_=206,W_=207,j_=208,K_=209,q_=210,X_=0,$_=1,Y_=2,Ju=3,Z_=4,J_=5,Q_=6,eb=7,Xc=0,tb=1,nb=2,Lr=0,ib=1,sb=2,rb=3,zm=4,ob=5,od=300,No=301,Oo=302,zc=303,Vc=304,gl=306,mr=1e3,qi=1001,ba=1002,ei=1003,hl=1004,yw=1004,ul=1005,Cw=1005,Ln=1006,$c=1007,Mw=1007,gr=1008,Ew=1008,Fo=1009,ab=1010,lb=1011,Vm=1012,cb=1013,Do=1014,Zr=1015,dl=1016,hb=1017,ub=1018,fa=1020,db=1021,pb=1022,Xs=1023,fb=1024,mb=1025,Vo=1026,wa=1027,vb=1028,gb=1029,_b=1030,bb=1031,wb=1033,Bu=33776,Uu=33777,Hu=33778,Gu=33779,Hf=35840,Gf=35841,Wf=35842,jf=35843,xb=36196,Kf=37492,qf=37496,Xf=37808,$f=37809,Yf=37810,Zf=37811,Jf=37812,Qf=37813,em=37814,tm=37815,nm=37816,im=37817,sm=37818,rm=37819,om=37820,am=37821,lm=36492,yb=2200,Cb=2201,Mb=2202,xa=2300,to=2301,Wu=2302,ca=2400,ha=2401,Nc=2402,ad=2500,Nm=2501,Eb=0,ld=1,pl=2,Bo=3e3,vn=3001,Sb=3200,Ab=3201,so=0,Pb=1,Sw="",ds="srgb",zo="srgb-linear",Aw=0,ju=7680,Pw=7681,Tw=7682,Lw=7683,kw=34055,Rw=34056,Iw=5386,Dw=512,zw=513,Vw=514,Nw=515,Ow=516,Fw=517,Bw=518,Tb=519,Oc=35044,Uw=35048,Hw=35040,Gw=35045,Ww=35049,jw=35041,Kw=35046,qw=35050,Xw=35042,$w="100",cm="300 es",Qu=1035;class ro{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let o=0,a=i.length;o<a;o++)i[o].call(this,e);e.target=null}}}const ts=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Vv=1234567;const ma=Math.PI/180,Fc=180/Math.PI;function Rs(){const h=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ts[h&255]+ts[h>>8&255]+ts[h>>16&255]+ts[h>>24&255]+"-"+ts[e&255]+ts[e>>8&255]+"-"+ts[e>>16&15|64]+ts[e>>24&255]+"-"+ts[t&63|128]+ts[t>>8&255]+"-"+ts[t>>16&255]+ts[t>>24&255]+ts[n&255]+ts[n>>8&255]+ts[n>>16&255]+ts[n>>24&255]).toLowerCase()}function ai(h,e,t){return Math.max(e,Math.min(t,h))}function Om(h,e){return(h%e+e)%e}function Yw(h,e,t,n,i){return n+(h-e)*(i-n)/(t-e)}function Zw(h,e,t){return h!==e?(t-h)/(e-h):0}function Tc(h,e,t){return(1-t)*h+t*e}function Jw(h,e,t,n){return Tc(h,e,1-Math.exp(-t*n))}function Qw(h,e=1){return e-Math.abs(Om(h,e*2)-e)}function ex(h,e,t){return h<=e?0:h>=t?1:(h=(h-e)/(t-e),h*h*(3-2*h))}function tx(h,e,t){return h<=e?0:h>=t?1:(h=(h-e)/(t-e),h*h*h*(h*(h*6-15)+10))}function nx(h,e){return h+Math.floor(Math.random()*(e-h+1))}function ix(h,e){return h+Math.random()*(e-h)}function sx(h){return h*(.5-Math.random())}function rx(h){h!==void 0&&(Vv=h);let e=Vv+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function ox(h){return h*ma}function ax(h){return h*Fc}function hm(h){return(h&h-1)===0&&h!==0}function Lb(h){return Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))}function ed(h){return Math.pow(2,Math.floor(Math.log(h)/Math.LN2))}function lx(h,e,t,n,i){const o=Math.cos,a=Math.sin,c=o(t/2),u=a(t/2),d=o((e+n)/2),v=a((e+n)/2),g=o((e-n)/2),b=a((e-n)/2),y=o((n-e)/2),S=a((n-e)/2);switch(i){case"XYX":h.set(c*v,u*g,u*b,c*d);break;case"YZY":h.set(u*b,c*v,u*g,c*d);break;case"ZXZ":h.set(u*g,u*b,c*v,c*d);break;case"XZX":h.set(c*v,u*S,u*y,c*d);break;case"YXY":h.set(u*y,c*v,u*S,c*d);break;case"ZYZ":h.set(u*S,u*y,c*v,c*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Jr(h,e){switch(e.constructor){case Float32Array:return h;case Uint16Array:return h/65535;case Uint8Array:return h/255;case Int16Array:return Math.max(h/32767,-1);case Int8Array:return Math.max(h/127,-1);default:throw new Error("Invalid component type.")}}function An(h,e){switch(e.constructor){case Float32Array:return h;case Uint16Array:return Math.round(h*65535);case Uint8Array:return Math.round(h*255);case Int16Array:return Math.round(h*32767);case Int8Array:return Math.round(h*127);default:throw new Error("Invalid component type.")}}var cd=Object.freeze({__proto__:null,DEG2RAD:ma,RAD2DEG:Fc,generateUUID:Rs,clamp:ai,euclideanModulo:Om,mapLinear:Yw,inverseLerp:Zw,lerp:Tc,damp:Jw,pingpong:Qw,smoothstep:ex,smootherstep:tx,randInt:nx,randFloat:ix,randFloatSpread:sx,seededRandom:rx,degToRad:ox,radToDeg:ax,isPowerOfTwo:hm,ceilPowerOfTwo:Lb,floorPowerOfTwo:ed,setQuaternionFromProperEuler:lx,normalize:An,denormalize:Jr});class De{constructor(e=0,t=0){De.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),o=this.x-e.x,a=this.y-e.y;return this.x=o*n-a*i+e.x,this.y=o*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ms{constructor(){Ms.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,o,a,c,u,d){const v=this.elements;return v[0]=e,v[1]=i,v[2]=c,v[3]=t,v[4]=o,v[5]=u,v[6]=n,v[7]=a,v[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,a=n[0],c=n[3],u=n[6],d=n[1],v=n[4],g=n[7],b=n[2],y=n[5],S=n[8],E=i[0],M=i[3],L=i[6],R=i[1],z=i[4],V=i[7],H=i[2],B=i[5],j=i[8];return o[0]=a*E+c*R+u*H,o[3]=a*M+c*z+u*B,o[6]=a*L+c*V+u*j,o[1]=d*E+v*R+g*H,o[4]=d*M+v*z+g*B,o[7]=d*L+v*V+g*j,o[2]=b*E+y*R+S*H,o[5]=b*M+y*z+S*B,o[8]=b*L+y*V+S*j,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],c=e[5],u=e[6],d=e[7],v=e[8];return t*a*v-t*c*d-n*o*v+n*c*u+i*o*d-i*a*u}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],c=e[5],u=e[6],d=e[7],v=e[8],g=v*a-c*d,b=c*u-v*o,y=d*o-a*u,S=t*g+n*b+i*y;if(S===0)return this.set(0,0,0,0,0,0,0,0,0);const E=1/S;return e[0]=g*E,e[1]=(i*d-v*n)*E,e[2]=(c*n-i*a)*E,e[3]=b*E,e[4]=(v*t-i*u)*E,e[5]=(i*o-c*t)*E,e[6]=y*E,e[7]=(n*u-d*t)*E,e[8]=(a*t-n*o)*E,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,o,a,c){const u=Math.cos(o),d=Math.sin(o);return this.set(n*u,n*d,-n*(u*a+d*c)+a+e,-i*d,i*u,-i*(-d*a+u*c)+c+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,o=i[0],a=i[3],c=i[6],u=i[1],d=i[4],v=i[7];return i[0]=t*o+n*u,i[3]=t*a+n*d,i[6]=t*c+n*v,i[1]=-n*o+t*u,i[4]=-n*a+t*d,i[7]=-n*c+t*v,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function kb(h){for(let e=h.length-1;e>=0;--e)if(h[e]>=65535)return!0;return!1}const cx={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function rl(h,e){return new cx[h](e)}function Bc(h){return document.createElementNS("http://www.w3.org/1999/xhtml",h)}function va(h){return h<.04045?h*.0773993808:Math.pow(h*.9478672986+.0521327014,2.4)}function Ku(h){return h<.0031308?h*12.92:1.055*Math.pow(h,.41666)-.055}const Xp={[ds]:{[zo]:va},[zo]:{[ds]:Ku}},Ts={legacyMode:!0,get workingColorSpace(){return zo},set workingColorSpace(h){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(h,e,t){if(this.legacyMode||e===t||!e||!t)return h;if(Xp[e]&&Xp[e][t]!==void 0){const n=Xp[e][t];return h.r=n(h.r),h.g=n(h.g),h.b=n(h.b),h}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(h,e){return this.convert(h,this.workingColorSpace,e)},toWorkingColorSpace:function(h,e){return this.convert(h,e,this.workingColorSpace)}},Rb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ki={r:0,g:0,b:0},ur={h:0,s:0,l:0},Yh={h:0,s:0,l:0};function $p(h,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?h+(e-h)*6*t:t<1/2?e:t<2/3?h+(e-h)*6*(2/3-t):h}function Zh(h,e){return e.r=h.r,e.g=h.g,e.b=h.b,e}class $e{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ds){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ts.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=zo){return this.r=e,this.g=t,this.b=n,Ts.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=zo){if(e=Om(e,1),t=ai(t,0,1),n=ai(n,0,1),t===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+t):n+t-n*t,a=2*n-o;this.r=$p(a,o,e+1/3),this.g=$p(a,o,e),this.b=$p(a,o,e-1/3)}return Ts.toWorkingColorSpace(this,i),this}setStyle(e,t=ds){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let o;const a=i[1],c=i[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,Ts.toWorkingColorSpace(this,t),n(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,Ts.toWorkingColorSpace(this,t),n(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c)){const u=parseFloat(o[1])/360,d=parseFloat(o[2])/100,v=parseFloat(o[3])/100;return n(o[4]),this.setHSL(u,d,v,t)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],a=o.length;if(a===3)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,Ts.toWorkingColorSpace(this,t),this;if(a===6)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,Ts.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=ds){const n=Rb[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=va(e.r),this.g=va(e.g),this.b=va(e.b),this}copyLinearToSRGB(e){return this.r=Ku(e.r),this.g=Ku(e.g),this.b=Ku(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ds){return Ts.fromWorkingColorSpace(Zh(this,ki),e),ai(ki.r*255,0,255)<<16^ai(ki.g*255,0,255)<<8^ai(ki.b*255,0,255)<<0}getHexString(e=ds){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=zo){Ts.fromWorkingColorSpace(Zh(this,ki),t);const n=ki.r,i=ki.g,o=ki.b,a=Math.max(n,i,o),c=Math.min(n,i,o);let u,d;const v=(c+a)/2;if(c===a)u=0,d=0;else{const g=a-c;switch(d=v<=.5?g/(a+c):g/(2-a-c),a){case n:u=(i-o)/g+(i<o?6:0);break;case i:u=(o-n)/g+2;break;case o:u=(n-i)/g+4;break}u/=6}return e.h=u,e.s=d,e.l=v,e}getRGB(e,t=zo){return Ts.fromWorkingColorSpace(Zh(this,ki),t),e.r=ki.r,e.g=ki.g,e.b=ki.b,e}getStyle(e=ds){return Ts.fromWorkingColorSpace(Zh(this,ki),e),e!==ds?`color(${e} ${ki.r} ${ki.g} ${ki.b})`:`rgb(${ki.r*255|0},${ki.g*255|0},${ki.b*255|0})`}offsetHSL(e,t,n){return this.getHSL(ur),ur.h+=e,ur.s+=t,ur.l+=n,this.setHSL(ur.h,ur.s,ur.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ur),e.getHSL(Yh);const n=Tc(ur.h,Yh.h,t),i=Tc(ur.s,Yh.s,t),o=Tc(ur.l,Yh.l,t);return this.setHSL(n,i,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}$e.NAMES=Rb;let Ba;class Fm{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Ba===void 0&&(Ba=Bc("canvas")),Ba.width=e.width,Ba.height=e.height;const n=Ba.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Ba}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Bc("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),o=i.data;for(let a=0;a<o.length;a++)o[a]=va(o[a]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(va(t[n]/255)*255):t[n]=va(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class ua{constructor(e=null){this.isSource=!0,this.uuid=Rs(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let a=0,c=i.length;a<c;a++)i[a].isDataTexture?o.push(Yp(i[a].image)):o.push(Yp(i[a]))}else o=Yp(i);n.url=o}return t||(e.images[this.uuid]=n),n}}function Yp(h){return typeof HTMLImageElement<"u"&&h instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&h instanceof ImageBitmap?Fm.getDataURL(h):h.data?{data:Array.from(h.data),width:h.width,height:h.height,type:h.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let hx=0;class Kn extends ro{constructor(e=Kn.DEFAULT_IMAGE,t=Kn.DEFAULT_MAPPING,n=qi,i=qi,o=Ln,a=gr,c=Xs,u=Fo,d=1,v=Bo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:hx++}),this.uuid=Rs(),this.name="",this.source=new ua(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=o,this.minFilter=a,this.anisotropy=d,this.format=c,this.internalFormat=null,this.type=u,this.offset=new De(0,0),this.repeat=new De(1,1),this.center=new De(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ms,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=v,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==od)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case mr:e.x=e.x-Math.floor(e.x);break;case qi:e.x=e.x<0?0:1;break;case ba:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case mr:e.y=e.y-Math.floor(e.y);break;case qi:e.y=e.y<0?0:1;break;case ba:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}Kn.DEFAULT_IMAGE=null;Kn.DEFAULT_MAPPING=od;class wn{constructor(e=0,t=0,n=0,i=1){wn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,o=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*o,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*o,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*o,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,o;const u=e.elements,d=u[0],v=u[4],g=u[8],b=u[1],y=u[5],S=u[9],E=u[2],M=u[6],L=u[10];if(Math.abs(v-b)<.01&&Math.abs(g-E)<.01&&Math.abs(S-M)<.01){if(Math.abs(v+b)<.1&&Math.abs(g+E)<.1&&Math.abs(S+M)<.1&&Math.abs(d+y+L-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const z=(d+1)/2,V=(y+1)/2,H=(L+1)/2,B=(v+b)/4,j=(g+E)/4,F=(S+M)/4;return z>V&&z>H?z<.01?(n=0,i=.707106781,o=.707106781):(n=Math.sqrt(z),i=B/n,o=j/n):V>H?V<.01?(n=.707106781,i=0,o=.707106781):(i=Math.sqrt(V),n=B/i,o=F/i):H<.01?(n=.707106781,i=.707106781,o=0):(o=Math.sqrt(H),n=j/o,i=F/o),this.set(n,i,o,t),this}let R=Math.sqrt((M-S)*(M-S)+(g-E)*(g-E)+(b-v)*(b-v));return Math.abs(R)<.001&&(R=1),this.x=(M-S)/R,this.y=(g-E)/R,this.z=(b-v)/R,this.w=Math.acos((d+y+L-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class $s extends ro{constructor(e,t,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new wn(0,0,e,t),this.scissorTest=!1,this.viewport=new wn(0,0,e,t);const i={width:e,height:t,depth:1};this.texture=new Kn(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Ln,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ua(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Yc extends Kn{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=ei,this.minFilter=ei,this.wrapR=qi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ux extends $s{constructor(e,t,n){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Yc(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class hd extends Kn{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=ei,this.minFilter=ei,this.wrapR=qi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class dx extends $s{constructor(e,t,n){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new hd(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class px extends $s{constructor(e,t,n,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;const o=this.texture;this.texture=[];for(let a=0;a<n;a++)this.texture[a]=o.clone(),this.texture[a].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,o=this.texture.length;i<o;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Vn{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,o,a,c){let u=n[i+0],d=n[i+1],v=n[i+2],g=n[i+3];const b=o[a+0],y=o[a+1],S=o[a+2],E=o[a+3];if(c===0){e[t+0]=u,e[t+1]=d,e[t+2]=v,e[t+3]=g;return}if(c===1){e[t+0]=b,e[t+1]=y,e[t+2]=S,e[t+3]=E;return}if(g!==E||u!==b||d!==y||v!==S){let M=1-c;const L=u*b+d*y+v*S+g*E,R=L>=0?1:-1,z=1-L*L;if(z>Number.EPSILON){const H=Math.sqrt(z),B=Math.atan2(H,L*R);M=Math.sin(M*B)/H,c=Math.sin(c*B)/H}const V=c*R;if(u=u*M+b*V,d=d*M+y*V,v=v*M+S*V,g=g*M+E*V,M===1-c){const H=1/Math.sqrt(u*u+d*d+v*v+g*g);u*=H,d*=H,v*=H,g*=H}}e[t]=u,e[t+1]=d,e[t+2]=v,e[t+3]=g}static multiplyQuaternionsFlat(e,t,n,i,o,a){const c=n[i],u=n[i+1],d=n[i+2],v=n[i+3],g=o[a],b=o[a+1],y=o[a+2],S=o[a+3];return e[t]=c*S+v*g+u*y-d*b,e[t+1]=u*S+v*b+d*g-c*y,e[t+2]=d*S+v*y+c*b-u*g,e[t+3]=v*S-c*g-u*b-d*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,o=e._z,a=e._order,c=Math.cos,u=Math.sin,d=c(n/2),v=c(i/2),g=c(o/2),b=u(n/2),y=u(i/2),S=u(o/2);switch(a){case"XYZ":this._x=b*v*g+d*y*S,this._y=d*y*g-b*v*S,this._z=d*v*S+b*y*g,this._w=d*v*g-b*y*S;break;case"YXZ":this._x=b*v*g+d*y*S,this._y=d*y*g-b*v*S,this._z=d*v*S-b*y*g,this._w=d*v*g+b*y*S;break;case"ZXY":this._x=b*v*g-d*y*S,this._y=d*y*g+b*v*S,this._z=d*v*S+b*y*g,this._w=d*v*g-b*y*S;break;case"ZYX":this._x=b*v*g-d*y*S,this._y=d*y*g+b*v*S,this._z=d*v*S-b*y*g,this._w=d*v*g+b*y*S;break;case"YZX":this._x=b*v*g+d*y*S,this._y=d*y*g+b*v*S,this._z=d*v*S-b*y*g,this._w=d*v*g-b*y*S;break;case"XZY":this._x=b*v*g-d*y*S,this._y=d*y*g-b*v*S,this._z=d*v*S+b*y*g,this._w=d*v*g+b*y*S;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],o=t[8],a=t[1],c=t[5],u=t[9],d=t[2],v=t[6],g=t[10],b=n+c+g;if(b>0){const y=.5/Math.sqrt(b+1);this._w=.25/y,this._x=(v-u)*y,this._y=(o-d)*y,this._z=(a-i)*y}else if(n>c&&n>g){const y=2*Math.sqrt(1+n-c-g);this._w=(v-u)/y,this._x=.25*y,this._y=(i+a)/y,this._z=(o+d)/y}else if(c>g){const y=2*Math.sqrt(1+c-n-g);this._w=(o-d)/y,this._x=(i+a)/y,this._y=.25*y,this._z=(u+v)/y}else{const y=2*Math.sqrt(1+g-n-c);this._w=(a-i)/y,this._x=(o+d)/y,this._y=(u+v)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ai(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,o=e._z,a=e._w,c=t._x,u=t._y,d=t._z,v=t._w;return this._x=n*v+a*c+i*d-o*u,this._y=i*v+a*u+o*c-n*d,this._z=o*v+a*d+n*u-i*c,this._w=a*v-n*c-i*u-o*d,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,o=this._z,a=this._w;let c=a*e._w+n*e._x+i*e._y+o*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=a,this._x=n,this._y=i,this._z=o,this;const u=1-c*c;if(u<=Number.EPSILON){const y=1-t;return this._w=y*a+t*this._w,this._x=y*n+t*this._x,this._y=y*i+t*this._y,this._z=y*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const d=Math.sqrt(u),v=Math.atan2(d,c),g=Math.sin((1-t)*v)/d,b=Math.sin(t*v)/d;return this._w=a*g+this._w*b,this._x=n*g+this._x*b,this._y=i*g+this._y*b,this._z=o*g+this._z*b,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(o),n*Math.cos(o),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class X{constructor(e=0,t=0,n=0){X.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Nv.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Nv.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*i,this.y=o[1]*t+o[4]*n+o[7]*i,this.z=o[2]*t+o[5]*n+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,o=e.elements,a=1/(o[3]*t+o[7]*n+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*i+o[12])*a,this.y=(o[1]*t+o[5]*n+o[9]*i+o[13])*a,this.z=(o[2]*t+o[6]*n+o[10]*i+o[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,o=e.x,a=e.y,c=e.z,u=e.w,d=u*t+a*i-c*n,v=u*n+c*t-o*i,g=u*i+o*n-a*t,b=-o*t-a*n-c*i;return this.x=d*u+b*-o+v*-c-g*-a,this.y=v*u+b*-a+g*-o-d*-c,this.z=g*u+b*-c+d*-a-v*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i,this.y=o[1]*t+o[5]*n+o[9]*i,this.z=o[2]*t+o[6]*n+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,o=e.z,a=t.x,c=t.y,u=t.z;return this.x=i*u-o*c,this.y=o*a-n*u,this.z=n*c-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Zp.copy(this).projectOnVector(e),this.sub(Zp)}reflect(e){return this.sub(Zp.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ai(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Zp=new X,Nv=new Vn;class oo{constructor(e=new X(1/0,1/0,1/0),t=new X(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,o=-1/0,a=-1/0,c=-1/0;for(let u=0,d=e.length;u<d;u+=3){const v=e[u],g=e[u+1],b=e[u+2];v<t&&(t=v),g<n&&(n=g),b<i&&(i=b),v>o&&(o=v),g>a&&(a=g),b>c&&(c=b)}return this.min.set(t,n,i),this.max.set(o,a,c),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,o=-1/0,a=-1/0,c=-1/0;for(let u=0,d=e.count;u<d;u++){const v=e.getX(u),g=e.getY(u),b=e.getZ(u);v<t&&(t=v),g<n&&(n=g),b<i&&(i=b),v>o&&(o=v),g>a&&(a=g),b>c&&(c=b)}return this.min.set(t,n,i),this.max.set(o,a,c),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Xo.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){const o=n.attributes.position;for(let a=0,c=o.count;a<c;a++)Xo.fromBufferAttribute(o,a).applyMatrix4(e.matrixWorld),this.expandByPoint(Xo)}else n.boundingBox===null&&n.computeBoundingBox(),Jp.copy(n.boundingBox),Jp.applyMatrix4(e.matrixWorld),this.union(Jp);const i=e.children;for(let o=0,a=i.length;o<a;o++)this.expandByObject(i[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Xo),Xo.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(fc),Jh.subVectors(this.max,fc),Ua.subVectors(e.a,fc),Ha.subVectors(e.b,fc),Ga.subVectors(e.c,fc),wo.subVectors(Ha,Ua),xo.subVectors(Ga,Ha),$o.subVectors(Ua,Ga);let t=[0,-wo.z,wo.y,0,-xo.z,xo.y,0,-$o.z,$o.y,wo.z,0,-wo.x,xo.z,0,-xo.x,$o.z,0,-$o.x,-wo.y,wo.x,0,-xo.y,xo.x,0,-$o.y,$o.x,0];return!Qp(t,Ua,Ha,Ga,Jh)||(t=[1,0,0,0,1,0,0,0,1],!Qp(t,Ua,Ha,Ga,Jh))?!1:(Qh.crossVectors(wo,xo),t=[Qh.x,Qh.y,Qh.z],Qp(t,Ua,Ha,Ga,Jh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Xo.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Xo).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ur[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ur[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ur[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ur[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ur[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ur[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ur[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ur[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ur),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ur=[new X,new X,new X,new X,new X,new X,new X,new X],Xo=new X,Jp=new oo,Ua=new X,Ha=new X,Ga=new X,wo=new X,xo=new X,$o=new X,fc=new X,Jh=new X,Qh=new X,Yo=new X;function Qp(h,e,t,n,i){for(let o=0,a=h.length-3;o<=a;o+=3){Yo.fromArray(h,o);const c=i.x*Math.abs(Yo.x)+i.y*Math.abs(Yo.y)+i.z*Math.abs(Yo.z),u=e.dot(Yo),d=t.dot(Yo),v=n.dot(Yo);if(Math.max(-Math.max(u,d,v),Math.min(u,d,v))>c)return!1}return!0}const fx=new oo,Ov=new X,eu=new X,ef=new X;class ao{constructor(e=new X,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):fx.setFromPoints(e).getCenter(n);let i=0;for(let o=0,a=e.length;o<a;o++)i=Math.max(i,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ef.subVectors(e,this.center);const t=ef.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.add(ef.multiplyScalar(i/n)),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?eu.set(0,0,1).multiplyScalar(e.radius):eu.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Ov.copy(e.center).add(eu)),this.expandByPoint(Ov.copy(e.center).sub(eu)),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Hr=new X,tf=new X,tu=new X,yo=new X,nf=new X,nu=new X,sf=new X;class Zc{constructor(e=new X,t=new X(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Hr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Hr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Hr.copy(this.direction).multiplyScalar(t).add(this.origin),Hr.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){tf.copy(e).add(t).multiplyScalar(.5),tu.copy(t).sub(e).normalize(),yo.copy(this.origin).sub(tf);const o=e.distanceTo(t)*.5,a=-this.direction.dot(tu),c=yo.dot(this.direction),u=-yo.dot(tu),d=yo.lengthSq(),v=Math.abs(1-a*a);let g,b,y,S;if(v>0)if(g=a*u-c,b=a*c-u,S=o*v,g>=0)if(b>=-S)if(b<=S){const E=1/v;g*=E,b*=E,y=g*(g+a*b+2*c)+b*(a*g+b+2*u)+d}else b=o,g=Math.max(0,-(a*b+c)),y=-g*g+b*(b+2*u)+d;else b=-o,g=Math.max(0,-(a*b+c)),y=-g*g+b*(b+2*u)+d;else b<=-S?(g=Math.max(0,-(-a*o+c)),b=g>0?-o:Math.min(Math.max(-o,-u),o),y=-g*g+b*(b+2*u)+d):b<=S?(g=0,b=Math.min(Math.max(-o,-u),o),y=b*(b+2*u)+d):(g=Math.max(0,-(a*o+c)),b=g>0?o:Math.min(Math.max(-o,-u),o),y=-g*g+b*(b+2*u)+d);else b=a>0?-o:o,g=Math.max(0,-(a*b+c)),y=-g*g+b*(b+2*u)+d;return n&&n.copy(this.direction).multiplyScalar(g).add(this.origin),i&&i.copy(tu).multiplyScalar(b).add(tf),y}intersectSphere(e,t){Hr.subVectors(e.center,this.origin);const n=Hr.dot(this.direction),i=Hr.dot(Hr)-n*n,o=e.radius*e.radius;if(i>o)return null;const a=Math.sqrt(o-i),c=n-a,u=n+a;return c<0&&u<0?null:c<0?this.at(u,t):this.at(c,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,o,a,c,u;const d=1/this.direction.x,v=1/this.direction.y,g=1/this.direction.z,b=this.origin;return d>=0?(n=(e.min.x-b.x)*d,i=(e.max.x-b.x)*d):(n=(e.max.x-b.x)*d,i=(e.min.x-b.x)*d),v>=0?(o=(e.min.y-b.y)*v,a=(e.max.y-b.y)*v):(o=(e.max.y-b.y)*v,a=(e.min.y-b.y)*v),n>a||o>i||((o>n||n!==n)&&(n=o),(a<i||i!==i)&&(i=a),g>=0?(c=(e.min.z-b.z)*g,u=(e.max.z-b.z)*g):(c=(e.max.z-b.z)*g,u=(e.min.z-b.z)*g),n>u||c>i)||((c>n||n!==n)&&(n=c),(u<i||i!==i)&&(i=u),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,Hr)!==null}intersectTriangle(e,t,n,i,o){nf.subVectors(t,e),nu.subVectors(n,e),sf.crossVectors(nf,nu);let a=this.direction.dot(sf),c;if(a>0){if(i)return null;c=1}else if(a<0)c=-1,a=-a;else return null;yo.subVectors(this.origin,e);const u=c*this.direction.dot(nu.crossVectors(yo,nu));if(u<0)return null;const d=c*this.direction.dot(nf.cross(yo));if(d<0||u+d>a)return null;const v=-c*yo.dot(sf);return v<0?null:this.at(v/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class It{constructor(){It.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,o,a,c,u,d,v,g,b,y,S,E,M){const L=this.elements;return L[0]=e,L[4]=t,L[8]=n,L[12]=i,L[1]=o,L[5]=a,L[9]=c,L[13]=u,L[2]=d,L[6]=v,L[10]=g,L[14]=b,L[3]=y,L[7]=S,L[11]=E,L[15]=M,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new It().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Wa.setFromMatrixColumn(e,0).length(),o=1/Wa.setFromMatrixColumn(e,1).length(),a=1/Wa.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,o=e.z,a=Math.cos(n),c=Math.sin(n),u=Math.cos(i),d=Math.sin(i),v=Math.cos(o),g=Math.sin(o);if(e.order==="XYZ"){const b=a*v,y=a*g,S=c*v,E=c*g;t[0]=u*v,t[4]=-u*g,t[8]=d,t[1]=y+S*d,t[5]=b-E*d,t[9]=-c*u,t[2]=E-b*d,t[6]=S+y*d,t[10]=a*u}else if(e.order==="YXZ"){const b=u*v,y=u*g,S=d*v,E=d*g;t[0]=b+E*c,t[4]=S*c-y,t[8]=a*d,t[1]=a*g,t[5]=a*v,t[9]=-c,t[2]=y*c-S,t[6]=E+b*c,t[10]=a*u}else if(e.order==="ZXY"){const b=u*v,y=u*g,S=d*v,E=d*g;t[0]=b-E*c,t[4]=-a*g,t[8]=S+y*c,t[1]=y+S*c,t[5]=a*v,t[9]=E-b*c,t[2]=-a*d,t[6]=c,t[10]=a*u}else if(e.order==="ZYX"){const b=a*v,y=a*g,S=c*v,E=c*g;t[0]=u*v,t[4]=S*d-y,t[8]=b*d+E,t[1]=u*g,t[5]=E*d+b,t[9]=y*d-S,t[2]=-d,t[6]=c*u,t[10]=a*u}else if(e.order==="YZX"){const b=a*u,y=a*d,S=c*u,E=c*d;t[0]=u*v,t[4]=E-b*g,t[8]=S*g+y,t[1]=g,t[5]=a*v,t[9]=-c*v,t[2]=-d*v,t[6]=y*g+S,t[10]=b-E*g}else if(e.order==="XZY"){const b=a*u,y=a*d,S=c*u,E=c*d;t[0]=u*v,t[4]=-g,t[8]=d*v,t[1]=b*g+E,t[5]=a*v,t[9]=y*g-S,t[2]=S*g-y,t[6]=c*v,t[10]=E*g+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(mx,e,vx)}lookAt(e,t,n){const i=this.elements;return As.subVectors(e,t),As.lengthSq()===0&&(As.z=1),As.normalize(),Co.crossVectors(n,As),Co.lengthSq()===0&&(Math.abs(n.z)===1?As.x+=1e-4:As.z+=1e-4,As.normalize(),Co.crossVectors(n,As)),Co.normalize(),iu.crossVectors(As,Co),i[0]=Co.x,i[4]=iu.x,i[8]=As.x,i[1]=Co.y,i[5]=iu.y,i[9]=As.y,i[2]=Co.z,i[6]=iu.z,i[10]=As.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,a=n[0],c=n[4],u=n[8],d=n[12],v=n[1],g=n[5],b=n[9],y=n[13],S=n[2],E=n[6],M=n[10],L=n[14],R=n[3],z=n[7],V=n[11],H=n[15],B=i[0],j=i[4],F=i[8],W=i[12],Z=i[1],se=i[5],we=i[9],oe=i[13],ne=i[2],ce=i[6],ve=i[10],de=i[14],he=i[3],ue=i[7],me=i[11],ze=i[15];return o[0]=a*B+c*Z+u*ne+d*he,o[4]=a*j+c*se+u*ce+d*ue,o[8]=a*F+c*we+u*ve+d*me,o[12]=a*W+c*oe+u*de+d*ze,o[1]=v*B+g*Z+b*ne+y*he,o[5]=v*j+g*se+b*ce+y*ue,o[9]=v*F+g*we+b*ve+y*me,o[13]=v*W+g*oe+b*de+y*ze,o[2]=S*B+E*Z+M*ne+L*he,o[6]=S*j+E*se+M*ce+L*ue,o[10]=S*F+E*we+M*ve+L*me,o[14]=S*W+E*oe+M*de+L*ze,o[3]=R*B+z*Z+V*ne+H*he,o[7]=R*j+z*se+V*ce+H*ue,o[11]=R*F+z*we+V*ve+H*me,o[15]=R*W+z*oe+V*de+H*ze,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],o=e[12],a=e[1],c=e[5],u=e[9],d=e[13],v=e[2],g=e[6],b=e[10],y=e[14],S=e[3],E=e[7],M=e[11],L=e[15];return S*(+o*u*g-i*d*g-o*c*b+n*d*b+i*c*y-n*u*y)+E*(+t*u*y-t*d*b+o*a*b-i*a*y+i*d*v-o*u*v)+M*(+t*d*g-t*c*y-o*a*g+n*a*y+o*c*v-n*d*v)+L*(-i*c*v-t*u*g+t*c*b+i*a*g-n*a*b+n*u*v)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],c=e[5],u=e[6],d=e[7],v=e[8],g=e[9],b=e[10],y=e[11],S=e[12],E=e[13],M=e[14],L=e[15],R=g*M*d-E*b*d+E*u*y-c*M*y-g*u*L+c*b*L,z=S*b*d-v*M*d-S*u*y+a*M*y+v*u*L-a*b*L,V=v*E*d-S*g*d+S*c*y-a*E*y-v*c*L+a*g*L,H=S*g*u-v*E*u-S*c*b+a*E*b+v*c*M-a*g*M,B=t*R+n*z+i*V+o*H;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const j=1/B;return e[0]=R*j,e[1]=(E*b*o-g*M*o-E*i*y+n*M*y+g*i*L-n*b*L)*j,e[2]=(c*M*o-E*u*o+E*i*d-n*M*d-c*i*L+n*u*L)*j,e[3]=(g*u*o-c*b*o-g*i*d+n*b*d+c*i*y-n*u*y)*j,e[4]=z*j,e[5]=(v*M*o-S*b*o+S*i*y-t*M*y-v*i*L+t*b*L)*j,e[6]=(S*u*o-a*M*o-S*i*d+t*M*d+a*i*L-t*u*L)*j,e[7]=(a*b*o-v*u*o+v*i*d-t*b*d-a*i*y+t*u*y)*j,e[8]=V*j,e[9]=(S*g*o-v*E*o-S*n*y+t*E*y+v*n*L-t*g*L)*j,e[10]=(a*E*o-S*c*o+S*n*d-t*E*d-a*n*L+t*c*L)*j,e[11]=(v*c*o-a*g*o-v*n*d+t*g*d+a*n*y-t*c*y)*j,e[12]=H*j,e[13]=(v*E*i-S*g*i+S*n*b-t*E*b-v*n*M+t*g*M)*j,e[14]=(S*c*i-a*E*i-S*n*u+t*E*u+a*n*M-t*c*M)*j,e[15]=(a*g*i-v*c*i+v*n*u-t*g*u-a*n*b+t*c*b)*j,this}scale(e){const t=this.elements,n=e.x,i=e.y,o=e.z;return t[0]*=n,t[4]*=i,t[8]*=o,t[1]*=n,t[5]*=i,t[9]*=o,t[2]*=n,t[6]*=i,t[10]*=o,t[3]*=n,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),o=1-n,a=e.x,c=e.y,u=e.z,d=o*a,v=o*c;return this.set(d*a+n,d*c-i*u,d*u+i*c,0,d*c+i*u,v*c+n,v*u-i*a,0,d*u-i*c,v*u+i*a,o*u*u+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,o,a){return this.set(1,n,o,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,o=t._x,a=t._y,c=t._z,u=t._w,d=o+o,v=a+a,g=c+c,b=o*d,y=o*v,S=o*g,E=a*v,M=a*g,L=c*g,R=u*d,z=u*v,V=u*g,H=n.x,B=n.y,j=n.z;return i[0]=(1-(E+L))*H,i[1]=(y+V)*H,i[2]=(S-z)*H,i[3]=0,i[4]=(y-V)*B,i[5]=(1-(b+L))*B,i[6]=(M+R)*B,i[7]=0,i[8]=(S+z)*j,i[9]=(M-R)*j,i[10]=(1-(b+E))*j,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let o=Wa.set(i[0],i[1],i[2]).length();const a=Wa.set(i[4],i[5],i[6]).length(),c=Wa.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],dr.copy(this);const d=1/o,v=1/a,g=1/c;return dr.elements[0]*=d,dr.elements[1]*=d,dr.elements[2]*=d,dr.elements[4]*=v,dr.elements[5]*=v,dr.elements[6]*=v,dr.elements[8]*=g,dr.elements[9]*=g,dr.elements[10]*=g,t.setFromRotationMatrix(dr),n.x=o,n.y=a,n.z=c,this}makePerspective(e,t,n,i,o,a){const c=this.elements,u=2*o/(t-e),d=2*o/(n-i),v=(t+e)/(t-e),g=(n+i)/(n-i),b=-(a+o)/(a-o),y=-2*a*o/(a-o);return c[0]=u,c[4]=0,c[8]=v,c[12]=0,c[1]=0,c[5]=d,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=b,c[14]=y,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,i,o,a){const c=this.elements,u=1/(t-e),d=1/(n-i),v=1/(a-o),g=(t+e)*u,b=(n+i)*d,y=(a+o)*v;return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-g,c[1]=0,c[5]=2*d,c[9]=0,c[13]=-b,c[2]=0,c[6]=0,c[10]=-2*v,c[14]=-y,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Wa=new X,dr=new It,mx=new X(0,0,0),vx=new X(1,1,1),Co=new X,iu=new X,As=new X,Fv=new It,Bv=new Vn;class Ho{constructor(e=0,t=0,n=0,i=Ho.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,o=i[0],a=i[4],c=i[8],u=i[1],d=i[5],v=i[9],g=i[2],b=i[6],y=i[10];switch(t){case"XYZ":this._y=Math.asin(ai(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-v,y),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(b,d),this._z=0);break;case"YXZ":this._x=Math.asin(-ai(v,-1,1)),Math.abs(v)<.9999999?(this._y=Math.atan2(c,y),this._z=Math.atan2(u,d)):(this._y=Math.atan2(-g,o),this._z=0);break;case"ZXY":this._x=Math.asin(ai(b,-1,1)),Math.abs(b)<.9999999?(this._y=Math.atan2(-g,y),this._z=Math.atan2(-a,d)):(this._y=0,this._z=Math.atan2(u,o));break;case"ZYX":this._y=Math.asin(-ai(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(b,y),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,d));break;case"YZX":this._z=Math.asin(ai(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-v,d),this._y=Math.atan2(-g,o)):(this._x=0,this._y=Math.atan2(c,y));break;case"XZY":this._z=Math.asin(-ai(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(b,d),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-v,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Fv.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Fv,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Bv.setFromEuler(this),this.setFromQuaternion(Bv,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Ho.DefaultOrder="XYZ";Ho.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ud{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let gx=0;const Uv=new X,ja=new Vn,Gr=new It,su=new X,mc=new X,_x=new X,bx=new Vn,Hv=new X(1,0,0),Gv=new X(0,1,0),Wv=new X(0,0,1),wx={type:"added"},jv={type:"removed"};class Jt extends ro{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:gx++}),this.uuid=Rs(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Jt.DefaultUp.clone();const e=new X,t=new Ho,n=new Vn,i=new X(1,1,1);function o(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(o),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new It},normalMatrix:{value:new Ms}}),this.matrix=new It,this.matrixWorld=new It,this.matrixAutoUpdate=Jt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Jt.DefaultMatrixWorldAutoUpdate,this.layers=new ud,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ja.setFromAxisAngle(e,t),this.quaternion.multiply(ja),this}rotateOnWorldAxis(e,t){return ja.setFromAxisAngle(e,t),this.quaternion.premultiply(ja),this}rotateX(e){return this.rotateOnAxis(Hv,e)}rotateY(e){return this.rotateOnAxis(Gv,e)}rotateZ(e){return this.rotateOnAxis(Wv,e)}translateOnAxis(e,t){return Uv.copy(e).applyQuaternion(this.quaternion),this.position.add(Uv.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Hv,e)}translateY(e){return this.translateOnAxis(Gv,e)}translateZ(e){return this.translateOnAxis(Wv,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Gr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?su.copy(e):su.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),mc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Gr.lookAt(mc,su,this.up):Gr.lookAt(su,mc,this.up),this.quaternion.setFromRotationMatrix(Gr),i&&(Gr.extractRotation(i.matrixWorld),ja.setFromRotationMatrix(Gr),this.quaternion.premultiply(ja.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(wx)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(jv)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(jv)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Gr.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Gr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Gr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mc,e,_x),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mc,bx,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const o=t[n];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let o=0,a=i.length;o<a;o++){const c=i[o];c.matrixWorldAutoUpdate===!0&&c.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function o(c,u){return c[u.uuid]===void 0&&(c[u.uuid]=u.toJSON(e)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){const u=c.shapes;if(Array.isArray(u))for(let d=0,v=u.length;d<v;d++){const g=u[d];o(e.shapes,g)}else o(e.shapes,u)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const c=[];for(let u=0,d=this.material.length;u<d;u++)c.push(o(e.materials,this.material[u]));i.material=c}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let c=0;c<this.children.length;c++)i.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let c=0;c<this.animations.length;c++){const u=this.animations[c];i.animations.push(o(e.animations,u))}}if(t){const c=a(e.geometries),u=a(e.materials),d=a(e.textures),v=a(e.images),g=a(e.shapes),b=a(e.skeletons),y=a(e.animations),S=a(e.nodes);c.length>0&&(n.geometries=c),u.length>0&&(n.materials=u),d.length>0&&(n.textures=d),v.length>0&&(n.images=v),g.length>0&&(n.shapes=g),b.length>0&&(n.skeletons=b),y.length>0&&(n.animations=y),S.length>0&&(n.nodes=S)}return n.object=i,n;function a(c){const u=[];for(const d in c){const v=c[d];delete v.metadata,u.push(v)}return u}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Jt.DefaultUp=new X(0,1,0);Jt.DefaultMatrixAutoUpdate=!0;Jt.DefaultMatrixWorldAutoUpdate=!0;const pr=new X,Wr=new X,rf=new X,jr=new X,Ka=new X,qa=new X,Kv=new X,of=new X,af=new X,lf=new X;class Ks{constructor(e=new X,t=new X,n=new X){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),pr.subVectors(e,t),i.cross(pr);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,n,i,o){pr.subVectors(i,t),Wr.subVectors(n,t),rf.subVectors(e,t);const a=pr.dot(pr),c=pr.dot(Wr),u=pr.dot(rf),d=Wr.dot(Wr),v=Wr.dot(rf),g=a*d-c*c;if(g===0)return o.set(-2,-1,-1);const b=1/g,y=(d*u-c*v)*b,S=(a*v-c*u)*b;return o.set(1-y-S,S,y)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,jr),jr.x>=0&&jr.y>=0&&jr.x+jr.y<=1}static getUV(e,t,n,i,o,a,c,u){return this.getBarycoord(e,t,n,i,jr),u.set(0,0),u.addScaledVector(o,jr.x),u.addScaledVector(a,jr.y),u.addScaledVector(c,jr.z),u}static isFrontFacing(e,t,n,i){return pr.subVectors(n,t),Wr.subVectors(e,t),pr.cross(Wr).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pr.subVectors(this.c,this.b),Wr.subVectors(this.a,this.b),pr.cross(Wr).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ks.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ks.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,o){return Ks.getUV(e,this.a,this.b,this.c,t,n,i,o)}containsPoint(e){return Ks.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ks.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,o=this.c;let a,c;Ka.subVectors(i,n),qa.subVectors(o,n),of.subVectors(e,n);const u=Ka.dot(of),d=qa.dot(of);if(u<=0&&d<=0)return t.copy(n);af.subVectors(e,i);const v=Ka.dot(af),g=qa.dot(af);if(v>=0&&g<=v)return t.copy(i);const b=u*g-v*d;if(b<=0&&u>=0&&v<=0)return a=u/(u-v),t.copy(n).addScaledVector(Ka,a);lf.subVectors(e,o);const y=Ka.dot(lf),S=qa.dot(lf);if(S>=0&&y<=S)return t.copy(o);const E=y*d-u*S;if(E<=0&&d>=0&&S<=0)return c=d/(d-S),t.copy(n).addScaledVector(qa,c);const M=v*S-y*g;if(M<=0&&g-v>=0&&y-S>=0)return Kv.subVectors(o,i),c=(g-v)/(g-v+(y-S)),t.copy(i).addScaledVector(Kv,c);const L=1/(M+E+b);return a=E*L,c=b*L,t.copy(n).addScaledVector(Ka,a).addScaledVector(qa,c)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let xx=0;class ti extends ro{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:xx++}),this.uuid=Rs(),this.name="",this.type="Material",this.blending=pa,this.side=eo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Im,this.blendDst=Dm,this.blendEquation=oa,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ju,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Tb,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ju,this.stencilZFail=ju,this.stencilZPass=ju,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==pa&&(n.blending=this.blending),this.side!==eo&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function i(o){const a=[];for(const c in o){const u=o[c];delete u.metadata,a.push(u)}return a}if(t){const o=i(e.textures),a=i(e.images);o.length>0&&(n.textures=o),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let o=0;o!==i;++o)n[o]=t[o].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class wi extends ti{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new $e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const _i=new X,ru=new De;class pn{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=Oc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)ru.fromBufferAttribute(this,t),ru.applyMatrix3(e),this.setXY(t,ru.x,ru.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)_i.fromBufferAttribute(this,t),_i.applyMatrix3(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)_i.fromBufferAttribute(this,t),_i.applyMatrix4(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)_i.fromBufferAttribute(this,t),_i.applyNormalMatrix(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)_i.fromBufferAttribute(this,t),_i.transformDirection(e),this.setXYZ(t,_i.x,_i.y,_i.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Jr(t,this.array)),t}setX(e,t){return this.normalized&&(t=An(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Jr(t,this.array)),t}setY(e,t){return this.normalized&&(t=An(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Jr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=An(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Jr(t,this.array)),t}setW(e,t){return this.normalized&&(t=An(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=An(t,this.array),n=An(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=An(t,this.array),n=An(n,this.array),i=An(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,o){return e*=this.itemSize,this.normalized&&(t=An(t,this.array),n=An(n,this.array),i=An(i,this.array),o=An(o,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Oc&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class yx extends pn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Cx extends pn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Mx extends pn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Ex extends pn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Bm extends pn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Sx extends pn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Um extends pn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Ax extends pn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}}class bt extends pn{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Px extends pn{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Tx=0;const Gs=new It,cf=new Jt,Xa=new X,Ps=new oo,vc=new oo,Oi=new X;class jt extends ro{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Tx++}),this.uuid=Rs(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(kb(e)?Um:Bm)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new Ms().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Gs.makeRotationFromQuaternion(e),this.applyMatrix4(Gs),this}rotateX(e){return Gs.makeRotationX(e),this.applyMatrix4(Gs),this}rotateY(e){return Gs.makeRotationY(e),this.applyMatrix4(Gs),this}rotateZ(e){return Gs.makeRotationZ(e),this.applyMatrix4(Gs),this}translate(e,t,n){return Gs.makeTranslation(e,t,n),this.applyMatrix4(Gs),this}scale(e,t,n){return Gs.makeScale(e,t,n),this.applyMatrix4(Gs),this}lookAt(e){return cf.lookAt(e),cf.updateMatrix(),this.applyMatrix4(cf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xa).negate(),this.translate(Xa.x,Xa.y,Xa.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new bt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new oo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new X(-1/0,-1/0,-1/0),new X(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const o=t[n];Ps.setFromBufferAttribute(o),this.morphTargetsRelative?(Oi.addVectors(this.boundingBox.min,Ps.min),this.boundingBox.expandByPoint(Oi),Oi.addVectors(this.boundingBox.max,Ps.max),this.boundingBox.expandByPoint(Oi)):(this.boundingBox.expandByPoint(Ps.min),this.boundingBox.expandByPoint(Ps.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ao);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new X,1/0);return}if(e){const n=this.boundingSphere.center;if(Ps.setFromBufferAttribute(e),t)for(let o=0,a=t.length;o<a;o++){const c=t[o];vc.setFromBufferAttribute(c),this.morphTargetsRelative?(Oi.addVectors(Ps.min,vc.min),Ps.expandByPoint(Oi),Oi.addVectors(Ps.max,vc.max),Ps.expandByPoint(Oi)):(Ps.expandByPoint(vc.min),Ps.expandByPoint(vc.max))}Ps.getCenter(n);let i=0;for(let o=0,a=e.count;o<a;o++)Oi.fromBufferAttribute(e,o),i=Math.max(i,n.distanceToSquared(Oi));if(t)for(let o=0,a=t.length;o<a;o++){const c=t[o],u=this.morphTargetsRelative;for(let d=0,v=c.count;d<v;d++)Oi.fromBufferAttribute(c,d),u&&(Xa.fromBufferAttribute(e,d),Oi.add(Xa)),i=Math.max(i,n.distanceToSquared(Oi))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,i=t.position.array,o=t.normal.array,a=t.uv.array,c=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new pn(new Float32Array(4*c),4));const u=this.getAttribute("tangent").array,d=[],v=[];for(let Z=0;Z<c;Z++)d[Z]=new X,v[Z]=new X;const g=new X,b=new X,y=new X,S=new De,E=new De,M=new De,L=new X,R=new X;function z(Z,se,we){g.fromArray(i,Z*3),b.fromArray(i,se*3),y.fromArray(i,we*3),S.fromArray(a,Z*2),E.fromArray(a,se*2),M.fromArray(a,we*2),b.sub(g),y.sub(g),E.sub(S),M.sub(S);const oe=1/(E.x*M.y-M.x*E.y);isFinite(oe)&&(L.copy(b).multiplyScalar(M.y).addScaledVector(y,-E.y).multiplyScalar(oe),R.copy(y).multiplyScalar(E.x).addScaledVector(b,-M.x).multiplyScalar(oe),d[Z].add(L),d[se].add(L),d[we].add(L),v[Z].add(R),v[se].add(R),v[we].add(R))}let V=this.groups;V.length===0&&(V=[{start:0,count:n.length}]);for(let Z=0,se=V.length;Z<se;++Z){const we=V[Z],oe=we.start,ne=we.count;for(let ce=oe,ve=oe+ne;ce<ve;ce+=3)z(n[ce+0],n[ce+1],n[ce+2])}const H=new X,B=new X,j=new X,F=new X;function W(Z){j.fromArray(o,Z*3),F.copy(j);const se=d[Z];H.copy(se),H.sub(j.multiplyScalar(j.dot(se))).normalize(),B.crossVectors(F,se);const oe=B.dot(v[Z])<0?-1:1;u[Z*4]=H.x,u[Z*4+1]=H.y,u[Z*4+2]=H.z,u[Z*4+3]=oe}for(let Z=0,se=V.length;Z<se;++Z){const we=V[Z],oe=we.start,ne=we.count;for(let ce=oe,ve=oe+ne;ce<ve;ce+=3)W(n[ce+0]),W(n[ce+1]),W(n[ce+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new pn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let b=0,y=n.count;b<y;b++)n.setXYZ(b,0,0,0);const i=new X,o=new X,a=new X,c=new X,u=new X,d=new X,v=new X,g=new X;if(e)for(let b=0,y=e.count;b<y;b+=3){const S=e.getX(b+0),E=e.getX(b+1),M=e.getX(b+2);i.fromBufferAttribute(t,S),o.fromBufferAttribute(t,E),a.fromBufferAttribute(t,M),v.subVectors(a,o),g.subVectors(i,o),v.cross(g),c.fromBufferAttribute(n,S),u.fromBufferAttribute(n,E),d.fromBufferAttribute(n,M),c.add(v),u.add(v),d.add(v),n.setXYZ(S,c.x,c.y,c.z),n.setXYZ(E,u.x,u.y,u.z),n.setXYZ(M,d.x,d.y,d.z)}else for(let b=0,y=t.count;b<y;b+=3)i.fromBufferAttribute(t,b+0),o.fromBufferAttribute(t,b+1),a.fromBufferAttribute(t,b+2),v.subVectors(a,o),g.subVectors(i,o),v.cross(g),n.setXYZ(b+0,v.x,v.y,v.z),n.setXYZ(b+1,v.x,v.y,v.z),n.setXYZ(b+2,v.x,v.y,v.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Oi.fromBufferAttribute(e,t),Oi.normalize(),e.setXYZ(t,Oi.x,Oi.y,Oi.z)}toNonIndexed(){function e(c,u){const d=c.array,v=c.itemSize,g=c.normalized,b=new d.constructor(u.length*v);let y=0,S=0;for(let E=0,M=u.length;E<M;E++){c.isInterleavedBufferAttribute?y=u[E]*c.data.stride+c.offset:y=u[E]*v;for(let L=0;L<v;L++)b[S++]=d[y++]}return new pn(b,v,g)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new jt,n=this.index.array,i=this.attributes;for(const c in i){const u=i[c],d=e(u,n);t.setAttribute(c,d)}const o=this.morphAttributes;for(const c in o){const u=[],d=o[c];for(let v=0,g=d.length;v<g;v++){const b=d[v],y=e(b,n);u.push(y)}t.morphAttributes[c]=u}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let c=0,u=a.length;c<u;c++){const d=a[c];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const d in u)u[d]!==void 0&&(e[d]=u[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const u in n){const d=n[u];e.data.attributes[u]=d.toJSON(e.data)}const i={};let o=!1;for(const u in this.morphAttributes){const d=this.morphAttributes[u],v=[];for(let g=0,b=d.length;g<b;g++){const y=d[g];v.push(y.toJSON(e.data))}v.length>0&&(i[u]=v,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const c=this.boundingSphere;return c!==null&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const i=e.attributes;for(const d in i){const v=i[d];this.setAttribute(d,v.clone(t))}const o=e.morphAttributes;for(const d in o){const v=[],g=o[d];for(let b=0,y=g.length;b<y;b++)v.push(g[b].clone(t));this.morphAttributes[d]=v}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let d=0,v=a.length;d<v;d++){const g=a[d];this.addGroup(g.start,g.count,g.materialIndex)}const c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());const u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const qv=new It,$a=new Zc,hf=new ao,Mo=new X,Eo=new X,So=new X,uf=new X,df=new X,pf=new X,ou=new X,au=new X,lu=new X,cu=new De,hu=new De,uu=new De,ff=new X,du=new X;class Bn extends Jt{constructor(e=new jt,t=new wi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=i.length;o<a;o++){const c=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=o}}}}raycast(e,t){const n=this.geometry,i=this.material,o=this.matrixWorld;if(i===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),hf.copy(n.boundingSphere),hf.applyMatrix4(o),e.ray.intersectsSphere(hf)===!1)||(qv.copy(o).invert(),$a.copy(e.ray).applyMatrix4(qv),n.boundingBox!==null&&$a.intersectsBox(n.boundingBox)===!1))return;let a;const c=n.index,u=n.attributes.position,d=n.morphAttributes.position,v=n.morphTargetsRelative,g=n.attributes.uv,b=n.attributes.uv2,y=n.groups,S=n.drawRange;if(c!==null)if(Array.isArray(i))for(let E=0,M=y.length;E<M;E++){const L=y[E],R=i[L.materialIndex],z=Math.max(L.start,S.start),V=Math.min(c.count,Math.min(L.start+L.count,S.start+S.count));for(let H=z,B=V;H<B;H+=3){const j=c.getX(H),F=c.getX(H+1),W=c.getX(H+2);a=pu(this,R,e,$a,u,d,v,g,b,j,F,W),a&&(a.faceIndex=Math.floor(H/3),a.face.materialIndex=L.materialIndex,t.push(a))}}else{const E=Math.max(0,S.start),M=Math.min(c.count,S.start+S.count);for(let L=E,R=M;L<R;L+=3){const z=c.getX(L),V=c.getX(L+1),H=c.getX(L+2);a=pu(this,i,e,$a,u,d,v,g,b,z,V,H),a&&(a.faceIndex=Math.floor(L/3),t.push(a))}}else if(u!==void 0)if(Array.isArray(i))for(let E=0,M=y.length;E<M;E++){const L=y[E],R=i[L.materialIndex],z=Math.max(L.start,S.start),V=Math.min(u.count,Math.min(L.start+L.count,S.start+S.count));for(let H=z,B=V;H<B;H+=3){const j=H,F=H+1,W=H+2;a=pu(this,R,e,$a,u,d,v,g,b,j,F,W),a&&(a.faceIndex=Math.floor(H/3),a.face.materialIndex=L.materialIndex,t.push(a))}}else{const E=Math.max(0,S.start),M=Math.min(u.count,S.start+S.count);for(let L=E,R=M;L<R;L+=3){const z=L,V=L+1,H=L+2;a=pu(this,i,e,$a,u,d,v,g,b,z,V,H),a&&(a.faceIndex=Math.floor(L/3),t.push(a))}}}}function Lx(h,e,t,n,i,o,a,c){let u;if(e.side===ks?u=n.intersectTriangle(a,o,i,!0,c):u=n.intersectTriangle(i,o,a,e.side!==qs,c),u===null)return null;du.copy(c),du.applyMatrix4(h.matrixWorld);const d=t.ray.origin.distanceTo(du);return d<t.near||d>t.far?null:{distance:d,point:du.clone(),object:h}}function pu(h,e,t,n,i,o,a,c,u,d,v,g){Mo.fromBufferAttribute(i,d),Eo.fromBufferAttribute(i,v),So.fromBufferAttribute(i,g);const b=h.morphTargetInfluences;if(o&&b){ou.set(0,0,0),au.set(0,0,0),lu.set(0,0,0);for(let S=0,E=o.length;S<E;S++){const M=b[S],L=o[S];M!==0&&(uf.fromBufferAttribute(L,d),df.fromBufferAttribute(L,v),pf.fromBufferAttribute(L,g),a?(ou.addScaledVector(uf,M),au.addScaledVector(df,M),lu.addScaledVector(pf,M)):(ou.addScaledVector(uf.sub(Mo),M),au.addScaledVector(df.sub(Eo),M),lu.addScaledVector(pf.sub(So),M)))}Mo.add(ou),Eo.add(au),So.add(lu)}h.isSkinnedMesh&&(h.boneTransform(d,Mo),h.boneTransform(v,Eo),h.boneTransform(g,So));const y=Lx(h,e,t,n,Mo,Eo,So,ff);if(y){c&&(cu.fromBufferAttribute(c,d),hu.fromBufferAttribute(c,v),uu.fromBufferAttribute(c,g),y.uv=Ks.getUV(ff,Mo,Eo,So,cu,hu,uu,new De)),u&&(cu.fromBufferAttribute(u,d),hu.fromBufferAttribute(u,v),uu.fromBufferAttribute(u,g),y.uv2=Ks.getUV(ff,Mo,Eo,So,cu,hu,uu,new De));const S={a:d,b:v,c:g,normal:new X,materialIndex:0};Ks.getNormal(Mo,Eo,So,S.normal),y.face=S}return y}class lo extends jt{constructor(e=1,t=1,n=1,i=1,o=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:o,depthSegments:a};const c=this;i=Math.floor(i),o=Math.floor(o),a=Math.floor(a);const u=[],d=[],v=[],g=[];let b=0,y=0;S("z","y","x",-1,-1,n,t,e,a,o,0),S("z","y","x",1,-1,n,t,-e,a,o,1),S("x","z","y",1,1,e,n,t,i,a,2),S("x","z","y",1,-1,e,n,-t,i,a,3),S("x","y","z",1,-1,e,t,n,i,o,4),S("x","y","z",-1,-1,e,t,-n,i,o,5),this.setIndex(u),this.setAttribute("position",new bt(d,3)),this.setAttribute("normal",new bt(v,3)),this.setAttribute("uv",new bt(g,2));function S(E,M,L,R,z,V,H,B,j,F,W){const Z=V/j,se=H/F,we=V/2,oe=H/2,ne=B/2,ce=j+1,ve=F+1;let de=0,he=0;const ue=new X;for(let me=0;me<ve;me++){const ze=me*se-oe;for(let Te=0;Te<ce;Te++){const Re=Te*Z-we;ue[E]=Re*R,ue[M]=ze*z,ue[L]=ne,d.push(ue.x,ue.y,ue.z),ue[E]=0,ue[M]=0,ue[L]=B>0?1:-1,v.push(ue.x,ue.y,ue.z),g.push(Te/j),g.push(1-me/F),de+=1}}for(let me=0;me<F;me++)for(let ze=0;ze<j;ze++){const Te=b+ze+ce*me,Re=b+ze+ce*(me+1),Ie=b+(ze+1)+ce*(me+1),rt=b+(ze+1)+ce*me;u.push(Te,Re,rt),u.push(Re,Ie,rt),he+=6}c.addGroup(y,he,W),y+=he,b+=de}}static fromJSON(e){return new lo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function fl(h){const e={};for(const t in h){e[t]={};for(const n in h[t]){const i=h[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function ns(h){const e={};for(let t=0;t<h.length;t++){const n=fl(h[t]);for(const i in n)e[i]=n[i]}return e}function kx(h){const e=[];for(let t=0;t<h.length;t++)e.push(h[t].clone());return e}const Ib={clone:fl,merge:ns};var Rx=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Ix=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ds extends ti{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Rx,this.fragmentShader=Ix,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=fl(e.uniforms),this.uniformsGroups=kx(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class dd extends Jt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new It,this.projectionMatrix=new It,this.projectionMatrixInverse=new It}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Ri extends dd{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Fc*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(ma*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Fc*2*Math.atan(Math.tan(ma*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,o,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(ma*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,o=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const u=a.fullWidth,d=a.fullHeight;o+=a.offsetX*i/u,t-=a.offsetY*n/d,i*=a.width/u,n*=a.height/d}const c=this.filmOffset;c!==0&&(o+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ya=90,Za=1;class Db extends Jt{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const i=new Ri(Ya,Za,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new X(1,0,0)),this.add(i);const o=new Ri(Ya,Za,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new X(-1,0,0)),this.add(o);const a=new Ri(Ya,Za,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new X(0,1,0)),this.add(a);const c=new Ri(Ya,Za,e,t);c.layers=this.layers,c.up.set(0,0,-1),c.lookAt(new X(0,-1,0)),this.add(c);const u=new Ri(Ya,Za,e,t);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new X(0,0,1)),this.add(u);const d=new Ri(Ya,Za,e,t);d.layers=this.layers,d.up.set(0,-1,0),d.lookAt(new X(0,0,-1)),this.add(d)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[i,o,a,c,u,d]=this.children,v=e.getRenderTarget(),g=e.toneMapping,b=e.xr.enabled;e.toneMapping=Lr,e.xr.enabled=!1;const y=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,o),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,c),e.setRenderTarget(n,4),e.render(t,u),n.texture.generateMipmaps=y,e.setRenderTarget(n,5),e.render(t,d),e.setRenderTarget(v),e.toneMapping=g,e.xr.enabled=b,n.texture.needsPMREMUpdate=!0}}class Jc extends Kn{constructor(e,t,n,i,o,a,c,u,d,v){e=e!==void 0?e:[],t=t!==void 0?t:No,super(e,t,n,i,o,a,c,u,d,v),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class zb extends $s{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new Jc(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ln}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new lo(5,5,5),o=new Ds({name:"CubemapFromEquirect",uniforms:fl(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:ks,blending:Qr});o.uniforms.tEquirect.value=t;const a=new Bn(i,o),c=t.minFilter;return t.minFilter===gr&&(t.minFilter=Ln),new Db(1,10,this).update(e,a),t.minFilter=c,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,i){const o=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(o)}}const mf=new X,Dx=new X,zx=new Ms;class $r{constructor(e=new X(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=mf.subVectors(n,t).cross(Dx.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(mf),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(n).multiplyScalar(o).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||zx.getNormalMatrix(e),i=this.coplanarPoint(mf).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ja=new ao,fu=new X;class pd{constructor(e=new $r,t=new $r,n=new $r,i=new $r,o=new $r,a=new $r){this.planes=[e,t,n,i,o,a]}set(e,t,n,i,o,a){const c=this.planes;return c[0].copy(e),c[1].copy(t),c[2].copy(n),c[3].copy(i),c[4].copy(o),c[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],o=n[1],a=n[2],c=n[3],u=n[4],d=n[5],v=n[6],g=n[7],b=n[8],y=n[9],S=n[10],E=n[11],M=n[12],L=n[13],R=n[14],z=n[15];return t[0].setComponents(c-i,g-u,E-b,z-M).normalize(),t[1].setComponents(c+i,g+u,E+b,z+M).normalize(),t[2].setComponents(c+o,g+d,E+y,z+L).normalize(),t[3].setComponents(c-o,g-d,E-y,z-L).normalize(),t[4].setComponents(c-a,g-v,E-S,z-R).normalize(),t[5].setComponents(c+a,g+v,E+S,z+R).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Ja.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ja)}intersectsSprite(e){return Ja.center.set(0,0,0),Ja.radius=.7071067811865476,Ja.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ja)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(fu.x=i.normal.x>0?e.max.x:e.min.x,fu.y=i.normal.y>0?e.max.y:e.min.y,fu.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(fu)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Vb(){let h=null,e=!1,t=null,n=null;function i(o,a){t(o,a),n=h.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=h.requestAnimationFrame(i),e=!0)},stop:function(){h.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){h=o}}}function Vx(h,e){const t=e.isWebGL2,n=new WeakMap;function i(d,v){const g=d.array,b=d.usage,y=h.createBuffer();h.bindBuffer(v,y),h.bufferData(v,g,b),d.onUploadCallback();let S;if(g instanceof Float32Array)S=5126;else if(g instanceof Uint16Array)if(d.isFloat16BufferAttribute)if(t)S=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else S=5123;else if(g instanceof Int16Array)S=5122;else if(g instanceof Uint32Array)S=5125;else if(g instanceof Int32Array)S=5124;else if(g instanceof Int8Array)S=5120;else if(g instanceof Uint8Array)S=5121;else if(g instanceof Uint8ClampedArray)S=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+g);return{buffer:y,type:S,bytesPerElement:g.BYTES_PER_ELEMENT,version:d.version}}function o(d,v,g){const b=v.array,y=v.updateRange;h.bindBuffer(g,d),y.count===-1?h.bufferSubData(g,0,b):(t?h.bufferSubData(g,y.offset*b.BYTES_PER_ELEMENT,b,y.offset,y.count):h.bufferSubData(g,y.offset*b.BYTES_PER_ELEMENT,b.subarray(y.offset,y.offset+y.count)),y.count=-1)}function a(d){return d.isInterleavedBufferAttribute&&(d=d.data),n.get(d)}function c(d){d.isInterleavedBufferAttribute&&(d=d.data);const v=n.get(d);v&&(h.deleteBuffer(v.buffer),n.delete(d))}function u(d,v){if(d.isGLBufferAttribute){const b=n.get(d);(!b||b.version<d.version)&&n.set(d,{buffer:d.buffer,type:d.type,bytesPerElement:d.elementSize,version:d.version});return}d.isInterleavedBufferAttribute&&(d=d.data);const g=n.get(d);g===void 0?n.set(d,i(d,v)):g.version<d.version&&(o(g.buffer,d,v),g.version=d.version)}return{get:a,remove:c,update:u}}class co extends jt{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const o=e/2,a=t/2,c=Math.floor(n),u=Math.floor(i),d=c+1,v=u+1,g=e/c,b=t/u,y=[],S=[],E=[],M=[];for(let L=0;L<v;L++){const R=L*b-a;for(let z=0;z<d;z++){const V=z*g-o;S.push(V,-R,0),E.push(0,0,1),M.push(z/c),M.push(1-L/u)}}for(let L=0;L<u;L++)for(let R=0;R<c;R++){const z=R+d*L,V=R+d*(L+1),H=R+1+d*(L+1),B=R+1+d*L;y.push(z,V,B),y.push(V,H,B)}this.setIndex(y),this.setAttribute("position",new bt(S,3)),this.setAttribute("normal",new bt(E,3)),this.setAttribute("uv",new bt(M,2))}static fromJSON(e){return new co(e.width,e.height,e.widthSegments,e.heightSegments)}}var Nx=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Ox=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Fx=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Bx=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Ux=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Hx=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Gx="vec3 transformed = vec3( position );",Wx=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,jx=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Kx=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,qx=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Xx=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,$x=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Yx=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Zx=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Jx=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Qx=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,ey=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,ty=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,ny=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,iy=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,sy=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,ry=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,oy=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,ay=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,ly=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,cy="gl_FragColor = linearToOutputTexel( gl_FragColor );",hy=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,uy=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,dy=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,py=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,fy=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,my=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,vy=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,gy=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,_y=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,by=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,wy=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,xy=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,yy=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Cy=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,My=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,Ey=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Sy=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Ay=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Py=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,Ty=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Ly=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,ky=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Ry=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Iy=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Dy=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,zy=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Vy=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Ny=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Oy=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Fy=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,By=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Uy=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Hy=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Gy=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Wy=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,jy=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Ky=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,qy=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Xy=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,$y=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Yy=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Zy=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Jy=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Qy=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,eC=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,tC=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,nC=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,iC=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,sC=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,rC=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,oC=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,aC=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,lC=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,cC=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,hC=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,uC=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,dC=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,pC=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,fC=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,mC=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,vC=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,gC=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,_C=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,bC=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,wC=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,xC=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,yC=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,CC=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,MC=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,EC=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,SC=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,AC=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,PC=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,TC=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,LC=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,kC=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,RC=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,IC=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,DC=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const zC=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,VC=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,NC=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,OC=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,FC=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,BC=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,UC=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,HC=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,GC=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,WC=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,jC=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,KC=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,qC=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,XC=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$C=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,YC=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ZC=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,JC=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QC=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,e1=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,t1=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,n1=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,i1=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,s1=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,r1=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,o1=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,a1=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,l1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,c1=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,h1=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,u1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,d1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Tt={alphamap_fragment:Nx,alphamap_pars_fragment:Ox,alphatest_fragment:Fx,alphatest_pars_fragment:Bx,aomap_fragment:Ux,aomap_pars_fragment:Hx,begin_vertex:Gx,beginnormal_vertex:Wx,bsdfs:jx,iridescence_fragment:Kx,bumpmap_pars_fragment:qx,clipping_planes_fragment:Xx,clipping_planes_pars_fragment:$x,clipping_planes_pars_vertex:Yx,clipping_planes_vertex:Zx,color_fragment:Jx,color_pars_fragment:Qx,color_pars_vertex:ey,color_vertex:ty,common:ny,cube_uv_reflection_fragment:iy,defaultnormal_vertex:sy,displacementmap_pars_vertex:ry,displacementmap_vertex:oy,emissivemap_fragment:ay,emissivemap_pars_fragment:ly,encodings_fragment:cy,encodings_pars_fragment:hy,envmap_fragment:uy,envmap_common_pars_fragment:dy,envmap_pars_fragment:py,envmap_pars_vertex:fy,envmap_physical_pars_fragment:Sy,envmap_vertex:my,fog_vertex:vy,fog_pars_vertex:gy,fog_fragment:_y,fog_pars_fragment:by,gradientmap_pars_fragment:wy,lightmap_fragment:xy,lightmap_pars_fragment:yy,lights_lambert_fragment:Cy,lights_lambert_pars_fragment:My,lights_pars_begin:Ey,lights_toon_fragment:Ay,lights_toon_pars_fragment:Py,lights_phong_fragment:Ty,lights_phong_pars_fragment:Ly,lights_physical_fragment:ky,lights_physical_pars_fragment:Ry,lights_fragment_begin:Iy,lights_fragment_maps:Dy,lights_fragment_end:zy,logdepthbuf_fragment:Vy,logdepthbuf_pars_fragment:Ny,logdepthbuf_pars_vertex:Oy,logdepthbuf_vertex:Fy,map_fragment:By,map_pars_fragment:Uy,map_particle_fragment:Hy,map_particle_pars_fragment:Gy,metalnessmap_fragment:Wy,metalnessmap_pars_fragment:jy,morphcolor_vertex:Ky,morphnormal_vertex:qy,morphtarget_pars_vertex:Xy,morphtarget_vertex:$y,normal_fragment_begin:Yy,normal_fragment_maps:Zy,normal_pars_fragment:Jy,normal_pars_vertex:Qy,normal_vertex:eC,normalmap_pars_fragment:tC,clearcoat_normal_fragment_begin:nC,clearcoat_normal_fragment_maps:iC,clearcoat_pars_fragment:sC,iridescence_pars_fragment:rC,output_fragment:oC,packing:aC,premultiplied_alpha_fragment:lC,project_vertex:cC,dithering_fragment:hC,dithering_pars_fragment:uC,roughnessmap_fragment:dC,roughnessmap_pars_fragment:pC,shadowmap_pars_fragment:fC,shadowmap_pars_vertex:mC,shadowmap_vertex:vC,shadowmask_pars_fragment:gC,skinbase_vertex:_C,skinning_pars_vertex:bC,skinning_vertex:wC,skinnormal_vertex:xC,specularmap_fragment:yC,specularmap_pars_fragment:CC,tonemapping_fragment:MC,tonemapping_pars_fragment:EC,transmission_fragment:SC,transmission_pars_fragment:AC,uv_pars_fragment:PC,uv_pars_vertex:TC,uv_vertex:LC,uv2_pars_fragment:kC,uv2_pars_vertex:RC,uv2_vertex:IC,worldpos_vertex:DC,background_vert:zC,background_frag:VC,cube_vert:NC,cube_frag:OC,depth_vert:FC,depth_frag:BC,distanceRGBA_vert:UC,distanceRGBA_frag:HC,equirect_vert:GC,equirect_frag:WC,linedashed_vert:jC,linedashed_frag:KC,meshbasic_vert:qC,meshbasic_frag:XC,meshlambert_vert:$C,meshlambert_frag:YC,meshmatcap_vert:ZC,meshmatcap_frag:JC,meshnormal_vert:QC,meshnormal_frag:e1,meshphong_vert:t1,meshphong_frag:n1,meshphysical_vert:i1,meshphysical_frag:s1,meshtoon_vert:r1,meshtoon_frag:o1,points_vert:a1,points_frag:l1,shadow_vert:c1,shadow_frag:h1,sprite_vert:u1,sprite_frag:d1},tt={common:{diffuse:{value:new $e(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ms},uv2Transform:{value:new Ms},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new De(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $e(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $e(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ms}},sprite:{diffuse:{value:new $e(16777215)},opacity:{value:1},center:{value:new De(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ms}}},fr={basic:{uniforms:ns([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.fog]),vertexShader:Tt.meshbasic_vert,fragmentShader:Tt.meshbasic_frag},lambert:{uniforms:ns([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new $e(0)}}]),vertexShader:Tt.meshlambert_vert,fragmentShader:Tt.meshlambert_frag},phong:{uniforms:ns([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new $e(0)},specular:{value:new $e(1118481)},shininess:{value:30}}]),vertexShader:Tt.meshphong_vert,fragmentShader:Tt.meshphong_frag},standard:{uniforms:ns([tt.common,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.roughnessmap,tt.metalnessmap,tt.fog,tt.lights,{emissive:{value:new $e(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Tt.meshphysical_vert,fragmentShader:Tt.meshphysical_frag},toon:{uniforms:ns([tt.common,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.gradientmap,tt.fog,tt.lights,{emissive:{value:new $e(0)}}]),vertexShader:Tt.meshtoon_vert,fragmentShader:Tt.meshtoon_frag},matcap:{uniforms:ns([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,{matcap:{value:null}}]),vertexShader:Tt.meshmatcap_vert,fragmentShader:Tt.meshmatcap_frag},points:{uniforms:ns([tt.points,tt.fog]),vertexShader:Tt.points_vert,fragmentShader:Tt.points_frag},dashed:{uniforms:ns([tt.common,tt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Tt.linedashed_vert,fragmentShader:Tt.linedashed_frag},depth:{uniforms:ns([tt.common,tt.displacementmap]),vertexShader:Tt.depth_vert,fragmentShader:Tt.depth_frag},normal:{uniforms:ns([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,{opacity:{value:1}}]),vertexShader:Tt.meshnormal_vert,fragmentShader:Tt.meshnormal_frag},sprite:{uniforms:ns([tt.sprite,tt.fog]),vertexShader:Tt.sprite_vert,fragmentShader:Tt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ms},t2D:{value:null}},vertexShader:Tt.background_vert,fragmentShader:Tt.background_frag},cube:{uniforms:ns([tt.envmap,{opacity:{value:1}}]),vertexShader:Tt.cube_vert,fragmentShader:Tt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Tt.equirect_vert,fragmentShader:Tt.equirect_frag},distanceRGBA:{uniforms:ns([tt.common,tt.displacementmap,{referencePosition:{value:new X},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Tt.distanceRGBA_vert,fragmentShader:Tt.distanceRGBA_frag},shadow:{uniforms:ns([tt.lights,tt.fog,{color:{value:new $e(0)},opacity:{value:1}}]),vertexShader:Tt.shadow_vert,fragmentShader:Tt.shadow_frag}};fr.physical={uniforms:ns([fr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new De(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new $e(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new De},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new $e(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new $e(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Tt.meshphysical_vert,fragmentShader:Tt.meshphysical_frag};function p1(h,e,t,n,i,o){const a=new $e(0);let c=i===!0?0:1,u,d,v=null,g=0,b=null;function y(E,M){let L=!1,R=M.isScene===!0?M.background:null;R&&R.isTexture&&(R=e.get(R));const z=h.xr,V=z.getSession&&z.getSession();V&&V.environmentBlendMode==="additive"&&(R=null),R===null?S(a,c):R&&R.isColor&&(S(R,1),L=!0),(h.autoClear||L)&&h.clear(h.autoClearColor,h.autoClearDepth,h.autoClearStencil),R&&(R.isCubeTexture||R.mapping===gl)?(d===void 0&&(d=new Bn(new lo(1,1,1),new Ds({name:"BackgroundCubeMaterial",uniforms:fl(fr.cube.uniforms),vertexShader:fr.cube.vertexShader,fragmentShader:fr.cube.fragmentShader,side:ks,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(H,B,j){this.matrixWorld.copyPosition(j.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(d)),d.material.uniforms.envMap.value=R,d.material.uniforms.flipEnvMap.value=R.isCubeTexture&&R.isRenderTargetTexture===!1?-1:1,(v!==R||g!==R.version||b!==h.toneMapping)&&(d.material.needsUpdate=!0,v=R,g=R.version,b=h.toneMapping),d.layers.enableAll(),E.unshift(d,d.geometry,d.material,0,0,null)):R&&R.isTexture&&(u===void 0&&(u=new Bn(new co(2,2),new Ds({name:"BackgroundMaterial",uniforms:fl(fr.background.uniforms),vertexShader:fr.background.vertexShader,fragmentShader:fr.background.fragmentShader,side:eo,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(u)),u.material.uniforms.t2D.value=R,R.matrixAutoUpdate===!0&&R.updateMatrix(),u.material.uniforms.uvTransform.value.copy(R.matrix),(v!==R||g!==R.version||b!==h.toneMapping)&&(u.material.needsUpdate=!0,v=R,g=R.version,b=h.toneMapping),u.layers.enableAll(),E.unshift(u,u.geometry,u.material,0,0,null))}function S(E,M){t.buffers.color.setClear(E.r,E.g,E.b,M,o)}return{getClearColor:function(){return a},setClearColor:function(E,M=1){a.set(E),c=M,S(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(E){c=E,S(a,c)},render:y}}function f1(h,e,t,n){const i=h.getParameter(34921),o=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||o!==null,c={},u=M(null);let d=u,v=!1;function g(ne,ce,ve,de,he){let ue=!1;if(a){const me=E(de,ve,ce);d!==me&&(d=me,y(d.object)),ue=L(ne,de,ve,he),ue&&R(ne,de,ve,he)}else{const me=ce.wireframe===!0;(d.geometry!==de.id||d.program!==ve.id||d.wireframe!==me)&&(d.geometry=de.id,d.program=ve.id,d.wireframe=me,ue=!0)}he!==null&&t.update(he,34963),(ue||v)&&(v=!1,F(ne,ce,ve,de),he!==null&&h.bindBuffer(34963,t.get(he).buffer))}function b(){return n.isWebGL2?h.createVertexArray():o.createVertexArrayOES()}function y(ne){return n.isWebGL2?h.bindVertexArray(ne):o.bindVertexArrayOES(ne)}function S(ne){return n.isWebGL2?h.deleteVertexArray(ne):o.deleteVertexArrayOES(ne)}function E(ne,ce,ve){const de=ve.wireframe===!0;let he=c[ne.id];he===void 0&&(he={},c[ne.id]=he);let ue=he[ce.id];ue===void 0&&(ue={},he[ce.id]=ue);let me=ue[de];return me===void 0&&(me=M(b()),ue[de]=me),me}function M(ne){const ce=[],ve=[],de=[];for(let he=0;he<i;he++)ce[he]=0,ve[he]=0,de[he]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ce,enabledAttributes:ve,attributeDivisors:de,object:ne,attributes:{},index:null}}function L(ne,ce,ve,de){const he=d.attributes,ue=ce.attributes;let me=0;const ze=ve.getAttributes();for(const Te in ze)if(ze[Te].location>=0){const Ie=he[Te];let rt=ue[Te];if(rt===void 0&&(Te==="instanceMatrix"&&ne.instanceMatrix&&(rt=ne.instanceMatrix),Te==="instanceColor"&&ne.instanceColor&&(rt=ne.instanceColor)),Ie===void 0||Ie.attribute!==rt||rt&&Ie.data!==rt.data)return!0;me++}return d.attributesNum!==me||d.index!==de}function R(ne,ce,ve,de){const he={},ue=ce.attributes;let me=0;const ze=ve.getAttributes();for(const Te in ze)if(ze[Te].location>=0){let Ie=ue[Te];Ie===void 0&&(Te==="instanceMatrix"&&ne.instanceMatrix&&(Ie=ne.instanceMatrix),Te==="instanceColor"&&ne.instanceColor&&(Ie=ne.instanceColor));const rt={};rt.attribute=Ie,Ie&&Ie.data&&(rt.data=Ie.data),he[Te]=rt,me++}d.attributes=he,d.attributesNum=me,d.index=de}function z(){const ne=d.newAttributes;for(let ce=0,ve=ne.length;ce<ve;ce++)ne[ce]=0}function V(ne){H(ne,0)}function H(ne,ce){const ve=d.newAttributes,de=d.enabledAttributes,he=d.attributeDivisors;ve[ne]=1,de[ne]===0&&(h.enableVertexAttribArray(ne),de[ne]=1),he[ne]!==ce&&((n.isWebGL2?h:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ne,ce),he[ne]=ce)}function B(){const ne=d.newAttributes,ce=d.enabledAttributes;for(let ve=0,de=ce.length;ve<de;ve++)ce[ve]!==ne[ve]&&(h.disableVertexAttribArray(ve),ce[ve]=0)}function j(ne,ce,ve,de,he,ue){n.isWebGL2===!0&&(ve===5124||ve===5125)?h.vertexAttribIPointer(ne,ce,ve,he,ue):h.vertexAttribPointer(ne,ce,ve,de,he,ue)}function F(ne,ce,ve,de){if(n.isWebGL2===!1&&(ne.isInstancedMesh||de.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;z();const he=de.attributes,ue=ve.getAttributes(),me=ce.defaultAttributeValues;for(const ze in ue){const Te=ue[ze];if(Te.location>=0){let Re=he[ze];if(Re===void 0&&(ze==="instanceMatrix"&&ne.instanceMatrix&&(Re=ne.instanceMatrix),ze==="instanceColor"&&ne.instanceColor&&(Re=ne.instanceColor)),Re!==void 0){const Ie=Re.normalized,rt=Re.itemSize,Ae=t.get(Re);if(Ae===void 0)continue;const pt=Ae.buffer,nt=Ae.type,Et=Ae.bytesPerElement;if(Re.isInterleavedBufferAttribute){const He=Re.data,mt=He.stride,ke=Re.offset;if(He.isInstancedInterleavedBuffer){for(let xe=0;xe<Te.locationSize;xe++)H(Te.location+xe,He.meshPerAttribute);ne.isInstancedMesh!==!0&&de._maxInstanceCount===void 0&&(de._maxInstanceCount=He.meshPerAttribute*He.count)}else for(let xe=0;xe<Te.locationSize;xe++)V(Te.location+xe);h.bindBuffer(34962,pt);for(let xe=0;xe<Te.locationSize;xe++)j(Te.location+xe,rt/Te.locationSize,nt,Ie,mt*Et,(ke+rt/Te.locationSize*xe)*Et)}else{if(Re.isInstancedBufferAttribute){for(let He=0;He<Te.locationSize;He++)H(Te.location+He,Re.meshPerAttribute);ne.isInstancedMesh!==!0&&de._maxInstanceCount===void 0&&(de._maxInstanceCount=Re.meshPerAttribute*Re.count)}else for(let He=0;He<Te.locationSize;He++)V(Te.location+He);h.bindBuffer(34962,pt);for(let He=0;He<Te.locationSize;He++)j(Te.location+He,rt/Te.locationSize,nt,Ie,rt*Et,rt/Te.locationSize*He*Et)}}else if(me!==void 0){const Ie=me[ze];if(Ie!==void 0)switch(Ie.length){case 2:h.vertexAttrib2fv(Te.location,Ie);break;case 3:h.vertexAttrib3fv(Te.location,Ie);break;case 4:h.vertexAttrib4fv(Te.location,Ie);break;default:h.vertexAttrib1fv(Te.location,Ie)}}}}B()}function W(){we();for(const ne in c){const ce=c[ne];for(const ve in ce){const de=ce[ve];for(const he in de)S(de[he].object),delete de[he];delete ce[ve]}delete c[ne]}}function Z(ne){if(c[ne.id]===void 0)return;const ce=c[ne.id];for(const ve in ce){const de=ce[ve];for(const he in de)S(de[he].object),delete de[he];delete ce[ve]}delete c[ne.id]}function se(ne){for(const ce in c){const ve=c[ce];if(ve[ne.id]===void 0)continue;const de=ve[ne.id];for(const he in de)S(de[he].object),delete de[he];delete ve[ne.id]}}function we(){oe(),v=!0,d!==u&&(d=u,y(d.object))}function oe(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:g,reset:we,resetDefaultState:oe,dispose:W,releaseStatesOfGeometry:Z,releaseStatesOfProgram:se,initAttributes:z,enableAttribute:V,disableUnusedAttributes:B}}function m1(h,e,t,n){const i=n.isWebGL2;let o;function a(d){o=d}function c(d,v){h.drawArrays(o,d,v),t.update(v,o,1)}function u(d,v,g){if(g===0)return;let b,y;if(i)b=h,y="drawArraysInstanced";else if(b=e.get("ANGLE_instanced_arrays"),y="drawArraysInstancedANGLE",b===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}b[y](o,d,v,g),t.update(v,o,g)}this.setMode=a,this.render=c,this.renderInstances=u}function v1(h,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const j=e.get("EXT_texture_filter_anisotropic");n=h.getParameter(j.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function o(j){if(j==="highp"){if(h.getShaderPrecisionFormat(35633,36338).precision>0&&h.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";j="mediump"}return j==="mediump"&&h.getShaderPrecisionFormat(35633,36337).precision>0&&h.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&h instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&h instanceof WebGL2ComputeRenderingContext;let c=t.precision!==void 0?t.precision:"highp";const u=o(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const d=a||e.has("WEBGL_draw_buffers"),v=t.logarithmicDepthBuffer===!0,g=h.getParameter(34930),b=h.getParameter(35660),y=h.getParameter(3379),S=h.getParameter(34076),E=h.getParameter(34921),M=h.getParameter(36347),L=h.getParameter(36348),R=h.getParameter(36349),z=b>0,V=a||e.has("OES_texture_float"),H=z&&V,B=a?h.getParameter(36183):0;return{isWebGL2:a,drawBuffers:d,getMaxAnisotropy:i,getMaxPrecision:o,precision:c,logarithmicDepthBuffer:v,maxTextures:g,maxVertexTextures:b,maxTextureSize:y,maxCubemapSize:S,maxAttributes:E,maxVertexUniforms:M,maxVaryings:L,maxFragmentUniforms:R,vertexTextures:z,floatFragmentTextures:V,floatVertexTextures:H,maxSamples:B}}function g1(h){const e=this;let t=null,n=0,i=!1,o=!1;const a=new $r,c=new Ms,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(g,b,y){const S=g.length!==0||b||n!==0||i;return i=b,t=v(g,y,0),n=g.length,S},this.beginShadows=function(){o=!0,v(null)},this.endShadows=function(){o=!1,d()},this.setState=function(g,b,y){const S=g.clippingPlanes,E=g.clipIntersection,M=g.clipShadows,L=h.get(g);if(!i||S===null||S.length===0||o&&!M)o?v(null):d();else{const R=o?0:n,z=R*4;let V=L.clippingState||null;u.value=V,V=v(S,b,z,y);for(let H=0;H!==z;++H)V[H]=t[H];L.clippingState=V,this.numIntersection=E?this.numPlanes:0,this.numPlanes+=R}};function d(){u.value!==t&&(u.value=t,u.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function v(g,b,y,S){const E=g!==null?g.length:0;let M=null;if(E!==0){if(M=u.value,S!==!0||M===null){const L=y+E*4,R=b.matrixWorldInverse;c.getNormalMatrix(R),(M===null||M.length<L)&&(M=new Float32Array(L));for(let z=0,V=y;z!==E;++z,V+=4)a.copy(g[z]).applyMatrix4(R,c),a.normal.toArray(M,V),M[V+3]=a.constant}u.value=M,u.needsUpdate=!0}return e.numPlanes=E,e.numIntersection=0,M}}function _1(h){let e=new WeakMap;function t(a,c){return c===zc?a.mapping=No:c===Vc&&(a.mapping=Oo),a}function n(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const c=a.mapping;if(c===zc||c===Vc)if(e.has(a)){const u=e.get(a).texture;return t(u,a.mapping)}else{const u=a.image;if(u&&u.height>0){const d=new zb(u.height/2);return d.fromEquirectangularTexture(h,a),e.set(a,d),a.addEventListener("dispose",i),t(d.texture,a.mapping)}else return null}}return a}function i(a){const c=a.target;c.removeEventListener("dispose",i);const u=e.get(c);u!==void 0&&(e.delete(c),u.dispose())}function o(){e=new WeakMap}return{get:n,dispose:o}}class Ea extends dd{constructor(e=-1,t=1,n=1,i=-1,o=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=o,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,o,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=n-e,a=n+e,c=i+t,u=i-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,v=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=d*this.view.offsetX,a=o+d*this.view.width,c-=v*this.view.offsetY,u=c-v*this.view.height}this.projectionMatrix.makeOrthographic(o,a,c,u,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const ol=4,Xv=[.125,.215,.35,.446,.526,.582],aa=20,vf=new Ea,$v=new $e;let gf=null;const sa=(1+Math.sqrt(5))/2,Qa=1/sa,Yv=[new X(1,1,1),new X(-1,1,1),new X(1,1,-1),new X(-1,1,-1),new X(0,sa,Qa),new X(0,sa,-Qa),new X(Qa,0,sa),new X(-Qa,0,sa),new X(sa,Qa,0),new X(-sa,Qa,0)];class um{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){gf=this._renderer.getRenderTarget(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,i,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Qv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Jv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(gf),e.scissorTest=!1,mu(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===No||e.mapping===Oo?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),gf=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Ln,minFilter:Ln,generateMipmaps:!1,type:dl,format:Xs,encoding:Bo,depthBuffer:!1},i=Zv(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Zv(e,t,n);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=b1(o)),this._blurMaterial=w1(o,e,t)}return i}_compileMaterial(e){const t=new Bn(this._lodPlanes[0],e);this._renderer.compile(t,vf)}_sceneToCubeUV(e,t,n,i){const c=new Ri(90,1,t,n),u=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],v=this._renderer,g=v.autoClear,b=v.toneMapping;v.getClearColor($v),v.toneMapping=Lr,v.autoClear=!1;const y=new wi({name:"PMREM.Background",side:ks,depthWrite:!1,depthTest:!1}),S=new Bn(new lo,y);let E=!1;const M=e.background;M?M.isColor&&(y.color.copy(M),e.background=null,E=!0):(y.color.copy($v),E=!0);for(let L=0;L<6;L++){const R=L%3;R===0?(c.up.set(0,u[L],0),c.lookAt(d[L],0,0)):R===1?(c.up.set(0,0,u[L]),c.lookAt(0,d[L],0)):(c.up.set(0,u[L],0),c.lookAt(0,0,d[L]));const z=this._cubeSize;mu(i,R*z,L>2?z:0,z,z),v.setRenderTarget(i),E&&v.render(S,c),v.render(e,c)}S.geometry.dispose(),S.material.dispose(),v.toneMapping=b,v.autoClear=g,e.background=M}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===No||e.mapping===Oo;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=Qv()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Jv());const o=i?this._cubemapMaterial:this._equirectMaterial,a=new Bn(this._lodPlanes[0],o),c=o.uniforms;c.envMap.value=e;const u=this._cubeSize;mu(t,0,0,3*u,2*u),n.setRenderTarget(t),n.render(a,vf)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const o=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),a=Yv[(i-1)%Yv.length];this._blur(e,i-1,i,o,a)}t.autoClear=n}_blur(e,t,n,i,o){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",o),this._halfBlur(a,e,n,n,i,"longitudinal",o)}_halfBlur(e,t,n,i,o,a,c){const u=this._renderer,d=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const v=3,g=new Bn(this._lodPlanes[i],d),b=d.uniforms,y=this._sizeLods[n]-1,S=isFinite(o)?Math.PI/(2*y):2*Math.PI/(2*aa-1),E=o/S,M=isFinite(o)?1+Math.floor(v*E):aa;M>aa&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${M} samples when the maximum is set to ${aa}`);const L=[];let R=0;for(let j=0;j<aa;++j){const F=j/E,W=Math.exp(-F*F/2);L.push(W),j===0?R+=W:j<M&&(R+=2*W)}for(let j=0;j<L.length;j++)L[j]=L[j]/R;b.envMap.value=e.texture,b.samples.value=M,b.weights.value=L,b.latitudinal.value=a==="latitudinal",c&&(b.poleAxis.value=c);const{_lodMax:z}=this;b.dTheta.value=S,b.mipInt.value=z-n;const V=this._sizeLods[i],H=3*V*(i>z-ol?i-z+ol:0),B=4*(this._cubeSize-V);mu(t,H,B,3*V,2*V),u.setRenderTarget(t),u.render(g,vf)}}function b1(h){const e=[],t=[],n=[];let i=h;const o=h-ol+1+Xv.length;for(let a=0;a<o;a++){const c=Math.pow(2,i);t.push(c);let u=1/c;a>h-ol?u=Xv[a-h+ol-1]:a===0&&(u=0),n.push(u);const d=1/(c-2),v=-d,g=1+d,b=[v,v,g,v,g,g,v,v,g,g,v,g],y=6,S=6,E=3,M=2,L=1,R=new Float32Array(E*S*y),z=new Float32Array(M*S*y),V=new Float32Array(L*S*y);for(let B=0;B<y;B++){const j=B%3*2/3-1,F=B>2?0:-1,W=[j,F,0,j+2/3,F,0,j+2/3,F+1,0,j,F,0,j+2/3,F+1,0,j,F+1,0];R.set(W,E*S*B),z.set(b,M*S*B);const Z=[B,B,B,B,B,B];V.set(Z,L*S*B)}const H=new jt;H.setAttribute("position",new pn(R,E)),H.setAttribute("uv",new pn(z,M)),H.setAttribute("faceIndex",new pn(V,L)),e.push(H),i>ol&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function Zv(h,e,t){const n=new $s(h,e,t);return n.texture.mapping=gl,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function mu(h,e,t,n,i){h.viewport.set(e,t,n,i),h.scissor.set(e,t,n,i)}function w1(h,e,t){const n=new Float32Array(aa),i=new X(0,1,0);return new Ds({name:"SphericalGaussianBlur",defines:{n:aa,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${h}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Hm(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Qr,depthTest:!1,depthWrite:!1})}function Jv(){return new Ds({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Hm(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Qr,depthTest:!1,depthWrite:!1})}function Qv(){return new Ds({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Hm(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Qr,depthTest:!1,depthWrite:!1})}function Hm(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function x1(h){let e=new WeakMap,t=null;function n(c){if(c&&c.isTexture){const u=c.mapping,d=u===zc||u===Vc,v=u===No||u===Oo;if(d||v)if(c.isRenderTargetTexture&&c.needsPMREMUpdate===!0){c.needsPMREMUpdate=!1;let g=e.get(c);return t===null&&(t=new um(h)),g=d?t.fromEquirectangular(c,g):t.fromCubemap(c,g),e.set(c,g),g.texture}else{if(e.has(c))return e.get(c).texture;{const g=c.image;if(d&&g&&g.height>0||v&&g&&i(g)){t===null&&(t=new um(h));const b=d?t.fromEquirectangular(c):t.fromCubemap(c);return e.set(c,b),c.addEventListener("dispose",o),b.texture}else return null}}}return c}function i(c){let u=0;const d=6;for(let v=0;v<d;v++)c[v]!==void 0&&u++;return u===d}function o(c){const u=c.target;u.removeEventListener("dispose",o);const d=e.get(u);d!==void 0&&(e.delete(u),d.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function y1(h){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=h.getExtension("WEBGL_depth_texture")||h.getExtension("MOZ_WEBGL_depth_texture")||h.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=h.getExtension("WEBGL_compressed_texture_s3tc")||h.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=h.getExtension("WEBGL_compressed_texture_pvrtc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=h.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function C1(h,e,t,n){const i={},o=new WeakMap;function a(g){const b=g.target;b.index!==null&&e.remove(b.index);for(const S in b.attributes)e.remove(b.attributes[S]);b.removeEventListener("dispose",a),delete i[b.id];const y=o.get(b);y&&(e.remove(y),o.delete(b)),n.releaseStatesOfGeometry(b),b.isInstancedBufferGeometry===!0&&delete b._maxInstanceCount,t.memory.geometries--}function c(g,b){return i[b.id]===!0||(b.addEventListener("dispose",a),i[b.id]=!0,t.memory.geometries++),b}function u(g){const b=g.attributes;for(const S in b)e.update(b[S],34962);const y=g.morphAttributes;for(const S in y){const E=y[S];for(let M=0,L=E.length;M<L;M++)e.update(E[M],34962)}}function d(g){const b=[],y=g.index,S=g.attributes.position;let E=0;if(y!==null){const R=y.array;E=y.version;for(let z=0,V=R.length;z<V;z+=3){const H=R[z+0],B=R[z+1],j=R[z+2];b.push(H,B,B,j,j,H)}}else{const R=S.array;E=S.version;for(let z=0,V=R.length/3-1;z<V;z+=3){const H=z+0,B=z+1,j=z+2;b.push(H,B,B,j,j,H)}}const M=new(kb(b)?Um:Bm)(b,1);M.version=E;const L=o.get(g);L&&e.remove(L),o.set(g,M)}function v(g){const b=o.get(g);if(b){const y=g.index;y!==null&&b.version<y.version&&d(g)}else d(g);return o.get(g)}return{get:c,update:u,getWireframeAttribute:v}}function M1(h,e,t,n){const i=n.isWebGL2;let o;function a(b){o=b}let c,u;function d(b){c=b.type,u=b.bytesPerElement}function v(b,y){h.drawElements(o,y,c,b*u),t.update(y,o,1)}function g(b,y,S){if(S===0)return;let E,M;if(i)E=h,M="drawElementsInstanced";else if(E=e.get("ANGLE_instanced_arrays"),M="drawElementsInstancedANGLE",E===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}E[M](o,y,c,b*u,S),t.update(y,o,S)}this.setMode=a,this.setIndex=d,this.render=v,this.renderInstances=g}function E1(h){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(o,a,c){switch(t.calls++,a){case 4:t.triangles+=c*(o/3);break;case 1:t.lines+=c*(o/2);break;case 3:t.lines+=c*(o-1);break;case 2:t.lines+=c*o;break;case 0:t.points+=c*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function S1(h,e){return h[0]-e[0]}function A1(h,e){return Math.abs(e[1])-Math.abs(h[1])}function P1(h,e,t){const n={},i=new Float32Array(8),o=new WeakMap,a=new wn,c=[];for(let d=0;d<8;d++)c[d]=[d,0];function u(d,v,g,b){const y=d.morphTargetInfluences;if(e.isWebGL2===!0){const S=v.morphAttributes.position||v.morphAttributes.normal||v.morphAttributes.color,E=S!==void 0?S.length:0;let M=o.get(v);if(M===void 0||M.count!==E){let ce=function(){oe.dispose(),o.delete(v),v.removeEventListener("dispose",ce)};M!==void 0&&M.texture.dispose();const z=v.morphAttributes.position!==void 0,V=v.morphAttributes.normal!==void 0,H=v.morphAttributes.color!==void 0,B=v.morphAttributes.position||[],j=v.morphAttributes.normal||[],F=v.morphAttributes.color||[];let W=0;z===!0&&(W=1),V===!0&&(W=2),H===!0&&(W=3);let Z=v.attributes.position.count*W,se=1;Z>e.maxTextureSize&&(se=Math.ceil(Z/e.maxTextureSize),Z=e.maxTextureSize);const we=new Float32Array(Z*se*4*E),oe=new Yc(we,Z,se,E);oe.type=Zr,oe.needsUpdate=!0;const ne=W*4;for(let ve=0;ve<E;ve++){const de=B[ve],he=j[ve],ue=F[ve],me=Z*se*4*ve;for(let ze=0;ze<de.count;ze++){const Te=ze*ne;z===!0&&(a.fromBufferAttribute(de,ze),we[me+Te+0]=a.x,we[me+Te+1]=a.y,we[me+Te+2]=a.z,we[me+Te+3]=0),V===!0&&(a.fromBufferAttribute(he,ze),we[me+Te+4]=a.x,we[me+Te+5]=a.y,we[me+Te+6]=a.z,we[me+Te+7]=0),H===!0&&(a.fromBufferAttribute(ue,ze),we[me+Te+8]=a.x,we[me+Te+9]=a.y,we[me+Te+10]=a.z,we[me+Te+11]=ue.itemSize===4?a.w:1)}}M={count:E,texture:oe,size:new De(Z,se)},o.set(v,M),v.addEventListener("dispose",ce)}let L=0;for(let z=0;z<y.length;z++)L+=y[z];const R=v.morphTargetsRelative?1:1-L;b.getUniforms().setValue(h,"morphTargetBaseInfluence",R),b.getUniforms().setValue(h,"morphTargetInfluences",y),b.getUniforms().setValue(h,"morphTargetsTexture",M.texture,t),b.getUniforms().setValue(h,"morphTargetsTextureSize",M.size)}else{const S=y===void 0?0:y.length;let E=n[v.id];if(E===void 0||E.length!==S){E=[];for(let V=0;V<S;V++)E[V]=[V,0];n[v.id]=E}for(let V=0;V<S;V++){const H=E[V];H[0]=V,H[1]=y[V]}E.sort(A1);for(let V=0;V<8;V++)V<S&&E[V][1]?(c[V][0]=E[V][0],c[V][1]=E[V][1]):(c[V][0]=Number.MAX_SAFE_INTEGER,c[V][1]=0);c.sort(S1);const M=v.morphAttributes.position,L=v.morphAttributes.normal;let R=0;for(let V=0;V<8;V++){const H=c[V],B=H[0],j=H[1];B!==Number.MAX_SAFE_INTEGER&&j?(M&&v.getAttribute("morphTarget"+V)!==M[B]&&v.setAttribute("morphTarget"+V,M[B]),L&&v.getAttribute("morphNormal"+V)!==L[B]&&v.setAttribute("morphNormal"+V,L[B]),i[V]=j,R+=j):(M&&v.hasAttribute("morphTarget"+V)===!0&&v.deleteAttribute("morphTarget"+V),L&&v.hasAttribute("morphNormal"+V)===!0&&v.deleteAttribute("morphNormal"+V),i[V]=0)}const z=v.morphTargetsRelative?1:1-R;b.getUniforms().setValue(h,"morphTargetBaseInfluence",z),b.getUniforms().setValue(h,"morphTargetInfluences",i)}}return{update:u}}function T1(h,e,t,n){let i=new WeakMap;function o(u){const d=n.render.frame,v=u.geometry,g=e.get(u,v);return i.get(g)!==d&&(e.update(g),i.set(g,d)),u.isInstancedMesh&&(u.hasEventListener("dispose",c)===!1&&u.addEventListener("dispose",c),t.update(u.instanceMatrix,34962),u.instanceColor!==null&&t.update(u.instanceColor,34962)),g}function a(){i=new WeakMap}function c(u){const d=u.target;d.removeEventListener("dispose",c),t.remove(d.instanceMatrix),d.instanceColor!==null&&t.remove(d.instanceColor)}return{update:o,dispose:a}}const Nb=new Kn,Ob=new Yc,Fb=new hd,Bb=new Jc,eg=[],tg=[],ng=new Float32Array(16),ig=new Float32Array(9),sg=new Float32Array(4);function _l(h,e,t){const n=h[0];if(n<=0||n>0)return h;const i=e*t;let o=eg[i];if(o===void 0&&(o=new Float32Array(i),eg[i]=o),e!==0){n.toArray(o,0);for(let a=1,c=0;a!==e;++a)c+=t,h[a].toArray(o,c)}return o}function Ii(h,e){if(h.length!==e.length)return!1;for(let t=0,n=h.length;t<n;t++)if(h[t]!==e[t])return!1;return!0}function Di(h,e){for(let t=0,n=e.length;t<n;t++)h[t]=e[t]}function fd(h,e){let t=tg[e];t===void 0&&(t=new Int32Array(e),tg[e]=t);for(let n=0;n!==e;++n)t[n]=h.allocateTextureUnit();return t}function L1(h,e){const t=this.cache;t[0]!==e&&(h.uniform1f(this.addr,e),t[0]=e)}function k1(h,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(h.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ii(t,e))return;h.uniform2fv(this.addr,e),Di(t,e)}}function R1(h,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(h.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(h.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ii(t,e))return;h.uniform3fv(this.addr,e),Di(t,e)}}function I1(h,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(h.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ii(t,e))return;h.uniform4fv(this.addr,e),Di(t,e)}}function D1(h,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ii(t,e))return;h.uniformMatrix2fv(this.addr,!1,e),Di(t,e)}else{if(Ii(t,n))return;sg.set(n),h.uniformMatrix2fv(this.addr,!1,sg),Di(t,n)}}function z1(h,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ii(t,e))return;h.uniformMatrix3fv(this.addr,!1,e),Di(t,e)}else{if(Ii(t,n))return;ig.set(n),h.uniformMatrix3fv(this.addr,!1,ig),Di(t,n)}}function V1(h,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ii(t,e))return;h.uniformMatrix4fv(this.addr,!1,e),Di(t,e)}else{if(Ii(t,n))return;ng.set(n),h.uniformMatrix4fv(this.addr,!1,ng),Di(t,n)}}function N1(h,e){const t=this.cache;t[0]!==e&&(h.uniform1i(this.addr,e),t[0]=e)}function O1(h,e){const t=this.cache;Ii(t,e)||(h.uniform2iv(this.addr,e),Di(t,e))}function F1(h,e){const t=this.cache;Ii(t,e)||(h.uniform3iv(this.addr,e),Di(t,e))}function B1(h,e){const t=this.cache;Ii(t,e)||(h.uniform4iv(this.addr,e),Di(t,e))}function U1(h,e){const t=this.cache;t[0]!==e&&(h.uniform1ui(this.addr,e),t[0]=e)}function H1(h,e){const t=this.cache;Ii(t,e)||(h.uniform2uiv(this.addr,e),Di(t,e))}function G1(h,e){const t=this.cache;Ii(t,e)||(h.uniform3uiv(this.addr,e),Di(t,e))}function W1(h,e){const t=this.cache;Ii(t,e)||(h.uniform4uiv(this.addr,e),Di(t,e))}function j1(h,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(h.uniform1i(this.addr,i),n[0]=i),t.setTexture2D(e||Nb,i)}function K1(h,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(h.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||Fb,i)}function q1(h,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(h.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||Bb,i)}function X1(h,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(h.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||Ob,i)}function $1(h){switch(h){case 5126:return L1;case 35664:return k1;case 35665:return R1;case 35666:return I1;case 35674:return D1;case 35675:return z1;case 35676:return V1;case 5124:case 35670:return N1;case 35667:case 35671:return O1;case 35668:case 35672:return F1;case 35669:case 35673:return B1;case 5125:return U1;case 36294:return H1;case 36295:return G1;case 36296:return W1;case 35678:case 36198:case 36298:case 36306:case 35682:return j1;case 35679:case 36299:case 36307:return K1;case 35680:case 36300:case 36308:case 36293:return q1;case 36289:case 36303:case 36311:case 36292:return X1}}function Y1(h,e){h.uniform1fv(this.addr,e)}function Z1(h,e){const t=_l(e,this.size,2);h.uniform2fv(this.addr,t)}function J1(h,e){const t=_l(e,this.size,3);h.uniform3fv(this.addr,t)}function Q1(h,e){const t=_l(e,this.size,4);h.uniform4fv(this.addr,t)}function eM(h,e){const t=_l(e,this.size,4);h.uniformMatrix2fv(this.addr,!1,t)}function tM(h,e){const t=_l(e,this.size,9);h.uniformMatrix3fv(this.addr,!1,t)}function nM(h,e){const t=_l(e,this.size,16);h.uniformMatrix4fv(this.addr,!1,t)}function iM(h,e){h.uniform1iv(this.addr,e)}function sM(h,e){h.uniform2iv(this.addr,e)}function rM(h,e){h.uniform3iv(this.addr,e)}function oM(h,e){h.uniform4iv(this.addr,e)}function aM(h,e){h.uniform1uiv(this.addr,e)}function lM(h,e){h.uniform2uiv(this.addr,e)}function cM(h,e){h.uniform3uiv(this.addr,e)}function hM(h,e){h.uniform4uiv(this.addr,e)}function uM(h,e,t){const n=this.cache,i=e.length,o=fd(t,i);Ii(n,o)||(h.uniform1iv(this.addr,o),Di(n,o));for(let a=0;a!==i;++a)t.setTexture2D(e[a]||Nb,o[a])}function dM(h,e,t){const n=this.cache,i=e.length,o=fd(t,i);Ii(n,o)||(h.uniform1iv(this.addr,o),Di(n,o));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||Fb,o[a])}function pM(h,e,t){const n=this.cache,i=e.length,o=fd(t,i);Ii(n,o)||(h.uniform1iv(this.addr,o),Di(n,o));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||Bb,o[a])}function fM(h,e,t){const n=this.cache,i=e.length,o=fd(t,i);Ii(n,o)||(h.uniform1iv(this.addr,o),Di(n,o));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||Ob,o[a])}function mM(h){switch(h){case 5126:return Y1;case 35664:return Z1;case 35665:return J1;case 35666:return Q1;case 35674:return eM;case 35675:return tM;case 35676:return nM;case 5124:case 35670:return iM;case 35667:case 35671:return sM;case 35668:case 35672:return rM;case 35669:case 35673:return oM;case 5125:return aM;case 36294:return lM;case 36295:return cM;case 36296:return hM;case 35678:case 36198:case 36298:case 36306:case 35682:return uM;case 35679:case 36299:case 36307:return dM;case 35680:case 36300:case 36308:case 36293:return pM;case 36289:case 36303:case 36311:case 36292:return fM}}class vM{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=$1(t.type)}}class gM{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=mM(t.type)}}class _M{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let o=0,a=i.length;o!==a;++o){const c=i[o];c.setValue(e,t[c.id],n)}}}const _f=/(\w+)(\])?(\[|\.)?/g;function rg(h,e){h.seq.push(e),h.map[e.id]=e}function bM(h,e,t){const n=h.name,i=n.length;for(_f.lastIndex=0;;){const o=_f.exec(n),a=_f.lastIndex;let c=o[1];const u=o[2]==="]",d=o[3];if(u&&(c=c|0),d===void 0||d==="["&&a+2===i){rg(t,d===void 0?new vM(c,h,e):new gM(c,h,e));break}else{let g=t.map[c];g===void 0&&(g=new _M(c),rg(t,g)),t=g}}}class qu{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const o=e.getActiveUniform(t,i),a=e.getUniformLocation(t,o.name);bM(o,a,this)}}setValue(e,t,n,i){const o=this.map[t];o!==void 0&&o.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let o=0,a=t.length;o!==a;++o){const c=t[o],u=n[c.id];u.needsUpdate!==!1&&c.setValue(e,u.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,o=e.length;i!==o;++i){const a=e[i];a.id in t&&n.push(a)}return n}}function og(h,e,t){const n=h.createShader(e);return h.shaderSource(n,t),h.compileShader(n),n}let wM=0;function xM(h,e){const t=h.split(`
`),n=[],i=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let a=i;a<o;a++){const c=a+1;n.push(`${c===e?">":" "} ${c}: ${t[a]}`)}return n.join(`
`)}function yM(h){switch(h){case Bo:return["Linear","( value )"];case vn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",h),["Linear","( value )"]}}function ag(h,e,t){const n=h.getShaderParameter(e,35713),i=h.getShaderInfoLog(e).trim();if(n&&i==="")return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const a=parseInt(o[1]);return t.toUpperCase()+`

`+i+`

`+xM(h.getShaderSource(e),a)}else return i}function CM(h,e){const t=yM(e);return"vec4 "+h+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function MM(h,e){let t;switch(e){case ib:t="Linear";break;case sb:t="Reinhard";break;case rb:t="OptimizedCineon";break;case zm:t="ACESFilmic";break;case ob:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+h+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function EM(h){return[h.extensionDerivatives||h.envMapCubeUVHeight||h.bumpMap||h.tangentSpaceNormalMap||h.clearcoatNormalMap||h.flatShading||h.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(h.extensionFragDepth||h.logarithmicDepthBuffer)&&h.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",h.extensionDrawBuffers&&h.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(h.extensionShaderTextureLOD||h.envMap||h.transmission)&&h.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Pc).join(`
`)}function SM(h){const e=[];for(const t in h){const n=h[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function AM(h,e){const t={},n=h.getProgramParameter(e,35721);for(let i=0;i<n;i++){const o=h.getActiveAttrib(e,i),a=o.name;let c=1;o.type===35674&&(c=2),o.type===35675&&(c=3),o.type===35676&&(c=4),t[a]={type:o.type,location:h.getAttribLocation(e,a),locationSize:c}}return t}function Pc(h){return h!==""}function lg(h,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return h.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function cg(h,e){return h.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const PM=/^[ \t]*#include +<([\w\d./]+)>/gm;function dm(h){return h.replace(PM,TM)}function TM(h,e){const t=Tt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return dm(t)}const LM=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function hg(h){return h.replace(LM,kM)}function kM(h,e,t,n){let i="";for(let o=parseInt(e);o<parseInt(t);o++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function ug(h){let e="precision "+h.precision+` float;
precision `+h.precision+" int;";return h.precision==="highp"?e+=`
#define HIGH_PRECISION`:h.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:h.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function RM(h){let e="SHADOWMAP_TYPE_BASIC";return h.shadowMapType===rd?e="SHADOWMAP_TYPE_PCF":h.shadowMapType===Rm?e="SHADOWMAP_TYPE_PCF_SOFT":h.shadowMapType===la&&(e="SHADOWMAP_TYPE_VSM"),e}function IM(h){let e="ENVMAP_TYPE_CUBE";if(h.envMap)switch(h.envMapMode){case No:case Oo:e="ENVMAP_TYPE_CUBE";break;case gl:e="ENVMAP_TYPE_CUBE_UV";break}return e}function DM(h){let e="ENVMAP_MODE_REFLECTION";if(h.envMap)switch(h.envMapMode){case Oo:e="ENVMAP_MODE_REFRACTION";break}return e}function zM(h){let e="ENVMAP_BLENDING_NONE";if(h.envMap)switch(h.combine){case Xc:e="ENVMAP_BLENDING_MULTIPLY";break;case tb:e="ENVMAP_BLENDING_MIX";break;case nb:e="ENVMAP_BLENDING_ADD";break}return e}function VM(h){const e=h.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function NM(h,e,t,n){const i=h.getContext(),o=t.defines;let a=t.vertexShader,c=t.fragmentShader;const u=RM(t),d=IM(t),v=DM(t),g=zM(t),b=VM(t),y=t.isWebGL2?"":EM(t),S=SM(o),E=i.createProgram();let M,L,R=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(M=[S].filter(Pc).join(`
`),M.length>0&&(M+=`
`),L=[y,S].filter(Pc).join(`
`),L.length>0&&(L+=`
`)):(M=[ug(t),"#define SHADER_NAME "+t.shaderName,S,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+v:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Pc).join(`
`),L=[y,ug(t),"#define SHADER_NAME "+t.shaderName,S,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.envMap?"#define "+v:"",t.envMap?"#define "+g:"",b?"#define CUBEUV_TEXEL_WIDTH "+b.texelWidth:"",b?"#define CUBEUV_TEXEL_HEIGHT "+b.texelHeight:"",b?"#define CUBEUV_MAX_MIP "+b.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Lr?"#define TONE_MAPPING":"",t.toneMapping!==Lr?Tt.tonemapping_pars_fragment:"",t.toneMapping!==Lr?MM("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Tt.encodings_pars_fragment,CM("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Pc).join(`
`)),a=dm(a),a=lg(a,t),a=cg(a,t),c=dm(c),c=lg(c,t),c=cg(c,t),a=hg(a),c=hg(c),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(R=`#version 300 es
`,M=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+M,L=["#define varying in",t.glslVersion===cm?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===cm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+L);const z=R+M+a,V=R+L+c,H=og(i,35633,z),B=og(i,35632,V);if(i.attachShader(E,H),i.attachShader(E,B),t.index0AttributeName!==void 0?i.bindAttribLocation(E,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(E,0,"position"),i.linkProgram(E),h.debug.checkShaderErrors){const W=i.getProgramInfoLog(E).trim(),Z=i.getShaderInfoLog(H).trim(),se=i.getShaderInfoLog(B).trim();let we=!0,oe=!0;if(i.getProgramParameter(E,35714)===!1){we=!1;const ne=ag(i,H,"vertex"),ce=ag(i,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(E,35715)+`

Program Info Log: `+W+`
`+ne+`
`+ce)}else W!==""?console.warn("THREE.WebGLProgram: Program Info Log:",W):(Z===""||se==="")&&(oe=!1);oe&&(this.diagnostics={runnable:we,programLog:W,vertexShader:{log:Z,prefix:M},fragmentShader:{log:se,prefix:L}})}i.deleteShader(H),i.deleteShader(B);let j;this.getUniforms=function(){return j===void 0&&(j=new qu(i,E)),j};let F;return this.getAttributes=function(){return F===void 0&&(F=AM(i,E)),F},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(E),this.program=void 0},this.name=t.shaderName,this.id=wM++,this.cacheKey=e,this.usedTimes=1,this.program=E,this.vertexShader=H,this.fragmentShader=B,this}let OM=0;class FM{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),o=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(o)===!1&&(a.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new BM(e),t.set(e,n)),n}}class BM{constructor(e){this.id=OM++,this.code=e,this.usedTimes=0}}function UM(h,e,t,n,i,o,a){const c=new ud,u=new FM,d=[],v=i.isWebGL2,g=i.logarithmicDepthBuffer,b=i.vertexTextures;let y=i.precision;const S={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function E(F,W,Z,se,we){const oe=se.fog,ne=we.geometry,ce=F.isMeshStandardMaterial?se.environment:null,ve=(F.isMeshStandardMaterial?t:e).get(F.envMap||ce),de=ve&&ve.mapping===gl?ve.image.height:null,he=S[F.type];F.precision!==null&&(y=i.getMaxPrecision(F.precision),y!==F.precision&&console.warn("THREE.WebGLProgram.getParameters:",F.precision,"not supported, using",y,"instead."));const ue=ne.morphAttributes.position||ne.morphAttributes.normal||ne.morphAttributes.color,me=ue!==void 0?ue.length:0;let ze=0;ne.morphAttributes.position!==void 0&&(ze=1),ne.morphAttributes.normal!==void 0&&(ze=2),ne.morphAttributes.color!==void 0&&(ze=3);let Te,Re,Ie,rt;if(he){const mt=fr[he];Te=mt.vertexShader,Re=mt.fragmentShader}else Te=F.vertexShader,Re=F.fragmentShader,u.update(F),Ie=u.getVertexShaderID(F),rt=u.getFragmentShaderID(F);const Ae=h.getRenderTarget(),pt=F.alphaTest>0,nt=F.clearcoat>0,Et=F.iridescence>0;return{isWebGL2:v,shaderID:he,shaderName:F.type,vertexShader:Te,fragmentShader:Re,defines:F.defines,customVertexShaderID:Ie,customFragmentShaderID:rt,isRawShaderMaterial:F.isRawShaderMaterial===!0,glslVersion:F.glslVersion,precision:y,instancing:we.isInstancedMesh===!0,instancingColor:we.isInstancedMesh===!0&&we.instanceColor!==null,supportsVertexTextures:b,outputEncoding:Ae===null?h.outputEncoding:Ae.isXRRenderTarget===!0?Ae.texture.encoding:Bo,map:!!F.map,matcap:!!F.matcap,envMap:!!ve,envMapMode:ve&&ve.mapping,envMapCubeUVHeight:de,lightMap:!!F.lightMap,aoMap:!!F.aoMap,emissiveMap:!!F.emissiveMap,bumpMap:!!F.bumpMap,normalMap:!!F.normalMap,objectSpaceNormalMap:F.normalMapType===Pb,tangentSpaceNormalMap:F.normalMapType===so,decodeVideoTexture:!!F.map&&F.map.isVideoTexture===!0&&F.map.encoding===vn,clearcoat:nt,clearcoatMap:nt&&!!F.clearcoatMap,clearcoatRoughnessMap:nt&&!!F.clearcoatRoughnessMap,clearcoatNormalMap:nt&&!!F.clearcoatNormalMap,iridescence:Et,iridescenceMap:Et&&!!F.iridescenceMap,iridescenceThicknessMap:Et&&!!F.iridescenceThicknessMap,displacementMap:!!F.displacementMap,roughnessMap:!!F.roughnessMap,metalnessMap:!!F.metalnessMap,specularMap:!!F.specularMap,specularIntensityMap:!!F.specularIntensityMap,specularColorMap:!!F.specularColorMap,opaque:F.transparent===!1&&F.blending===pa,alphaMap:!!F.alphaMap,alphaTest:pt,gradientMap:!!F.gradientMap,sheen:F.sheen>0,sheenColorMap:!!F.sheenColorMap,sheenRoughnessMap:!!F.sheenRoughnessMap,transmission:F.transmission>0,transmissionMap:!!F.transmissionMap,thicknessMap:!!F.thicknessMap,combine:F.combine,vertexTangents:!!F.normalMap&&!!ne.attributes.tangent,vertexColors:F.vertexColors,vertexAlphas:F.vertexColors===!0&&!!ne.attributes.color&&ne.attributes.color.itemSize===4,vertexUvs:!!F.map||!!F.bumpMap||!!F.normalMap||!!F.specularMap||!!F.alphaMap||!!F.emissiveMap||!!F.roughnessMap||!!F.metalnessMap||!!F.clearcoatMap||!!F.clearcoatRoughnessMap||!!F.clearcoatNormalMap||!!F.iridescenceMap||!!F.iridescenceThicknessMap||!!F.displacementMap||!!F.transmissionMap||!!F.thicknessMap||!!F.specularIntensityMap||!!F.specularColorMap||!!F.sheenColorMap||!!F.sheenRoughnessMap,uvsVertexOnly:!(F.map||F.bumpMap||F.normalMap||F.specularMap||F.alphaMap||F.emissiveMap||F.roughnessMap||F.metalnessMap||F.clearcoatNormalMap||F.iridescenceMap||F.iridescenceThicknessMap||F.transmission>0||F.transmissionMap||F.thicknessMap||F.specularIntensityMap||F.specularColorMap||F.sheen>0||F.sheenColorMap||F.sheenRoughnessMap)&&!!F.displacementMap,fog:!!oe,useFog:F.fog===!0,fogExp2:oe&&oe.isFogExp2,flatShading:!!F.flatShading,sizeAttenuation:F.sizeAttenuation,logarithmicDepthBuffer:g,skinning:we.isSkinnedMesh===!0,morphTargets:ne.morphAttributes.position!==void 0,morphNormals:ne.morphAttributes.normal!==void 0,morphColors:ne.morphAttributes.color!==void 0,morphTargetsCount:me,morphTextureStride:ze,numDirLights:W.directional.length,numPointLights:W.point.length,numSpotLights:W.spot.length,numSpotLightMaps:W.spotLightMap.length,numRectAreaLights:W.rectArea.length,numHemiLights:W.hemi.length,numDirLightShadows:W.directionalShadowMap.length,numPointLightShadows:W.pointShadowMap.length,numSpotLightShadows:W.spotShadowMap.length,numSpotLightShadowsWithMaps:W.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:F.dithering,shadowMapEnabled:h.shadowMap.enabled&&Z.length>0,shadowMapType:h.shadowMap.type,toneMapping:F.toneMapped?h.toneMapping:Lr,physicallyCorrectLights:h.physicallyCorrectLights,premultipliedAlpha:F.premultipliedAlpha,doubleSided:F.side===qs,flipSided:F.side===ks,useDepthPacking:!!F.depthPacking,depthPacking:F.depthPacking||0,index0AttributeName:F.index0AttributeName,extensionDerivatives:F.extensions&&F.extensions.derivatives,extensionFragDepth:F.extensions&&F.extensions.fragDepth,extensionDrawBuffers:F.extensions&&F.extensions.drawBuffers,extensionShaderTextureLOD:F.extensions&&F.extensions.shaderTextureLOD,rendererExtensionFragDepth:v||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:v||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:v||n.has("EXT_shader_texture_lod"),customProgramCacheKey:F.customProgramCacheKey()}}function M(F){const W=[];if(F.shaderID?W.push(F.shaderID):(W.push(F.customVertexShaderID),W.push(F.customFragmentShaderID)),F.defines!==void 0)for(const Z in F.defines)W.push(Z),W.push(F.defines[Z]);return F.isRawShaderMaterial===!1&&(L(W,F),R(W,F),W.push(h.outputEncoding)),W.push(F.customProgramCacheKey),W.join()}function L(F,W){F.push(W.precision),F.push(W.outputEncoding),F.push(W.envMapMode),F.push(W.envMapCubeUVHeight),F.push(W.combine),F.push(W.vertexUvs),F.push(W.fogExp2),F.push(W.sizeAttenuation),F.push(W.morphTargetsCount),F.push(W.morphAttributeCount),F.push(W.numDirLights),F.push(W.numPointLights),F.push(W.numSpotLights),F.push(W.numSpotLightMaps),F.push(W.numHemiLights),F.push(W.numRectAreaLights),F.push(W.numDirLightShadows),F.push(W.numPointLightShadows),F.push(W.numSpotLightShadows),F.push(W.numSpotLightShadowsWithMaps),F.push(W.shadowMapType),F.push(W.toneMapping),F.push(W.numClippingPlanes),F.push(W.numClipIntersection),F.push(W.depthPacking)}function R(F,W){c.disableAll(),W.isWebGL2&&c.enable(0),W.supportsVertexTextures&&c.enable(1),W.instancing&&c.enable(2),W.instancingColor&&c.enable(3),W.map&&c.enable(4),W.matcap&&c.enable(5),W.envMap&&c.enable(6),W.lightMap&&c.enable(7),W.aoMap&&c.enable(8),W.emissiveMap&&c.enable(9),W.bumpMap&&c.enable(10),W.normalMap&&c.enable(11),W.objectSpaceNormalMap&&c.enable(12),W.tangentSpaceNormalMap&&c.enable(13),W.clearcoat&&c.enable(14),W.clearcoatMap&&c.enable(15),W.clearcoatRoughnessMap&&c.enable(16),W.clearcoatNormalMap&&c.enable(17),W.iridescence&&c.enable(18),W.iridescenceMap&&c.enable(19),W.iridescenceThicknessMap&&c.enable(20),W.displacementMap&&c.enable(21),W.specularMap&&c.enable(22),W.roughnessMap&&c.enable(23),W.metalnessMap&&c.enable(24),W.gradientMap&&c.enable(25),W.alphaMap&&c.enable(26),W.alphaTest&&c.enable(27),W.vertexColors&&c.enable(28),W.vertexAlphas&&c.enable(29),W.vertexUvs&&c.enable(30),W.vertexTangents&&c.enable(31),W.uvsVertexOnly&&c.enable(32),F.push(c.mask),c.disableAll(),W.fog&&c.enable(0),W.useFog&&c.enable(1),W.flatShading&&c.enable(2),W.logarithmicDepthBuffer&&c.enable(3),W.skinning&&c.enable(4),W.morphTargets&&c.enable(5),W.morphNormals&&c.enable(6),W.morphColors&&c.enable(7),W.premultipliedAlpha&&c.enable(8),W.shadowMapEnabled&&c.enable(9),W.physicallyCorrectLights&&c.enable(10),W.doubleSided&&c.enable(11),W.flipSided&&c.enable(12),W.useDepthPacking&&c.enable(13),W.dithering&&c.enable(14),W.specularIntensityMap&&c.enable(15),W.specularColorMap&&c.enable(16),W.transmission&&c.enable(17),W.transmissionMap&&c.enable(18),W.thicknessMap&&c.enable(19),W.sheen&&c.enable(20),W.sheenColorMap&&c.enable(21),W.sheenRoughnessMap&&c.enable(22),W.decodeVideoTexture&&c.enable(23),W.opaque&&c.enable(24),F.push(c.mask)}function z(F){const W=S[F.type];let Z;if(W){const se=fr[W];Z=Ib.clone(se.uniforms)}else Z=F.uniforms;return Z}function V(F,W){let Z;for(let se=0,we=d.length;se<we;se++){const oe=d[se];if(oe.cacheKey===W){Z=oe,++Z.usedTimes;break}}return Z===void 0&&(Z=new NM(h,W,F,o),d.push(Z)),Z}function H(F){if(--F.usedTimes===0){const W=d.indexOf(F);d[W]=d[d.length-1],d.pop(),F.destroy()}}function B(F){u.remove(F)}function j(){u.dispose()}return{getParameters:E,getProgramCacheKey:M,getUniforms:z,acquireProgram:V,releaseProgram:H,releaseShaderCache:B,programs:d,dispose:j}}function HM(){let h=new WeakMap;function e(o){let a=h.get(o);return a===void 0&&(a={},h.set(o,a)),a}function t(o){h.delete(o)}function n(o,a,c){h.get(o)[a]=c}function i(){h=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function GM(h,e){return h.groupOrder!==e.groupOrder?h.groupOrder-e.groupOrder:h.renderOrder!==e.renderOrder?h.renderOrder-e.renderOrder:h.material.id!==e.material.id?h.material.id-e.material.id:h.z!==e.z?h.z-e.z:h.id-e.id}function dg(h,e){return h.groupOrder!==e.groupOrder?h.groupOrder-e.groupOrder:h.renderOrder!==e.renderOrder?h.renderOrder-e.renderOrder:h.z!==e.z?e.z-h.z:h.id-e.id}function pg(){const h=[];let e=0;const t=[],n=[],i=[];function o(){e=0,t.length=0,n.length=0,i.length=0}function a(g,b,y,S,E,M){let L=h[e];return L===void 0?(L={id:g.id,object:g,geometry:b,material:y,groupOrder:S,renderOrder:g.renderOrder,z:E,group:M},h[e]=L):(L.id=g.id,L.object=g,L.geometry=b,L.material=y,L.groupOrder=S,L.renderOrder=g.renderOrder,L.z=E,L.group=M),e++,L}function c(g,b,y,S,E,M){const L=a(g,b,y,S,E,M);y.transmission>0?n.push(L):y.transparent===!0?i.push(L):t.push(L)}function u(g,b,y,S,E,M){const L=a(g,b,y,S,E,M);y.transmission>0?n.unshift(L):y.transparent===!0?i.unshift(L):t.unshift(L)}function d(g,b){t.length>1&&t.sort(g||GM),n.length>1&&n.sort(b||dg),i.length>1&&i.sort(b||dg)}function v(){for(let g=e,b=h.length;g<b;g++){const y=h[g];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:i,init:o,push:c,unshift:u,finish:v,sort:d}}function WM(){let h=new WeakMap;function e(n,i){const o=h.get(n);let a;return o===void 0?(a=new pg,h.set(n,[a])):i>=o.length?(a=new pg,o.push(a)):a=o[i],a}function t(){h=new WeakMap}return{get:e,dispose:t}}function jM(){const h={};return{get:function(e){if(h[e.id]!==void 0)return h[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new X,color:new $e};break;case"SpotLight":t={position:new X,direction:new X,color:new $e,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new X,color:new $e,distance:0,decay:0};break;case"HemisphereLight":t={direction:new X,skyColor:new $e,groundColor:new $e};break;case"RectAreaLight":t={color:new $e,position:new X,halfWidth:new X,halfHeight:new X};break}return h[e.id]=t,t}}}function KM(){const h={};return{get:function(e){if(h[e.id]!==void 0)return h[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new De};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new De};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new De,shadowCameraNear:1,shadowCameraFar:1e3};break}return h[e.id]=t,t}}}let qM=0;function XM(h,e){return(e.castShadow?2:0)-(h.castShadow?2:0)+(e.map?1:0)-(h.map?1:0)}function $M(h,e){const t=new jM,n=KM(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let v=0;v<9;v++)i.probe.push(new X);const o=new X,a=new It,c=new It;function u(v,g){let b=0,y=0,S=0;for(let se=0;se<9;se++)i.probe[se].set(0,0,0);let E=0,M=0,L=0,R=0,z=0,V=0,H=0,B=0,j=0,F=0;v.sort(XM);const W=g!==!0?Math.PI:1;for(let se=0,we=v.length;se<we;se++){const oe=v[se],ne=oe.color,ce=oe.intensity,ve=oe.distance,de=oe.shadow&&oe.shadow.map?oe.shadow.map.texture:null;if(oe.isAmbientLight)b+=ne.r*ce*W,y+=ne.g*ce*W,S+=ne.b*ce*W;else if(oe.isLightProbe)for(let he=0;he<9;he++)i.probe[he].addScaledVector(oe.sh.coefficients[he],ce);else if(oe.isDirectionalLight){const he=t.get(oe);if(he.color.copy(oe.color).multiplyScalar(oe.intensity*W),oe.castShadow){const ue=oe.shadow,me=n.get(oe);me.shadowBias=ue.bias,me.shadowNormalBias=ue.normalBias,me.shadowRadius=ue.radius,me.shadowMapSize=ue.mapSize,i.directionalShadow[E]=me,i.directionalShadowMap[E]=de,i.directionalShadowMatrix[E]=oe.shadow.matrix,V++}i.directional[E]=he,E++}else if(oe.isSpotLight){const he=t.get(oe);he.position.setFromMatrixPosition(oe.matrixWorld),he.color.copy(ne).multiplyScalar(ce*W),he.distance=ve,he.coneCos=Math.cos(oe.angle),he.penumbraCos=Math.cos(oe.angle*(1-oe.penumbra)),he.decay=oe.decay,i.spot[L]=he;const ue=oe.shadow;if(oe.map&&(i.spotLightMap[j]=oe.map,j++,ue.updateMatrices(oe),oe.castShadow&&F++),i.spotLightMatrix[L]=ue.matrix,oe.castShadow){const me=n.get(oe);me.shadowBias=ue.bias,me.shadowNormalBias=ue.normalBias,me.shadowRadius=ue.radius,me.shadowMapSize=ue.mapSize,i.spotShadow[L]=me,i.spotShadowMap[L]=de,B++}L++}else if(oe.isRectAreaLight){const he=t.get(oe);he.color.copy(ne).multiplyScalar(ce),he.halfWidth.set(oe.width*.5,0,0),he.halfHeight.set(0,oe.height*.5,0),i.rectArea[R]=he,R++}else if(oe.isPointLight){const he=t.get(oe);if(he.color.copy(oe.color).multiplyScalar(oe.intensity*W),he.distance=oe.distance,he.decay=oe.decay,oe.castShadow){const ue=oe.shadow,me=n.get(oe);me.shadowBias=ue.bias,me.shadowNormalBias=ue.normalBias,me.shadowRadius=ue.radius,me.shadowMapSize=ue.mapSize,me.shadowCameraNear=ue.camera.near,me.shadowCameraFar=ue.camera.far,i.pointShadow[M]=me,i.pointShadowMap[M]=de,i.pointShadowMatrix[M]=oe.shadow.matrix,H++}i.point[M]=he,M++}else if(oe.isHemisphereLight){const he=t.get(oe);he.skyColor.copy(oe.color).multiplyScalar(ce*W),he.groundColor.copy(oe.groundColor).multiplyScalar(ce*W),i.hemi[z]=he,z++}}R>0&&(e.isWebGL2||h.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=tt.LTC_FLOAT_1,i.rectAreaLTC2=tt.LTC_FLOAT_2):h.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=tt.LTC_HALF_1,i.rectAreaLTC2=tt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=b,i.ambient[1]=y,i.ambient[2]=S;const Z=i.hash;(Z.directionalLength!==E||Z.pointLength!==M||Z.spotLength!==L||Z.rectAreaLength!==R||Z.hemiLength!==z||Z.numDirectionalShadows!==V||Z.numPointShadows!==H||Z.numSpotShadows!==B||Z.numSpotMaps!==j)&&(i.directional.length=E,i.spot.length=L,i.rectArea.length=R,i.point.length=M,i.hemi.length=z,i.directionalShadow.length=V,i.directionalShadowMap.length=V,i.pointShadow.length=H,i.pointShadowMap.length=H,i.spotShadow.length=B,i.spotShadowMap.length=B,i.directionalShadowMatrix.length=V,i.pointShadowMatrix.length=H,i.spotLightMatrix.length=B+j-F,i.spotLightMap.length=j,i.numSpotLightShadowsWithMaps=F,Z.directionalLength=E,Z.pointLength=M,Z.spotLength=L,Z.rectAreaLength=R,Z.hemiLength=z,Z.numDirectionalShadows=V,Z.numPointShadows=H,Z.numSpotShadows=B,Z.numSpotMaps=j,i.version=qM++)}function d(v,g){let b=0,y=0,S=0,E=0,M=0;const L=g.matrixWorldInverse;for(let R=0,z=v.length;R<z;R++){const V=v[R];if(V.isDirectionalLight){const H=i.directional[b];H.direction.setFromMatrixPosition(V.matrixWorld),o.setFromMatrixPosition(V.target.matrixWorld),H.direction.sub(o),H.direction.transformDirection(L),b++}else if(V.isSpotLight){const H=i.spot[S];H.position.setFromMatrixPosition(V.matrixWorld),H.position.applyMatrix4(L),H.direction.setFromMatrixPosition(V.matrixWorld),o.setFromMatrixPosition(V.target.matrixWorld),H.direction.sub(o),H.direction.transformDirection(L),S++}else if(V.isRectAreaLight){const H=i.rectArea[E];H.position.setFromMatrixPosition(V.matrixWorld),H.position.applyMatrix4(L),c.identity(),a.copy(V.matrixWorld),a.premultiply(L),c.extractRotation(a),H.halfWidth.set(V.width*.5,0,0),H.halfHeight.set(0,V.height*.5,0),H.halfWidth.applyMatrix4(c),H.halfHeight.applyMatrix4(c),E++}else if(V.isPointLight){const H=i.point[y];H.position.setFromMatrixPosition(V.matrixWorld),H.position.applyMatrix4(L),y++}else if(V.isHemisphereLight){const H=i.hemi[M];H.direction.setFromMatrixPosition(V.matrixWorld),H.direction.transformDirection(L),M++}}}return{setup:u,setupView:d,state:i}}function fg(h,e){const t=new $M(h,e),n=[],i=[];function o(){n.length=0,i.length=0}function a(g){n.push(g)}function c(g){i.push(g)}function u(g){t.setup(n,g)}function d(g){t.setupView(n,g)}return{init:o,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:u,setupLightsView:d,pushLight:a,pushShadow:c}}function YM(h,e){let t=new WeakMap;function n(o,a=0){const c=t.get(o);let u;return c===void 0?(u=new fg(h,e),t.set(o,[u])):a>=c.length?(u=new fg(h,e),c.push(u)):u=c[a],u}function i(){t=new WeakMap}return{get:n,dispose:i}}class Gm extends ti{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Sb,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Wm extends ti{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new X,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const ZM=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,JM=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function QM(h,e,t){let n=new pd;const i=new De,o=new De,a=new wn,c=new Gm({depthPacking:Ab}),u=new Wm,d={},v=t.maxTextureSize,g={0:ks,1:eo,2:qs},b=new Ds({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new De},radius:{value:4}},vertexShader:ZM,fragmentShader:JM}),y=b.clone();y.defines.HORIZONTAL_PASS=1;const S=new jt;S.setAttribute("position",new pn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const E=new Bn(S,b),M=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=rd,this.render=function(V,H,B){if(M.enabled===!1||M.autoUpdate===!1&&M.needsUpdate===!1||V.length===0)return;const j=h.getRenderTarget(),F=h.getActiveCubeFace(),W=h.getActiveMipmapLevel(),Z=h.state;Z.setBlending(Qr),Z.buffers.color.setClear(1,1,1,1),Z.buffers.depth.setTest(!0),Z.setScissorTest(!1);for(let se=0,we=V.length;se<we;se++){const oe=V[se],ne=oe.shadow;if(ne===void 0){console.warn("THREE.WebGLShadowMap:",oe,"has no shadow.");continue}if(ne.autoUpdate===!1&&ne.needsUpdate===!1)continue;i.copy(ne.mapSize);const ce=ne.getFrameExtents();if(i.multiply(ce),o.copy(ne.mapSize),(i.x>v||i.y>v)&&(i.x>v&&(o.x=Math.floor(v/ce.x),i.x=o.x*ce.x,ne.mapSize.x=o.x),i.y>v&&(o.y=Math.floor(v/ce.y),i.y=o.y*ce.y,ne.mapSize.y=o.y)),ne.map===null){const de=this.type!==la?{minFilter:ei,magFilter:ei}:{};ne.map=new $s(i.x,i.y,de),ne.map.texture.name=oe.name+".shadowMap",ne.camera.updateProjectionMatrix()}h.setRenderTarget(ne.map),h.clear();const ve=ne.getViewportCount();for(let de=0;de<ve;de++){const he=ne.getViewport(de);a.set(o.x*he.x,o.y*he.y,o.x*he.z,o.y*he.w),Z.viewport(a),ne.updateMatrices(oe,de),n=ne.getFrustum(),z(H,B,ne.camera,oe,this.type)}ne.isPointLightShadow!==!0&&this.type===la&&L(ne,B),ne.needsUpdate=!1}M.needsUpdate=!1,h.setRenderTarget(j,F,W)};function L(V,H){const B=e.update(E);b.defines.VSM_SAMPLES!==V.blurSamples&&(b.defines.VSM_SAMPLES=V.blurSamples,y.defines.VSM_SAMPLES=V.blurSamples,b.needsUpdate=!0,y.needsUpdate=!0),V.mapPass===null&&(V.mapPass=new $s(i.x,i.y)),b.uniforms.shadow_pass.value=V.map.texture,b.uniforms.resolution.value=V.mapSize,b.uniforms.radius.value=V.radius,h.setRenderTarget(V.mapPass),h.clear(),h.renderBufferDirect(H,null,B,b,E,null),y.uniforms.shadow_pass.value=V.mapPass.texture,y.uniforms.resolution.value=V.mapSize,y.uniforms.radius.value=V.radius,h.setRenderTarget(V.map),h.clear(),h.renderBufferDirect(H,null,B,y,E,null)}function R(V,H,B,j,F,W){let Z=null;const se=B.isPointLight===!0?V.customDistanceMaterial:V.customDepthMaterial;if(se!==void 0?Z=se:Z=B.isPointLight===!0?u:c,h.localClippingEnabled&&H.clipShadows===!0&&Array.isArray(H.clippingPlanes)&&H.clippingPlanes.length!==0||H.displacementMap&&H.displacementScale!==0||H.alphaMap&&H.alphaTest>0){const we=Z.uuid,oe=H.uuid;let ne=d[we];ne===void 0&&(ne={},d[we]=ne);let ce=ne[oe];ce===void 0&&(ce=Z.clone(),ne[oe]=ce),Z=ce}return Z.visible=H.visible,Z.wireframe=H.wireframe,W===la?Z.side=H.shadowSide!==null?H.shadowSide:H.side:Z.side=H.shadowSide!==null?H.shadowSide:g[H.side],Z.alphaMap=H.alphaMap,Z.alphaTest=H.alphaTest,Z.clipShadows=H.clipShadows,Z.clippingPlanes=H.clippingPlanes,Z.clipIntersection=H.clipIntersection,Z.displacementMap=H.displacementMap,Z.displacementScale=H.displacementScale,Z.displacementBias=H.displacementBias,Z.wireframeLinewidth=H.wireframeLinewidth,Z.linewidth=H.linewidth,B.isPointLight===!0&&Z.isMeshDistanceMaterial===!0&&(Z.referencePosition.setFromMatrixPosition(B.matrixWorld),Z.nearDistance=j,Z.farDistance=F),Z}function z(V,H,B,j,F){if(V.visible===!1)return;if(V.layers.test(H.layers)&&(V.isMesh||V.isLine||V.isPoints)&&(V.castShadow||V.receiveShadow&&F===la)&&(!V.frustumCulled||n.intersectsObject(V))){V.modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,V.matrixWorld);const se=e.update(V),we=V.material;if(Array.isArray(we)){const oe=se.groups;for(let ne=0,ce=oe.length;ne<ce;ne++){const ve=oe[ne],de=we[ve.materialIndex];if(de&&de.visible){const he=R(V,de,j,B.near,B.far,F);h.renderBufferDirect(B,null,se,he,V,ve)}}}else if(we.visible){const oe=R(V,we,j,B.near,B.far,F);h.renderBufferDirect(B,null,se,oe,V,null)}}const Z=V.children;for(let se=0,we=Z.length;se<we;se++)z(Z[se],H,B,j,F)}}function eE(h,e,t){const n=t.isWebGL2;function i(){let ie=!1;const at=new wn;let Ge=null;const Le=new wn(0,0,0,0);return{setMask:function(We){Ge!==We&&!ie&&(h.colorMask(We,We,We,We),Ge=We)},setLocked:function(We){ie=We},setClear:function(We,_t,Yt,an,xn){xn===!0&&(We*=an,_t*=an,Yt*=an),at.set(We,_t,Yt,an),Le.equals(at)===!1&&(h.clearColor(We,_t,Yt,an),Le.copy(at))},reset:function(){ie=!1,Ge=null,Le.set(-1,0,0,0)}}}function o(){let ie=!1,at=null,Ge=null,Le=null;return{setTest:function(We){We?pt(2929):nt(2929)},setMask:function(We){at!==We&&!ie&&(h.depthMask(We),at=We)},setFunc:function(We){if(Ge!==We){switch(We){case X_:h.depthFunc(512);break;case $_:h.depthFunc(519);break;case Y_:h.depthFunc(513);break;case Ju:h.depthFunc(515);break;case Z_:h.depthFunc(514);break;case J_:h.depthFunc(518);break;case Q_:h.depthFunc(516);break;case eb:h.depthFunc(517);break;default:h.depthFunc(515)}Ge=We}},setLocked:function(We){ie=We},setClear:function(We){Le!==We&&(h.clearDepth(We),Le=We)},reset:function(){ie=!1,at=null,Ge=null,Le=null}}}function a(){let ie=!1,at=null,Ge=null,Le=null,We=null,_t=null,Yt=null,an=null,xn=null;return{setTest:function(Gt){ie||(Gt?pt(2960):nt(2960))},setMask:function(Gt){at!==Gt&&!ie&&(h.stencilMask(Gt),at=Gt)},setFunc:function(Gt,Bt,Ft){(Ge!==Gt||Le!==Bt||We!==Ft)&&(h.stencilFunc(Gt,Bt,Ft),Ge=Gt,Le=Bt,We=Ft)},setOp:function(Gt,Bt,Ft){(_t!==Gt||Yt!==Bt||an!==Ft)&&(h.stencilOp(Gt,Bt,Ft),_t=Gt,Yt=Bt,an=Ft)},setLocked:function(Gt){ie=Gt},setClear:function(Gt){xn!==Gt&&(h.clearStencil(Gt),xn=Gt)},reset:function(){ie=!1,at=null,Ge=null,Le=null,We=null,_t=null,Yt=null,an=null,xn=null}}}const c=new i,u=new o,d=new a,v=new WeakMap,g=new WeakMap;let b={},y={},S=new WeakMap,E=[],M=null,L=!1,R=null,z=null,V=null,H=null,B=null,j=null,F=null,W=!1,Z=null,se=null,we=null,oe=null,ne=null;const ce=h.getParameter(35661);let ve=!1,de=0;const he=h.getParameter(7938);he.indexOf("WebGL")!==-1?(de=parseFloat(/^WebGL (\d)/.exec(he)[1]),ve=de>=1):he.indexOf("OpenGL ES")!==-1&&(de=parseFloat(/^OpenGL ES (\d)/.exec(he)[1]),ve=de>=2);let ue=null,me={};const ze=h.getParameter(3088),Te=h.getParameter(2978),Re=new wn().fromArray(ze),Ie=new wn().fromArray(Te);function rt(ie,at,Ge){const Le=new Uint8Array(4),We=h.createTexture();h.bindTexture(ie,We),h.texParameteri(ie,10241,9728),h.texParameteri(ie,10240,9728);for(let _t=0;_t<Ge;_t++)h.texImage2D(at+_t,0,6408,1,1,0,6408,5121,Le);return We}const Ae={};Ae[3553]=rt(3553,3553,1),Ae[34067]=rt(34067,34069,6),c.setClear(0,0,0,1),u.setClear(1),d.setClear(0),pt(2929),u.setFunc(Ju),Oe(!1),St(Nf),pt(2884),Ve(Qr);function pt(ie){b[ie]!==!0&&(h.enable(ie),b[ie]=!0)}function nt(ie){b[ie]!==!1&&(h.disable(ie),b[ie]=!1)}function Et(ie,at){return y[ie]!==at?(h.bindFramebuffer(ie,at),y[ie]=at,n&&(ie===36009&&(y[36160]=at),ie===36160&&(y[36009]=at)),!0):!1}function He(ie,at){let Ge=E,Le=!1;if(ie)if(Ge=S.get(at),Ge===void 0&&(Ge=[],S.set(at,Ge)),ie.isWebGLMultipleRenderTargets){const We=ie.texture;if(Ge.length!==We.length||Ge[0]!==36064){for(let _t=0,Yt=We.length;_t<Yt;_t++)Ge[_t]=36064+_t;Ge.length=We.length,Le=!0}}else Ge[0]!==36064&&(Ge[0]=36064,Le=!0);else Ge[0]!==1029&&(Ge[0]=1029,Le=!0);Le&&(t.isWebGL2?h.drawBuffers(Ge):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ge))}function mt(ie){return M!==ie?(h.useProgram(ie),M=ie,!0):!1}const ke={[oa]:32774,[N_]:32778,[O_]:32779};if(n)ke[Bf]=32775,ke[Uf]=32776;else{const ie=e.get("EXT_blend_minmax");ie!==null&&(ke[Bf]=ie.MIN_EXT,ke[Uf]=ie.MAX_EXT)}const xe={[F_]:0,[B_]:1,[U_]:768,[Im]:770,[q_]:776,[j_]:774,[G_]:772,[H_]:769,[Dm]:771,[K_]:775,[W_]:773};function Ve(ie,at,Ge,Le,We,_t,Yt,an){if(ie===Qr){L===!0&&(nt(3042),L=!1);return}if(L===!1&&(pt(3042),L=!0),ie!==V_){if(ie!==R||an!==W){if((z!==oa||B!==oa)&&(h.blendEquation(32774),z=oa,B=oa),an)switch(ie){case pa:h.blendFuncSeparate(1,771,1,771);break;case Zu:h.blendFunc(1,1);break;case Of:h.blendFuncSeparate(0,769,0,1);break;case Ff:h.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}else switch(ie){case pa:h.blendFuncSeparate(770,771,1,771);break;case Zu:h.blendFunc(770,1);break;case Of:h.blendFuncSeparate(0,769,0,1);break;case Ff:h.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}V=null,H=null,j=null,F=null,R=ie,W=an}return}We=We||at,_t=_t||Ge,Yt=Yt||Le,(at!==z||We!==B)&&(h.blendEquationSeparate(ke[at],ke[We]),z=at,B=We),(Ge!==V||Le!==H||_t!==j||Yt!==F)&&(h.blendFuncSeparate(xe[Ge],xe[Le],xe[_t],xe[Yt]),V=Ge,H=Le,j=_t,F=Yt),R=ie,W=null}function Ye(ie,at){ie.side===qs?nt(2884):pt(2884);let Ge=ie.side===ks;at&&(Ge=!Ge),Oe(Ge),ie.blending===pa&&ie.transparent===!1?Ve(Qr):Ve(ie.blending,ie.blendEquation,ie.blendSrc,ie.blendDst,ie.blendEquationAlpha,ie.blendSrcAlpha,ie.blendDstAlpha,ie.premultipliedAlpha),u.setFunc(ie.depthFunc),u.setTest(ie.depthTest),u.setMask(ie.depthWrite),c.setMask(ie.colorWrite);const Le=ie.stencilWrite;d.setTest(Le),Le&&(d.setMask(ie.stencilWriteMask),d.setFunc(ie.stencilFunc,ie.stencilRef,ie.stencilFuncMask),d.setOp(ie.stencilFail,ie.stencilZFail,ie.stencilZPass)),dt(ie.polygonOffset,ie.polygonOffsetFactor,ie.polygonOffsetUnits),ie.alphaToCoverage===!0?pt(32926):nt(32926)}function Oe(ie){Z!==ie&&(ie?h.frontFace(2304):h.frontFace(2305),Z=ie)}function St(ie){ie!==I_?(pt(2884),ie!==se&&(ie===Nf?h.cullFace(1029):ie===D_?h.cullFace(1028):h.cullFace(1032))):nt(2884),se=ie}function vt(ie){ie!==we&&(ve&&h.lineWidth(ie),we=ie)}function dt(ie,at,Ge){ie?(pt(32823),(oe!==at||ne!==Ge)&&(h.polygonOffset(at,Ge),oe=at,ne=Ge)):nt(32823)}function en(ie){ie?pt(3089):nt(3089)}function Xt(ie){ie===void 0&&(ie=33984+ce-1),ue!==ie&&(h.activeTexture(ie),ue=ie)}function Q(ie,at,Ge){Ge===void 0&&(ue===null?Ge=33984+ce-1:Ge=ue);let Le=me[Ge];Le===void 0&&(Le={type:void 0,texture:void 0},me[Ge]=Le),(Le.type!==ie||Le.texture!==at)&&(ue!==Ge&&(h.activeTexture(Ge),ue=Ge),h.bindTexture(ie,at||Ae[ie]),Le.type=ie,Le.texture=at)}function q(){const ie=me[ue];ie!==void 0&&ie.type!==void 0&&(h.bindTexture(ie.type,null),ie.type=void 0,ie.texture=void 0)}function ge(){try{h.compressedTexImage2D.apply(h,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ne(){try{h.texSubImage2D.apply(h,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function je(){try{h.texSubImage3D.apply(h,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Ze(){try{h.compressedTexSubImage2D.apply(h,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function wt(){try{h.texStorage2D.apply(h,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function qe(){try{h.texStorage3D.apply(h,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Pe(){try{h.texImage2D.apply(h,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function ct(){try{h.texImage3D.apply(h,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function ft(ie){Re.equals(ie)===!1&&(h.scissor(ie.x,ie.y,ie.z,ie.w),Re.copy(ie))}function lt(ie){Ie.equals(ie)===!1&&(h.viewport(ie.x,ie.y,ie.z,ie.w),Ie.copy(ie))}function gt(ie,at){let Ge=g.get(at);Ge===void 0&&(Ge=new WeakMap,g.set(at,Ge));let Le=Ge.get(ie);Le===void 0&&(Le=h.getUniformBlockIndex(at,ie.name),Ge.set(ie,Le))}function yt(ie,at){const Le=g.get(at).get(ie);v.get(ie)!==Le&&(h.uniformBlockBinding(at,Le,ie.__bindingPointIndex),v.set(ie,Le))}function Dt(){h.disable(3042),h.disable(2884),h.disable(2929),h.disable(32823),h.disable(3089),h.disable(2960),h.disable(32926),h.blendEquation(32774),h.blendFunc(1,0),h.blendFuncSeparate(1,0,1,0),h.colorMask(!0,!0,!0,!0),h.clearColor(0,0,0,0),h.depthMask(!0),h.depthFunc(513),h.clearDepth(1),h.stencilMask(4294967295),h.stencilFunc(519,0,4294967295),h.stencilOp(7680,7680,7680),h.clearStencil(0),h.cullFace(1029),h.frontFace(2305),h.polygonOffset(0,0),h.activeTexture(33984),h.bindFramebuffer(36160,null),n===!0&&(h.bindFramebuffer(36009,null),h.bindFramebuffer(36008,null)),h.useProgram(null),h.lineWidth(1),h.scissor(0,0,h.canvas.width,h.canvas.height),h.viewport(0,0,h.canvas.width,h.canvas.height),b={},ue=null,me={},y={},S=new WeakMap,E=[],M=null,L=!1,R=null,z=null,V=null,H=null,B=null,j=null,F=null,W=!1,Z=null,se=null,we=null,oe=null,ne=null,Re.set(0,0,h.canvas.width,h.canvas.height),Ie.set(0,0,h.canvas.width,h.canvas.height),c.reset(),u.reset(),d.reset()}return{buffers:{color:c,depth:u,stencil:d},enable:pt,disable:nt,bindFramebuffer:Et,drawBuffers:He,useProgram:mt,setBlending:Ve,setMaterial:Ye,setFlipSided:Oe,setCullFace:St,setLineWidth:vt,setPolygonOffset:dt,setScissorTest:en,activeTexture:Xt,bindTexture:Q,unbindTexture:q,compressedTexImage2D:ge,texImage2D:Pe,texImage3D:ct,updateUBOMapping:gt,uniformBlockBinding:yt,texStorage2D:wt,texStorage3D:qe,texSubImage2D:Ne,texSubImage3D:je,compressedTexSubImage2D:Ze,scissor:ft,viewport:lt,reset:Dt}}function tE(h,e,t,n,i,o,a){const c=i.isWebGL2,u=i.maxTextures,d=i.maxCubemapSize,v=i.maxTextureSize,g=i.maxSamples,b=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,y=/OculusBrowser/g.test(navigator.userAgent),S=new WeakMap;let E;const M=new WeakMap;let L=!1;try{L=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function R(Q,q){return L?new OffscreenCanvas(Q,q):Bc("canvas")}function z(Q,q,ge,Ne){let je=1;if((Q.width>Ne||Q.height>Ne)&&(je=Ne/Math.max(Q.width,Q.height)),je<1||q===!0)if(typeof HTMLImageElement<"u"&&Q instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Q instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Q instanceof ImageBitmap){const Ze=q?ed:Math.floor,wt=Ze(je*Q.width),qe=Ze(je*Q.height);E===void 0&&(E=R(wt,qe));const Pe=ge?R(wt,qe):E;return Pe.width=wt,Pe.height=qe,Pe.getContext("2d").drawImage(Q,0,0,wt,qe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Q.width+"x"+Q.height+") to ("+wt+"x"+qe+")."),Pe}else return"data"in Q&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Q.width+"x"+Q.height+")."),Q;return Q}function V(Q){return hm(Q.width)&&hm(Q.height)}function H(Q){return c?!1:Q.wrapS!==qi||Q.wrapT!==qi||Q.minFilter!==ei&&Q.minFilter!==Ln}function B(Q,q){return Q.generateMipmaps&&q&&Q.minFilter!==ei&&Q.minFilter!==Ln}function j(Q){h.generateMipmap(Q)}function F(Q,q,ge,Ne,je=!1){if(c===!1)return q;if(Q!==null){if(h[Q]!==void 0)return h[Q];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Q+"'")}let Ze=q;return q===6403&&(ge===5126&&(Ze=33326),ge===5131&&(Ze=33325),ge===5121&&(Ze=33321)),q===33319&&(ge===5126&&(Ze=33328),ge===5131&&(Ze=33327),ge===5121&&(Ze=33323)),q===6408&&(ge===5126&&(Ze=34836),ge===5131&&(Ze=34842),ge===5121&&(Ze=Ne===vn&&je===!1?35907:32856),ge===32819&&(Ze=32854),ge===32820&&(Ze=32855)),(Ze===33325||Ze===33326||Ze===33327||Ze===33328||Ze===34842||Ze===34836)&&e.get("EXT_color_buffer_float"),Ze}function W(Q,q,ge){return B(Q,ge)===!0||Q.isFramebufferTexture&&Q.minFilter!==ei&&Q.minFilter!==Ln?Math.log2(Math.max(q.width,q.height))+1:Q.mipmaps!==void 0&&Q.mipmaps.length>0?Q.mipmaps.length:Q.isCompressedTexture&&Array.isArray(Q.image)?q.mipmaps.length:1}function Z(Q){return Q===ei||Q===hl||Q===ul?9728:9729}function se(Q){const q=Q.target;q.removeEventListener("dispose",se),oe(q),q.isVideoTexture&&S.delete(q)}function we(Q){const q=Q.target;q.removeEventListener("dispose",we),ce(q)}function oe(Q){const q=n.get(Q);if(q.__webglInit===void 0)return;const ge=Q.source,Ne=M.get(ge);if(Ne){const je=Ne[q.__cacheKey];je.usedTimes--,je.usedTimes===0&&ne(Q),Object.keys(Ne).length===0&&M.delete(ge)}n.remove(Q)}function ne(Q){const q=n.get(Q);h.deleteTexture(q.__webglTexture);const ge=Q.source,Ne=M.get(ge);delete Ne[q.__cacheKey],a.memory.textures--}function ce(Q){const q=Q.texture,ge=n.get(Q),Ne=n.get(q);if(Ne.__webglTexture!==void 0&&(h.deleteTexture(Ne.__webglTexture),a.memory.textures--),Q.depthTexture&&Q.depthTexture.dispose(),Q.isWebGLCubeRenderTarget)for(let je=0;je<6;je++)h.deleteFramebuffer(ge.__webglFramebuffer[je]),ge.__webglDepthbuffer&&h.deleteRenderbuffer(ge.__webglDepthbuffer[je]);else{if(h.deleteFramebuffer(ge.__webglFramebuffer),ge.__webglDepthbuffer&&h.deleteRenderbuffer(ge.__webglDepthbuffer),ge.__webglMultisampledFramebuffer&&h.deleteFramebuffer(ge.__webglMultisampledFramebuffer),ge.__webglColorRenderbuffer)for(let je=0;je<ge.__webglColorRenderbuffer.length;je++)ge.__webglColorRenderbuffer[je]&&h.deleteRenderbuffer(ge.__webglColorRenderbuffer[je]);ge.__webglDepthRenderbuffer&&h.deleteRenderbuffer(ge.__webglDepthRenderbuffer)}if(Q.isWebGLMultipleRenderTargets)for(let je=0,Ze=q.length;je<Ze;je++){const wt=n.get(q[je]);wt.__webglTexture&&(h.deleteTexture(wt.__webglTexture),a.memory.textures--),n.remove(q[je])}n.remove(q),n.remove(Q)}let ve=0;function de(){ve=0}function he(){const Q=ve;return Q>=u&&console.warn("THREE.WebGLTextures: Trying to use "+Q+" texture units while this GPU supports only "+u),ve+=1,Q}function ue(Q){const q=[];return q.push(Q.wrapS),q.push(Q.wrapT),q.push(Q.magFilter),q.push(Q.minFilter),q.push(Q.anisotropy),q.push(Q.internalFormat),q.push(Q.format),q.push(Q.type),q.push(Q.generateMipmaps),q.push(Q.premultiplyAlpha),q.push(Q.flipY),q.push(Q.unpackAlignment),q.push(Q.encoding),q.join()}function me(Q,q){const ge=n.get(Q);if(Q.isVideoTexture&&en(Q),Q.isRenderTargetTexture===!1&&Q.version>0&&ge.__version!==Q.version){const Ne=Q.image;if(Ne===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ne.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{nt(ge,Q,q);return}}t.bindTexture(3553,ge.__webglTexture,33984+q)}function ze(Q,q){const ge=n.get(Q);if(Q.version>0&&ge.__version!==Q.version){nt(ge,Q,q);return}t.bindTexture(35866,ge.__webglTexture,33984+q)}function Te(Q,q){const ge=n.get(Q);if(Q.version>0&&ge.__version!==Q.version){nt(ge,Q,q);return}t.bindTexture(32879,ge.__webglTexture,33984+q)}function Re(Q,q){const ge=n.get(Q);if(Q.version>0&&ge.__version!==Q.version){Et(ge,Q,q);return}t.bindTexture(34067,ge.__webglTexture,33984+q)}const Ie={[mr]:10497,[qi]:33071,[ba]:33648},rt={[ei]:9728,[hl]:9984,[ul]:9986,[Ln]:9729,[$c]:9985,[gr]:9987};function Ae(Q,q,ge){if(ge?(h.texParameteri(Q,10242,Ie[q.wrapS]),h.texParameteri(Q,10243,Ie[q.wrapT]),(Q===32879||Q===35866)&&h.texParameteri(Q,32882,Ie[q.wrapR]),h.texParameteri(Q,10240,rt[q.magFilter]),h.texParameteri(Q,10241,rt[q.minFilter])):(h.texParameteri(Q,10242,33071),h.texParameteri(Q,10243,33071),(Q===32879||Q===35866)&&h.texParameteri(Q,32882,33071),(q.wrapS!==qi||q.wrapT!==qi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),h.texParameteri(Q,10240,Z(q.magFilter)),h.texParameteri(Q,10241,Z(q.minFilter)),q.minFilter!==ei&&q.minFilter!==Ln&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const Ne=e.get("EXT_texture_filter_anisotropic");if(q.type===Zr&&e.has("OES_texture_float_linear")===!1||c===!1&&q.type===dl&&e.has("OES_texture_half_float_linear")===!1)return;(q.anisotropy>1||n.get(q).__currentAnisotropy)&&(h.texParameterf(Q,Ne.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(q.anisotropy,i.getMaxAnisotropy())),n.get(q).__currentAnisotropy=q.anisotropy)}}function pt(Q,q){let ge=!1;Q.__webglInit===void 0&&(Q.__webglInit=!0,q.addEventListener("dispose",se));const Ne=q.source;let je=M.get(Ne);je===void 0&&(je={},M.set(Ne,je));const Ze=ue(q);if(Ze!==Q.__cacheKey){je[Ze]===void 0&&(je[Ze]={texture:h.createTexture(),usedTimes:0},a.memory.textures++,ge=!0),je[Ze].usedTimes++;const wt=je[Q.__cacheKey];wt!==void 0&&(je[Q.__cacheKey].usedTimes--,wt.usedTimes===0&&ne(q)),Q.__cacheKey=Ze,Q.__webglTexture=je[Ze].texture}return ge}function nt(Q,q,ge){let Ne=3553;q.isDataArrayTexture&&(Ne=35866),q.isData3DTexture&&(Ne=32879);const je=pt(Q,q),Ze=q.source;t.bindTexture(Ne,Q.__webglTexture,33984+ge);const wt=n.get(Ze);if(Ze.version!==wt.__version||je===!0){t.activeTexture(33984+ge),h.pixelStorei(37440,q.flipY),h.pixelStorei(37441,q.premultiplyAlpha),h.pixelStorei(3317,q.unpackAlignment),h.pixelStorei(37443,0);const qe=H(q)&&V(q.image)===!1;let Pe=z(q.image,qe,!1,v);Pe=Xt(q,Pe);const ct=V(Pe)||c,ft=o.convert(q.format,q.encoding);let lt=o.convert(q.type),gt=F(q.internalFormat,ft,lt,q.encoding,q.isVideoTexture);Ae(Ne,q,ct);let yt;const Dt=q.mipmaps,ie=c&&q.isVideoTexture!==!0,at=wt.__version===void 0||je===!0,Ge=W(q,Pe,ct);if(q.isDepthTexture)gt=6402,c?q.type===Zr?gt=36012:q.type===Do?gt=33190:q.type===fa?gt=35056:gt=33189:q.type===Zr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),q.format===Vo&&gt===6402&&q.type!==Vm&&q.type!==Do&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),q.type=Do,lt=o.convert(q.type)),q.format===wa&&gt===6402&&(gt=34041,q.type!==fa&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),q.type=fa,lt=o.convert(q.type))),at&&(ie?t.texStorage2D(3553,1,gt,Pe.width,Pe.height):t.texImage2D(3553,0,gt,Pe.width,Pe.height,0,ft,lt,null));else if(q.isDataTexture)if(Dt.length>0&&ct){ie&&at&&t.texStorage2D(3553,Ge,gt,Dt[0].width,Dt[0].height);for(let Le=0,We=Dt.length;Le<We;Le++)yt=Dt[Le],ie?t.texSubImage2D(3553,Le,0,0,yt.width,yt.height,ft,lt,yt.data):t.texImage2D(3553,Le,gt,yt.width,yt.height,0,ft,lt,yt.data);q.generateMipmaps=!1}else ie?(at&&t.texStorage2D(3553,Ge,gt,Pe.width,Pe.height),t.texSubImage2D(3553,0,0,0,Pe.width,Pe.height,ft,lt,Pe.data)):t.texImage2D(3553,0,gt,Pe.width,Pe.height,0,ft,lt,Pe.data);else if(q.isCompressedTexture){ie&&at&&t.texStorage2D(3553,Ge,gt,Dt[0].width,Dt[0].height);for(let Le=0,We=Dt.length;Le<We;Le++)yt=Dt[Le],q.format!==Xs?ft!==null?ie?t.compressedTexSubImage2D(3553,Le,0,0,yt.width,yt.height,ft,yt.data):t.compressedTexImage2D(3553,Le,gt,yt.width,yt.height,0,yt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ie?t.texSubImage2D(3553,Le,0,0,yt.width,yt.height,ft,lt,yt.data):t.texImage2D(3553,Le,gt,yt.width,yt.height,0,ft,lt,yt.data)}else if(q.isDataArrayTexture)ie?(at&&t.texStorage3D(35866,Ge,gt,Pe.width,Pe.height,Pe.depth),t.texSubImage3D(35866,0,0,0,0,Pe.width,Pe.height,Pe.depth,ft,lt,Pe.data)):t.texImage3D(35866,0,gt,Pe.width,Pe.height,Pe.depth,0,ft,lt,Pe.data);else if(q.isData3DTexture)ie?(at&&t.texStorage3D(32879,Ge,gt,Pe.width,Pe.height,Pe.depth),t.texSubImage3D(32879,0,0,0,0,Pe.width,Pe.height,Pe.depth,ft,lt,Pe.data)):t.texImage3D(32879,0,gt,Pe.width,Pe.height,Pe.depth,0,ft,lt,Pe.data);else if(q.isFramebufferTexture){if(at)if(ie)t.texStorage2D(3553,Ge,gt,Pe.width,Pe.height);else{let Le=Pe.width,We=Pe.height;for(let _t=0;_t<Ge;_t++)t.texImage2D(3553,_t,gt,Le,We,0,ft,lt,null),Le>>=1,We>>=1}}else if(Dt.length>0&&ct){ie&&at&&t.texStorage2D(3553,Ge,gt,Dt[0].width,Dt[0].height);for(let Le=0,We=Dt.length;Le<We;Le++)yt=Dt[Le],ie?t.texSubImage2D(3553,Le,0,0,ft,lt,yt):t.texImage2D(3553,Le,gt,ft,lt,yt);q.generateMipmaps=!1}else ie?(at&&t.texStorage2D(3553,Ge,gt,Pe.width,Pe.height),t.texSubImage2D(3553,0,0,0,ft,lt,Pe)):t.texImage2D(3553,0,gt,ft,lt,Pe);B(q,ct)&&j(Ne),wt.__version=Ze.version,q.onUpdate&&q.onUpdate(q)}Q.__version=q.version}function Et(Q,q,ge){if(q.image.length!==6)return;const Ne=pt(Q,q),je=q.source;t.bindTexture(34067,Q.__webglTexture,33984+ge);const Ze=n.get(je);if(je.version!==Ze.__version||Ne===!0){t.activeTexture(33984+ge),h.pixelStorei(37440,q.flipY),h.pixelStorei(37441,q.premultiplyAlpha),h.pixelStorei(3317,q.unpackAlignment),h.pixelStorei(37443,0);const wt=q.isCompressedTexture||q.image[0].isCompressedTexture,qe=q.image[0]&&q.image[0].isDataTexture,Pe=[];for(let Le=0;Le<6;Le++)!wt&&!qe?Pe[Le]=z(q.image[Le],!1,!0,d):Pe[Le]=qe?q.image[Le].image:q.image[Le],Pe[Le]=Xt(q,Pe[Le]);const ct=Pe[0],ft=V(ct)||c,lt=o.convert(q.format,q.encoding),gt=o.convert(q.type),yt=F(q.internalFormat,lt,gt,q.encoding),Dt=c&&q.isVideoTexture!==!0,ie=Ze.__version===void 0||Ne===!0;let at=W(q,ct,ft);Ae(34067,q,ft);let Ge;if(wt){Dt&&ie&&t.texStorage2D(34067,at,yt,ct.width,ct.height);for(let Le=0;Le<6;Le++){Ge=Pe[Le].mipmaps;for(let We=0;We<Ge.length;We++){const _t=Ge[We];q.format!==Xs?lt!==null?Dt?t.compressedTexSubImage2D(34069+Le,We,0,0,_t.width,_t.height,lt,_t.data):t.compressedTexImage2D(34069+Le,We,yt,_t.width,_t.height,0,_t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Dt?t.texSubImage2D(34069+Le,We,0,0,_t.width,_t.height,lt,gt,_t.data):t.texImage2D(34069+Le,We,yt,_t.width,_t.height,0,lt,gt,_t.data)}}}else{Ge=q.mipmaps,Dt&&ie&&(Ge.length>0&&at++,t.texStorage2D(34067,at,yt,Pe[0].width,Pe[0].height));for(let Le=0;Le<6;Le++)if(qe){Dt?t.texSubImage2D(34069+Le,0,0,0,Pe[Le].width,Pe[Le].height,lt,gt,Pe[Le].data):t.texImage2D(34069+Le,0,yt,Pe[Le].width,Pe[Le].height,0,lt,gt,Pe[Le].data);for(let We=0;We<Ge.length;We++){const Yt=Ge[We].image[Le].image;Dt?t.texSubImage2D(34069+Le,We+1,0,0,Yt.width,Yt.height,lt,gt,Yt.data):t.texImage2D(34069+Le,We+1,yt,Yt.width,Yt.height,0,lt,gt,Yt.data)}}else{Dt?t.texSubImage2D(34069+Le,0,0,0,lt,gt,Pe[Le]):t.texImage2D(34069+Le,0,yt,lt,gt,Pe[Le]);for(let We=0;We<Ge.length;We++){const _t=Ge[We];Dt?t.texSubImage2D(34069+Le,We+1,0,0,lt,gt,_t.image[Le]):t.texImage2D(34069+Le,We+1,yt,lt,gt,_t.image[Le])}}}B(q,ft)&&j(34067),Ze.__version=je.version,q.onUpdate&&q.onUpdate(q)}Q.__version=q.version}function He(Q,q,ge,Ne,je){const Ze=o.convert(ge.format,ge.encoding),wt=o.convert(ge.type),qe=F(ge.internalFormat,Ze,wt,ge.encoding);n.get(q).__hasExternalTextures||(je===32879||je===35866?t.texImage3D(je,0,qe,q.width,q.height,q.depth,0,Ze,wt,null):t.texImage2D(je,0,qe,q.width,q.height,0,Ze,wt,null)),t.bindFramebuffer(36160,Q),dt(q)?b.framebufferTexture2DMultisampleEXT(36160,Ne,je,n.get(ge).__webglTexture,0,vt(q)):h.framebufferTexture2D(36160,Ne,je,n.get(ge).__webglTexture,0),t.bindFramebuffer(36160,null)}function mt(Q,q,ge){if(h.bindRenderbuffer(36161,Q),q.depthBuffer&&!q.stencilBuffer){let Ne=33189;if(ge||dt(q)){const je=q.depthTexture;je&&je.isDepthTexture&&(je.type===Zr?Ne=36012:je.type===Do&&(Ne=33190));const Ze=vt(q);dt(q)?b.renderbufferStorageMultisampleEXT(36161,Ze,Ne,q.width,q.height):h.renderbufferStorageMultisample(36161,Ze,Ne,q.width,q.height)}else h.renderbufferStorage(36161,Ne,q.width,q.height);h.framebufferRenderbuffer(36160,36096,36161,Q)}else if(q.depthBuffer&&q.stencilBuffer){const Ne=vt(q);ge&&dt(q)===!1?h.renderbufferStorageMultisample(36161,Ne,35056,q.width,q.height):dt(q)?b.renderbufferStorageMultisampleEXT(36161,Ne,35056,q.width,q.height):h.renderbufferStorage(36161,34041,q.width,q.height),h.framebufferRenderbuffer(36160,33306,36161,Q)}else{const Ne=q.isWebGLMultipleRenderTargets===!0?q.texture:[q.texture];for(let je=0;je<Ne.length;je++){const Ze=Ne[je],wt=o.convert(Ze.format,Ze.encoding),qe=o.convert(Ze.type),Pe=F(Ze.internalFormat,wt,qe,Ze.encoding),ct=vt(q);ge&&dt(q)===!1?h.renderbufferStorageMultisample(36161,ct,Pe,q.width,q.height):dt(q)?b.renderbufferStorageMultisampleEXT(36161,ct,Pe,q.width,q.height):h.renderbufferStorage(36161,Pe,q.width,q.height)}}h.bindRenderbuffer(36161,null)}function ke(Q,q){if(q&&q.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,Q),!(q.depthTexture&&q.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(q.depthTexture).__webglTexture||q.depthTexture.image.width!==q.width||q.depthTexture.image.height!==q.height)&&(q.depthTexture.image.width=q.width,q.depthTexture.image.height=q.height,q.depthTexture.needsUpdate=!0),me(q.depthTexture,0);const Ne=n.get(q.depthTexture).__webglTexture,je=vt(q);if(q.depthTexture.format===Vo)dt(q)?b.framebufferTexture2DMultisampleEXT(36160,36096,3553,Ne,0,je):h.framebufferTexture2D(36160,36096,3553,Ne,0);else if(q.depthTexture.format===wa)dt(q)?b.framebufferTexture2DMultisampleEXT(36160,33306,3553,Ne,0,je):h.framebufferTexture2D(36160,33306,3553,Ne,0);else throw new Error("Unknown depthTexture format")}function xe(Q){const q=n.get(Q),ge=Q.isWebGLCubeRenderTarget===!0;if(Q.depthTexture&&!q.__autoAllocateDepthBuffer){if(ge)throw new Error("target.depthTexture not supported in Cube render targets");ke(q.__webglFramebuffer,Q)}else if(ge){q.__webglDepthbuffer=[];for(let Ne=0;Ne<6;Ne++)t.bindFramebuffer(36160,q.__webglFramebuffer[Ne]),q.__webglDepthbuffer[Ne]=h.createRenderbuffer(),mt(q.__webglDepthbuffer[Ne],Q,!1)}else t.bindFramebuffer(36160,q.__webglFramebuffer),q.__webglDepthbuffer=h.createRenderbuffer(),mt(q.__webglDepthbuffer,Q,!1);t.bindFramebuffer(36160,null)}function Ve(Q,q,ge){const Ne=n.get(Q);q!==void 0&&He(Ne.__webglFramebuffer,Q,Q.texture,36064,3553),ge!==void 0&&xe(Q)}function Ye(Q){const q=Q.texture,ge=n.get(Q),Ne=n.get(q);Q.addEventListener("dispose",we),Q.isWebGLMultipleRenderTargets!==!0&&(Ne.__webglTexture===void 0&&(Ne.__webglTexture=h.createTexture()),Ne.__version=q.version,a.memory.textures++);const je=Q.isWebGLCubeRenderTarget===!0,Ze=Q.isWebGLMultipleRenderTargets===!0,wt=V(Q)||c;if(je){ge.__webglFramebuffer=[];for(let qe=0;qe<6;qe++)ge.__webglFramebuffer[qe]=h.createFramebuffer()}else{if(ge.__webglFramebuffer=h.createFramebuffer(),Ze)if(i.drawBuffers){const qe=Q.texture;for(let Pe=0,ct=qe.length;Pe<ct;Pe++){const ft=n.get(qe[Pe]);ft.__webglTexture===void 0&&(ft.__webglTexture=h.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(c&&Q.samples>0&&dt(Q)===!1){const qe=Ze?q:[q];ge.__webglMultisampledFramebuffer=h.createFramebuffer(),ge.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,ge.__webglMultisampledFramebuffer);for(let Pe=0;Pe<qe.length;Pe++){const ct=qe[Pe];ge.__webglColorRenderbuffer[Pe]=h.createRenderbuffer(),h.bindRenderbuffer(36161,ge.__webglColorRenderbuffer[Pe]);const ft=o.convert(ct.format,ct.encoding),lt=o.convert(ct.type),gt=F(ct.internalFormat,ft,lt,ct.encoding,Q.isXRRenderTarget===!0),yt=vt(Q);h.renderbufferStorageMultisample(36161,yt,gt,Q.width,Q.height),h.framebufferRenderbuffer(36160,36064+Pe,36161,ge.__webglColorRenderbuffer[Pe])}h.bindRenderbuffer(36161,null),Q.depthBuffer&&(ge.__webglDepthRenderbuffer=h.createRenderbuffer(),mt(ge.__webglDepthRenderbuffer,Q,!0)),t.bindFramebuffer(36160,null)}}if(je){t.bindTexture(34067,Ne.__webglTexture),Ae(34067,q,wt);for(let qe=0;qe<6;qe++)He(ge.__webglFramebuffer[qe],Q,q,36064,34069+qe);B(q,wt)&&j(34067),t.unbindTexture()}else if(Ze){const qe=Q.texture;for(let Pe=0,ct=qe.length;Pe<ct;Pe++){const ft=qe[Pe],lt=n.get(ft);t.bindTexture(3553,lt.__webglTexture),Ae(3553,ft,wt),He(ge.__webglFramebuffer,Q,ft,36064+Pe,3553),B(ft,wt)&&j(3553)}t.unbindTexture()}else{let qe=3553;(Q.isWebGL3DRenderTarget||Q.isWebGLArrayRenderTarget)&&(c?qe=Q.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(qe,Ne.__webglTexture),Ae(qe,q,wt),He(ge.__webglFramebuffer,Q,q,36064,qe),B(q,wt)&&j(qe),t.unbindTexture()}Q.depthBuffer&&xe(Q)}function Oe(Q){const q=V(Q)||c,ge=Q.isWebGLMultipleRenderTargets===!0?Q.texture:[Q.texture];for(let Ne=0,je=ge.length;Ne<je;Ne++){const Ze=ge[Ne];if(B(Ze,q)){const wt=Q.isWebGLCubeRenderTarget?34067:3553,qe=n.get(Ze).__webglTexture;t.bindTexture(wt,qe),j(wt),t.unbindTexture()}}}function St(Q){if(c&&Q.samples>0&&dt(Q)===!1){const q=Q.isWebGLMultipleRenderTargets?Q.texture:[Q.texture],ge=Q.width,Ne=Q.height;let je=16384;const Ze=[],wt=Q.stencilBuffer?33306:36096,qe=n.get(Q),Pe=Q.isWebGLMultipleRenderTargets===!0;if(Pe)for(let ct=0;ct<q.length;ct++)t.bindFramebuffer(36160,qe.__webglMultisampledFramebuffer),h.framebufferRenderbuffer(36160,36064+ct,36161,null),t.bindFramebuffer(36160,qe.__webglFramebuffer),h.framebufferTexture2D(36009,36064+ct,3553,null,0);t.bindFramebuffer(36008,qe.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,qe.__webglFramebuffer);for(let ct=0;ct<q.length;ct++){Ze.push(36064+ct),Q.depthBuffer&&Ze.push(wt);const ft=qe.__ignoreDepthValues!==void 0?qe.__ignoreDepthValues:!1;if(ft===!1&&(Q.depthBuffer&&(je|=256),Q.stencilBuffer&&(je|=1024)),Pe&&h.framebufferRenderbuffer(36008,36064,36161,qe.__webglColorRenderbuffer[ct]),ft===!0&&(h.invalidateFramebuffer(36008,[wt]),h.invalidateFramebuffer(36009,[wt])),Pe){const lt=n.get(q[ct]).__webglTexture;h.framebufferTexture2D(36009,36064,3553,lt,0)}h.blitFramebuffer(0,0,ge,Ne,0,0,ge,Ne,je,9728),y&&h.invalidateFramebuffer(36008,Ze)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),Pe)for(let ct=0;ct<q.length;ct++){t.bindFramebuffer(36160,qe.__webglMultisampledFramebuffer),h.framebufferRenderbuffer(36160,36064+ct,36161,qe.__webglColorRenderbuffer[ct]);const ft=n.get(q[ct]).__webglTexture;t.bindFramebuffer(36160,qe.__webglFramebuffer),h.framebufferTexture2D(36009,36064+ct,3553,ft,0)}t.bindFramebuffer(36009,qe.__webglMultisampledFramebuffer)}}function vt(Q){return Math.min(g,Q.samples)}function dt(Q){const q=n.get(Q);return c&&Q.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&q.__useRenderToTexture!==!1}function en(Q){const q=a.render.frame;S.get(Q)!==q&&(S.set(Q,q),Q.update())}function Xt(Q,q){const ge=Q.encoding,Ne=Q.format,je=Q.type;return Q.isCompressedTexture===!0||Q.isVideoTexture===!0||Q.format===Qu||ge!==Bo&&(ge===vn?c===!1?e.has("EXT_sRGB")===!0&&Ne===Xs?(Q.format=Qu,Q.minFilter=Ln,Q.generateMipmaps=!1):q=Fm.sRGBToLinear(q):(Ne!==Xs||je!==Fo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ge)),q}this.allocateTextureUnit=he,this.resetTextureUnits=de,this.setTexture2D=me,this.setTexture2DArray=ze,this.setTexture3D=Te,this.setTextureCube=Re,this.rebindTextures=Ve,this.setupRenderTarget=Ye,this.updateRenderTargetMipmap=Oe,this.updateMultisampleRenderTarget=St,this.setupDepthRenderbuffer=xe,this.setupFrameBufferTexture=He,this.useMultisampledRTT=dt}function Ub(h,e,t){const n=t.isWebGL2;function i(o,a=null){let c;if(o===Fo)return 5121;if(o===hb)return 32819;if(o===ub)return 32820;if(o===ab)return 5120;if(o===lb)return 5122;if(o===Vm)return 5123;if(o===cb)return 5124;if(o===Do)return 5125;if(o===Zr)return 5126;if(o===dl)return n?5131:(c=e.get("OES_texture_half_float"),c!==null?c.HALF_FLOAT_OES:null);if(o===db)return 6406;if(o===Xs)return 6408;if(o===fb)return 6409;if(o===mb)return 6410;if(o===Vo)return 6402;if(o===wa)return 34041;if(o===vb)return 6403;if(o===pb)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(o===Qu)return c=e.get("EXT_sRGB"),c!==null?c.SRGB_ALPHA_EXT:null;if(o===gb)return 36244;if(o===_b)return 33319;if(o===bb)return 33320;if(o===wb)return 36249;if(o===Bu||o===Uu||o===Hu||o===Gu)if(a===vn)if(c=e.get("WEBGL_compressed_texture_s3tc_srgb"),c!==null){if(o===Bu)return c.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===Uu)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===Hu)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===Gu)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(c=e.get("WEBGL_compressed_texture_s3tc"),c!==null){if(o===Bu)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===Uu)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===Hu)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===Gu)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===Hf||o===Gf||o===Wf||o===jf)if(c=e.get("WEBGL_compressed_texture_pvrtc"),c!==null){if(o===Hf)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===Gf)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===Wf)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===jf)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===xb)return c=e.get("WEBGL_compressed_texture_etc1"),c!==null?c.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===Kf||o===qf)if(c=e.get("WEBGL_compressed_texture_etc"),c!==null){if(o===Kf)return a===vn?c.COMPRESSED_SRGB8_ETC2:c.COMPRESSED_RGB8_ETC2;if(o===qf)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===Xf||o===$f||o===Yf||o===Zf||o===Jf||o===Qf||o===em||o===tm||o===nm||o===im||o===sm||o===rm||o===om||o===am)if(c=e.get("WEBGL_compressed_texture_astc"),c!==null){if(o===Xf)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:c.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===$f)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:c.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===Yf)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:c.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===Zf)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:c.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===Jf)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:c.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===Qf)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:c.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===em)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:c.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===tm)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:c.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===nm)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:c.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===im)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:c.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===sm)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:c.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===rm)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:c.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===om)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:c.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===am)return a===vn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:c.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===lm)if(c=e.get("EXT_texture_compression_bptc"),c!==null){if(o===lm)return a===vn?c.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:c.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return o===fa?n?34042:(c=e.get("WEBGL_depth_texture"),c!==null?c.UNSIGNED_INT_24_8_WEBGL:null):h[o]!==void 0?h[o]:null}return{convert:i}}class Hb extends Ri{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Ls extends Jt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const nE={type:"move"};class bf{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ls,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ls,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new X,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new X),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ls,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new X,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new X),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,o=null,a=null;const c=this._targetRay,u=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(d&&e.hand){a=!0;for(const E of e.hand.values()){const M=t.getJointPose(E,n);if(d.joints[E.jointName]===void 0){const R=new Ls;R.matrixAutoUpdate=!1,R.visible=!1,d.joints[E.jointName]=R,d.add(R)}const L=d.joints[E.jointName];M!==null&&(L.matrix.fromArray(M.transform.matrix),L.matrix.decompose(L.position,L.rotation,L.scale),L.jointRadius=M.radius),L.visible=M!==null}const v=d.joints["index-finger-tip"],g=d.joints["thumb-tip"],b=v.position.distanceTo(g.position),y=.02,S=.005;d.inputState.pinching&&b>y+S?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&b<=y-S&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else u!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,n),o!==null&&(u.matrix.fromArray(o.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),o.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(o.linearVelocity)):u.hasLinearVelocity=!1,o.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(o.angularVelocity)):u.hasAngularVelocity=!1));c!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&o!==null&&(i=o),i!==null&&(c.matrix.fromArray(i.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),i.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(i.linearVelocity)):c.hasLinearVelocity=!1,i.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(i.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(nE)))}return c!==null&&(c.visible=i!==null),u!==null&&(u.visible=o!==null),d!==null&&(d.visible=a!==null),this}}class Gb extends Kn{constructor(e,t,n,i,o,a,c,u,d,v){if(v=v!==void 0?v:Vo,v!==Vo&&v!==wa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&v===Vo&&(n=Do),n===void 0&&v===wa&&(n=fa),super(null,i,o,a,c,u,v,n,d),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=c!==void 0?c:ei,this.minFilter=u!==void 0?u:ei,this.flipY=!1,this.generateMipmaps=!1}}class iE extends ro{constructor(e,t){super();const n=this;let i=null,o=1,a=null,c="local-floor",u=null,d=null,v=null,g=null,b=null,y=null;const S=t.getContextAttributes();let E=null,M=null;const L=[],R=[],z=new Ri;z.layers.enable(1),z.viewport=new wn;const V=new Ri;V.layers.enable(2),V.viewport=new wn;const H=[z,V],B=new Hb;B.layers.enable(1),B.layers.enable(2);let j=null,F=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ue){let me=L[ue];return me===void 0&&(me=new bf,L[ue]=me),me.getTargetRaySpace()},this.getControllerGrip=function(ue){let me=L[ue];return me===void 0&&(me=new bf,L[ue]=me),me.getGripSpace()},this.getHand=function(ue){let me=L[ue];return me===void 0&&(me=new bf,L[ue]=me),me.getHandSpace()};function W(ue){const me=R.indexOf(ue.inputSource);if(me===-1)return;const ze=L[me];ze!==void 0&&ze.dispatchEvent({type:ue.type,data:ue.inputSource})}function Z(){i.removeEventListener("select",W),i.removeEventListener("selectstart",W),i.removeEventListener("selectend",W),i.removeEventListener("squeeze",W),i.removeEventListener("squeezestart",W),i.removeEventListener("squeezeend",W),i.removeEventListener("end",Z),i.removeEventListener("inputsourceschange",se);for(let ue=0;ue<L.length;ue++){const me=R[ue];me!==null&&(R[ue]=null,L[ue].disconnect(me))}j=null,F=null,e.setRenderTarget(E),b=null,g=null,v=null,i=null,M=null,he.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ue){o=ue,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ue){c=ue,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(ue){u=ue},this.getBaseLayer=function(){return g!==null?g:b},this.getBinding=function(){return v},this.getFrame=function(){return y},this.getSession=function(){return i},this.setSession=async function(ue){if(i=ue,i!==null){if(E=e.getRenderTarget(),i.addEventListener("select",W),i.addEventListener("selectstart",W),i.addEventListener("selectend",W),i.addEventListener("squeeze",W),i.addEventListener("squeezestart",W),i.addEventListener("squeezeend",W),i.addEventListener("end",Z),i.addEventListener("inputsourceschange",se),S.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const me={antialias:i.renderState.layers===void 0?S.antialias:!0,alpha:S.alpha,depth:S.depth,stencil:S.stencil,framebufferScaleFactor:o};b=new XRWebGLLayer(i,t,me),i.updateRenderState({baseLayer:b}),M=new $s(b.framebufferWidth,b.framebufferHeight,{format:Xs,type:Fo,encoding:e.outputEncoding,stencilBuffer:S.stencil})}else{let me=null,ze=null,Te=null;S.depth&&(Te=S.stencil?35056:33190,me=S.stencil?wa:Vo,ze=S.stencil?fa:Do);const Re={colorFormat:32856,depthFormat:Te,scaleFactor:o};v=new XRWebGLBinding(i,t),g=v.createProjectionLayer(Re),i.updateRenderState({layers:[g]}),M=new $s(g.textureWidth,g.textureHeight,{format:Xs,type:Fo,depthTexture:new Gb(g.textureWidth,g.textureHeight,ze,void 0,void 0,void 0,void 0,void 0,void 0,me),stencilBuffer:S.stencil,encoding:e.outputEncoding,samples:S.antialias?4:0});const Ie=e.properties.get(M);Ie.__ignoreDepthValues=g.ignoreDepthValues}M.isXRRenderTarget=!0,this.setFoveation(1),u=null,a=await i.requestReferenceSpace(c),he.setContext(i),he.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function se(ue){for(let me=0;me<ue.removed.length;me++){const ze=ue.removed[me],Te=R.indexOf(ze);Te>=0&&(R[Te]=null,L[Te].dispatchEvent({type:"disconnected",data:ze}))}for(let me=0;me<ue.added.length;me++){const ze=ue.added[me];let Te=R.indexOf(ze);if(Te===-1){for(let Ie=0;Ie<L.length;Ie++)if(Ie>=R.length){R.push(ze),Te=Ie;break}else if(R[Ie]===null){R[Ie]=ze,Te=Ie;break}if(Te===-1)break}const Re=L[Te];Re&&Re.dispatchEvent({type:"connected",data:ze})}}const we=new X,oe=new X;function ne(ue,me,ze){we.setFromMatrixPosition(me.matrixWorld),oe.setFromMatrixPosition(ze.matrixWorld);const Te=we.distanceTo(oe),Re=me.projectionMatrix.elements,Ie=ze.projectionMatrix.elements,rt=Re[14]/(Re[10]-1),Ae=Re[14]/(Re[10]+1),pt=(Re[9]+1)/Re[5],nt=(Re[9]-1)/Re[5],Et=(Re[8]-1)/Re[0],He=(Ie[8]+1)/Ie[0],mt=rt*Et,ke=rt*He,xe=Te/(-Et+He),Ve=xe*-Et;me.matrixWorld.decompose(ue.position,ue.quaternion,ue.scale),ue.translateX(Ve),ue.translateZ(xe),ue.matrixWorld.compose(ue.position,ue.quaternion,ue.scale),ue.matrixWorldInverse.copy(ue.matrixWorld).invert();const Ye=rt+xe,Oe=Ae+xe,St=mt-Ve,vt=ke+(Te-Ve),dt=pt*Ae/Oe*Ye,en=nt*Ae/Oe*Ye;ue.projectionMatrix.makePerspective(St,vt,dt,en,Ye,Oe)}function ce(ue,me){me===null?ue.matrixWorld.copy(ue.matrix):ue.matrixWorld.multiplyMatrices(me.matrixWorld,ue.matrix),ue.matrixWorldInverse.copy(ue.matrixWorld).invert()}this.updateCamera=function(ue){if(i===null)return;B.near=V.near=z.near=ue.near,B.far=V.far=z.far=ue.far,(j!==B.near||F!==B.far)&&(i.updateRenderState({depthNear:B.near,depthFar:B.far}),j=B.near,F=B.far);const me=ue.parent,ze=B.cameras;ce(B,me);for(let Re=0;Re<ze.length;Re++)ce(ze[Re],me);B.matrixWorld.decompose(B.position,B.quaternion,B.scale),ue.matrix.copy(B.matrix),ue.matrix.decompose(ue.position,ue.quaternion,ue.scale);const Te=ue.children;for(let Re=0,Ie=Te.length;Re<Ie;Re++)Te[Re].updateMatrixWorld(!0);ze.length===2?ne(B,z,V):B.projectionMatrix.copy(z.projectionMatrix)},this.getCamera=function(){return B},this.getFoveation=function(){if(g!==null)return g.fixedFoveation;if(b!==null)return b.fixedFoveation},this.setFoveation=function(ue){g!==null&&(g.fixedFoveation=ue),b!==null&&b.fixedFoveation!==void 0&&(b.fixedFoveation=ue)};let ve=null;function de(ue,me){if(d=me.getViewerPose(u||a),y=me,d!==null){const ze=d.views;b!==null&&(e.setRenderTargetFramebuffer(M,b.framebuffer),e.setRenderTarget(M));let Te=!1;ze.length!==B.cameras.length&&(B.cameras.length=0,Te=!0);for(let Re=0;Re<ze.length;Re++){const Ie=ze[Re];let rt=null;if(b!==null)rt=b.getViewport(Ie);else{const pt=v.getViewSubImage(g,Ie);rt=pt.viewport,Re===0&&(e.setRenderTargetTextures(M,pt.colorTexture,g.ignoreDepthValues?void 0:pt.depthStencilTexture),e.setRenderTarget(M))}let Ae=H[Re];Ae===void 0&&(Ae=new Ri,Ae.layers.enable(Re),Ae.viewport=new wn,H[Re]=Ae),Ae.matrix.fromArray(Ie.transform.matrix),Ae.projectionMatrix.fromArray(Ie.projectionMatrix),Ae.viewport.set(rt.x,rt.y,rt.width,rt.height),Re===0&&B.matrix.copy(Ae.matrix),Te===!0&&B.cameras.push(Ae)}}for(let ze=0;ze<L.length;ze++){const Te=R[ze],Re=L[ze];Te!==null&&Re!==void 0&&Re.update(Te,me,u||a)}ve&&ve(ue,me),y=null}const he=new Vb;he.setAnimationLoop(de),this.setAnimationLoop=function(ue){ve=ue},this.dispose=function(){}}}function sE(h,e){function t(E,M){E.fogColor.value.copy(M.color),M.isFog?(E.fogNear.value=M.near,E.fogFar.value=M.far):M.isFogExp2&&(E.fogDensity.value=M.density)}function n(E,M,L,R,z){M.isMeshBasicMaterial||M.isMeshLambertMaterial?i(E,M):M.isMeshToonMaterial?(i(E,M),v(E,M)):M.isMeshPhongMaterial?(i(E,M),d(E,M)):M.isMeshStandardMaterial?(i(E,M),g(E,M),M.isMeshPhysicalMaterial&&b(E,M,z)):M.isMeshMatcapMaterial?(i(E,M),y(E,M)):M.isMeshDepthMaterial?i(E,M):M.isMeshDistanceMaterial?(i(E,M),S(E,M)):M.isMeshNormalMaterial?i(E,M):M.isLineBasicMaterial?(o(E,M),M.isLineDashedMaterial&&a(E,M)):M.isPointsMaterial?c(E,M,L,R):M.isSpriteMaterial?u(E,M):M.isShadowMaterial?(E.color.value.copy(M.color),E.opacity.value=M.opacity):M.isShaderMaterial&&(M.uniformsNeedUpdate=!1)}function i(E,M){E.opacity.value=M.opacity,M.color&&E.diffuse.value.copy(M.color),M.emissive&&E.emissive.value.copy(M.emissive).multiplyScalar(M.emissiveIntensity),M.map&&(E.map.value=M.map),M.alphaMap&&(E.alphaMap.value=M.alphaMap),M.bumpMap&&(E.bumpMap.value=M.bumpMap,E.bumpScale.value=M.bumpScale,M.side===ks&&(E.bumpScale.value*=-1)),M.displacementMap&&(E.displacementMap.value=M.displacementMap,E.displacementScale.value=M.displacementScale,E.displacementBias.value=M.displacementBias),M.emissiveMap&&(E.emissiveMap.value=M.emissiveMap),M.normalMap&&(E.normalMap.value=M.normalMap,E.normalScale.value.copy(M.normalScale),M.side===ks&&E.normalScale.value.negate()),M.specularMap&&(E.specularMap.value=M.specularMap),M.alphaTest>0&&(E.alphaTest.value=M.alphaTest);const L=e.get(M).envMap;if(L&&(E.envMap.value=L,E.flipEnvMap.value=L.isCubeTexture&&L.isRenderTargetTexture===!1?-1:1,E.reflectivity.value=M.reflectivity,E.ior.value=M.ior,E.refractionRatio.value=M.refractionRatio),M.lightMap){E.lightMap.value=M.lightMap;const V=h.physicallyCorrectLights!==!0?Math.PI:1;E.lightMapIntensity.value=M.lightMapIntensity*V}M.aoMap&&(E.aoMap.value=M.aoMap,E.aoMapIntensity.value=M.aoMapIntensity);let R;M.map?R=M.map:M.specularMap?R=M.specularMap:M.displacementMap?R=M.displacementMap:M.normalMap?R=M.normalMap:M.bumpMap?R=M.bumpMap:M.roughnessMap?R=M.roughnessMap:M.metalnessMap?R=M.metalnessMap:M.alphaMap?R=M.alphaMap:M.emissiveMap?R=M.emissiveMap:M.clearcoatMap?R=M.clearcoatMap:M.clearcoatNormalMap?R=M.clearcoatNormalMap:M.clearcoatRoughnessMap?R=M.clearcoatRoughnessMap:M.iridescenceMap?R=M.iridescenceMap:M.iridescenceThicknessMap?R=M.iridescenceThicknessMap:M.specularIntensityMap?R=M.specularIntensityMap:M.specularColorMap?R=M.specularColorMap:M.transmissionMap?R=M.transmissionMap:M.thicknessMap?R=M.thicknessMap:M.sheenColorMap?R=M.sheenColorMap:M.sheenRoughnessMap&&(R=M.sheenRoughnessMap),R!==void 0&&(R.isWebGLRenderTarget&&(R=R.texture),R.matrixAutoUpdate===!0&&R.updateMatrix(),E.uvTransform.value.copy(R.matrix));let z;M.aoMap?z=M.aoMap:M.lightMap&&(z=M.lightMap),z!==void 0&&(z.isWebGLRenderTarget&&(z=z.texture),z.matrixAutoUpdate===!0&&z.updateMatrix(),E.uv2Transform.value.copy(z.matrix))}function o(E,M){E.diffuse.value.copy(M.color),E.opacity.value=M.opacity}function a(E,M){E.dashSize.value=M.dashSize,E.totalSize.value=M.dashSize+M.gapSize,E.scale.value=M.scale}function c(E,M,L,R){E.diffuse.value.copy(M.color),E.opacity.value=M.opacity,E.size.value=M.size*L,E.scale.value=R*.5,M.map&&(E.map.value=M.map),M.alphaMap&&(E.alphaMap.value=M.alphaMap),M.alphaTest>0&&(E.alphaTest.value=M.alphaTest);let z;M.map?z=M.map:M.alphaMap&&(z=M.alphaMap),z!==void 0&&(z.matrixAutoUpdate===!0&&z.updateMatrix(),E.uvTransform.value.copy(z.matrix))}function u(E,M){E.diffuse.value.copy(M.color),E.opacity.value=M.opacity,E.rotation.value=M.rotation,M.map&&(E.map.value=M.map),M.alphaMap&&(E.alphaMap.value=M.alphaMap),M.alphaTest>0&&(E.alphaTest.value=M.alphaTest);let L;M.map?L=M.map:M.alphaMap&&(L=M.alphaMap),L!==void 0&&(L.matrixAutoUpdate===!0&&L.updateMatrix(),E.uvTransform.value.copy(L.matrix))}function d(E,M){E.specular.value.copy(M.specular),E.shininess.value=Math.max(M.shininess,1e-4)}function v(E,M){M.gradientMap&&(E.gradientMap.value=M.gradientMap)}function g(E,M){E.roughness.value=M.roughness,E.metalness.value=M.metalness,M.roughnessMap&&(E.roughnessMap.value=M.roughnessMap),M.metalnessMap&&(E.metalnessMap.value=M.metalnessMap),e.get(M).envMap&&(E.envMapIntensity.value=M.envMapIntensity)}function b(E,M,L){E.ior.value=M.ior,M.sheen>0&&(E.sheenColor.value.copy(M.sheenColor).multiplyScalar(M.sheen),E.sheenRoughness.value=M.sheenRoughness,M.sheenColorMap&&(E.sheenColorMap.value=M.sheenColorMap),M.sheenRoughnessMap&&(E.sheenRoughnessMap.value=M.sheenRoughnessMap)),M.clearcoat>0&&(E.clearcoat.value=M.clearcoat,E.clearcoatRoughness.value=M.clearcoatRoughness,M.clearcoatMap&&(E.clearcoatMap.value=M.clearcoatMap),M.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=M.clearcoatRoughnessMap),M.clearcoatNormalMap&&(E.clearcoatNormalScale.value.copy(M.clearcoatNormalScale),E.clearcoatNormalMap.value=M.clearcoatNormalMap,M.side===ks&&E.clearcoatNormalScale.value.negate())),M.iridescence>0&&(E.iridescence.value=M.iridescence,E.iridescenceIOR.value=M.iridescenceIOR,E.iridescenceThicknessMinimum.value=M.iridescenceThicknessRange[0],E.iridescenceThicknessMaximum.value=M.iridescenceThicknessRange[1],M.iridescenceMap&&(E.iridescenceMap.value=M.iridescenceMap),M.iridescenceThicknessMap&&(E.iridescenceThicknessMap.value=M.iridescenceThicknessMap)),M.transmission>0&&(E.transmission.value=M.transmission,E.transmissionSamplerMap.value=L.texture,E.transmissionSamplerSize.value.set(L.width,L.height),M.transmissionMap&&(E.transmissionMap.value=M.transmissionMap),E.thickness.value=M.thickness,M.thicknessMap&&(E.thicknessMap.value=M.thicknessMap),E.attenuationDistance.value=M.attenuationDistance,E.attenuationColor.value.copy(M.attenuationColor)),E.specularIntensity.value=M.specularIntensity,E.specularColor.value.copy(M.specularColor),M.specularIntensityMap&&(E.specularIntensityMap.value=M.specularIntensityMap),M.specularColorMap&&(E.specularColorMap.value=M.specularColorMap)}function y(E,M){M.matcap&&(E.matcap.value=M.matcap)}function S(E,M){E.referencePosition.value.copy(M.referencePosition),E.nearDistance.value=M.nearDistance,E.farDistance.value=M.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function rE(h,e,t,n){let i={},o={},a=[];const c=t.isWebGL2?h.getParameter(35375):0;function u(R,z){const V=z.program;n.uniformBlockBinding(R,V)}function d(R,z){let V=i[R.id];V===void 0&&(S(R),V=v(R),i[R.id]=V,R.addEventListener("dispose",M));const H=z.program;n.updateUBOMapping(R,H);const B=e.render.frame;o[R.id]!==B&&(b(R),o[R.id]=B)}function v(R){const z=g();R.__bindingPointIndex=z;const V=h.createBuffer(),H=R.__size,B=R.usage;return h.bindBuffer(35345,V),h.bufferData(35345,H,B),h.bindBuffer(35345,null),h.bindBufferBase(35345,z,V),V}function g(){for(let R=0;R<c;R++)if(a.indexOf(R)===-1)return a.push(R),R;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function b(R){const z=i[R.id],V=R.uniforms,H=R.__cache;h.bindBuffer(35345,z);for(let B=0,j=V.length;B<j;B++){const F=V[B];if(y(F,B,H)===!0){const W=F.value,Z=F.__offset;typeof W=="number"?(F.__data[0]=W,h.bufferSubData(35345,Z,F.__data)):(F.value.isMatrix3?(F.__data[0]=F.value.elements[0],F.__data[1]=F.value.elements[1],F.__data[2]=F.value.elements[2],F.__data[3]=F.value.elements[0],F.__data[4]=F.value.elements[3],F.__data[5]=F.value.elements[4],F.__data[6]=F.value.elements[5],F.__data[7]=F.value.elements[0],F.__data[8]=F.value.elements[6],F.__data[9]=F.value.elements[7],F.__data[10]=F.value.elements[8],F.__data[11]=F.value.elements[0]):W.toArray(F.__data),h.bufferSubData(35345,Z,F.__data))}}h.bindBuffer(35345,null)}function y(R,z,V){const H=R.value;if(V[z]===void 0)return typeof H=="number"?V[z]=H:V[z]=H.clone(),!0;if(typeof H=="number"){if(V[z]!==H)return V[z]=H,!0}else{const B=V[z];if(B.equals(H)===!1)return B.copy(H),!0}return!1}function S(R){const z=R.uniforms;let V=0;const H=16;let B=0;for(let j=0,F=z.length;j<F;j++){const W=z[j],Z=E(W);if(W.__data=new Float32Array(Z.storage/Float32Array.BYTES_PER_ELEMENT),W.__offset=V,j>0){B=V%H;const se=H-B;B!==0&&se-Z.boundary<0&&(V+=H-B,W.__offset=V)}V+=Z.storage}return B=V%H,B>0&&(V+=H-B),R.__size=V,R.__cache={},this}function E(R){const z=R.value,V={boundary:0,storage:0};return typeof z=="number"?(V.boundary=4,V.storage=4):z.isVector2?(V.boundary=8,V.storage=8):z.isVector3||z.isColor?(V.boundary=16,V.storage=12):z.isVector4?(V.boundary=16,V.storage=16):z.isMatrix3?(V.boundary=48,V.storage=48):z.isMatrix4?(V.boundary=64,V.storage=64):z.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",z),V}function M(R){const z=R.target;z.removeEventListener("dispose",M);const V=a.indexOf(z.__bindingPointIndex);a.splice(V,1),h.deleteBuffer(i[z.id]),delete i[z.id],delete o[z.id]}function L(){for(const R in i)h.deleteBuffer(i[R]);a=[],i={},o={}}return{bind:u,update:d,dispose:L}}function oE(){const h=Bc("canvas");return h.style.display="block",h}function jm(h={}){this.isWebGLRenderer=!0;const e=h.canvas!==void 0?h.canvas:oE(),t=h.context!==void 0?h.context:null,n=h.depth!==void 0?h.depth:!0,i=h.stencil!==void 0?h.stencil:!0,o=h.antialias!==void 0?h.antialias:!1,a=h.premultipliedAlpha!==void 0?h.premultipliedAlpha:!0,c=h.preserveDrawingBuffer!==void 0?h.preserveDrawingBuffer:!1,u=h.powerPreference!==void 0?h.powerPreference:"default",d=h.failIfMajorPerformanceCaveat!==void 0?h.failIfMajorPerformanceCaveat:!1;let v;t!==null?v=t.getContextAttributes().alpha:v=h.alpha!==void 0?h.alpha:!1;let g=null,b=null;const y=[],S=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Bo,this.physicallyCorrectLights=!1,this.toneMapping=Lr,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const E=this;let M=!1,L=0,R=0,z=null,V=-1,H=null;const B=new wn,j=new wn;let F=null,W=e.width,Z=e.height,se=1,we=null,oe=null;const ne=new wn(0,0,W,Z),ce=new wn(0,0,W,Z);let ve=!1;const de=new pd;let he=!1,ue=!1,me=null;const ze=new It,Te=new De,Re=new X,Ie={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function rt(){return z===null?se:1}let Ae=t;function pt($,pe){for(let Me=0;Me<$.length;Me++){const le=$[Me],Se=e.getContext(le,pe);if(Se!==null)return Se}return null}try{const $={alpha:!0,depth:n,stencil:i,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${sd}`),e.addEventListener("webglcontextlost",gt,!1),e.addEventListener("webglcontextrestored",yt,!1),e.addEventListener("webglcontextcreationerror",Dt,!1),Ae===null){const pe=["webgl2","webgl","experimental-webgl"];if(E.isWebGL1Renderer===!0&&pe.shift(),Ae=pt(pe,$),Ae===null)throw pt(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ae.getShaderPrecisionFormat===void 0&&(Ae.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch($){throw console.error("THREE.WebGLRenderer: "+$.message),$}let nt,Et,He,mt,ke,xe,Ve,Ye,Oe,St,vt,dt,en,Xt,Q,q,ge,Ne,je,Ze,wt,qe,Pe,ct;function ft(){nt=new y1(Ae),Et=new v1(Ae,nt,h),nt.init(Et),qe=new Ub(Ae,nt,Et),He=new eE(Ae,nt,Et),mt=new E1,ke=new HM,xe=new tE(Ae,nt,He,ke,Et,qe,mt),Ve=new _1(E),Ye=new x1(E),Oe=new Vx(Ae,Et),Pe=new f1(Ae,nt,Oe,Et),St=new C1(Ae,Oe,mt,Pe),vt=new T1(Ae,St,Oe,mt),je=new P1(Ae,Et,xe),q=new g1(ke),dt=new UM(E,Ve,Ye,nt,Et,Pe,q),en=new sE(E,ke),Xt=new WM,Q=new YM(nt,Et),Ne=new p1(E,Ve,He,vt,v,a),ge=new QM(E,vt,Et),ct=new rE(Ae,mt,Et,He),Ze=new m1(Ae,nt,mt,Et),wt=new M1(Ae,nt,mt,Et),mt.programs=dt.programs,E.capabilities=Et,E.extensions=nt,E.properties=ke,E.renderLists=Xt,E.shadowMap=ge,E.state=He,E.info=mt}ft();const lt=new iE(E,Ae);this.xr=lt,this.getContext=function(){return Ae},this.getContextAttributes=function(){return Ae.getContextAttributes()},this.forceContextLoss=function(){const $=nt.get("WEBGL_lose_context");$&&$.loseContext()},this.forceContextRestore=function(){const $=nt.get("WEBGL_lose_context");$&&$.restoreContext()},this.getPixelRatio=function(){return se},this.setPixelRatio=function($){$!==void 0&&(se=$,this.setSize(W,Z,!1))},this.getSize=function($){return $.set(W,Z)},this.setSize=function($,pe,Me){if(lt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}W=$,Z=pe,e.width=Math.floor($*se),e.height=Math.floor(pe*se),Me!==!1&&(e.style.width=$+"px",e.style.height=pe+"px"),this.setViewport(0,0,$,pe)},this.getDrawingBufferSize=function($){return $.set(W*se,Z*se).floor()},this.setDrawingBufferSize=function($,pe,Me){W=$,Z=pe,se=Me,e.width=Math.floor($*Me),e.height=Math.floor(pe*Me),this.setViewport(0,0,$,pe)},this.getCurrentViewport=function($){return $.copy(B)},this.getViewport=function($){return $.copy(ne)},this.setViewport=function($,pe,Me,le){$.isVector4?ne.set($.x,$.y,$.z,$.w):ne.set($,pe,Me,le),He.viewport(B.copy(ne).multiplyScalar(se).floor())},this.getScissor=function($){return $.copy(ce)},this.setScissor=function($,pe,Me,le){$.isVector4?ce.set($.x,$.y,$.z,$.w):ce.set($,pe,Me,le),He.scissor(j.copy(ce).multiplyScalar(se).floor())},this.getScissorTest=function(){return ve},this.setScissorTest=function($){He.setScissorTest(ve=$)},this.setOpaqueSort=function($){we=$},this.setTransparentSort=function($){oe=$},this.getClearColor=function($){return $.copy(Ne.getClearColor())},this.setClearColor=function(){Ne.setClearColor.apply(Ne,arguments)},this.getClearAlpha=function(){return Ne.getClearAlpha()},this.setClearAlpha=function(){Ne.setClearAlpha.apply(Ne,arguments)},this.clear=function($=!0,pe=!0,Me=!0){let le=0;$&&(le|=16384),pe&&(le|=256),Me&&(le|=1024),Ae.clear(le)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",gt,!1),e.removeEventListener("webglcontextrestored",yt,!1),e.removeEventListener("webglcontextcreationerror",Dt,!1),Xt.dispose(),Q.dispose(),ke.dispose(),Ve.dispose(),Ye.dispose(),vt.dispose(),Pe.dispose(),ct.dispose(),dt.dispose(),lt.dispose(),lt.removeEventListener("sessionstart",_t),lt.removeEventListener("sessionend",Yt),me&&(me.dispose(),me=null),an.stop()};function gt($){$.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function yt(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;const $=mt.autoReset,pe=ge.enabled,Me=ge.autoUpdate,le=ge.needsUpdate,Se=ge.type;ft(),mt.autoReset=$,ge.enabled=pe,ge.autoUpdate=Me,ge.needsUpdate=le,ge.type=Se}function Dt($){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",$.statusMessage)}function ie($){const pe=$.target;pe.removeEventListener("dispose",ie),at(pe)}function at($){Ge($),ke.remove($)}function Ge($){const pe=ke.get($).programs;pe!==void 0&&(pe.forEach(function(Me){dt.releaseProgram(Me)}),$.isShaderMaterial&&dt.releaseShaderCache($))}this.renderBufferDirect=function($,pe,Me,le,Se,ut){pe===null&&(pe=Ie);const At=Se.isMesh&&Se.matrixWorld.determinant()<0,zt=yi($,pe,Me,le,Se);He.setMaterial(le,At);let xt=Me.index;const Pt=Me.attributes.position;if(xt===null){if(Pt===void 0||Pt.count===0)return}else if(xt.count===0)return;let Je=1;le.wireframe===!0&&(xt=St.getWireframeAttribute(Me),Je=2),Pe.setup(Se,le,zt,Me,xt);let et,Ct=Ze;xt!==null&&(et=Oe.get(xt),Ct=wt,Ct.setIndex(et));const it=xt!==null?xt.count:Pt.count,ht=Me.drawRange.start*Je,Qt=Me.drawRange.count*Je,ot=ut!==null?ut.start*Je:0,Ue=ut!==null?ut.count*Je:1/0,Cn=Math.max(ht,ot),Ht=Math.min(it,ht+Qt,ot+Ue)-1,Ut=Math.max(0,Ht-Cn+1);if(Ut!==0){if(Se.isMesh)le.wireframe===!0?(He.setLineWidth(le.wireframeLinewidth*rt()),Ct.setMode(1)):Ct.setMode(4);else if(Se.isLine){let fn=le.linewidth;fn===void 0&&(fn=1),He.setLineWidth(fn*rt()),Se.isLineSegments?Ct.setMode(1):Se.isLineLoop?Ct.setMode(2):Ct.setMode(3)}else Se.isPoints?Ct.setMode(0):Se.isSprite&&Ct.setMode(4);if(Se.isInstancedMesh)Ct.renderInstances(Cn,Ut,Se.count);else if(Me.isInstancedBufferGeometry){const fn=Math.min(Me.instanceCount,Me._maxInstanceCount);Ct.renderInstances(Cn,Ut,fn)}else Ct.render(Cn,Ut)}},this.compile=function($,pe){function Me(le,Se,ut){le.transparent===!0&&le.side===qs?(le.side=ks,le.needsUpdate=!0,tn(le,Se,ut),le.side=eo,le.needsUpdate=!0,tn(le,Se,ut),le.side=qs):tn(le,Se,ut)}b=Q.get($),b.init(),S.push(b),$.traverseVisible(function(le){le.isLight&&le.layers.test(pe.layers)&&(b.pushLight(le),le.castShadow&&b.pushShadow(le))}),b.setupLights(E.physicallyCorrectLights),$.traverse(function(le){const Se=le.material;if(Se)if(Array.isArray(Se))for(let ut=0;ut<Se.length;ut++){const At=Se[ut];Me(At,$,le)}else Me(Se,$,le)}),S.pop(),b=null};let Le=null;function We($){Le&&Le($)}function _t(){an.stop()}function Yt(){an.start()}const an=new Vb;an.setAnimationLoop(We),typeof self<"u"&&an.setContext(self),this.setAnimationLoop=function($){Le=$,lt.setAnimationLoop($),$===null?an.stop():an.start()},lt.addEventListener("sessionstart",_t),lt.addEventListener("sessionend",Yt),this.render=function($,pe){if(pe!==void 0&&pe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(M===!0)return;$.matrixWorldAutoUpdate===!0&&$.updateMatrixWorld(),pe.parent===null&&pe.matrixWorldAutoUpdate===!0&&pe.updateMatrixWorld(),lt.enabled===!0&&lt.isPresenting===!0&&(lt.cameraAutoUpdate===!0&&lt.updateCamera(pe),pe=lt.getCamera()),$.isScene===!0&&$.onBeforeRender(E,$,pe,z),b=Q.get($,S.length),b.init(),S.push(b),ze.multiplyMatrices(pe.projectionMatrix,pe.matrixWorldInverse),de.setFromProjectionMatrix(ze),ue=this.localClippingEnabled,he=q.init(this.clippingPlanes,ue,pe),g=Xt.get($,y.length),g.init(),y.push(g),xn($,pe,0,E.sortObjects),g.finish(),E.sortObjects===!0&&g.sort(we,oe),he===!0&&q.beginShadows();const Me=b.state.shadowsArray;if(ge.render(Me,$,pe),he===!0&&q.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ne.render(g,$),b.setupLights(E.physicallyCorrectLights),pe.isArrayCamera){const le=pe.cameras;for(let Se=0,ut=le.length;Se<ut;Se++){const At=le[Se];Gt(g,$,At,At.viewport)}}else Gt(g,$,pe);z!==null&&(xe.updateMultisampleRenderTarget(z),xe.updateRenderTargetMipmap(z)),$.isScene===!0&&$.onAfterRender(E,$,pe),Pe.resetDefaultState(),V=-1,H=null,S.pop(),S.length>0?b=S[S.length-1]:b=null,y.pop(),y.length>0?g=y[y.length-1]:g=null};function xn($,pe,Me,le){if($.visible===!1)return;if($.layers.test(pe.layers)){if($.isGroup)Me=$.renderOrder;else if($.isLOD)$.autoUpdate===!0&&$.update(pe);else if($.isLight)b.pushLight($),$.castShadow&&b.pushShadow($);else if($.isSprite){if(!$.frustumCulled||de.intersectsSprite($)){le&&Re.setFromMatrixPosition($.matrixWorld).applyMatrix4(ze);const At=vt.update($),zt=$.material;zt.visible&&g.push($,At,zt,Me,Re.z,null)}}else if(($.isMesh||$.isLine||$.isPoints)&&($.isSkinnedMesh&&$.skeleton.frame!==mt.render.frame&&($.skeleton.update(),$.skeleton.frame=mt.render.frame),!$.frustumCulled||de.intersectsObject($))){le&&Re.setFromMatrixPosition($.matrixWorld).applyMatrix4(ze);const At=vt.update($),zt=$.material;if(Array.isArray(zt)){const xt=At.groups;for(let Pt=0,Je=xt.length;Pt<Je;Pt++){const et=xt[Pt],Ct=zt[et.materialIndex];Ct&&Ct.visible&&g.push($,At,Ct,Me,Re.z,et)}}else zt.visible&&g.push($,At,zt,Me,Re.z,null)}}const ut=$.children;for(let At=0,zt=ut.length;At<zt;At++)xn(ut[At],pe,Me,le)}function Gt($,pe,Me,le){const Se=$.opaque,ut=$.transmissive,At=$.transparent;b.setupLightsView(Me),ut.length>0&&Bt(Se,pe,Me),le&&He.viewport(B.copy(le)),Se.length>0&&Ft(Se,pe,Me),ut.length>0&&Ft(ut,pe,Me),At.length>0&&Ft(At,pe,Me),He.buffers.depth.setTest(!0),He.buffers.depth.setMask(!0),He.buffers.color.setMask(!0),He.setPolygonOffset(!1)}function Bt($,pe,Me){const le=Et.isWebGL2;me===null&&(me=new $s(1,1,{generateMipmaps:!0,type:nt.has("EXT_color_buffer_half_float")?dl:Fo,minFilter:gr,samples:le&&o===!0?4:0})),E.getDrawingBufferSize(Te),le?me.setSize(Te.x,Te.y):me.setSize(ed(Te.x),ed(Te.y));const Se=E.getRenderTarget();E.setRenderTarget(me),E.clear();const ut=E.toneMapping;E.toneMapping=Lr,Ft($,pe,Me),E.toneMapping=ut,xe.updateMultisampleRenderTarget(me),xe.updateRenderTargetMipmap(me),E.setRenderTarget(Se)}function Ft($,pe,Me){const le=pe.isScene===!0?pe.overrideMaterial:null;for(let Se=0,ut=$.length;Se<ut;Se++){const At=$[Se],zt=At.object,xt=At.geometry,Pt=le===null?At.material:le,Je=At.group;zt.layers.test(Me.layers)&&ln(zt,pe,Me,xt,Pt,Je)}}function ln($,pe,Me,le,Se,ut){$.onBeforeRender(E,pe,Me,le,Se,ut),$.modelViewMatrix.multiplyMatrices(Me.matrixWorldInverse,$.matrixWorld),$.normalMatrix.getNormalMatrix($.modelViewMatrix),Se.onBeforeRender(E,pe,Me,le,$,ut),Se.transparent===!0&&Se.side===qs?(Se.side=ks,Se.needsUpdate=!0,E.renderBufferDirect(Me,pe,le,Se,$,ut),Se.side=eo,Se.needsUpdate=!0,E.renderBufferDirect(Me,pe,le,Se,$,ut),Se.side=qs):E.renderBufferDirect(Me,pe,le,Se,$,ut),$.onAfterRender(E,pe,Me,le,Se,ut)}function tn($,pe,Me){pe.isScene!==!0&&(pe=Ie);const le=ke.get($),Se=b.state.lights,ut=b.state.shadowsArray,At=Se.state.version,zt=dt.getParameters($,Se.state,ut,pe,Me),xt=dt.getProgramCacheKey(zt);let Pt=le.programs;le.environment=$.isMeshStandardMaterial?pe.environment:null,le.fog=pe.fog,le.envMap=($.isMeshStandardMaterial?Ye:Ve).get($.envMap||le.environment),Pt===void 0&&($.addEventListener("dispose",ie),Pt=new Map,le.programs=Pt);let Je=Pt.get(xt);if(Je!==void 0){if(le.currentProgram===Je&&le.lightsStateVersion===At)return xi($,zt),Je}else zt.uniforms=dt.getUniforms($),$.onBuild(Me,zt,E),$.onBeforeCompile(zt,E),Je=dt.acquireProgram(zt,xt),Pt.set(xt,Je),le.uniforms=zt.uniforms;const et=le.uniforms;(!$.isShaderMaterial&&!$.isRawShaderMaterial||$.clipping===!0)&&(et.clippingPlanes=q.uniform),xi($,zt),le.needsLights=yn($),le.lightsStateVersion=At,le.needsLights&&(et.ambientLightColor.value=Se.state.ambient,et.lightProbe.value=Se.state.probe,et.directionalLights.value=Se.state.directional,et.directionalLightShadows.value=Se.state.directionalShadow,et.spotLights.value=Se.state.spot,et.spotLightShadows.value=Se.state.spotShadow,et.rectAreaLights.value=Se.state.rectArea,et.ltc_1.value=Se.state.rectAreaLTC1,et.ltc_2.value=Se.state.rectAreaLTC2,et.pointLights.value=Se.state.point,et.pointLightShadows.value=Se.state.pointShadow,et.hemisphereLights.value=Se.state.hemi,et.directionalShadowMap.value=Se.state.directionalShadowMap,et.directionalShadowMatrix.value=Se.state.directionalShadowMatrix,et.spotShadowMap.value=Se.state.spotShadowMap,et.spotLightMatrix.value=Se.state.spotLightMatrix,et.spotLightMap.value=Se.state.spotLightMap,et.pointShadowMap.value=Se.state.pointShadowMap,et.pointShadowMatrix.value=Se.state.pointShadowMatrix);const Ct=Je.getUniforms(),it=qu.seqWithValue(Ct.seq,et);return le.currentProgram=Je,le.uniformsList=it,Je}function xi($,pe){const Me=ke.get($);Me.outputEncoding=pe.outputEncoding,Me.instancing=pe.instancing,Me.skinning=pe.skinning,Me.morphTargets=pe.morphTargets,Me.morphNormals=pe.morphNormals,Me.morphColors=pe.morphColors,Me.morphTargetsCount=pe.morphTargetsCount,Me.numClippingPlanes=pe.numClippingPlanes,Me.numIntersection=pe.numClipIntersection,Me.vertexAlphas=pe.vertexAlphas,Me.vertexTangents=pe.vertexTangents,Me.toneMapping=pe.toneMapping}function yi($,pe,Me,le,Se){pe.isScene!==!0&&(pe=Ie),xe.resetTextureUnits();const ut=pe.fog,At=le.isMeshStandardMaterial?pe.environment:null,zt=z===null?E.outputEncoding:z.isXRRenderTarget===!0?z.texture.encoding:Bo,xt=(le.isMeshStandardMaterial?Ye:Ve).get(le.envMap||At),Pt=le.vertexColors===!0&&!!Me.attributes.color&&Me.attributes.color.itemSize===4,Je=!!le.normalMap&&!!Me.attributes.tangent,et=!!Me.morphAttributes.position,Ct=!!Me.morphAttributes.normal,it=!!Me.morphAttributes.color,ht=le.toneMapped?E.toneMapping:Lr,Qt=Me.morphAttributes.position||Me.morphAttributes.normal||Me.morphAttributes.color,ot=Qt!==void 0?Qt.length:0,Ue=ke.get(le),Cn=b.state.lights;if(he===!0&&(ue===!0||$!==H)){const un=$===H&&le.id===V;q.setState(le,$,un)}let Ht=!1;le.version===Ue.__version?(Ue.needsLights&&Ue.lightsStateVersion!==Cn.state.version||Ue.outputEncoding!==zt||Se.isInstancedMesh&&Ue.instancing===!1||!Se.isInstancedMesh&&Ue.instancing===!0||Se.isSkinnedMesh&&Ue.skinning===!1||!Se.isSkinnedMesh&&Ue.skinning===!0||Ue.envMap!==xt||le.fog===!0&&Ue.fog!==ut||Ue.numClippingPlanes!==void 0&&(Ue.numClippingPlanes!==q.numPlanes||Ue.numIntersection!==q.numIntersection)||Ue.vertexAlphas!==Pt||Ue.vertexTangents!==Je||Ue.morphTargets!==et||Ue.morphNormals!==Ct||Ue.morphColors!==it||Ue.toneMapping!==ht||Et.isWebGL2===!0&&Ue.morphTargetsCount!==ot)&&(Ht=!0):(Ht=!0,Ue.__version=le.version);let Ut=Ue.currentProgram;Ht===!0&&(Ut=tn(le,pe,Se));let fn=!1,Mn=!1,Ci=!1;const mn=Ut.getUniforms(),On=Ue.uniforms;if(He.useProgram(Ut.program)&&(fn=!0,Mn=!0,Ci=!0),le.id!==V&&(V=le.id,Mn=!0),fn||H!==$){if(mn.setValue(Ae,"projectionMatrix",$.projectionMatrix),Et.logarithmicDepthBuffer&&mn.setValue(Ae,"logDepthBufFC",2/(Math.log($.far+1)/Math.LN2)),H!==$&&(H=$,Mn=!0,Ci=!0),le.isShaderMaterial||le.isMeshPhongMaterial||le.isMeshToonMaterial||le.isMeshStandardMaterial||le.envMap){const un=mn.map.cameraPosition;un!==void 0&&un.setValue(Ae,Re.setFromMatrixPosition($.matrixWorld))}(le.isMeshPhongMaterial||le.isMeshToonMaterial||le.isMeshLambertMaterial||le.isMeshBasicMaterial||le.isMeshStandardMaterial||le.isShaderMaterial)&&mn.setValue(Ae,"isOrthographic",$.isOrthographicCamera===!0),(le.isMeshPhongMaterial||le.isMeshToonMaterial||le.isMeshLambertMaterial||le.isMeshBasicMaterial||le.isMeshStandardMaterial||le.isShaderMaterial||le.isShadowMaterial||Se.isSkinnedMesh)&&mn.setValue(Ae,"viewMatrix",$.matrixWorldInverse)}if(Se.isSkinnedMesh){mn.setOptional(Ae,Se,"bindMatrix"),mn.setOptional(Ae,Se,"bindMatrixInverse");const un=Se.skeleton;un&&(Et.floatVertexTextures?(un.boneTexture===null&&un.computeBoneTexture(),mn.setValue(Ae,"boneTexture",un.boneTexture,xe),mn.setValue(Ae,"boneTextureSize",un.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Un=Me.morphAttributes;if((Un.position!==void 0||Un.normal!==void 0||Un.color!==void 0&&Et.isWebGL2===!0)&&je.update(Se,Me,le,Ut),(Mn||Ue.receiveShadow!==Se.receiveShadow)&&(Ue.receiveShadow=Se.receiveShadow,mn.setValue(Ae,"receiveShadow",Se.receiveShadow)),le.isMeshGouraudMaterial&&le.envMap!==null&&(On.envMap.value=xt,On.flipEnvMap.value=xt.isCubeTexture&&xt.isRenderTargetTexture===!1?-1:1),Mn&&(mn.setValue(Ae,"toneMappingExposure",E.toneMappingExposure),Ue.needsLights&&Nn(On,Ci),ut&&le.fog===!0&&en.refreshFogUniforms(On,ut),en.refreshMaterialUniforms(On,le,se,Z,me),qu.upload(Ae,Ue.uniformsList,On,xe)),le.isShaderMaterial&&le.uniformsNeedUpdate===!0&&(qu.upload(Ae,Ue.uniformsList,On,xe),le.uniformsNeedUpdate=!1),le.isSpriteMaterial&&mn.setValue(Ae,"center",Se.center),mn.setValue(Ae,"modelViewMatrix",Se.modelViewMatrix),mn.setValue(Ae,"normalMatrix",Se.normalMatrix),mn.setValue(Ae,"modelMatrix",Se.matrixWorld),le.isShaderMaterial||le.isRawShaderMaterial){const un=le.uniformsGroups;for(let Hn=0,kn=un.length;Hn<kn;Hn++)if(Et.isWebGL2){const Rn=un[Hn];ct.update(Rn,Ut),ct.bind(Rn,Ut)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Ut}function Nn($,pe){$.ambientLightColor.needsUpdate=pe,$.lightProbe.needsUpdate=pe,$.directionalLights.needsUpdate=pe,$.directionalLightShadows.needsUpdate=pe,$.pointLights.needsUpdate=pe,$.pointLightShadows.needsUpdate=pe,$.spotLights.needsUpdate=pe,$.spotLightShadows.needsUpdate=pe,$.rectAreaLights.needsUpdate=pe,$.hemisphereLights.needsUpdate=pe}function yn($){return $.isMeshLambertMaterial||$.isMeshToonMaterial||$.isMeshPhongMaterial||$.isMeshStandardMaterial||$.isShadowMaterial||$.isShaderMaterial&&$.lights===!0}this.getActiveCubeFace=function(){return L},this.getActiveMipmapLevel=function(){return R},this.getRenderTarget=function(){return z},this.setRenderTargetTextures=function($,pe,Me){ke.get($.texture).__webglTexture=pe,ke.get($.depthTexture).__webglTexture=Me;const le=ke.get($);le.__hasExternalTextures=!0,le.__hasExternalTextures&&(le.__autoAllocateDepthBuffer=Me===void 0,le.__autoAllocateDepthBuffer||nt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),le.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function($,pe){const Me=ke.get($);Me.__webglFramebuffer=pe,Me.__useDefaultFramebuffer=pe===void 0},this.setRenderTarget=function($,pe=0,Me=0){z=$,L=pe,R=Me;let le=!0;if($){const xt=ke.get($);xt.__useDefaultFramebuffer!==void 0?(He.bindFramebuffer(36160,null),le=!1):xt.__webglFramebuffer===void 0?xe.setupRenderTarget($):xt.__hasExternalTextures&&xe.rebindTextures($,ke.get($.texture).__webglTexture,ke.get($.depthTexture).__webglTexture)}let Se=null,ut=!1,At=!1;if($){const xt=$.texture;(xt.isData3DTexture||xt.isDataArrayTexture)&&(At=!0);const Pt=ke.get($).__webglFramebuffer;$.isWebGLCubeRenderTarget?(Se=Pt[pe],ut=!0):Et.isWebGL2&&$.samples>0&&xe.useMultisampledRTT($)===!1?Se=ke.get($).__webglMultisampledFramebuffer:Se=Pt,B.copy($.viewport),j.copy($.scissor),F=$.scissorTest}else B.copy(ne).multiplyScalar(se).floor(),j.copy(ce).multiplyScalar(se).floor(),F=ve;if(He.bindFramebuffer(36160,Se)&&Et.drawBuffers&&le&&He.drawBuffers($,Se),He.viewport(B),He.scissor(j),He.setScissorTest(F),ut){const xt=ke.get($.texture);Ae.framebufferTexture2D(36160,36064,34069+pe,xt.__webglTexture,Me)}else if(At){const xt=ke.get($.texture),Pt=pe||0;Ae.framebufferTextureLayer(36160,36064,xt.__webglTexture,Me||0,Pt)}V=-1},this.readRenderTargetPixels=function($,pe,Me,le,Se,ut,At){if(!($&&$.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let zt=ke.get($).__webglFramebuffer;if($.isWebGLCubeRenderTarget&&At!==void 0&&(zt=zt[At]),zt){He.bindFramebuffer(36160,zt);try{const xt=$.texture,Pt=xt.format,Je=xt.type;if(Pt!==Xs&&qe.convert(Pt)!==Ae.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const et=Je===dl&&(nt.has("EXT_color_buffer_half_float")||Et.isWebGL2&&nt.has("EXT_color_buffer_float"));if(Je!==Fo&&qe.convert(Je)!==Ae.getParameter(35738)&&!(Je===Zr&&(Et.isWebGL2||nt.has("OES_texture_float")||nt.has("WEBGL_color_buffer_float")))&&!et){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}pe>=0&&pe<=$.width-le&&Me>=0&&Me<=$.height-Se&&Ae.readPixels(pe,Me,le,Se,qe.convert(Pt),qe.convert(Je),ut)}finally{const xt=z!==null?ke.get(z).__webglFramebuffer:null;He.bindFramebuffer(36160,xt)}}},this.copyFramebufferToTexture=function($,pe,Me=0){const le=Math.pow(2,-Me),Se=Math.floor(pe.image.width*le),ut=Math.floor(pe.image.height*le);xe.setTexture2D(pe,0),Ae.copyTexSubImage2D(3553,Me,0,0,$.x,$.y,Se,ut),He.unbindTexture()},this.copyTextureToTexture=function($,pe,Me,le=0){const Se=pe.image.width,ut=pe.image.height,At=qe.convert(Me.format),zt=qe.convert(Me.type);xe.setTexture2D(Me,0),Ae.pixelStorei(37440,Me.flipY),Ae.pixelStorei(37441,Me.premultiplyAlpha),Ae.pixelStorei(3317,Me.unpackAlignment),pe.isDataTexture?Ae.texSubImage2D(3553,le,$.x,$.y,Se,ut,At,zt,pe.image.data):pe.isCompressedTexture?Ae.compressedTexSubImage2D(3553,le,$.x,$.y,pe.mipmaps[0].width,pe.mipmaps[0].height,At,pe.mipmaps[0].data):Ae.texSubImage2D(3553,le,$.x,$.y,At,zt,pe.image),le===0&&Me.generateMipmaps&&Ae.generateMipmap(3553),He.unbindTexture()},this.copyTextureToTexture3D=function($,pe,Me,le,Se=0){if(E.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const ut=$.max.x-$.min.x+1,At=$.max.y-$.min.y+1,zt=$.max.z-$.min.z+1,xt=qe.convert(le.format),Pt=qe.convert(le.type);let Je;if(le.isData3DTexture)xe.setTexture3D(le,0),Je=32879;else if(le.isDataArrayTexture)xe.setTexture2DArray(le,0),Je=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Ae.pixelStorei(37440,le.flipY),Ae.pixelStorei(37441,le.premultiplyAlpha),Ae.pixelStorei(3317,le.unpackAlignment);const et=Ae.getParameter(3314),Ct=Ae.getParameter(32878),it=Ae.getParameter(3316),ht=Ae.getParameter(3315),Qt=Ae.getParameter(32877),ot=Me.isCompressedTexture?Me.mipmaps[0]:Me.image;Ae.pixelStorei(3314,ot.width),Ae.pixelStorei(32878,ot.height),Ae.pixelStorei(3316,$.min.x),Ae.pixelStorei(3315,$.min.y),Ae.pixelStorei(32877,$.min.z),Me.isDataTexture||Me.isData3DTexture?Ae.texSubImage3D(Je,Se,pe.x,pe.y,pe.z,ut,At,zt,xt,Pt,ot.data):Me.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ae.compressedTexSubImage3D(Je,Se,pe.x,pe.y,pe.z,ut,At,zt,xt,ot.data)):Ae.texSubImage3D(Je,Se,pe.x,pe.y,pe.z,ut,At,zt,xt,Pt,ot),Ae.pixelStorei(3314,et),Ae.pixelStorei(32878,Ct),Ae.pixelStorei(3316,it),Ae.pixelStorei(3315,ht),Ae.pixelStorei(32877,Qt),Se===0&&le.generateMipmaps&&Ae.generateMipmap(Je),He.unbindTexture()},this.initTexture=function($){$.isCubeTexture?xe.setTextureCube($,0):$.isData3DTexture?xe.setTexture3D($,0):$.isDataArrayTexture?xe.setTexture2DArray($,0):xe.setTexture2D($,0),He.unbindTexture()},this.resetState=function(){L=0,R=0,z=null,He.reset(),Pe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Wb extends jm{}Wb.prototype.isWebGL1Renderer=!0;class md{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new $e(e),this.density=t}clone(){return new md(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class vd{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new $e(e),this.near=t,this.far=n}clone(){return new vd(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Km extends Jt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class bl{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Oc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Rs()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,o=this.stride;i<o;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const us=new X;class no{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)us.fromBufferAttribute(this,t),us.applyMatrix4(e),this.setXYZ(t,us.x,us.y,us.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)us.fromBufferAttribute(this,t),us.applyNormalMatrix(e),this.setXYZ(t,us.x,us.y,us.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)us.fromBufferAttribute(this,t),us.transformDirection(e),this.setXYZ(t,us.x,us.y,us.z);return this}setX(e,t){return this.normalized&&(t=An(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=An(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=An(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=An(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Jr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Jr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Jr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Jr(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=An(t,this.array),n=An(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=An(t,this.array),n=An(n,this.array),i=An(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,o){return e=e*this.data.stride+this.offset,this.normalized&&(t=An(t,this.array),n=An(n,this.array),i=An(i,this.array),o=An(o,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[i+o])}return new pn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new no(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[i+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class qm extends ti{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new $e(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let el;const gc=new X,tl=new X,nl=new X,il=new De,_c=new De,jb=new It,vu=new X,bc=new X,gu=new X,mg=new De,wf=new De,vg=new De;class Kb extends Jt{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",el===void 0){el=new jt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new bl(t,5);el.setIndex([0,1,2,0,2,3]),el.setAttribute("position",new no(n,3,0,!1)),el.setAttribute("uv",new no(n,2,3,!1))}this.geometry=el,this.material=e!==void 0?e:new qm,this.center=new De(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),tl.setFromMatrixScale(this.matrixWorld),jb.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),nl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&tl.multiplyScalar(-nl.z);const n=this.material.rotation;let i,o;n!==0&&(o=Math.cos(n),i=Math.sin(n));const a=this.center;_u(vu.set(-.5,-.5,0),nl,a,tl,i,o),_u(bc.set(.5,-.5,0),nl,a,tl,i,o),_u(gu.set(.5,.5,0),nl,a,tl,i,o),mg.set(0,0),wf.set(1,0),vg.set(1,1);let c=e.ray.intersectTriangle(vu,bc,gu,!1,gc);if(c===null&&(_u(bc.set(-.5,.5,0),nl,a,tl,i,o),wf.set(0,1),c=e.ray.intersectTriangle(vu,gu,bc,!1,gc),c===null))return;const u=e.ray.origin.distanceTo(gc);u<e.near||u>e.far||t.push({distance:u,point:gc.clone(),uv:Ks.getUV(gc,vu,bc,gu,mg,wf,vg,new De),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function _u(h,e,t,n,i,o){il.subVectors(h,t).addScalar(.5).multiply(n),i!==void 0?(_c.x=o*il.x-i*il.y,_c.y=i*il.x+o*il.y):_c.copy(il),h.copy(e),h.x+=_c.x,h.y+=_c.y,h.applyMatrix4(jb)}const bu=new X,gg=new X;class qb extends Jt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.addLevel(o.object.clone(),o.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){bu.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(bu);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){bu.setFromMatrixPosition(e.matrixWorld),gg.setFromMatrixPosition(this.matrixWorld);const n=bu.distanceTo(gg)/e.zoom;t[0].object.visible=!0;let i,o;for(i=1,o=t.length;i<o&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<o;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,o=n.length;i<o;i++){const a=n[i];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}const _g=new X,bg=new wn,wg=new wn,aE=new X,xg=new It;class gd extends Bn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new It,this.bindMatrixInverse=new It}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new wn,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;bg.fromBufferAttribute(i.attributes.skinIndex,e),wg.fromBufferAttribute(i.attributes.skinWeight,e),_g.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const a=wg.getComponent(o);if(a!==0){const c=bg.getComponent(o);xg.multiplyMatrices(n.bones[c].matrixWorld,n.boneInverses[c]),t.addScaledVector(aE.copy(_g).applyMatrix4(xg),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Qc extends Jt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ll extends Kn{constructor(e=null,t=1,n=1,i,o,a,c,u,d=ei,v=ei,g,b){super(null,a,c,u,d,v,i,o,g,b),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const yg=new It,lE=new It;class wl{constructor(e=[],t=[]){this.uuid=Rs(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new It)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new It;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let o=0,a=e.length;o<a;o++){const c=e[o]?e[o].matrixWorld:lE;yg.multiplyMatrices(c,t[o]),yg.toArray(n,o*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new wl(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Lb(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new ll(t,e,e,Xs,Zr);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const o=e.bones[n];let a=t[o];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),a=new Qc),this.bones.push(a),this.boneInverses.push(new It().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,o=t.length;i<o;i++){const a=t[i];e.bones.push(a.uuid);const c=n[i];e.boneInverses.push(c.toArray())}return e}}class ml extends pn{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Cg=new It,Mg=new It,wu=[],wc=new Bn;class Xm extends Bn{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new ml(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(wc.geometry=this.geometry,wc.material=this.material,wc.material!==void 0)for(let o=0;o<i;o++){this.getMatrixAt(o,Cg),Mg.multiplyMatrices(n,Cg),wc.matrixWorld=Mg,wc.raycast(e,wu);for(let a=0,c=wu.length;a<c;a++){const u=wu[a];u.instanceId=o,u.object=this,t.push(u)}wu.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new ml(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Fi extends ti{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new $e(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Eg=new X,Sg=new X,Ag=new It,xf=new Zc,xu=new ao;class vr extends Jt{constructor(e=new jt,t=new Fi){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,o=t.count;i<o;i++)Eg.fromBufferAttribute(t,i-1),Sg.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Eg.distanceTo(Sg);e.setAttribute("lineDistance",new bt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,o=e.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),xu.copy(n.boundingSphere),xu.applyMatrix4(i),xu.radius+=o,e.ray.intersectsSphere(xu)===!1)return;Ag.copy(i).invert(),xf.copy(e.ray).applyMatrix4(Ag);const c=o/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,d=new X,v=new X,g=new X,b=new X,y=this.isLineSegments?2:1,S=n.index,M=n.attributes.position;if(S!==null){const L=Math.max(0,a.start),R=Math.min(S.count,a.start+a.count);for(let z=L,V=R-1;z<V;z+=y){const H=S.getX(z),B=S.getX(z+1);if(d.fromBufferAttribute(M,H),v.fromBufferAttribute(M,B),xf.distanceSqToSegment(d,v,b,g)>u)continue;b.applyMatrix4(this.matrixWorld);const F=e.ray.origin.distanceTo(b);F<e.near||F>e.far||t.push({distance:F,point:g.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this})}}else{const L=Math.max(0,a.start),R=Math.min(M.count,a.start+a.count);for(let z=L,V=R-1;z<V;z+=y){if(d.fromBufferAttribute(M,z),v.fromBufferAttribute(M,z+1),xf.distanceSqToSegment(d,v,b,g)>u)continue;b.applyMatrix4(this.matrixWorld);const B=e.ray.origin.distanceTo(b);B<e.near||B>e.far||t.push({distance:B,point:g.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=i.length;o<a;o++){const c=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=o}}}}}const Pg=new X,Tg=new X;class Ys extends vr{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,o=t.count;i<o;i+=2)Pg.fromBufferAttribute(t,i),Tg.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+Pg.distanceTo(Tg);e.setAttribute("lineDistance",new bt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class _d extends vr{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class eh extends ti{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new $e(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Lg=new It,pm=new Zc,yu=new ao,Cu=new X;class bd extends Jt{constructor(e=new jt,t=new eh){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,o=e.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),yu.copy(n.boundingSphere),yu.applyMatrix4(i),yu.radius+=o,e.ray.intersectsSphere(yu)===!1)return;Lg.copy(i).invert(),pm.copy(e.ray).applyMatrix4(Lg);const c=o/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,d=n.index,g=n.attributes.position;if(d!==null){const b=Math.max(0,a.start),y=Math.min(d.count,a.start+a.count);for(let S=b,E=y;S<E;S++){const M=d.getX(S);Cu.fromBufferAttribute(g,M),kg(Cu,M,u,i,e,t,this)}}else{const b=Math.max(0,a.start),y=Math.min(g.count,a.start+a.count);for(let S=b,E=y;S<E;S++)Cu.fromBufferAttribute(g,S),kg(Cu,S,u,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=i.length;o<a;o++){const c=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=o}}}}}function kg(h,e,t,n,i,o,a){const c=pm.distanceSqToPoint(h);if(c<t){const u=new X;pm.closestPointToPoint(h,u),u.applyMatrix4(n);const d=i.ray.origin.distanceTo(u);if(d<i.near||d>i.far)return;o.push({distance:d,distanceToRay:Math.sqrt(c),point:u,index:e,face:null,object:a})}}class cE extends Kn{constructor(e,t,n,i,o,a,c,u,d){super(e,t,n,i,o,a,c,u,d),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Ln,this.magFilter=o!==void 0?o:Ln,this.generateMipmaps=!1;const v=this;function g(){v.needsUpdate=!0,e.requestVideoFrameCallback(g)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(g)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class hE extends Kn{constructor(e,t,n){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=n,this.magFilter=ei,this.minFilter=ei,this.generateMipmaps=!1,this.needsUpdate=!0}}class Xb extends Kn{constructor(e,t,n,i,o,a,c,u,d,v,g,b){super(null,a,c,u,d,v,i,o,g,b),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class $b extends Kn{constructor(e,t,n,i,o,a,c,u,d){super(e,t,n,i,o,a,c,u,d),this.isCanvasTexture=!0,this.needsUpdate=!0}}class _r{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),o=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),o+=n.distanceTo(i),t.push(o),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const o=n.length;let a;t?a=t:a=e*n[o-1];let c=0,u=o-1,d;for(;c<=u;)if(i=Math.floor(c+(u-c)/2),d=n[i]-a,d<0)c=i+1;else if(d>0)u=i-1;else{u=i;break}if(i=u,n[i]===a)return i/(o-1);const v=n[i],b=n[i+1]-v,y=(a-v)/b;return(i+y)/(o-1)}getTangent(e,t){let i=e-1e-4,o=e+1e-4;i<0&&(i=0),o>1&&(o=1);const a=this.getPoint(i),c=this.getPoint(o),u=t||(a.isVector2?new De:new X);return u.copy(c).sub(a).normalize(),u}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new X,i=[],o=[],a=[],c=new X,u=new It;for(let y=0;y<=e;y++){const S=y/e;i[y]=this.getTangentAt(S,new X)}o[0]=new X,a[0]=new X;let d=Number.MAX_VALUE;const v=Math.abs(i[0].x),g=Math.abs(i[0].y),b=Math.abs(i[0].z);v<=d&&(d=v,n.set(1,0,0)),g<=d&&(d=g,n.set(0,1,0)),b<=d&&n.set(0,0,1),c.crossVectors(i[0],n).normalize(),o[0].crossVectors(i[0],c),a[0].crossVectors(i[0],o[0]);for(let y=1;y<=e;y++){if(o[y]=o[y-1].clone(),a[y]=a[y-1].clone(),c.crossVectors(i[y-1],i[y]),c.length()>Number.EPSILON){c.normalize();const S=Math.acos(ai(i[y-1].dot(i[y]),-1,1));o[y].applyMatrix4(u.makeRotationAxis(c,S))}a[y].crossVectors(i[y],o[y])}if(t===!0){let y=Math.acos(ai(o[0].dot(o[e]),-1,1));y/=e,i[0].dot(c.crossVectors(o[0],o[e]))>0&&(y=-y);for(let S=1;S<=e;S++)o[S].applyMatrix4(u.makeRotationAxis(i[S],y*S)),a[S].crossVectors(i[S],o[S])}return{tangents:i,normals:o,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class wd extends _r{constructor(e=0,t=0,n=1,i=1,o=0,a=Math.PI*2,c=!1,u=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=o,this.aEndAngle=a,this.aClockwise=c,this.aRotation=u}getPoint(e,t){const n=t||new De,i=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const a=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=i;for(;o>i;)o-=i;o<Number.EPSILON&&(a?o=0:o=i),this.aClockwise===!0&&!a&&(o===i?o=-i:o=o-i);const c=this.aStartAngle+e*o;let u=this.aX+this.xRadius*Math.cos(c),d=this.aY+this.yRadius*Math.sin(c);if(this.aRotation!==0){const v=Math.cos(this.aRotation),g=Math.sin(this.aRotation),b=u-this.aX,y=d-this.aY;u=b*v-y*g+this.aX,d=b*g+y*v+this.aY}return n.set(u,d)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Yb extends wd{constructor(e,t,n,i,o,a){super(e,t,n,n,i,o,a),this.isArcCurve=!0,this.type="ArcCurve"}}function $m(){let h=0,e=0,t=0,n=0;function i(o,a,c,u){h=o,e=c,t=-3*o+3*a-2*c-u,n=2*o-2*a+c+u}return{initCatmullRom:function(o,a,c,u,d){i(a,c,d*(c-o),d*(u-a))},initNonuniformCatmullRom:function(o,a,c,u,d,v,g){let b=(a-o)/d-(c-o)/(d+v)+(c-a)/v,y=(c-a)/v-(u-a)/(v+g)+(u-c)/g;b*=v,y*=v,i(a,c,b,y)},calc:function(o){const a=o*o,c=a*o;return h+e*o+t*a+n*c}}}const Mu=new X,yf=new $m,Cf=new $m,Mf=new $m;class Zb extends _r{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new X){const n=t,i=this.points,o=i.length,a=(o-(this.closed?0:1))*e;let c=Math.floor(a),u=a-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/o)+1)*o:u===0&&c===o-1&&(c=o-2,u=1);let d,v;this.closed||c>0?d=i[(c-1)%o]:(Mu.subVectors(i[0],i[1]).add(i[0]),d=Mu);const g=i[c%o],b=i[(c+1)%o];if(this.closed||c+2<o?v=i[(c+2)%o]:(Mu.subVectors(i[o-1],i[o-2]).add(i[o-1]),v=Mu),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let S=Math.pow(d.distanceToSquared(g),y),E=Math.pow(g.distanceToSquared(b),y),M=Math.pow(b.distanceToSquared(v),y);E<1e-4&&(E=1),S<1e-4&&(S=E),M<1e-4&&(M=E),yf.initNonuniformCatmullRom(d.x,g.x,b.x,v.x,S,E,M),Cf.initNonuniformCatmullRom(d.y,g.y,b.y,v.y,S,E,M),Mf.initNonuniformCatmullRom(d.z,g.z,b.z,v.z,S,E,M)}else this.curveType==="catmullrom"&&(yf.initCatmullRom(d.x,g.x,b.x,v.x,this.tension),Cf.initCatmullRom(d.y,g.y,b.y,v.y,this.tension),Mf.initCatmullRom(d.z,g.z,b.z,v.z,this.tension));return n.set(yf.calc(u),Cf.calc(u),Mf.calc(u)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new X().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Rg(h,e,t,n,i){const o=(n-e)*.5,a=(i-t)*.5,c=h*h,u=h*c;return(2*t-2*n+o+a)*u+(-3*t+3*n-2*o-a)*c+o*h+t}function uE(h,e){const t=1-h;return t*t*e}function dE(h,e){return 2*(1-h)*h*e}function pE(h,e){return h*h*e}function Lc(h,e,t,n){return uE(h,e)+dE(h,t)+pE(h,n)}function fE(h,e){const t=1-h;return t*t*t*e}function mE(h,e){const t=1-h;return 3*t*t*h*e}function vE(h,e){return 3*(1-h)*h*h*e}function gE(h,e){return h*h*h*e}function kc(h,e,t,n,i){return fE(h,e)+mE(h,t)+vE(h,n)+gE(h,i)}class Ym extends _r{constructor(e=new De,t=new De,n=new De,i=new De){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new De){const n=t,i=this.v0,o=this.v1,a=this.v2,c=this.v3;return n.set(kc(e,i.x,o.x,a.x,c.x),kc(e,i.y,o.y,a.y,c.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Jb extends _r{constructor(e=new X,t=new X,n=new X,i=new X){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new X){const n=t,i=this.v0,o=this.v1,a=this.v2,c=this.v3;return n.set(kc(e,i.x,o.x,a.x,c.x),kc(e,i.y,o.y,a.y,c.y),kc(e,i.z,o.z,a.z,c.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class xd extends _r{constructor(e=new De,t=new De){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new De){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new De;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Qb extends _r{constructor(e=new X,t=new X){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new X){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Zm extends _r{constructor(e=new De,t=new De,n=new De){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new De){const n=t,i=this.v0,o=this.v1,a=this.v2;return n.set(Lc(e,i.x,o.x,a.x),Lc(e,i.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Jm extends _r{constructor(e=new X,t=new X,n=new X){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new X){const n=t,i=this.v0,o=this.v1,a=this.v2;return n.set(Lc(e,i.x,o.x,a.x),Lc(e,i.y,o.y,a.y),Lc(e,i.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Qm extends _r{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new De){const n=t,i=this.points,o=(i.length-1)*e,a=Math.floor(o),c=o-a,u=i[a===0?a:a-1],d=i[a],v=i[a>i.length-2?i.length-1:a+1],g=i[a>i.length-3?i.length-1:a+2];return n.set(Rg(c,u.x,d.x,v.x,g.x),Rg(c,u.y,d.y,v.y,g.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new De().fromArray(i))}return this}}var ev=Object.freeze({__proto__:null,ArcCurve:Yb,CatmullRomCurve3:Zb,CubicBezierCurve:Ym,CubicBezierCurve3:Jb,EllipseCurve:wd,LineCurve:xd,LineCurve3:Qb,QuadraticBezierCurve:Zm,QuadraticBezierCurve3:Jm,SplineCurve:Qm});class e0 extends _r{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new xd(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let o=0;for(;o<i.length;){if(i[o]>=n){const a=i[o]-n,c=this.curves[o],u=c.getLength(),d=u===0?0:1-a/u;return c.getPointAt(d,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,o=this.curves;i<o.length;i++){const a=o[i],c=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,u=a.getPoints(c);for(let d=0;d<u.length;d++){const v=u[d];n&&n.equals(v)||(t.push(v),n=v)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new ev[i.type]().fromJSON(i))}return this}}class Uc extends e0{constructor(e){super(),this.type="Path",this.currentPoint=new De,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new xd(this.currentPoint.clone(),new De(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const o=new Zm(this.currentPoint.clone(),new De(e,t),new De(n,i));return this.curves.push(o),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,o,a){const c=new Ym(this.currentPoint.clone(),new De(e,t),new De(n,i),new De(o,a));return this.curves.push(c),this.currentPoint.set(o,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Qm(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,o,a){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absarc(e+c,t+u,n,i,o,a),this}absarc(e,t,n,i,o,a){return this.absellipse(e,t,n,n,i,o,a),this}ellipse(e,t,n,i,o,a,c,u){const d=this.currentPoint.x,v=this.currentPoint.y;return this.absellipse(e+d,t+v,n,i,o,a,c,u),this}absellipse(e,t,n,i,o,a,c,u){const d=new wd(e,t,n,i,o,a,c,u);if(this.curves.length>0){const g=d.getPoint(0);g.equals(this.currentPoint)||this.lineTo(g.x,g.y)}this.curves.push(d);const v=d.getPoint(1);return this.currentPoint.copy(v),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class xl extends jt{constructor(e=[new De(0,-.5),new De(.5,0),new De(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=ai(i,0,Math.PI*2);const o=[],a=[],c=[],u=[],d=[],v=1/t,g=new X,b=new De,y=new X,S=new X,E=new X;let M=0,L=0;for(let R=0;R<=e.length-1;R++)switch(R){case 0:M=e[R+1].x-e[R].x,L=e[R+1].y-e[R].y,y.x=L*1,y.y=-M,y.z=L*0,E.copy(y),y.normalize(),u.push(y.x,y.y,y.z);break;case e.length-1:u.push(E.x,E.y,E.z);break;default:M=e[R+1].x-e[R].x,L=e[R+1].y-e[R].y,y.x=L*1,y.y=-M,y.z=L*0,S.copy(y),y.x+=E.x,y.y+=E.y,y.z+=E.z,y.normalize(),u.push(y.x,y.y,y.z),E.copy(S)}for(let R=0;R<=t;R++){const z=n+R*v*i,V=Math.sin(z),H=Math.cos(z);for(let B=0;B<=e.length-1;B++){g.x=e[B].x*V,g.y=e[B].y,g.z=e[B].x*H,a.push(g.x,g.y,g.z),b.x=R/t,b.y=B/(e.length-1),c.push(b.x,b.y);const j=u[3*B+0]*V,F=u[3*B+1],W=u[3*B+0]*H;d.push(j,F,W)}}for(let R=0;R<t;R++)for(let z=0;z<e.length-1;z++){const V=z+R*e.length,H=V,B=V+e.length,j=V+e.length+1,F=V+1;o.push(H,B,F),o.push(j,F,B)}this.setIndex(o),this.setAttribute("position",new bt(a,3)),this.setAttribute("uv",new bt(c,2)),this.setAttribute("normal",new bt(d,3))}static fromJSON(e){return new xl(e.points,e.segments,e.phiStart,e.phiLength)}}class th extends xl{constructor(e=1,t=1,n=4,i=8){const o=new Uc;o.absarc(0,-t/2,e,Math.PI*1.5,0),o.absarc(0,t/2,e,0,Math.PI*.5),super(o.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new th(e.radius,e.length,e.capSegments,e.radialSegments)}}class nh extends jt{constructor(e=1,t=8,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const o=[],a=[],c=[],u=[],d=new X,v=new De;a.push(0,0,0),c.push(0,0,1),u.push(.5,.5);for(let g=0,b=3;g<=t;g++,b+=3){const y=n+g/t*i;d.x=e*Math.cos(y),d.y=e*Math.sin(y),a.push(d.x,d.y,d.z),c.push(0,0,1),v.x=(a[b]/e+1)/2,v.y=(a[b+1]/e+1)/2,u.push(v.x,v.y)}for(let g=1;g<=t;g++)o.push(g,g+1,0);this.setIndex(o),this.setAttribute("position",new bt(a,3)),this.setAttribute("normal",new bt(c,3)),this.setAttribute("uv",new bt(u,2))}static fromJSON(e){return new nh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Sa extends jt{constructor(e=1,t=1,n=1,i=8,o=1,a=!1,c=0,u=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:c,thetaLength:u};const d=this;i=Math.floor(i),o=Math.floor(o);const v=[],g=[],b=[],y=[];let S=0;const E=[],M=n/2;let L=0;R(),a===!1&&(e>0&&z(!0),t>0&&z(!1)),this.setIndex(v),this.setAttribute("position",new bt(g,3)),this.setAttribute("normal",new bt(b,3)),this.setAttribute("uv",new bt(y,2));function R(){const V=new X,H=new X;let B=0;const j=(t-e)/n;for(let F=0;F<=o;F++){const W=[],Z=F/o,se=Z*(t-e)+e;for(let we=0;we<=i;we++){const oe=we/i,ne=oe*u+c,ce=Math.sin(ne),ve=Math.cos(ne);H.x=se*ce,H.y=-Z*n+M,H.z=se*ve,g.push(H.x,H.y,H.z),V.set(ce,j,ve).normalize(),b.push(V.x,V.y,V.z),y.push(oe,1-Z),W.push(S++)}E.push(W)}for(let F=0;F<i;F++)for(let W=0;W<o;W++){const Z=E[W][F],se=E[W+1][F],we=E[W+1][F+1],oe=E[W][F+1];v.push(Z,se,oe),v.push(se,we,oe),B+=6}d.addGroup(L,B,0),L+=B}function z(V){const H=S,B=new De,j=new X;let F=0;const W=V===!0?e:t,Z=V===!0?1:-1;for(let we=1;we<=i;we++)g.push(0,M*Z,0),b.push(0,Z,0),y.push(.5,.5),S++;const se=S;for(let we=0;we<=i;we++){const ne=we/i*u+c,ce=Math.cos(ne),ve=Math.sin(ne);j.x=W*ve,j.y=M*Z,j.z=W*ce,g.push(j.x,j.y,j.z),b.push(0,Z,0),B.x=ce*.5+.5,B.y=ve*.5*Z+.5,y.push(B.x,B.y),S++}for(let we=0;we<i;we++){const oe=H+we,ne=se+we;V===!0?v.push(ne,ne+1,oe):v.push(ne+1,ne,oe),F+=3}d.addGroup(L,F,V===!0?1:2),L+=F}}static fromJSON(e){return new Sa(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ih extends Sa{constructor(e=1,t=1,n=8,i=1,o=!1,a=0,c=Math.PI*2){super(0,e,t,n,i,o,a,c),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:c}}static fromJSON(e){return new ih(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ho extends jt{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const o=[],a=[];c(i),d(n),v(),this.setAttribute("position",new bt(o,3)),this.setAttribute("normal",new bt(o.slice(),3)),this.setAttribute("uv",new bt(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function c(R){const z=new X,V=new X,H=new X;for(let B=0;B<t.length;B+=3)y(t[B+0],z),y(t[B+1],V),y(t[B+2],H),u(z,V,H,R)}function u(R,z,V,H){const B=H+1,j=[];for(let F=0;F<=B;F++){j[F]=[];const W=R.clone().lerp(V,F/B),Z=z.clone().lerp(V,F/B),se=B-F;for(let we=0;we<=se;we++)we===0&&F===B?j[F][we]=W:j[F][we]=W.clone().lerp(Z,we/se)}for(let F=0;F<B;F++)for(let W=0;W<2*(B-F)-1;W++){const Z=Math.floor(W/2);W%2===0?(b(j[F][Z+1]),b(j[F+1][Z]),b(j[F][Z])):(b(j[F][Z+1]),b(j[F+1][Z+1]),b(j[F+1][Z]))}}function d(R){const z=new X;for(let V=0;V<o.length;V+=3)z.x=o[V+0],z.y=o[V+1],z.z=o[V+2],z.normalize().multiplyScalar(R),o[V+0]=z.x,o[V+1]=z.y,o[V+2]=z.z}function v(){const R=new X;for(let z=0;z<o.length;z+=3){R.x=o[z+0],R.y=o[z+1],R.z=o[z+2];const V=M(R)/2/Math.PI+.5,H=L(R)/Math.PI+.5;a.push(V,1-H)}S(),g()}function g(){for(let R=0;R<a.length;R+=6){const z=a[R+0],V=a[R+2],H=a[R+4],B=Math.max(z,V,H),j=Math.min(z,V,H);B>.9&&j<.1&&(z<.2&&(a[R+0]+=1),V<.2&&(a[R+2]+=1),H<.2&&(a[R+4]+=1))}}function b(R){o.push(R.x,R.y,R.z)}function y(R,z){const V=R*3;z.x=e[V+0],z.y=e[V+1],z.z=e[V+2]}function S(){const R=new X,z=new X,V=new X,H=new X,B=new De,j=new De,F=new De;for(let W=0,Z=0;W<o.length;W+=9,Z+=6){R.set(o[W+0],o[W+1],o[W+2]),z.set(o[W+3],o[W+4],o[W+5]),V.set(o[W+6],o[W+7],o[W+8]),B.set(a[Z+0],a[Z+1]),j.set(a[Z+2],a[Z+3]),F.set(a[Z+4],a[Z+5]),H.copy(R).add(z).add(V).divideScalar(3);const se=M(H);E(B,Z+0,R,se),E(j,Z+2,z,se),E(F,Z+4,V,se)}}function E(R,z,V,H){H<0&&R.x===1&&(a[z]=R.x-1),V.x===0&&V.z===0&&(a[z]=H/2/Math.PI+.5)}function M(R){return Math.atan2(R.z,-R.x)}function L(R){return Math.atan2(-R.y,Math.sqrt(R.x*R.x+R.z*R.z))}}static fromJSON(e){return new ho(e.vertices,e.indices,e.radius,e.details)}}class sh extends ho{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sh(e.radius,e.detail)}}const Eu=new X,Su=new X,Ef=new X,Au=new Ks;class t0 extends jt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),o=Math.cos(ma*t),a=e.getIndex(),c=e.getAttribute("position"),u=a?a.count:c.count,d=[0,0,0],v=["a","b","c"],g=new Array(3),b={},y=[];for(let S=0;S<u;S+=3){a?(d[0]=a.getX(S),d[1]=a.getX(S+1),d[2]=a.getX(S+2)):(d[0]=S,d[1]=S+1,d[2]=S+2);const{a:E,b:M,c:L}=Au;if(E.fromBufferAttribute(c,d[0]),M.fromBufferAttribute(c,d[1]),L.fromBufferAttribute(c,d[2]),Au.getNormal(Ef),g[0]=`${Math.round(E.x*i)},${Math.round(E.y*i)},${Math.round(E.z*i)}`,g[1]=`${Math.round(M.x*i)},${Math.round(M.y*i)},${Math.round(M.z*i)}`,g[2]=`${Math.round(L.x*i)},${Math.round(L.y*i)},${Math.round(L.z*i)}`,!(g[0]===g[1]||g[1]===g[2]||g[2]===g[0]))for(let R=0;R<3;R++){const z=(R+1)%3,V=g[R],H=g[z],B=Au[v[R]],j=Au[v[z]],F=`${V}_${H}`,W=`${H}_${V}`;W in b&&b[W]?(Ef.dot(b[W].normal)<=o&&(y.push(B.x,B.y,B.z),y.push(j.x,j.y,j.z)),b[W]=null):F in b||(b[F]={index0:d[R],index1:d[z],normal:Ef.clone()})}}for(const S in b)if(b[S]){const{index0:E,index1:M}=b[S];Eu.fromBufferAttribute(c,E),Su.fromBufferAttribute(c,M),y.push(Eu.x,Eu.y,Eu.z),y.push(Su.x,Su.y,Su.z)}this.setAttribute("position",new bt(y,3))}}}class ga extends Uc{constructor(e){super(e),this.uuid=Rs(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new Uc().fromJSON(i))}return this}}const _E={triangulate:function(h,e,t=2){const n=e&&e.length,i=n?e[0]*t:h.length;let o=n0(h,0,i,t,!0);const a=[];if(!o||o.next===o.prev)return a;let c,u,d,v,g,b,y;if(n&&(o=CE(h,e,o,t)),h.length>80*t){c=d=h[0],u=v=h[1];for(let S=t;S<i;S+=t)g=h[S],b=h[S+1],g<c&&(c=g),b<u&&(u=b),g>d&&(d=g),b>v&&(v=b);y=Math.max(d-c,v-u),y=y!==0?1/y:0}return Hc(o,a,t,c,u,y),a}};function n0(h,e,t,n,i){let o,a;if(i===DE(h,e,t,n)>0)for(o=e;o<t;o+=n)a=Ig(o,h[o],h[o+1],a);else for(o=t-n;o>=e;o-=n)a=Ig(o,h[o],h[o+1],a);return a&&yd(a,a.next)&&(Wc(a),a=a.next),a}function Uo(h,e){if(!h)return h;e||(e=h);let t=h,n;do if(n=!1,!t.steiner&&(yd(t,t.next)||jn(t.prev,t,t.next)===0)){if(Wc(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Hc(h,e,t,n,i,o,a){if(!h)return;!a&&o&&PE(h,n,i,o);let c=h,u,d;for(;h.prev!==h.next;){if(u=h.prev,d=h.next,o?wE(h,n,i,o):bE(h)){e.push(u.i/t),e.push(h.i/t),e.push(d.i/t),Wc(h),h=d.next,c=d.next;continue}if(h=d,h===c){a?a===1?(h=xE(Uo(h),e,t),Hc(h,e,t,n,i,o,2)):a===2&&yE(h,e,t,n,i,o):Hc(Uo(h),e,t,n,i,o,1);break}}}function bE(h){const e=h.prev,t=h,n=h.next;if(jn(e,t,n)>=0)return!1;let i=h.next.next;for(;i!==h.prev;){if(al(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&jn(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function wE(h,e,t,n){const i=h.prev,o=h,a=h.next;if(jn(i,o,a)>=0)return!1;const c=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,d=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,v=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,g=fm(c,u,e,t,n),b=fm(d,v,e,t,n);let y=h.prevZ,S=h.nextZ;for(;y&&y.z>=g&&S&&S.z<=b;){if(y!==h.prev&&y!==h.next&&al(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&jn(y.prev,y,y.next)>=0||(y=y.prevZ,S!==h.prev&&S!==h.next&&al(i.x,i.y,o.x,o.y,a.x,a.y,S.x,S.y)&&jn(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;y&&y.z>=g;){if(y!==h.prev&&y!==h.next&&al(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&jn(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;S&&S.z<=b;){if(S!==h.prev&&S!==h.next&&al(i.x,i.y,o.x,o.y,a.x,a.y,S.x,S.y)&&jn(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function xE(h,e,t){let n=h;do{const i=n.prev,o=n.next.next;!yd(i,o)&&i0(i,n,n.next,o)&&Gc(i,o)&&Gc(o,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(o.i/t),Wc(n),Wc(n.next),n=h=o),n=n.next}while(n!==h);return Uo(n)}function yE(h,e,t,n,i,o){let a=h;do{let c=a.next.next;for(;c!==a.prev;){if(a.i!==c.i&&kE(a,c)){let u=s0(a,c);a=Uo(a,a.next),u=Uo(u,u.next),Hc(a,e,t,n,i,o),Hc(u,e,t,n,i,o);return}c=c.next}a=a.next}while(a!==h)}function CE(h,e,t,n){const i=[];let o,a,c,u,d;for(o=0,a=e.length;o<a;o++)c=e[o]*n,u=o<a-1?e[o+1]*n:h.length,d=n0(h,c,u,n,!1),d===d.next&&(d.steiner=!0),i.push(LE(d));for(i.sort(ME),o=0;o<i.length;o++)EE(i[o],t),t=Uo(t,t.next);return t}function ME(h,e){return h.x-e.x}function EE(h,e){if(e=SE(h,e),e){const t=s0(e,h);Uo(e,e.next),Uo(t,t.next)}}function SE(h,e){let t=e;const n=h.x,i=h.y;let o=-1/0,a;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const b=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(b<=n&&b>o){if(o=b,b===n){if(i===t.y)return t;if(i===t.next.y)return t.next}a=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!a)return null;if(n===o)return a;const c=a,u=a.x,d=a.y;let v=1/0,g;t=a;do n>=t.x&&t.x>=u&&n!==t.x&&al(i<d?n:o,i,u,d,i<d?o:n,i,t.x,t.y)&&(g=Math.abs(i-t.y)/(n-t.x),Gc(t,h)&&(g<v||g===v&&(t.x>a.x||t.x===a.x&&AE(a,t)))&&(a=t,v=g)),t=t.next;while(t!==c);return a}function AE(h,e){return jn(h.prev,h,e.prev)<0&&jn(e.next,h,h.next)<0}function PE(h,e,t,n){let i=h;do i.z===null&&(i.z=fm(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==h);i.prevZ.nextZ=null,i.prevZ=null,TE(i)}function TE(h){let e,t,n,i,o,a,c,u,d=1;do{for(t=h,h=null,o=null,a=0;t;){for(a++,n=t,c=0,e=0;e<d&&(c++,n=n.nextZ,!!n);e++);for(u=d;c>0||u>0&&n;)c!==0&&(u===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,c--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:h=i,i.prevZ=o,o=i;t=n}o.nextZ=null,d*=2}while(a>1);return h}function fm(h,e,t,n,i){return h=32767*(h-t)*i,e=32767*(e-n)*i,h=(h|h<<8)&16711935,h=(h|h<<4)&252645135,h=(h|h<<2)&858993459,h=(h|h<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,h|e<<1}function LE(h){let e=h,t=h;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==h);return t}function al(h,e,t,n,i,o,a,c){return(i-a)*(e-c)-(h-a)*(o-c)>=0&&(h-a)*(n-c)-(t-a)*(e-c)>=0&&(t-a)*(o-c)-(i-a)*(n-c)>=0}function kE(h,e){return h.next.i!==e.i&&h.prev.i!==e.i&&!RE(h,e)&&(Gc(h,e)&&Gc(e,h)&&IE(h,e)&&(jn(h.prev,h,e.prev)||jn(h,e.prev,e))||yd(h,e)&&jn(h.prev,h,h.next)>0&&jn(e.prev,e,e.next)>0)}function jn(h,e,t){return(e.y-h.y)*(t.x-e.x)-(e.x-h.x)*(t.y-e.y)}function yd(h,e){return h.x===e.x&&h.y===e.y}function i0(h,e,t,n){const i=Tu(jn(h,e,t)),o=Tu(jn(h,e,n)),a=Tu(jn(t,n,h)),c=Tu(jn(t,n,e));return!!(i!==o&&a!==c||i===0&&Pu(h,t,e)||o===0&&Pu(h,n,e)||a===0&&Pu(t,h,n)||c===0&&Pu(t,e,n))}function Pu(h,e,t){return e.x<=Math.max(h.x,t.x)&&e.x>=Math.min(h.x,t.x)&&e.y<=Math.max(h.y,t.y)&&e.y>=Math.min(h.y,t.y)}function Tu(h){return h>0?1:h<0?-1:0}function RE(h,e){let t=h;do{if(t.i!==h.i&&t.next.i!==h.i&&t.i!==e.i&&t.next.i!==e.i&&i0(t,t.next,h,e))return!0;t=t.next}while(t!==h);return!1}function Gc(h,e){return jn(h.prev,h,h.next)<0?jn(h,e,h.next)>=0&&jn(h,h.prev,e)>=0:jn(h,e,h.prev)<0||jn(h,h.next,e)<0}function IE(h,e){let t=h,n=!1;const i=(h.x+e.x)/2,o=(h.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&i<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==h);return n}function s0(h,e){const t=new mm(h.i,h.x,h.y),n=new mm(e.i,e.x,e.y),i=h.next,o=e.prev;return h.next=e,e.prev=h,t.next=i,i.prev=t,n.next=t,t.prev=n,o.next=n,n.prev=o,n}function Ig(h,e,t,n){const i=new mm(h,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Wc(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function mm(h,e,t){this.i=h,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function DE(h,e,t,n){let i=0;for(let o=e,a=t-n;o<t;o+=n)i+=(h[a]-h[o])*(h[o+1]+h[a+1]),a=o;return i}class kr{static area(e){const t=e.length;let n=0;for(let i=t-1,o=0;o<t;i=o++)n+=e[i].x*e[o].y-e[o].x*e[i].y;return n*.5}static isClockWise(e){return kr.area(e)<0}static triangulateShape(e,t){const n=[],i=[],o=[];Dg(e),zg(n,e);let a=e.length;t.forEach(Dg);for(let u=0;u<t.length;u++)i.push(a),a+=t[u].length,zg(n,t[u]);const c=_E.triangulate(n,i);for(let u=0;u<c.length;u+=3)o.push(c.slice(u,u+3));return o}}function Dg(h){const e=h.length;e>2&&h[e-1].equals(h[0])&&h.pop()}function zg(h,e){for(let t=0;t<e.length;t++)h.push(e[t].x),h.push(e[t].y)}class rh extends jt{constructor(e=new ga([new De(.5,.5),new De(-.5,.5),new De(-.5,-.5),new De(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],o=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];a(d)}this.setAttribute("position",new bt(i,3)),this.setAttribute("uv",new bt(o,2)),this.computeVertexNormals();function a(c){const u=[],d=t.curveSegments!==void 0?t.curveSegments:12,v=t.steps!==void 0?t.steps:1,g=t.depth!==void 0?t.depth:1;let b=t.bevelEnabled!==void 0?t.bevelEnabled:!0,y=t.bevelThickness!==void 0?t.bevelThickness:.2,S=t.bevelSize!==void 0?t.bevelSize:y-.1,E=t.bevelOffset!==void 0?t.bevelOffset:0,M=t.bevelSegments!==void 0?t.bevelSegments:3;const L=t.extrudePath,R=t.UVGenerator!==void 0?t.UVGenerator:zE;let z,V=!1,H,B,j,F;L&&(z=L.getSpacedPoints(v),V=!0,b=!1,H=L.computeFrenetFrames(v,!1),B=new X,j=new X,F=new X),b||(M=0,y=0,S=0,E=0);const W=c.extractPoints(d);let Z=W.shape;const se=W.holes;if(!kr.isClockWise(Z)){Z=Z.reverse();for(let ke=0,xe=se.length;ke<xe;ke++){const Ve=se[ke];kr.isClockWise(Ve)&&(se[ke]=Ve.reverse())}}const oe=kr.triangulateShape(Z,se),ne=Z;for(let ke=0,xe=se.length;ke<xe;ke++){const Ve=se[ke];Z=Z.concat(Ve)}function ce(ke,xe,Ve){return xe||console.error("THREE.ExtrudeGeometry: vec does not exist"),xe.clone().multiplyScalar(Ve).add(ke)}const ve=Z.length,de=oe.length;function he(ke,xe,Ve){let Ye,Oe,St;const vt=ke.x-xe.x,dt=ke.y-xe.y,en=Ve.x-ke.x,Xt=Ve.y-ke.y,Q=vt*vt+dt*dt,q=vt*Xt-dt*en;if(Math.abs(q)>Number.EPSILON){const ge=Math.sqrt(Q),Ne=Math.sqrt(en*en+Xt*Xt),je=xe.x-dt/ge,Ze=xe.y+vt/ge,wt=Ve.x-Xt/Ne,qe=Ve.y+en/Ne,Pe=((wt-je)*Xt-(qe-Ze)*en)/(vt*Xt-dt*en);Ye=je+vt*Pe-ke.x,Oe=Ze+dt*Pe-ke.y;const ct=Ye*Ye+Oe*Oe;if(ct<=2)return new De(Ye,Oe);St=Math.sqrt(ct/2)}else{let ge=!1;vt>Number.EPSILON?en>Number.EPSILON&&(ge=!0):vt<-Number.EPSILON?en<-Number.EPSILON&&(ge=!0):Math.sign(dt)===Math.sign(Xt)&&(ge=!0),ge?(Ye=-dt,Oe=vt,St=Math.sqrt(Q)):(Ye=vt,Oe=dt,St=Math.sqrt(Q/2))}return new De(Ye/St,Oe/St)}const ue=[];for(let ke=0,xe=ne.length,Ve=xe-1,Ye=ke+1;ke<xe;ke++,Ve++,Ye++)Ve===xe&&(Ve=0),Ye===xe&&(Ye=0),ue[ke]=he(ne[ke],ne[Ve],ne[Ye]);const me=[];let ze,Te=ue.concat();for(let ke=0,xe=se.length;ke<xe;ke++){const Ve=se[ke];ze=[];for(let Ye=0,Oe=Ve.length,St=Oe-1,vt=Ye+1;Ye<Oe;Ye++,St++,vt++)St===Oe&&(St=0),vt===Oe&&(vt=0),ze[Ye]=he(Ve[Ye],Ve[St],Ve[vt]);me.push(ze),Te=Te.concat(ze)}for(let ke=0;ke<M;ke++){const xe=ke/M,Ve=y*Math.cos(xe*Math.PI/2),Ye=S*Math.sin(xe*Math.PI/2)+E;for(let Oe=0,St=ne.length;Oe<St;Oe++){const vt=ce(ne[Oe],ue[Oe],Ye);pt(vt.x,vt.y,-Ve)}for(let Oe=0,St=se.length;Oe<St;Oe++){const vt=se[Oe];ze=me[Oe];for(let dt=0,en=vt.length;dt<en;dt++){const Xt=ce(vt[dt],ze[dt],Ye);pt(Xt.x,Xt.y,-Ve)}}}const Re=S+E;for(let ke=0;ke<ve;ke++){const xe=b?ce(Z[ke],Te[ke],Re):Z[ke];V?(j.copy(H.normals[0]).multiplyScalar(xe.x),B.copy(H.binormals[0]).multiplyScalar(xe.y),F.copy(z[0]).add(j).add(B),pt(F.x,F.y,F.z)):pt(xe.x,xe.y,0)}for(let ke=1;ke<=v;ke++)for(let xe=0;xe<ve;xe++){const Ve=b?ce(Z[xe],Te[xe],Re):Z[xe];V?(j.copy(H.normals[ke]).multiplyScalar(Ve.x),B.copy(H.binormals[ke]).multiplyScalar(Ve.y),F.copy(z[ke]).add(j).add(B),pt(F.x,F.y,F.z)):pt(Ve.x,Ve.y,g/v*ke)}for(let ke=M-1;ke>=0;ke--){const xe=ke/M,Ve=y*Math.cos(xe*Math.PI/2),Ye=S*Math.sin(xe*Math.PI/2)+E;for(let Oe=0,St=ne.length;Oe<St;Oe++){const vt=ce(ne[Oe],ue[Oe],Ye);pt(vt.x,vt.y,g+Ve)}for(let Oe=0,St=se.length;Oe<St;Oe++){const vt=se[Oe];ze=me[Oe];for(let dt=0,en=vt.length;dt<en;dt++){const Xt=ce(vt[dt],ze[dt],Ye);V?pt(Xt.x,Xt.y+z[v-1].y,z[v-1].x+Ve):pt(Xt.x,Xt.y,g+Ve)}}}Ie(),rt();function Ie(){const ke=i.length/3;if(b){let xe=0,Ve=ve*xe;for(let Ye=0;Ye<de;Ye++){const Oe=oe[Ye];nt(Oe[2]+Ve,Oe[1]+Ve,Oe[0]+Ve)}xe=v+M*2,Ve=ve*xe;for(let Ye=0;Ye<de;Ye++){const Oe=oe[Ye];nt(Oe[0]+Ve,Oe[1]+Ve,Oe[2]+Ve)}}else{for(let xe=0;xe<de;xe++){const Ve=oe[xe];nt(Ve[2],Ve[1],Ve[0])}for(let xe=0;xe<de;xe++){const Ve=oe[xe];nt(Ve[0]+ve*v,Ve[1]+ve*v,Ve[2]+ve*v)}}n.addGroup(ke,i.length/3-ke,0)}function rt(){const ke=i.length/3;let xe=0;Ae(ne,xe),xe+=ne.length;for(let Ve=0,Ye=se.length;Ve<Ye;Ve++){const Oe=se[Ve];Ae(Oe,xe),xe+=Oe.length}n.addGroup(ke,i.length/3-ke,1)}function Ae(ke,xe){let Ve=ke.length;for(;--Ve>=0;){const Ye=Ve;let Oe=Ve-1;Oe<0&&(Oe=ke.length-1);for(let St=0,vt=v+M*2;St<vt;St++){const dt=ve*St,en=ve*(St+1),Xt=xe+Ye+dt,Q=xe+Oe+dt,q=xe+Oe+en,ge=xe+Ye+en;Et(Xt,Q,q,ge)}}}function pt(ke,xe,Ve){u.push(ke),u.push(xe),u.push(Ve)}function nt(ke,xe,Ve){He(ke),He(xe),He(Ve);const Ye=i.length/3,Oe=R.generateTopUV(n,i,Ye-3,Ye-2,Ye-1);mt(Oe[0]),mt(Oe[1]),mt(Oe[2])}function Et(ke,xe,Ve,Ye){He(ke),He(xe),He(Ye),He(xe),He(Ve),He(Ye);const Oe=i.length/3,St=R.generateSideWallUV(n,i,Oe-6,Oe-3,Oe-2,Oe-1);mt(St[0]),mt(St[1]),mt(St[3]),mt(St[1]),mt(St[2]),mt(St[3])}function He(ke){i.push(u[ke*3+0]),i.push(u[ke*3+1]),i.push(u[ke*3+2])}function mt(ke){o.push(ke.x),o.push(ke.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return VE(t,n,e)}static fromJSON(e,t){const n=[];for(let o=0,a=e.shapes.length;o<a;o++){const c=t[e.shapes[o]];n.push(c)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new ev[i.type]().fromJSON(i)),new rh(n,e.options)}}const zE={generateTopUV:function(h,e,t,n,i){const o=e[t*3],a=e[t*3+1],c=e[n*3],u=e[n*3+1],d=e[i*3],v=e[i*3+1];return[new De(o,a),new De(c,u),new De(d,v)]},generateSideWallUV:function(h,e,t,n,i,o){const a=e[t*3],c=e[t*3+1],u=e[t*3+2],d=e[n*3],v=e[n*3+1],g=e[n*3+2],b=e[i*3],y=e[i*3+1],S=e[i*3+2],E=e[o*3],M=e[o*3+1],L=e[o*3+2];return Math.abs(c-v)<Math.abs(a-d)?[new De(a,1-u),new De(d,1-g),new De(b,1-S),new De(E,1-L)]:[new De(c,1-u),new De(v,1-g),new De(y,1-S),new De(M,1-L)]}};function VE(h,e,t){if(t.shapes=[],Array.isArray(h))for(let n=0,i=h.length;n<i;n++){const o=h[n];t.shapes.push(o.uuid)}else t.shapes.push(h.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class oh extends ho{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,o,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new oh(e.radius,e.detail)}}class yl extends ho{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new yl(e.radius,e.detail)}}class ah extends jt{constructor(e=.5,t=1,n=8,i=1,o=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:o,thetaLength:a},n=Math.max(3,n),i=Math.max(1,i);const c=[],u=[],d=[],v=[];let g=e;const b=(t-e)/i,y=new X,S=new De;for(let E=0;E<=i;E++){for(let M=0;M<=n;M++){const L=o+M/n*a;y.x=g*Math.cos(L),y.y=g*Math.sin(L),u.push(y.x,y.y,y.z),d.push(0,0,1),S.x=(y.x/t+1)/2,S.y=(y.y/t+1)/2,v.push(S.x,S.y)}g+=b}for(let E=0;E<i;E++){const M=E*(n+1);for(let L=0;L<n;L++){const R=L+M,z=R,V=R+n+1,H=R+n+2,B=R+1;c.push(z,V,B),c.push(V,H,B)}}this.setIndex(c),this.setAttribute("position",new bt(u,3)),this.setAttribute("normal",new bt(d,3)),this.setAttribute("uv",new bt(v,2))}static fromJSON(e){return new ah(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class lh extends jt{constructor(e=new ga([new De(0,.5),new De(-.5,-.5),new De(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],o=[],a=[];let c=0,u=0;if(Array.isArray(e)===!1)d(e);else for(let v=0;v<e.length;v++)d(e[v]),this.addGroup(c,u,v),c+=u,u=0;this.setIndex(n),this.setAttribute("position",new bt(i,3)),this.setAttribute("normal",new bt(o,3)),this.setAttribute("uv",new bt(a,2));function d(v){const g=i.length/3,b=v.extractPoints(t);let y=b.shape;const S=b.holes;kr.isClockWise(y)===!1&&(y=y.reverse());for(let M=0,L=S.length;M<L;M++){const R=S[M];kr.isClockWise(R)===!0&&(S[M]=R.reverse())}const E=kr.triangulateShape(y,S);for(let M=0,L=S.length;M<L;M++){const R=S[M];y=y.concat(R)}for(let M=0,L=y.length;M<L;M++){const R=y[M];i.push(R.x,R.y,0),o.push(0,0,1),a.push(R.x,R.y)}for(let M=0,L=E.length;M<L;M++){const R=E[M],z=R[0]+g,V=R[1]+g,H=R[2]+g;n.push(z,V,H),u+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return NE(t,e)}static fromJSON(e,t){const n=[];for(let i=0,o=e.shapes.length;i<o;i++){const a=t[e.shapes[i]];n.push(a)}return new lh(n,e.curveSegments)}}function NE(h,e){if(e.shapes=[],Array.isArray(h))for(let t=0,n=h.length;t<n;t++){const i=h[t];e.shapes.push(i.uuid)}else e.shapes.push(h.uuid);return e}class Go extends jt{constructor(e=1,t=32,n=16,i=0,o=Math.PI*2,a=0,c=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:o,thetaStart:a,thetaLength:c},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const u=Math.min(a+c,Math.PI);let d=0;const v=[],g=new X,b=new X,y=[],S=[],E=[],M=[];for(let L=0;L<=n;L++){const R=[],z=L/n;let V=0;L==0&&a==0?V=.5/t:L==n&&u==Math.PI&&(V=-.5/t);for(let H=0;H<=t;H++){const B=H/t;g.x=-e*Math.cos(i+B*o)*Math.sin(a+z*c),g.y=e*Math.cos(a+z*c),g.z=e*Math.sin(i+B*o)*Math.sin(a+z*c),S.push(g.x,g.y,g.z),b.copy(g).normalize(),E.push(b.x,b.y,b.z),M.push(B+V,1-z),R.push(d++)}v.push(R)}for(let L=0;L<n;L++)for(let R=0;R<t;R++){const z=v[L][R+1],V=v[L][R],H=v[L+1][R],B=v[L+1][R+1];(L!==0||a>0)&&y.push(z,V,B),(L!==n-1||u<Math.PI)&&y.push(V,H,B)}this.setIndex(y),this.setAttribute("position",new bt(S,3)),this.setAttribute("normal",new bt(E,3)),this.setAttribute("uv",new bt(M,2))}static fromJSON(e){return new Go(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class ch extends ho{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ch(e.radius,e.detail)}}class hh extends jt{constructor(e=1,t=.4,n=8,i=6,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:o},n=Math.floor(n),i=Math.floor(i);const a=[],c=[],u=[],d=[],v=new X,g=new X,b=new X;for(let y=0;y<=n;y++)for(let S=0;S<=i;S++){const E=S/i*o,M=y/n*Math.PI*2;g.x=(e+t*Math.cos(M))*Math.cos(E),g.y=(e+t*Math.cos(M))*Math.sin(E),g.z=t*Math.sin(M),c.push(g.x,g.y,g.z),v.x=e*Math.cos(E),v.y=e*Math.sin(E),b.subVectors(g,v).normalize(),u.push(b.x,b.y,b.z),d.push(S/i),d.push(y/n)}for(let y=1;y<=n;y++)for(let S=1;S<=i;S++){const E=(i+1)*y+S-1,M=(i+1)*(y-1)+S-1,L=(i+1)*(y-1)+S,R=(i+1)*y+S;a.push(E,M,R),a.push(M,L,R)}this.setIndex(a),this.setAttribute("position",new bt(c,3)),this.setAttribute("normal",new bt(u,3)),this.setAttribute("uv",new bt(d,2))}static fromJSON(e){return new hh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class uh extends jt{constructor(e=1,t=.4,n=64,i=8,o=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:o,q:a},n=Math.floor(n),i=Math.floor(i);const c=[],u=[],d=[],v=[],g=new X,b=new X,y=new X,S=new X,E=new X,M=new X,L=new X;for(let z=0;z<=n;++z){const V=z/n*o*Math.PI*2;R(V,o,a,e,y),R(V+.01,o,a,e,S),M.subVectors(S,y),L.addVectors(S,y),E.crossVectors(M,L),L.crossVectors(E,M),E.normalize(),L.normalize();for(let H=0;H<=i;++H){const B=H/i*Math.PI*2,j=-t*Math.cos(B),F=t*Math.sin(B);g.x=y.x+(j*L.x+F*E.x),g.y=y.y+(j*L.y+F*E.y),g.z=y.z+(j*L.z+F*E.z),u.push(g.x,g.y,g.z),b.subVectors(g,y).normalize(),d.push(b.x,b.y,b.z),v.push(z/n),v.push(H/i)}}for(let z=1;z<=n;z++)for(let V=1;V<=i;V++){const H=(i+1)*(z-1)+(V-1),B=(i+1)*z+(V-1),j=(i+1)*z+V,F=(i+1)*(z-1)+V;c.push(H,B,F),c.push(B,j,F)}this.setIndex(c),this.setAttribute("position",new bt(u,3)),this.setAttribute("normal",new bt(d,3)),this.setAttribute("uv",new bt(v,2));function R(z,V,H,B,j){const F=Math.cos(z),W=Math.sin(z),Z=H/V*z,se=Math.cos(Z);j.x=B*(2+se)*.5*F,j.y=B*(2+se)*W*.5,j.z=B*Math.sin(Z)*.5}}static fromJSON(e){return new uh(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class dh extends jt{constructor(e=new Jm(new X(-1,-1,0),new X(-1,1,0),new X(1,1,0)),t=64,n=1,i=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:o};const a=e.computeFrenetFrames(t,o);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const c=new X,u=new X,d=new De;let v=new X;const g=[],b=[],y=[],S=[];E(),this.setIndex(S),this.setAttribute("position",new bt(g,3)),this.setAttribute("normal",new bt(b,3)),this.setAttribute("uv",new bt(y,2));function E(){for(let z=0;z<t;z++)M(z);M(o===!1?t:0),R(),L()}function M(z){v=e.getPointAt(z/t,v);const V=a.normals[z],H=a.binormals[z];for(let B=0;B<=i;B++){const j=B/i*Math.PI*2,F=Math.sin(j),W=-Math.cos(j);u.x=W*V.x+F*H.x,u.y=W*V.y+F*H.y,u.z=W*V.z+F*H.z,u.normalize(),b.push(u.x,u.y,u.z),c.x=v.x+n*u.x,c.y=v.y+n*u.y,c.z=v.z+n*u.z,g.push(c.x,c.y,c.z)}}function L(){for(let z=1;z<=t;z++)for(let V=1;V<=i;V++){const H=(i+1)*(z-1)+(V-1),B=(i+1)*z+(V-1),j=(i+1)*z+V,F=(i+1)*(z-1)+V;S.push(H,B,F),S.push(B,j,F)}}function R(){for(let z=0;z<=t;z++)for(let V=0;V<=i;V++)d.x=z/t,d.y=V/i,y.push(d.x,d.y)}}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new dh(new ev[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class r0 extends jt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new X,o=new X;if(e.index!==null){const a=e.attributes.position,c=e.index;let u=e.groups;u.length===0&&(u=[{start:0,count:c.count,materialIndex:0}]);for(let d=0,v=u.length;d<v;++d){const g=u[d],b=g.start,y=g.count;for(let S=b,E=b+y;S<E;S+=3)for(let M=0;M<3;M++){const L=c.getX(S+M),R=c.getX(S+(M+1)%3);i.fromBufferAttribute(a,L),o.fromBufferAttribute(a,R),Vg(i,o,n)===!0&&(t.push(i.x,i.y,i.z),t.push(o.x,o.y,o.z))}}}else{const a=e.attributes.position;for(let c=0,u=a.count/3;c<u;c++)for(let d=0;d<3;d++){const v=3*c+d,g=3*c+(d+1)%3;i.fromBufferAttribute(a,v),o.fromBufferAttribute(a,g),Vg(i,o,n)===!0&&(t.push(i.x,i.y,i.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new bt(t,3))}}}function Vg(h,e,t){const n=`${h.x},${h.y},${h.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${h.x},${h.y},${h.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var Ng=Object.freeze({__proto__:null,BoxGeometry:lo,CapsuleGeometry:th,CircleGeometry:nh,ConeGeometry:ih,CylinderGeometry:Sa,DodecahedronGeometry:sh,EdgesGeometry:t0,ExtrudeGeometry:rh,IcosahedronGeometry:oh,LatheGeometry:xl,OctahedronGeometry:yl,PlaneGeometry:co,PolyhedronGeometry:ho,RingGeometry:ah,ShapeGeometry:lh,SphereGeometry:Go,TetrahedronGeometry:ch,TorusGeometry:hh,TorusKnotGeometry:uh,TubeGeometry:dh,WireframeGeometry:r0});class o0 extends ti{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new $e(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class a0 extends Ds{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Wo extends ti{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new $e(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=so,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $i extends Wo{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new De(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ai(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new $e(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new $e(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new $e(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class l0 extends ti{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new $e(16777215),this.specular=new $e(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=so,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class c0 extends ti{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new $e(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=so,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class h0 extends ti{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=so,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class u0 extends ti{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new $e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=so,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class d0 extends ti{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new $e(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=so,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class p0 extends Fi{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function js(h,e,t){return tv(h)?new h.constructor(h.subarray(e,t!==void 0?t:h.length)):h.slice(e,t)}function da(h,e,t){return!h||!t&&h.constructor===e?h:typeof e.BYTES_PER_ELEMENT=="number"?new e(h):Array.prototype.slice.call(h)}function tv(h){return ArrayBuffer.isView(h)&&!(h instanceof DataView)}function f0(h){function e(i,o){return h[i]-h[o]}const t=h.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function vm(h,e,t){const n=h.length,i=new h.constructor(n);for(let o=0,a=0;a!==n;++o){const c=t[o]*e;for(let u=0;u!==e;++u)i[a++]=h[c+u]}return i}function nv(h,e,t,n){let i=1,o=h[0];for(;o!==void 0&&o[n]===void 0;)o=h[i++];if(o===void 0)return;let a=o[n];if(a!==void 0)if(Array.isArray(a))do a=o[n],a!==void 0&&(e.push(o.time),t.push.apply(t,a)),o=h[i++];while(o!==void 0);else if(a.toArray!==void 0)do a=o[n],a!==void 0&&(e.push(o.time),a.toArray(t,t.length)),o=h[i++];while(o!==void 0);else do a=o[n],a!==void 0&&(e.push(o.time),t.push(a)),o=h[i++];while(o!==void 0)}function OE(h,e,t,n,i=30){const o=h.clone();o.name=e;const a=[];for(let u=0;u<o.tracks.length;++u){const d=o.tracks[u],v=d.getValueSize(),g=[],b=[];for(let y=0;y<d.times.length;++y){const S=d.times[y]*i;if(!(S<t||S>=n)){g.push(d.times[y]);for(let E=0;E<v;++E)b.push(d.values[y*v+E])}}g.length!==0&&(d.times=da(g,d.times.constructor),d.values=da(b,d.values.constructor),a.push(d))}o.tracks=a;let c=1/0;for(let u=0;u<o.tracks.length;++u)c>o.tracks[u].times[0]&&(c=o.tracks[u].times[0]);for(let u=0;u<o.tracks.length;++u)o.tracks[u].shift(-1*c);return o.resetDuration(),o}function FE(h,e=0,t=h,n=30){n<=0&&(n=30);const i=t.tracks.length,o=e/n;for(let a=0;a<i;++a){const c=t.tracks[a],u=c.ValueTypeName;if(u==="bool"||u==="string")continue;const d=h.tracks.find(function(L){return L.name===c.name&&L.ValueTypeName===u});if(d===void 0)continue;let v=0;const g=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(v=g/3);let b=0;const y=d.getValueSize();d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(b=y/3);const S=c.times.length-1;let E;if(o<=c.times[0]){const L=v,R=g-v;E=js(c.values,L,R)}else if(o>=c.times[S]){const L=S*g+v,R=L+g-v;E=js(c.values,L,R)}else{const L=c.createInterpolant(),R=v,z=g-v;L.evaluate(o),E=js(L.resultBuffer,R,z)}u==="quaternion"&&new Vn().fromArray(E).normalize().conjugate().toArray(E);const M=d.times.length;for(let L=0;L<M;++L){const R=L*y+b;if(u==="quaternion")Vn.multiplyQuaternionsFlat(d.values,R,E,0,d.values,R);else{const z=y-b*2;for(let V=0;V<z;++V)d.values[R+V]-=E[V]}}}return h.blendMode=Nm,h}var BE=Object.freeze({__proto__:null,arraySlice:js,convertArray:da,isTypedArray:tv,getKeyframeOrder:f0,sortedArray:vm,flattenJSON:nv,subclip:OE,makeClipAdditive:FE});class Aa{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],o=t[n-1];e:{t:{let a;n:{i:if(!(e<i)){for(let c=n+2;;){if(i===void 0){if(e<o)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===c)break;if(o=i,i=t[++n],e<i)break t}a=t.length;break n}if(!(e>=o)){const c=t[1];e<c&&(n=2,o=c);for(let u=n-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===u)break;if(i=o,o=t[--n-1],e>=o)break t}a=n,n=0;break n}break e}for(;n<a;){const c=n+a>>>1;e<t[c]?a=c:n=c+1}if(i=t[n],o=t[n-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,o,i)}return this.interpolate_(n,o,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=e*i;for(let a=0;a!==i;++a)t[a]=n[o+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class m0 extends Aa{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ca,endingEnd:ca}}intervalChanged_(e,t,n){const i=this.parameterPositions;let o=e-2,a=e+1,c=i[o],u=i[a];if(c===void 0)switch(this.getSettings_().endingStart){case ha:o=e,c=2*t-n;break;case Nc:o=i.length-2,c=t+i[o]-i[o+1];break;default:o=e,c=n}if(u===void 0)switch(this.getSettings_().endingEnd){case ha:a=e,u=2*n-t;break;case Nc:a=1,u=n+i[1]-i[0];break;default:a=e-1,u=t}const d=(n-t)*.5,v=this.valueSize;this._weightPrev=d/(t-c),this._weightNext=d/(u-n),this._offsetPrev=o*v,this._offsetNext=a*v}interpolate_(e,t,n,i){const o=this.resultBuffer,a=this.sampleValues,c=this.valueSize,u=e*c,d=u-c,v=this._offsetPrev,g=this._offsetNext,b=this._weightPrev,y=this._weightNext,S=(n-t)/(i-t),E=S*S,M=E*S,L=-b*M+2*b*E-b*S,R=(1+b)*M+(-1.5-2*b)*E+(-.5+b)*S+1,z=(-1-y)*M+(1.5+y)*E+.5*S,V=y*M-y*E;for(let H=0;H!==c;++H)o[H]=L*a[v+H]+R*a[d+H]+z*a[u+H]+V*a[g+H];return o}}class iv extends Aa{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const o=this.resultBuffer,a=this.sampleValues,c=this.valueSize,u=e*c,d=u-c,v=(n-t)/(i-t),g=1-v;for(let b=0;b!==c;++b)o[b]=a[d+b]*g+a[u+b]*v;return o}}class v0 extends Aa{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class br{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=da(t,this.TimeBufferType),this.values=da(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:da(e.times,Array),values:da(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new v0(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new iv(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new m0(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case xa:t=this.InterpolantFactoryMethodDiscrete;break;case to:t=this.InterpolantFactoryMethodLinear;break;case Wu:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return xa;case this.InterpolantFactoryMethodLinear:return to;case this.InterpolantFactoryMethodSmooth:return Wu}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let o=0,a=i-1;for(;o!==i&&n[o]<e;)++o;for(;a!==-1&&n[a]>t;)--a;if(++a,o!==0||a!==i){o>=a&&(a=Math.max(a,1),o=a-1);const c=this.getValueSize();this.times=js(n,o,a),this.values=js(this.values,o*c,a*c)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,o=n.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let c=0;c!==o;c++){const u=n[c];if(typeof u=="number"&&isNaN(u)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,c,u),e=!1;break}if(a!==null&&a>u){console.error("THREE.KeyframeTrack: Out of order keys.",this,c,u,a),e=!1;break}a=u}if(i!==void 0&&tv(i))for(let c=0,u=i.length;c!==u;++c){const d=i[c];if(isNaN(d)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,d),e=!1;break}}return e}optimize(){const e=js(this.times),t=js(this.values),n=this.getValueSize(),i=this.getInterpolation()===Wu,o=e.length-1;let a=1;for(let c=1;c<o;++c){let u=!1;const d=e[c],v=e[c+1];if(d!==v&&(c!==1||d!==e[0]))if(i)u=!0;else{const g=c*n,b=g-n,y=g+n;for(let S=0;S!==n;++S){const E=t[g+S];if(E!==t[b+S]||E!==t[y+S]){u=!0;break}}}if(u){if(c!==a){e[a]=e[c];const g=c*n,b=a*n;for(let y=0;y!==n;++y)t[b+y]=t[g+y]}++a}}if(o>0){e[a]=e[o];for(let c=o*n,u=a*n,d=0;d!==n;++d)t[u+d]=t[c+d];++a}return a!==e.length?(this.times=js(e,0,a),this.values=js(t,0,a*n)):(this.times=e,this.values=t),this}clone(){const e=js(this.times,0),t=js(this.values,0),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}br.prototype.TimeBufferType=Float32Array;br.prototype.ValueBufferType=Float32Array;br.prototype.DefaultInterpolation=to;class Pa extends br{}Pa.prototype.ValueTypeName="bool";Pa.prototype.ValueBufferType=Array;Pa.prototype.DefaultInterpolation=xa;Pa.prototype.InterpolantFactoryMethodLinear=void 0;Pa.prototype.InterpolantFactoryMethodSmooth=void 0;class sv extends br{}sv.prototype.ValueTypeName="color";class ya extends br{}ya.prototype.ValueTypeName="number";class g0 extends Aa{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const o=this.resultBuffer,a=this.sampleValues,c=this.valueSize,u=(n-t)/(i-t);let d=e*c;for(let v=d+c;d!==v;d+=4)Vn.slerpFlat(o,0,a,d-c,a,d,u);return o}}class Rr extends br{InterpolantFactoryMethodLinear(e){return new g0(this.times,this.values,this.getValueSize(),e)}}Rr.prototype.ValueTypeName="quaternion";Rr.prototype.DefaultInterpolation=to;Rr.prototype.InterpolantFactoryMethodSmooth=void 0;class Ta extends br{}Ta.prototype.ValueTypeName="string";Ta.prototype.ValueBufferType=Array;Ta.prototype.DefaultInterpolation=xa;Ta.prototype.InterpolantFactoryMethodLinear=void 0;Ta.prototype.InterpolantFactoryMethodSmooth=void 0;class Ca extends br{}Ca.prototype.ValueTypeName="vector";class Ma{constructor(e,t=-1,n,i=ad){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Rs(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let a=0,c=n.length;a!==c;++a)t.push(HE(n[a]).scale(i));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,a=n.length;o!==a;++o)t.push(br.toJSON(n[o]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const o=t.length,a=[];for(let c=0;c<o;c++){let u=[],d=[];u.push((c+o-1)%o,c,(c+1)%o),d.push(0,1,0);const v=f0(u);u=vm(u,1,v),d=vm(d,1,v),!i&&u[0]===0&&(u.push(o),d.push(d[0])),a.push(new ya(".morphTargetInfluences["+t[c].name+"]",u,d).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},o=/^([\w-]*?)([\d]+)$/;for(let c=0,u=e.length;c<u;c++){const d=e[c],v=d.name.match(o);if(v&&v.length>1){const g=v[1];let b=i[g];b||(i[g]=b=[]),b.push(d)}}const a=[];for(const c in i)a.push(this.CreateFromMorphTargetSequence(c,i[c],t,n));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(g,b,y,S,E){if(y.length!==0){const M=[],L=[];nv(y,M,L,S),M.length!==0&&E.push(new g(b,M,L))}},i=[],o=e.name||"default",a=e.fps||30,c=e.blendMode;let u=e.length||-1;const d=e.hierarchy||[];for(let g=0;g<d.length;g++){const b=d[g].keys;if(!(!b||b.length===0))if(b[0].morphTargets){const y={};let S;for(S=0;S<b.length;S++)if(b[S].morphTargets)for(let E=0;E<b[S].morphTargets.length;E++)y[b[S].morphTargets[E]]=-1;for(const E in y){const M=[],L=[];for(let R=0;R!==b[S].morphTargets.length;++R){const z=b[S];M.push(z.time),L.push(z.morphTarget===E?1:0)}i.push(new ya(".morphTargetInfluence["+E+"]",M,L))}u=y.length*a}else{const y=".bones["+t[g].name+"]";n(Ca,y+".position",b,"pos",i),n(Rr,y+".quaternion",b,"rot",i),n(Ca,y+".scale",b,"scl",i)}}return i.length===0?null:new this(o,u,i,c)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const o=this.tracks[n];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function UE(h){switch(h.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ya;case"vector":case"vector2":case"vector3":case"vector4":return Ca;case"color":return sv;case"quaternion":return Rr;case"bool":case"boolean":return Pa;case"string":return Ta}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+h)}function HE(h){if(h.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=UE(h.type);if(h.times===void 0){const t=[],n=[];nv(h.keys,t,n,"value"),h.times=t,h.values=n}return e.parse!==void 0?e.parse(h):new e(h.name,h.times,h.values,h.interpolation)}const io={enabled:!1,files:{},add:function(h,e){this.enabled!==!1&&(this.files[h]=e)},get:function(h){if(this.enabled!==!1)return this.files[h]},remove:function(h){delete this.files[h]},clear:function(){this.files={}}};class Cd{constructor(e,t,n){const i=this;let o=!1,a=0,c=0,u;const d=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(v){c++,o===!1&&i.onStart!==void 0&&i.onStart(v,a,c),o=!0},this.itemEnd=function(v){a++,i.onProgress!==void 0&&i.onProgress(v,a,c),a===c&&(o=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(v){i.onError!==void 0&&i.onError(v)},this.resolveURL=function(v){return u?u(v):v},this.setURLModifier=function(v){return u=v,this},this.addHandler=function(v,g){return d.push(v,g),this},this.removeHandler=function(v){const g=d.indexOf(v);return g!==-1&&d.splice(g,2),this},this.getHandler=function(v){for(let g=0,b=d.length;g<b;g+=2){const y=d[g],S=d[g+1];if(y.global&&(y.lastIndex=0),y.test(v))return S}return null}}}const _0=new Cd;class ps{constructor(e){this.manager=e!==void 0?e:_0,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,o){n.load(e,i,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Kr={};class GE extends Error{constructor(e,t){super(e),this.response=t}}class ss extends ps{constructor(e){super(e)}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=io.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(Kr[e]!==void 0){Kr[e].push({onLoad:t,onProgress:n,onError:i});return}Kr[e]=[],Kr[e].push({onLoad:t,onProgress:n,onError:i});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),c=this.mimeType,u=this.responseType;fetch(a).then(d=>{if(d.status===200||d.status===0){if(d.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||d.body===void 0||d.body.getReader===void 0)return d;const v=Kr[e],g=d.body.getReader(),b=d.headers.get("Content-Length"),y=b?parseInt(b):0,S=y!==0;let E=0;const M=new ReadableStream({start(L){R();function R(){g.read().then(({done:z,value:V})=>{if(z)L.close();else{E+=V.byteLength;const H=new ProgressEvent("progress",{lengthComputable:S,loaded:E,total:y});for(let B=0,j=v.length;B<j;B++){const F=v[B];F.onProgress&&F.onProgress(H)}L.enqueue(V),R()}})}}});return new Response(M)}else throw new GE(`fetch for "${d.url}" responded with ${d.status}: ${d.statusText}`,d)}).then(d=>{switch(u){case"arraybuffer":return d.arrayBuffer();case"blob":return d.blob();case"document":return d.text().then(v=>new DOMParser().parseFromString(v,c));case"json":return d.json();default:if(c===void 0)return d.text();{const g=/charset="?([^;"\s]*)"?/i.exec(c),b=g&&g[1]?g[1].toLowerCase():void 0,y=new TextDecoder(b);return d.arrayBuffer().then(S=>y.decode(S))}}}).then(d=>{io.add(e,d);const v=Kr[e];delete Kr[e];for(let g=0,b=v.length;g<b;g++){const y=v[g];y.onLoad&&y.onLoad(d)}}).catch(d=>{const v=Kr[e];if(v===void 0)throw this.manager.itemError(e),d;delete Kr[e];for(let g=0,b=v.length;g<b;g++){const y=v[g];y.onError&&y.onError(d)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class WE extends ps{constructor(e){super(e)}load(e,t,n,i){const o=this,a=new ss(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{t(o.parse(JSON.parse(c)))}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=Ma.parse(e[n]);t.push(i)}return t}}class jE extends ps{constructor(e){super(e)}load(e,t,n,i){const o=this,a=[],c=new Xb,u=new ss(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(o.withCredentials);let d=0;function v(g){u.load(e[g],function(b){const y=o.parse(b,!0);a[g]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},d+=1,d===6&&(y.mipmapCount===1&&(c.minFilter=Ln),c.image=a,c.format=y.format,c.needsUpdate=!0,t&&t(c))},n,i)}if(Array.isArray(e))for(let g=0,b=e.length;g<b;++g)v(g);else u.load(e,function(g){const b=o.parse(g,!0);if(b.isCubemap){const y=b.mipmaps.length/b.mipmapCount;for(let S=0;S<y;S++){a[S]={mipmaps:[]};for(let E=0;E<b.mipmapCount;E++)a[S].mipmaps.push(b.mipmaps[S*b.mipmapCount+E]),a[S].format=b.format,a[S].width=b.width,a[S].height=b.height}c.image=a}else c.image.width=b.width,c.image.height=b.height,c.mipmaps=b.mipmaps;b.mipmapCount===1&&(c.minFilter=Ln),c.format=b.format,c.needsUpdate=!0,t&&t(c)},n,i);return c}}class jc extends ps{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=io.get(e);if(a!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(a),o.manager.itemEnd(e)},0),a;const c=Bc("img");function u(){v(),io.add(e,this),t&&t(this),o.manager.itemEnd(e)}function d(g){v(),i&&i(g),o.manager.itemError(e),o.manager.itemEnd(e)}function v(){c.removeEventListener("load",u,!1),c.removeEventListener("error",d,!1)}return c.addEventListener("load",u,!1),c.addEventListener("error",d,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(c.crossOrigin=this.crossOrigin),o.manager.itemStart(e),c.src=e,c}}class KE extends ps{constructor(e){super(e)}load(e,t,n,i){const o=new Jc,a=new jc(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let c=0;function u(d){a.load(e[d],function(v){o.images[d]=v,c++,c===6&&(o.needsUpdate=!0,t&&t(o))},void 0,i)}for(let d=0;d<e.length;++d)u(d);return o}}class qE extends ps{constructor(e){super(e)}load(e,t,n,i){const o=this,a=new ll,c=new ss(this.manager);return c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setPath(this.path),c.setWithCredentials(o.withCredentials),c.load(e,function(u){const d=o.parse(u);d&&(d.image!==void 0?a.image=d.image:d.data!==void 0&&(a.image.width=d.width,a.image.height=d.height,a.image.data=d.data),a.wrapS=d.wrapS!==void 0?d.wrapS:qi,a.wrapT=d.wrapT!==void 0?d.wrapT:qi,a.magFilter=d.magFilter!==void 0?d.magFilter:Ln,a.minFilter=d.minFilter!==void 0?d.minFilter:Ln,a.anisotropy=d.anisotropy!==void 0?d.anisotropy:1,d.encoding!==void 0&&(a.encoding=d.encoding),d.flipY!==void 0&&(a.flipY=d.flipY),d.format!==void 0&&(a.format=d.format),d.type!==void 0&&(a.type=d.type),d.mipmaps!==void 0&&(a.mipmaps=d.mipmaps,a.minFilter=gr),d.mipmapCount===1&&(a.minFilter=Ln),d.generateMipmaps!==void 0&&(a.generateMipmaps=d.generateMipmaps),a.needsUpdate=!0,t&&t(a,d))},n,i),a}}class Cl extends ps{constructor(e){super(e)}load(e,t,n,i){const o=new Kn,a=new jc(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(c){o.image=c,o.needsUpdate=!0,t!==void 0&&t(o)},n,i),o}}class jo extends Jt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new $e(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class b0 extends jo{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Jt.DefaultUp),this.updateMatrix(),this.groundColor=new $e(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Sf=new It,Og=new X,Fg=new X;class rv{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new De(512,512),this.map=null,this.mapPass=null,this.matrix=new It,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new pd,this._frameExtents=new De(1,1),this._viewportCount=1,this._viewports=[new wn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Og.setFromMatrixPosition(e.matrixWorld),t.position.copy(Og),Fg.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Fg),t.updateMatrixWorld(),Sf.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sf),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Sf)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class XE extends rv{constructor(){super(new Ri(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=Fc*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(n!==t.fov||i!==t.aspect||o!==t.far)&&(t.fov=n,t.aspect=i,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Md extends jo{constructor(e,t,n=0,i=Math.PI/3,o=0,a=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Jt.DefaultUp),this.updateMatrix(),this.target=new Jt,this.distance=n,this.angle=i,this.penumbra=o,this.decay=a,this.map=null,this.shadow=new XE}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Bg=new It,xc=new X,Af=new X;class $E extends rv{constructor(){super(new Ri(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new De(4,2),this._viewportCount=6,this._viewports=[new wn(2,1,1,1),new wn(0,1,1,1),new wn(3,1,1,1),new wn(1,1,1,1),new wn(3,0,1,1),new wn(1,0,1,1)],this._cubeDirections=[new X(1,0,0),new X(-1,0,0),new X(0,0,1),new X(0,0,-1),new X(0,1,0),new X(0,-1,0)],this._cubeUps=[new X(0,1,0),new X(0,1,0),new X(0,1,0),new X(0,1,0),new X(0,0,1),new X(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),xc.setFromMatrixPosition(e.matrixWorld),n.position.copy(xc),Af.copy(n.position),Af.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Af),n.updateMatrixWorld(),i.makeTranslation(-xc.x,-xc.y,-xc.z),Bg.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Bg)}}class ph extends jo{constructor(e,t,n=0,i=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new $E}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class YE extends rv{constructor(){super(new Ea(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class fh extends jo{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Jt.DefaultUp),this.updateMatrix(),this.target=new Jt,this.shadow=new YE}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ov extends jo{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class w0 extends jo{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class x0{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new X)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,o=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*o),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],1.092548*(n*i)),t.addScaledVector(a[5],1.092548*(i*o)),t.addScaledVector(a[6],.315392*(3*o*o-1)),t.addScaledVector(a[7],1.092548*(n*o)),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,o=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*i),t.addScaledVector(a[2],2*.511664*o),t.addScaledVector(a[3],2*.511664*n),t.addScaledVector(a[4],2*.429043*n*i),t.addScaledVector(a[5],2*.429043*i*o),t.addScaledVector(a[6],.743125*o*o-.247708),t.addScaledVector(a[7],2*.429043*n*o),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,o=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*o,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*n*o,t[8]=.546274*(n*n-i*i)}}class Ed extends jo{constructor(e=new x0,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Sd extends ps{constructor(e){super(e),this.textures={}}load(e,t,n,i){const o=this,a=new ss(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(c){try{t(o.parse(JSON.parse(c)))}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(o){return t[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),t[o]}const i=Sd.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new $e().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const a=e.uniforms[o];switch(i.uniforms[o]={},a.type){case"t":i.uniforms[o].value=n(a.value);break;case"c":i.uniforms[o].value=new $e().setHex(a.value);break;case"v2":i.uniforms[o].value=new De().fromArray(a.value);break;case"v3":i.uniforms[o].value=new X().fromArray(a.value);break;case"v4":i.uniforms[o].value=new wn().fromArray(a.value);break;case"m3":i.uniforms[o].value=new Ms().fromArray(a.value);break;case"m4":i.uniforms[o].value=new It().fromArray(a.value);break;default:i.uniforms[o].value=a.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)i.extensions[o]=e.extensions[o];if(e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),i.normalScale=new De().fromArray(o)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new De().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:o0,SpriteMaterial:qm,RawShaderMaterial:a0,ShaderMaterial:Ds,PointsMaterial:eh,MeshPhysicalMaterial:$i,MeshStandardMaterial:Wo,MeshPhongMaterial:l0,MeshToonMaterial:c0,MeshNormalMaterial:h0,MeshLambertMaterial:u0,MeshDepthMaterial:Gm,MeshDistanceMaterial:Wm,MeshBasicMaterial:wi,MeshMatcapMaterial:d0,LineDashedMaterial:p0,LineBasicMaterial:Fi,Material:ti};return new t[e]}}class Is{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class y0 extends jt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class C0 extends ps{constructor(e){super(e)}load(e,t,n,i){const o=this,a=new ss(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(c){try{t(o.parse(JSON.parse(c)))}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(y,S){if(t[S]!==void 0)return t[S];const M=y.interleavedBuffers[S],L=o(y,M.buffer),R=rl(M.type,L),z=new bl(R,M.stride);return z.uuid=M.uuid,t[S]=z,z}function o(y,S){if(n[S]!==void 0)return n[S];const M=y.arrayBuffers[S],L=new Uint32Array(M).buffer;return n[S]=L,L}const a=e.isInstancedBufferGeometry?new y0:new jt,c=e.data.index;if(c!==void 0){const y=rl(c.type,c.array);a.setIndex(new pn(y,1))}const u=e.data.attributes;for(const y in u){const S=u[y];let E;if(S.isInterleavedBufferAttribute){const M=i(e.data,S.data);E=new no(M,S.itemSize,S.offset,S.normalized)}else{const M=rl(S.type,S.array),L=S.isInstancedBufferAttribute?ml:pn;E=new L(M,S.itemSize,S.normalized)}S.name!==void 0&&(E.name=S.name),S.usage!==void 0&&E.setUsage(S.usage),S.updateRange!==void 0&&(E.updateRange.offset=S.updateRange.offset,E.updateRange.count=S.updateRange.count),a.setAttribute(y,E)}const d=e.data.morphAttributes;if(d)for(const y in d){const S=d[y],E=[];for(let M=0,L=S.length;M<L;M++){const R=S[M];let z;if(R.isInterleavedBufferAttribute){const V=i(e.data,R.data);z=new no(V,R.itemSize,R.offset,R.normalized)}else{const V=rl(R.type,R.array);z=new pn(V,R.itemSize,R.normalized)}R.name!==void 0&&(z.name=R.name),E.push(z)}a.morphAttributes[y]=E}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const g=e.data.groups||e.data.drawcalls||e.data.offsets;if(g!==void 0)for(let y=0,S=g.length;y!==S;++y){const E=g[y];a.addGroup(E.start,E.count,E.materialIndex)}const b=e.data.boundingSphere;if(b!==void 0){const y=new X;b.center!==void 0&&y.fromArray(b.center),a.boundingSphere=new ao(y,b.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class ZE extends ps{constructor(e){super(e)}load(e,t,n,i){const o=this,a=this.path===""?Is.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const c=new ss(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(u){let d=null;try{d=JSON.parse(u)}catch(g){i!==void 0&&i(g),console.error("THREE:ObjectLoader: Can't parse "+e+".",g.message);return}const v=d.metadata;if(v===void 0||v.type===void 0||v.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(d,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?Is.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const o=new ss(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const a=await o.loadAsync(e,t),c=JSON.parse(a),u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(c)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){t!==void 0&&t(d)}),c=this.parseTextures(e.textures,a),u=this.parseMaterials(e.materials,c),d=this.parseObject(e.object,o,u,c,n),v=this.parseSkeletons(e.skeletons,d);if(this.bindSkeletons(d,v),t!==void 0){let g=!1;for(const b in a)if(a[b].data instanceof HTMLImageElement){g=!0;break}g===!1&&t(d)}return d}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),o=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,o),c=this.parseMaterials(e.materials,a),u=this.parseObject(e.object,i,c,a,t),d=this.parseSkeletons(e.skeletons,u);return this.bindSkeletons(u,d),u}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const o=new ga().fromJSON(e[n]);t[o.uuid]=o}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(o){o.isBone&&(i[o.uuid]=o)}),e!==void 0)for(let o=0,a=e.length;o<a;o++){const c=new wl().fromJSON(e[o],i);n[c.uuid]=c}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new C0;for(let o=0,a=e.length;o<a;o++){let c;const u=e[o];switch(u.type){case"BufferGeometry":case"InstancedBufferGeometry":c=i.parse(u);break;default:u.type in Ng?c=Ng[u.type].fromJSON(u,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${u.type}"`)}c.uuid=u.uuid,u.name!==void 0&&(c.name=u.name),c.isBufferGeometry===!0&&u.userData!==void 0&&(c.userData=u.userData),n[u.uuid]=c}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const o=new Sd;o.setTextures(t);for(let a=0,c=e.length;a<c;a++){const u=e[a];n[u.uuid]===void 0&&(n[u.uuid]=o.parse(u)),i[u.uuid]=n[u.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],o=Ma.parse(i);t[o.uuid]=o}return t}parseImages(e,t){const n=this,i={};let o;function a(u){return n.manager.itemStart(u),o.load(u,function(){n.manager.itemEnd(u)},void 0,function(){n.manager.itemError(u),n.manager.itemEnd(u)})}function c(u){if(typeof u=="string"){const d=u,v=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:n.resourcePath+d;return a(v)}else return u.data?{data:rl(u.type,u.data),width:u.width,height:u.height}:null}if(e!==void 0&&e.length>0){const u=new Cd(t);o=new jc(u),o.setCrossOrigin(this.crossOrigin);for(let d=0,v=e.length;d<v;d++){const g=e[d],b=g.url;if(Array.isArray(b)){const y=[];for(let S=0,E=b.length;S<E;S++){const M=b[S],L=c(M);L!==null&&(L instanceof HTMLImageElement?y.push(L):y.push(new ll(L.data,L.width,L.height)))}i[g.uuid]=new ua(y)}else{const y=c(g.url);i[g.uuid]=new ua(y)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function o(a){if(typeof a=="string"){const c=a,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:t.resourcePath+c;return await i.loadAsync(u)}else return a.data?{data:rl(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){i=new jc(this.manager),i.setCrossOrigin(this.crossOrigin);for(let a=0,c=e.length;a<c;a++){const u=e[a],d=u.url;if(Array.isArray(d)){const v=[];for(let g=0,b=d.length;g<b;g++){const y=d[g],S=await o(y);S!==null&&(S instanceof HTMLImageElement?v.push(S):v.push(new ll(S.data,S.width,S.height)))}n[u.uuid]=new ua(v)}else{const v=await o(u.url);n[u.uuid]=new ua(v)}}}return n}parseTextures(e,t){function n(o,a){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),a[o])}const i={};if(e!==void 0)for(let o=0,a=e.length;o<a;o++){const c=e[o];c.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',c.uuid),t[c.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",c.image);const u=t[c.image],d=u.data;let v;Array.isArray(d)?(v=new Jc,d.length===6&&(v.needsUpdate=!0)):(d&&d.data?v=new ll:v=new Kn,d&&(v.needsUpdate=!0)),v.source=u,v.uuid=c.uuid,c.name!==void 0&&(v.name=c.name),c.mapping!==void 0&&(v.mapping=n(c.mapping,JE)),c.offset!==void 0&&v.offset.fromArray(c.offset),c.repeat!==void 0&&v.repeat.fromArray(c.repeat),c.center!==void 0&&v.center.fromArray(c.center),c.rotation!==void 0&&(v.rotation=c.rotation),c.wrap!==void 0&&(v.wrapS=n(c.wrap[0],Ug),v.wrapT=n(c.wrap[1],Ug)),c.format!==void 0&&(v.format=c.format),c.type!==void 0&&(v.type=c.type),c.encoding!==void 0&&(v.encoding=c.encoding),c.minFilter!==void 0&&(v.minFilter=n(c.minFilter,Hg)),c.magFilter!==void 0&&(v.magFilter=n(c.magFilter,Hg)),c.anisotropy!==void 0&&(v.anisotropy=c.anisotropy),c.flipY!==void 0&&(v.flipY=c.flipY),c.premultiplyAlpha!==void 0&&(v.premultiplyAlpha=c.premultiplyAlpha),c.unpackAlignment!==void 0&&(v.unpackAlignment=c.unpackAlignment),c.userData!==void 0&&(v.userData=c.userData),i[c.uuid]=v}return i}parseObject(e,t,n,i,o){let a;function c(b){return t[b]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",b),t[b]}function u(b){if(b!==void 0){if(Array.isArray(b)){const y=[];for(let S=0,E=b.length;S<E;S++){const M=b[S];n[M]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",M),y.push(n[M])}return y}return n[b]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",b),n[b]}}function d(b){return i[b]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",b),i[b]}let v,g;switch(e.type){case"Scene":a=new Km,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new $e(e.background):a.background=d(e.background)),e.environment!==void 0&&(a.environment=d(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new vd(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new md(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":a=new Ri(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Ea(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new ov(e.color,e.intensity);break;case"DirectionalLight":a=new fh(e.color,e.intensity);break;case"PointLight":a=new ph(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new w0(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Md(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new b0(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new Ed().fromJSON(e);break;case"SkinnedMesh":v=c(e.geometry),g=u(e.material),a=new gd(v,g),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":v=c(e.geometry),g=u(e.material),a=new Bn(v,g);break;case"InstancedMesh":v=c(e.geometry),g=u(e.material);const b=e.count,y=e.instanceMatrix,S=e.instanceColor;a=new Xm(v,g,b),a.instanceMatrix=new ml(new Float32Array(y.array),16),S!==void 0&&(a.instanceColor=new ml(new Float32Array(S.array),S.itemSize));break;case"LOD":a=new qb;break;case"Line":a=new vr(c(e.geometry),u(e.material));break;case"LineLoop":a=new _d(c(e.geometry),u(e.material));break;case"LineSegments":a=new Ys(c(e.geometry),u(e.material));break;case"PointCloud":case"Points":a=new bd(c(e.geometry),u(e.material));break;case"Sprite":a=new Kb(u(e.material));break;case"Group":a=new Ls;break;case"Bone":a=new Qc;break;default:a=new Jt}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const b=e.children;for(let y=0;y<b.length;y++)a.add(this.parseObject(b[y],t,n,i,o))}if(e.animations!==void 0){const b=e.animations;for(let y=0;y<b.length;y++){const S=b[y];a.animations.push(o[S])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const b=e.levels;for(let y=0;y<b.length;y++){const S=b[y],E=a.getObjectByProperty("uuid",S.object);E!==void 0&&a.addLevel(E,S.distance)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}}const JE={UVMapping:od,CubeReflectionMapping:No,CubeRefractionMapping:Oo,EquirectangularReflectionMapping:zc,EquirectangularRefractionMapping:Vc,CubeUVReflectionMapping:gl},Ug={RepeatWrapping:mr,ClampToEdgeWrapping:qi,MirroredRepeatWrapping:ba},Hg={NearestFilter:ei,NearestMipmapNearestFilter:hl,NearestMipmapLinearFilter:ul,LinearFilter:Ln,LinearMipmapNearestFilter:$c,LinearMipmapLinearFilter:gr};class av extends ps{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=io.get(e);if(a!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(a),o.manager.itemEnd(e)},0),a;const c={};c.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",c.headers=this.requestHeader,fetch(e,c).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(u){io.add(e,u),t&&t(u),o.manager.itemEnd(e)}).catch(function(u){i&&i(u),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}}let Lu;const lv={getContext:function(){return Lu===void 0&&(Lu=new(window.AudioContext||window.webkitAudioContext)),Lu},setContext:function(h){Lu=h}};class cv extends ps{constructor(e){super(e)}load(e,t,n,i){const o=this,a=new ss(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{const u=c.slice(0);lv.getContext().decodeAudioData(u,function(v){t(v)})}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},n,i)}}class QE extends Ed{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const i=new $e().set(e),o=new $e().set(t),a=new X(i.r,i.g,i.b),c=new X(o.r,o.g,o.b),u=Math.sqrt(Math.PI),d=u*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(c).multiplyScalar(u),this.sh.coefficients[1].copy(a).sub(c).multiplyScalar(d)}}class eS extends Ed{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const n=new $e().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const Gg=new It,Wg=new It,Zo=new It;class tS{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ri,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ri,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Zo.copy(e.projectionMatrix);const i=t.eyeSep/2,o=i*t.near/t.focus,a=t.near*Math.tan(ma*t.fov*.5)/t.zoom;let c,u;Wg.elements[12]=-i,Gg.elements[12]=i,c=-a*t.aspect+o,u=a*t.aspect+o,Zo.elements[0]=2*t.near/(u-c),Zo.elements[8]=(u+c)/(u-c),this.cameraL.projectionMatrix.copy(Zo),c=-a*t.aspect-o,u=a*t.aspect-o,Zo.elements[0]=2*t.near/(u-c),Zo.elements[8]=(u+c)/(u-c),this.cameraR.projectionMatrix.copy(Zo)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Wg),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Gg)}}class M0{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=jg(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=jg();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function jg(){return(typeof performance>"u"?Date:performance).now()}const Jo=new X,Kg=new Vn,nS=new X,Qo=new X;class iS extends Jt{constructor(){super(),this.type="AudioListener",this.context=lv.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new M0}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Jo,Kg,nS),Qo.set(0,0,-1).applyQuaternion(Kg),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Jo.x,i),t.positionY.linearRampToValueAtTime(Jo.y,i),t.positionZ.linearRampToValueAtTime(Jo.z,i),t.forwardX.linearRampToValueAtTime(Qo.x,i),t.forwardY.linearRampToValueAtTime(Qo.y,i),t.forwardZ.linearRampToValueAtTime(Qo.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(Jo.x,Jo.y,Jo.z),t.setOrientation(Qo.x,Qo.y,Qo.z,n.x,n.y,n.z)}}class E0 extends Jt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const ea=new X,qg=new Vn,sS=new X,ta=new X;class rS extends E0{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(ea,qg,sS),ta.set(0,0,1).applyQuaternion(qg);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(ea.x,n),t.positionY.linearRampToValueAtTime(ea.y,n),t.positionZ.linearRampToValueAtTime(ea.z,n),t.orientationX.linearRampToValueAtTime(ta.x,n),t.orientationY.linearRampToValueAtTime(ta.y,n),t.orientationZ.linearRampToValueAtTime(ta.z,n)}else t.setPosition(ea.x,ea.y,ea.z),t.setOrientation(ta.x,ta.y,ta.z)}}class oS{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class S0{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,o,a;switch(t){case"quaternion":i=this._slerp,o=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,o=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,o=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=o,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,o=e*i+i;let a=this.cumulativeWeight;if(a===0){for(let c=0;c!==i;++c)n[o+c]=n[c];a=t}else{a+=t;const c=t/a;this._mixBufferRegion(n,o,0,c,i)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,o=this.cumulativeWeight,a=this.cumulativeWeightAdditive,c=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const u=t*this._origIndex;this._mixBufferRegion(n,i,u,1-o,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let u=t,d=t+t;u!==d;++u)if(n[u]!==n[u+t]){c.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let o=n,a=i;o!==a;++o)t[o]=t[i+o%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,o){if(i>=.5)for(let a=0;a!==o;++a)e[t+a]=e[n+a]}_slerp(e,t,n,i){Vn.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,o){const a=this._workIndex*o;Vn.multiplyQuaternionsFlat(e,a,e,t,e,n),Vn.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,n,i,o){const a=1-i;for(let c=0;c!==o;++c){const u=t+c;e[u]=e[u]*a+e[n+c]*i}}_lerpAdditive(e,t,n,i,o){for(let a=0;a!==o;++a){const c=t+a;e[c]=e[c]+e[n+a]*i}}}const hv="\\[\\]\\.:\\/",aS=new RegExp("["+hv+"]","g"),uv="[^"+hv+"]",lS="[^"+hv.replace("\\.","")+"]",cS=/((?:WC+[\/:])*)/.source.replace("WC",uv),hS=/(WCOD+)?/.source.replace("WCOD",lS),uS=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",uv),dS=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",uv),pS=new RegExp("^"+cS+hS+uS+dS+"$"),fS=["material","materials","bones","map"];class mS{constructor(e,t,n){const i=n||cn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,o=n.length;i!==o;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class cn{constructor(e,t,n){this.path=t,this.parsedPath=n||cn.parseTrackName(t),this.node=cn.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new cn.Composite(e,t,n):new cn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(aS,"")}static parseTrackName(e){const t=pS.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const o=n.nodeName.substring(i+1);fS.indexOf(o)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=o)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(o){for(let a=0;a<o.length;a++){const c=o[a];if(c.name===t||c.uuid===t)return c;const u=n(c.children);if(u)return u}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let o=t.propertyIndex;if(e||(e=cn.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let d=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let v=0;v<e.length;v++)if(e[v].name===d){d=v;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(d!==void 0){if(e[d]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[d]}}const a=e[i];if(a===void 0){const d=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+d+"."+i+" but it wasn't found.",e);return}let c=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?c=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate);let u=this.BindingType.Direct;if(o!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else a.fromArray!==void 0&&a.toArray!==void 0?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}cn.Composite=mS;cn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};cn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};cn.prototype.GetterByBindingType=[cn.prototype._getValue_direct,cn.prototype._getValue_array,cn.prototype._getValue_arrayElement,cn.prototype._getValue_toArray];cn.prototype.SetterByBindingTypeAndVersioning=[[cn.prototype._setValue_direct,cn.prototype._setValue_direct_setNeedsUpdate,cn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[cn.prototype._setValue_array,cn.prototype._setValue_array_setNeedsUpdate,cn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[cn.prototype._setValue_arrayElement,cn.prototype._setValue_arrayElement_setNeedsUpdate,cn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[cn.prototype._setValue_fromArray,cn.prototype._setValue_fromArray_setNeedsUpdate,cn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class vS{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Rs(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length;let c,u=e.length,d=this.nCachedObjects_;for(let v=0,g=arguments.length;v!==g;++v){const b=arguments[v],y=b.uuid;let S=t[y];if(S===void 0){S=u++,t[y]=S,e.push(b);for(let E=0,M=a;E!==M;++E)o[E].push(new cn(b,n[E],i[E]))}else if(S<d){c=e[S];const E=--d,M=e[E];t[M.uuid]=S,e[S]=M,t[y]=E,e[E]=b;for(let L=0,R=a;L!==R;++L){const z=o[L],V=z[E];let H=z[S];z[S]=V,H===void 0&&(H=new cn(b,n[L],i[L])),z[E]=H}}else e[S]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=d}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let o=this.nCachedObjects_;for(let a=0,c=arguments.length;a!==c;++a){const u=arguments[a],d=u.uuid,v=t[d];if(v!==void 0&&v>=o){const g=o++,b=e[g];t[b.uuid]=v,e[v]=b,t[d]=g,e[g]=u;for(let y=0,S=i;y!==S;++y){const E=n[y],M=E[g],L=E[v];E[v]=M,E[g]=L}}}this.nCachedObjects_=o}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let o=this.nCachedObjects_,a=e.length;for(let c=0,u=arguments.length;c!==u;++c){const d=arguments[c],v=d.uuid,g=t[v];if(g!==void 0)if(delete t[v],g<o){const b=--o,y=e[b],S=--a,E=e[S];t[y.uuid]=g,e[g]=y,t[E.uuid]=b,e[b]=E,e.pop();for(let M=0,L=i;M!==L;++M){const R=n[M],z=R[b],V=R[S];R[g]=z,R[b]=V,R.pop()}}else{const b=--a,y=e[b];b>0&&(t[y.uuid]=g),e[g]=y,e.pop();for(let S=0,E=i;S!==E;++S){const M=n[S];M[g]=M[b],M.pop()}}}this.nCachedObjects_=o}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const o=this._bindings;if(i!==void 0)return o[i];const a=this._paths,c=this._parsedPaths,u=this._objects,d=u.length,v=this.nCachedObjects_,g=new Array(d);i=o.length,n[e]=i,a.push(e),c.push(t),o.push(g);for(let b=v,y=u.length;b!==y;++b){const S=u[b];g[b]=new cn(S,e,t)}return g}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,o=this._parsedPaths,a=this._bindings,c=a.length-1,u=a[c],d=e[c];t[d]=n,a[n]=u,a.pop(),o[n]=o[c],o.pop(),i[n]=i[c],i.pop()}}}class gS{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const o=t.tracks,a=o.length,c=new Array(a),u={endingStart:ca,endingEnd:ca};for(let d=0;d!==a;++d){const v=o[d].createInterpolant(null);c[d]=v,v.settings=u}this._interpolantSettings=u,this._interpolants=c,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Cb,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const i=this._clip.duration,o=e._clip.duration,a=o/i,c=i/o;e.warp(1,a,t),this.warp(c,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,o=i.time,a=this.timeScale;let c=this._timeScaleInterpolant;c===null&&(c=i._lendControlInterpolant(),this._timeScaleInterpolant=c);const u=c.parameterPositions,d=c.sampleValues;return u[0]=o,u[1]=o+n,d[0]=e/a,d[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const u=(e-o)*n;u<0||n===0?t=0:(this._startTime=null,t=n*u)}t*=this._updateTimeScale(e);const a=this._updateTime(t),c=this._updateWeight(e);if(c>0){const u=this._interpolants,d=this._propertyBindings;switch(this.blendMode){case Nm:for(let v=0,g=u.length;v!==g;++v)u[v].evaluate(a),d[v].accumulateAdditive(c);break;case ad:default:for(let v=0,g=u.length;v!==g;++v)u[v].evaluate(a),d[v].accumulate(i,c)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,o=this._loopCount;const a=n===Mb;if(e===0)return o===-1?i:a&&(o&1)===1?t-i:i;if(n===yb){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),i>=t||i<0){const c=Math.floor(i/t);i-=t*c,o+=Math.abs(c);const u=this.repetitions-o;if(u<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(u===1){const d=e<0;this._setEndings(d,!d,a)}else this._setEndings(!1,!1,a);this._loopCount=o,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:c})}}else this.time=i;if(a&&(o&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=ha,i.endingEnd=ha):(e?i.endingStart=this.zeroSlopeAtStart?ha:ca:i.endingStart=Nc,t?i.endingEnd=this.zeroSlopeAtEnd?ha:ca:i.endingEnd=Nc)}_scheduleFading(e,t,n){const i=this._mixer,o=i.time;let a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const c=a.parameterPositions,u=a.sampleValues;return c[0]=o,u[0]=t,c[1]=o+e,u[1]=n,this}}const _S=new Float32Array(1);class bS extends ro{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,o=i.length,a=e._propertyBindings,c=e._interpolants,u=n.uuid,d=this._bindingsByRootAndName;let v=d[u];v===void 0&&(v={},d[u]=v);for(let g=0;g!==o;++g){const b=i[g],y=b.name;let S=v[y];if(S!==void 0)++S.referenceCount,a[g]=S;else{if(S=a[g],S!==void 0){S._cacheIndex===null&&(++S.referenceCount,this._addInactiveBinding(S,u,y));continue}const E=t&&t._propertyBindings[g].binding.parsedPath;S=new S0(cn.create(n,y,E),b.ValueTypeName,b.getValueSize()),++S.referenceCount,this._addInactiveBinding(S,u,y),a[g]=S}c[g].resultBuffer=S.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,o=this._actionsByClip[i];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const o=t[n];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const o=t[n];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,o=this._actionsByClip;let a=o[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=a;else{const c=a.knownActions;e._byClipCacheIndex=c.length,c.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,a=this._actionsByClip,c=a[o],u=c.knownActions,d=u[u.length-1],v=e._byClipCacheIndex;d._byClipCacheIndex=v,u[v]=d,u.pop(),e._byClipCacheIndex=null;const g=c.actionByRoot,b=(e._localRoot||this._root).uuid;delete g[b],u.length===0&&delete a[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const o=t[n];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,o=this._bindings;let a=i[t];a===void 0&&(a={},i[t]=a),a[n]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,o=n.path,a=this._bindingsByRootAndName,c=a[i],u=t[t.length-1],d=e._cacheIndex;u._cacheIndex=d,t[d]=u,t.pop(),delete c[o],Object.keys(c).length===0&&delete a[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new iv(new Float32Array(2),new Float32Array(2),1,_S),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,o=t[i];e.__cacheIndex=i,t[i]=e,o.__cacheIndex=n,t[n]=o}clipAction(e,t,n){const i=t||this._root,o=i.uuid;let a=typeof e=="string"?Ma.findByName(i,e):e;const c=a!==null?a.uuid:e,u=this._actionsByClip[c];let d=null;if(n===void 0&&(a!==null?n=a.blendMode:n=ad),u!==void 0){const g=u.actionByRoot[o];if(g!==void 0&&g.blendMode===n)return g;d=u.knownActions[0],a===null&&(a=d._clip)}if(a===null)return null;const v=new gS(this,a,t,n);return this._bindAction(v,d),this._addInactiveAction(v,c,o),v}existingAction(e,t){const n=t||this._root,i=n.uuid,o=typeof e=="string"?Ma.findByName(n,e):e,a=o?o.uuid:e,c=this._actionsByClip[a];return c!==void 0&&c.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,o=Math.sign(e),a=this._accuIndex^=1;for(let d=0;d!==n;++d)t[d]._update(i,e,o,a);const c=this._bindings,u=this._nActiveBindings;for(let d=0;d!==u;++d)c[d].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,o=i[n];if(o!==void 0){const a=o.knownActions;for(let c=0,u=a.length;c!==u;++c){const d=a[c];this._deactivateAction(d);const v=d._cacheIndex,g=t[t.length-1];d._cacheIndex=null,d._byClipCacheIndex=null,g._cacheIndex=v,t[v]=g,t.pop(),this._removeInactiveBindingsForAction(d)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const c=n[a].actionByRoot,u=c[t];u!==void 0&&(this._deactivateAction(u),this._removeInactiveAction(u))}const i=this._bindingsByRootAndName,o=i[t];if(o!==void 0)for(const a in o){const c=o[a];c.restoreOriginalState(),this._removeInactiveBinding(c)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class dv{constructor(e){this.value=e}clone(){return new dv(this.value.clone===void 0?this.value:this.value.clone())}}let wS=0;class xS extends ro{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:wS++}),this.name="",this.usage=Oc,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++)this.uniforms.push(t[n].clone());return this}clone(){return new this.constructor().copy(this)}}class yS extends bl{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class CS{constructor(e,t,n,i,o){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class A0{constructor(e,t,n=0,i=1/0){this.ray=new Zc(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new ud,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return gm(e,this,n,t),n.sort(Xg),n}intersectObjects(e,t=!0,n=[]){for(let i=0,o=e.length;i<o;i++)gm(e[i],this,n,t);return n.sort(Xg),n}}function Xg(h,e){return h.distance-e.distance}function gm(h,e,t,n){if(h.layers.test(e.layers)&&h.raycast(e,t),n===!0){const i=h.children;for(let o=0,a=i.length;o<a;o++)gm(i[o],e,t,!0)}}class MS{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ai(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ES{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const $g=new De;class SS{constructor(e=new De(1/0,1/0),t=new De(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=$g.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return $g.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Yg=new X,ku=new X;class AS{constructor(e=new X,t=new X){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Yg.subVectors(e,this.start),ku.subVectors(this.end,this.start);const n=ku.dot(ku);let o=ku.dot(Yg)/n;return t&&(o=ai(o,0,1)),o}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Zg=new X;class PS extends Jt{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new jt,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,c=1,u=32;a<u;a++,c++){const d=a/u*Math.PI*2,v=c/u*Math.PI*2;i.push(Math.cos(d),Math.sin(d),1,Math.cos(v),Math.sin(v),1)}n.setAttribute("position",new bt(i,3));const o=new Fi({fog:!1,toneMapped:!1});this.cone=new Ys(n,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Zg.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Zg),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ao=new X,Ru=new It,Pf=new It;class TS extends Ys{constructor(e){const t=P0(e),n=new jt,i=[],o=[],a=new $e(0,0,1),c=new $e(0,1,0);for(let d=0;d<t.length;d++){const v=t[d];v.parent&&v.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),o.push(a.r,a.g,a.b),o.push(c.r,c.g,c.b))}n.setAttribute("position",new bt(i,3)),n.setAttribute("color",new bt(o,3));const u=new Fi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,u),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");Pf.copy(this.root.matrixWorld).invert();for(let o=0,a=0;o<t.length;o++){const c=t[o];c.parent&&c.parent.isBone&&(Ru.multiplyMatrices(Pf,c.matrixWorld),Ao.setFromMatrixPosition(Ru),i.setXYZ(a,Ao.x,Ao.y,Ao.z),Ru.multiplyMatrices(Pf,c.parent.matrixWorld),Ao.setFromMatrixPosition(Ru),i.setXYZ(a+1,Ao.x,Ao.y,Ao.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function P0(h){const e=[];h.isBone===!0&&e.push(h);for(let t=0;t<h.children.length;t++)e.push.apply(e,P0(h.children[t]));return e}class LS extends Bn{constructor(e,t,n){const i=new Go(t,4,2),o=new wi({wireframe:!0,fog:!1,toneMapped:!1});super(i,o),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const kS=new X,Jg=new $e,Qg=new $e;class RS extends Jt{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new yl(t);i.rotateY(Math.PI*.5),this.material=new wi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=i.getAttribute("position"),a=new Float32Array(o.count*3);i.setAttribute("color",new pn(a,3)),this.add(new Bn(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Jg.copy(this.light.color),Qg.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const o=n<i/2?Jg:Qg;t.setXYZ(n,o.r,o.g,o.b)}t.needsUpdate=!0}e.lookAt(kS.setFromMatrixPosition(this.light.matrixWorld).negate())}}class T0 extends Ys{constructor(e=10,t=10,n=4473924,i=8947848){n=new $e(n),i=new $e(i);const o=t/2,a=e/t,c=e/2,u=[],d=[];for(let b=0,y=0,S=-c;b<=t;b++,S+=a){u.push(-c,0,S,c,0,S),u.push(S,0,-c,S,0,c);const E=b===o?n:i;E.toArray(d,y),y+=3,E.toArray(d,y),y+=3,E.toArray(d,y),y+=3,E.toArray(d,y),y+=3}const v=new jt;v.setAttribute("position",new bt(u,3)),v.setAttribute("color",new bt(d,3));const g=new Fi({vertexColors:!0,toneMapped:!1});super(v,g),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class IS extends Ys{constructor(e=10,t=16,n=8,i=64,o=4473924,a=8947848){o=new $e(o),a=new $e(a);const c=[],u=[];if(t>1)for(let g=0;g<t;g++){const b=g/t*(Math.PI*2),y=Math.sin(b)*e,S=Math.cos(b)*e;c.push(0,0,0),c.push(y,0,S);const E=g&1?o:a;u.push(E.r,E.g,E.b),u.push(E.r,E.g,E.b)}for(let g=0;g<n;g++){const b=g&1?o:a,y=e-e/n*g;for(let S=0;S<i;S++){let E=S/i*(Math.PI*2),M=Math.sin(E)*y,L=Math.cos(E)*y;c.push(M,0,L),u.push(b.r,b.g,b.b),E=(S+1)/i*(Math.PI*2),M=Math.sin(E)*y,L=Math.cos(E)*y,c.push(M,0,L),u.push(b.r,b.g,b.b)}}const d=new jt;d.setAttribute("position",new bt(c,3)),d.setAttribute("color",new bt(u,3));const v=new Fi({vertexColors:!0,toneMapped:!1});super(d,v),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const e_=new X,Iu=new X,t_=new X;class DS extends Jt{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let i=new jt;i.setAttribute("position",new bt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new Fi({fog:!1,toneMapped:!1});this.lightPlane=new vr(i,o),this.add(this.lightPlane),i=new jt,i.setAttribute("position",new bt([0,0,0,0,0,1],3)),this.targetLine=new vr(i,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){e_.setFromMatrixPosition(this.light.matrixWorld),Iu.setFromMatrixPosition(this.light.target.matrixWorld),t_.subVectors(Iu,e_),this.lightPlane.lookAt(Iu),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Iu),this.targetLine.scale.z=t_.length()}}const Du=new X,Zn=new dd;class zS extends Ys{constructor(e){const t=new jt,n=new Fi({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],o=[],a={};c("n1","n2"),c("n2","n4"),c("n4","n3"),c("n3","n1"),c("f1","f2"),c("f2","f4"),c("f4","f3"),c("f3","f1"),c("n1","f1"),c("n2","f2"),c("n3","f3"),c("n4","f4"),c("p","n1"),c("p","n2"),c("p","n3"),c("p","n4"),c("u1","u2"),c("u2","u3"),c("u3","u1"),c("c","t"),c("p","c"),c("cn1","cn2"),c("cn3","cn4"),c("cf1","cf2"),c("cf3","cf4");function c(S,E){u(S),u(E)}function u(S){i.push(0,0,0),o.push(0,0,0),a[S]===void 0&&(a[S]=[]),a[S].push(i.length/3-1)}t.setAttribute("position",new bt(i,3)),t.setAttribute("color",new bt(o,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const d=new $e(16755200),v=new $e(16711680),g=new $e(43775),b=new $e(16777215),y=new $e(3355443);this.setColors(d,v,g,b,y)}setColors(e,t,n,i,o){const c=this.geometry.getAttribute("color");c.setXYZ(0,e.r,e.g,e.b),c.setXYZ(1,e.r,e.g,e.b),c.setXYZ(2,e.r,e.g,e.b),c.setXYZ(3,e.r,e.g,e.b),c.setXYZ(4,e.r,e.g,e.b),c.setXYZ(5,e.r,e.g,e.b),c.setXYZ(6,e.r,e.g,e.b),c.setXYZ(7,e.r,e.g,e.b),c.setXYZ(8,e.r,e.g,e.b),c.setXYZ(9,e.r,e.g,e.b),c.setXYZ(10,e.r,e.g,e.b),c.setXYZ(11,e.r,e.g,e.b),c.setXYZ(12,e.r,e.g,e.b),c.setXYZ(13,e.r,e.g,e.b),c.setXYZ(14,e.r,e.g,e.b),c.setXYZ(15,e.r,e.g,e.b),c.setXYZ(16,e.r,e.g,e.b),c.setXYZ(17,e.r,e.g,e.b),c.setXYZ(18,e.r,e.g,e.b),c.setXYZ(19,e.r,e.g,e.b),c.setXYZ(20,e.r,e.g,e.b),c.setXYZ(21,e.r,e.g,e.b),c.setXYZ(22,e.r,e.g,e.b),c.setXYZ(23,e.r,e.g,e.b),c.setXYZ(24,t.r,t.g,t.b),c.setXYZ(25,t.r,t.g,t.b),c.setXYZ(26,t.r,t.g,t.b),c.setXYZ(27,t.r,t.g,t.b),c.setXYZ(28,t.r,t.g,t.b),c.setXYZ(29,t.r,t.g,t.b),c.setXYZ(30,t.r,t.g,t.b),c.setXYZ(31,t.r,t.g,t.b),c.setXYZ(32,n.r,n.g,n.b),c.setXYZ(33,n.r,n.g,n.b),c.setXYZ(34,n.r,n.g,n.b),c.setXYZ(35,n.r,n.g,n.b),c.setXYZ(36,n.r,n.g,n.b),c.setXYZ(37,n.r,n.g,n.b),c.setXYZ(38,i.r,i.g,i.b),c.setXYZ(39,i.r,i.g,i.b),c.setXYZ(40,o.r,o.g,o.b),c.setXYZ(41,o.r,o.g,o.b),c.setXYZ(42,o.r,o.g,o.b),c.setXYZ(43,o.r,o.g,o.b),c.setXYZ(44,o.r,o.g,o.b),c.setXYZ(45,o.r,o.g,o.b),c.setXYZ(46,o.r,o.g,o.b),c.setXYZ(47,o.r,o.g,o.b),c.setXYZ(48,o.r,o.g,o.b),c.setXYZ(49,o.r,o.g,o.b),c.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;Zn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ri("c",t,e,Zn,0,0,-1),ri("t",t,e,Zn,0,0,1),ri("n1",t,e,Zn,-n,-i,-1),ri("n2",t,e,Zn,n,-i,-1),ri("n3",t,e,Zn,-n,i,-1),ri("n4",t,e,Zn,n,i,-1),ri("f1",t,e,Zn,-n,-i,1),ri("f2",t,e,Zn,n,-i,1),ri("f3",t,e,Zn,-n,i,1),ri("f4",t,e,Zn,n,i,1),ri("u1",t,e,Zn,n*.7,i*1.1,-1),ri("u2",t,e,Zn,-n*.7,i*1.1,-1),ri("u3",t,e,Zn,0,i*2,-1),ri("cf1",t,e,Zn,-n,0,1),ri("cf2",t,e,Zn,n,0,1),ri("cf3",t,e,Zn,0,-i,1),ri("cf4",t,e,Zn,0,i,1),ri("cn1",t,e,Zn,-n,0,-1),ri("cn2",t,e,Zn,n,0,-1),ri("cn3",t,e,Zn,0,-i,-1),ri("cn4",t,e,Zn,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ri(h,e,t,n,i,o,a){Du.set(i,o,a).unproject(n);const c=e[h];if(c!==void 0){const u=t.getAttribute("position");for(let d=0,v=c.length;d<v;d++)u.setXYZ(c[d],Du.x,Du.y,Du.z)}}const zu=new oo;class VS extends Ys{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),o=new jt;o.setIndex(new pn(n,1)),o.setAttribute("position",new pn(i,3)),super(o,new Fi({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&zu.setFromObject(this.object),zu.isEmpty())return;const t=zu.min,n=zu.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=t.x,o[4]=n.y,o[5]=n.z,o[6]=t.x,o[7]=t.y,o[8]=n.z,o[9]=n.x,o[10]=t.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=t.z,o[15]=t.x,o[16]=n.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=n.x,o[22]=t.y,o[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class NS extends Ys{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new jt;o.setIndex(new pn(n,1)),o.setAttribute("position",new bt(i,3)),super(o,new Fi({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class OS extends vr{constructor(e,t=1,n=16776960){const i=n,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new jt;a.setAttribute("position",new bt(o,3)),a.computeBoundingSphere(),super(a,new Fi({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const c=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],u=new jt;u.setAttribute("position",new bt(c,3)),u.computeBoundingSphere(),this.add(new Bn(u,new wi({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const n_=new X;let Vu,Tf;class L0 extends Jt{constructor(e=new X(0,0,1),t=new X(0,0,0),n=1,i=16776960,o=n*.2,a=o*.2){super(),this.type="ArrowHelper",Vu===void 0&&(Vu=new jt,Vu.setAttribute("position",new bt([0,0,0,0,1,0],3)),Tf=new Sa(0,.5,1,5,1),Tf.translate(0,-.5,0)),this.position.copy(t),this.line=new vr(Vu,new Fi({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Bn(Tf,new wi({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{n_.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(n_,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class pv extends Ys{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new jt;i.setAttribute("position",new bt(t,3)),i.setAttribute("color",new bt(n,3));const o=new Fi({vertexColors:!0,toneMapped:!1});super(i,o),this.type="AxesHelper"}setColors(e,t,n){const i=new $e,o=this.geometry.attributes.color.array;return i.set(e),i.toArray(o,0),i.toArray(o,3),i.set(t),i.toArray(o,6),i.toArray(o,9),i.set(n),i.toArray(o,12),i.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class FS{constructor(){this.type="ShapePath",this.color=new $e,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Uc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,o,a){return this.currentPath.bezierCurveTo(e,t,n,i,o,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(L){const R=[];for(let z=0,V=L.length;z<V;z++){const H=L[z],B=new ga;B.curves=H.curves,R.push(B)}return R}function n(L,R){const z=R.length;let V=!1;for(let H=z-1,B=0;B<z;H=B++){let j=R[H],F=R[B],W=F.x-j.x,Z=F.y-j.y;if(Math.abs(Z)>Number.EPSILON){if(Z<0&&(j=R[B],W=-W,F=R[H],Z=-Z),L.y<j.y||L.y>F.y)continue;if(L.y===j.y){if(L.x===j.x)return!0}else{const se=Z*(L.x-j.x)-W*(L.y-j.y);if(se===0)return!0;if(se<0)continue;V=!V}}else{if(L.y!==j.y)continue;if(F.x<=L.x&&L.x<=j.x||j.x<=L.x&&L.x<=F.x)return!0}}return V}const i=kr.isClockWise,o=this.subPaths;if(o.length===0)return[];let a,c,u;const d=[];if(o.length===1)return c=o[0],u=new ga,u.curves=c.curves,d.push(u),d;let v=!i(o[0].getPoints());v=e?!v:v;const g=[],b=[];let y=[],S=0,E;b[S]=void 0,y[S]=[];for(let L=0,R=o.length;L<R;L++)c=o[L],E=c.getPoints(),a=i(E),a=e?!a:a,a?(!v&&b[S]&&S++,b[S]={s:new ga,p:E},b[S].s.curves=c.curves,v&&S++,y[S]=[]):y[S].push({h:c,p:E[0]});if(!b[0])return t(o);if(b.length>1){let L=!1,R=0;for(let z=0,V=b.length;z<V;z++)g[z]=[];for(let z=0,V=b.length;z<V;z++){const H=y[z];for(let B=0;B<H.length;B++){const j=H[B];let F=!0;for(let W=0;W<b.length;W++)n(j.p,b[W].p)&&(z!==W&&R++,F?(F=!1,g[W].push(j)):L=!0);F&&g[z].push(j)}}R>0&&L===!1&&(y=g)}let M;for(let L=0,R=b.length;L<R;L++){u=b[L].s,d.push(u),M=y[L];for(let z=0,V=M.length;z<V;z++)u.holes.push(M[z].h)}return d}}const Yr=BS();function BS(){const h=new ArrayBuffer(4),e=new Float32Array(h),t=new Uint32Array(h),n=new Uint32Array(512),i=new Uint32Array(512);for(let u=0;u<256;++u){const d=u-127;d<-27?(n[u]=0,n[u|256]=32768,i[u]=24,i[u|256]=24):d<-14?(n[u]=1024>>-d-14,n[u|256]=1024>>-d-14|32768,i[u]=-d-1,i[u|256]=-d-1):d<=15?(n[u]=d+15<<10,n[u|256]=d+15<<10|32768,i[u]=13,i[u|256]=13):d<128?(n[u]=31744,n[u|256]=64512,i[u]=24,i[u|256]=24):(n[u]=31744,n[u|256]=64512,i[u]=13,i[u|256]=13)}const o=new Uint32Array(2048),a=new Uint32Array(64),c=new Uint32Array(64);for(let u=1;u<1024;++u){let d=u<<13,v=0;for(;!(d&8388608);)d<<=1,v-=8388608;d&=-8388609,v+=947912704,o[u]=d|v}for(let u=1024;u<2048;++u)o[u]=939524096+(u-1024<<13);for(let u=1;u<31;++u)a[u]=u<<23;a[31]=1199570944,a[32]=2147483648;for(let u=33;u<63;++u)a[u]=2147483648+(u-32<<23);a[63]=3347054592;for(let u=1;u<64;++u)u!==32&&(c[u]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:o,exponentTable:a,offsetTable:c}}function US(h){Math.abs(h)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),h=ai(h,-65504,65504),Yr.floatView[0]=h;const e=Yr.uint32View[0],t=e>>23&511;return Yr.baseTable[t]+((e&8388607)>>Yr.shiftTable[t])}function HS(h){const e=h>>10;return Yr.uint32View[0]=Yr.mantissaTable[Yr.offsetTable[e]+(h&1023)]+Yr.exponentTable[e],Yr.floatView[0]}var GS=Object.freeze({__proto__:null,toHalfFloat:US,fromHalfFloat:HS});function WS(){console.error("THREE.ImmediateRenderObject has been removed.")}class jS extends $s{constructor(e,t,n){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,t,n),this.samples=4}}class KS extends Yc{constructor(e,t,n,i){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(e,t,n,i)}}class qS extends hd{constructor(e,t,n,i){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(e,t,n,i)}}class XS extends lo{constructor(e,t,n,i,o,a){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,n,i,o,a)}}class $S extends th{constructor(e,t,n,i){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,n,i)}}class YS extends nh{constructor(e,t,n,i){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,n,i)}}class ZS extends ih{constructor(e,t,n,i,o,a,c){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,n,i,o,a,c)}}class JS extends Sa{constructor(e,t,n,i,o,a,c,u){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,n,i,o,a,c,u)}}class QS extends sh{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class eA extends rh{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class tA extends oh{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class nA extends xl{constructor(e,t,n,i){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,n,i)}}class iA extends yl{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class sA extends co{constructor(e,t,n,i){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,n,i)}}class rA extends ho{constructor(e,t,n,i){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,n,i)}}class oA extends ah{constructor(e,t,n,i,o,a){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,n,i,o,a)}}class aA extends lh{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class lA extends Go{constructor(e,t,n,i,o,a,c){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,n,i,o,a,c)}}class cA extends ch{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class hA extends hh{constructor(e,t,n,i,o){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,n,i,o)}}class uA extends uh{constructor(e,t,n,i,o,a){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,n,i,o,a)}}class dA extends dh{constructor(e,t,n,i,o){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,n,i,o)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:sd}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=sd);const pA=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:zm,AddEquation:oa,AddOperation:nb,AdditiveAnimationBlendMode:Nm,AdditiveBlending:Zu,AlphaFormat:db,AlwaysDepth:$_,AlwaysStencilFunc:Tb,AmbientLight:ov,AmbientLightProbe:eS,AnimationClip:Ma,AnimationLoader:WE,AnimationMixer:bS,AnimationObjectGroup:vS,AnimationUtils:BE,ArcCurve:Yb,ArrayCamera:Hb,ArrowHelper:L0,Audio:E0,AudioAnalyser:oS,AudioContext:lv,AudioListener:iS,AudioLoader:cv,AxesHelper:pv,BackSide:ks,BasicDepthPacking:Sb,BasicShadowMap:z_,Bone:Qc,BooleanKeyframeTrack:Pa,Box2:SS,Box3:oo,Box3Helper:NS,BoxBufferGeometry:XS,BoxGeometry:lo,BoxHelper:VS,BufferAttribute:pn,BufferGeometry:jt,BufferGeometryLoader:C0,ByteType:ab,Cache:io,Camera:dd,CameraHelper:zS,CanvasTexture:$b,CapsuleBufferGeometry:$S,CapsuleGeometry:th,CatmullRomCurve3:Zb,CineonToneMapping:rb,CircleBufferGeometry:YS,CircleGeometry:nh,ClampToEdgeWrapping:qi,Clock:M0,Color:$e,ColorKeyframeTrack:sv,ColorManagement:Ts,CompressedTexture:Xb,CompressedTextureLoader:jE,ConeBufferGeometry:ZS,ConeGeometry:ih,CubeCamera:Db,CubeReflectionMapping:No,CubeRefractionMapping:Oo,CubeTexture:Jc,CubeTextureLoader:KE,CubeUVReflectionMapping:gl,CubicBezierCurve:Ym,CubicBezierCurve3:Jb,CubicInterpolant:m0,CullFaceBack:Nf,CullFaceFront:D_,CullFaceFrontBack:xw,CullFaceNone:I_,Curve:_r,CurvePath:e0,CustomBlending:V_,CustomToneMapping:ob,CylinderBufferGeometry:JS,CylinderGeometry:Sa,Cylindrical:ES,Data3DTexture:hd,DataArrayTexture:Yc,DataTexture:ll,DataTexture2DArray:KS,DataTexture3D:qS,DataTextureLoader:qE,DataUtils:GS,DecrementStencilOp:Lw,DecrementWrapStencilOp:Rw,DefaultLoadingManager:_0,DepthFormat:Vo,DepthStencilFormat:wa,DepthTexture:Gb,DirectionalLight:fh,DirectionalLightHelper:DS,DiscreteInterpolant:v0,DodecahedronBufferGeometry:QS,DodecahedronGeometry:sh,DoubleSide:qs,DstAlphaFactor:G_,DstColorFactor:j_,DynamicCopyUsage:qw,DynamicDrawUsage:Uw,DynamicReadUsage:Ww,EdgesGeometry:t0,EllipseCurve:wd,EqualDepth:Z_,EqualStencilFunc:Vw,EquirectangularReflectionMapping:zc,EquirectangularRefractionMapping:Vc,Euler:Ho,EventDispatcher:ro,ExtrudeBufferGeometry:eA,ExtrudeGeometry:rh,FileLoader:ss,Float16BufferAttribute:Ax,Float32BufferAttribute:bt,Float64BufferAttribute:Px,FloatType:Zr,Fog:vd,FogExp2:md,FramebufferTexture:hE,FrontSide:eo,Frustum:pd,GLBufferAttribute:CS,GLSL1:$w,GLSL3:cm,GreaterDepth:Q_,GreaterEqualDepth:J_,GreaterEqualStencilFunc:Bw,GreaterStencilFunc:Ow,GridHelper:T0,Group:Ls,HalfFloatType:dl,HemisphereLight:b0,HemisphereLightHelper:RS,HemisphereLightProbe:QE,IcosahedronBufferGeometry:tA,IcosahedronGeometry:oh,ImageBitmapLoader:av,ImageLoader:jc,ImageUtils:Fm,ImmediateRenderObject:WS,IncrementStencilOp:Tw,IncrementWrapStencilOp:kw,InstancedBufferAttribute:ml,InstancedBufferGeometry:y0,InstancedInterleavedBuffer:yS,InstancedMesh:Xm,Int16BufferAttribute:Ex,Int32BufferAttribute:Sx,Int8BufferAttribute:yx,IntType:cb,InterleavedBuffer:bl,InterleavedBufferAttribute:no,Interpolant:Aa,InterpolateDiscrete:xa,InterpolateLinear:to,InterpolateSmooth:Wu,InvertStencilOp:Iw,KeepStencilOp:ju,KeyframeTrack:br,LOD:qb,LatheBufferGeometry:nA,LatheGeometry:xl,Layers:ud,LessDepth:Y_,LessEqualDepth:Ju,LessEqualStencilFunc:Nw,LessStencilFunc:zw,Light:jo,LightProbe:Ed,Line:vr,Line3:AS,LineBasicMaterial:Fi,LineCurve:xd,LineCurve3:Qb,LineDashedMaterial:p0,LineLoop:_d,LineSegments:Ys,LinearEncoding:Bo,LinearFilter:Ln,LinearInterpolant:iv,LinearMipMapLinearFilter:Ew,LinearMipMapNearestFilter:Mw,LinearMipmapLinearFilter:gr,LinearMipmapNearestFilter:$c,LinearSRGBColorSpace:zo,LinearToneMapping:ib,Loader:ps,LoaderUtils:Is,LoadingManager:Cd,LoopOnce:yb,LoopPingPong:Mb,LoopRepeat:Cb,LuminanceAlphaFormat:mb,LuminanceFormat:fb,MOUSE:bw,Material:ti,MaterialLoader:Sd,MathUtils:cd,Matrix3:Ms,Matrix4:It,MaxEquation:Uf,Mesh:Bn,MeshBasicMaterial:wi,MeshDepthMaterial:Gm,MeshDistanceMaterial:Wm,MeshLambertMaterial:u0,MeshMatcapMaterial:d0,MeshNormalMaterial:h0,MeshPhongMaterial:l0,MeshPhysicalMaterial:$i,MeshStandardMaterial:Wo,MeshToonMaterial:c0,MinEquation:Bf,MirroredRepeatWrapping:ba,MixOperation:tb,MultiplyBlending:Ff,MultiplyOperation:Xc,NearestFilter:ei,NearestMipMapLinearFilter:Cw,NearestMipMapNearestFilter:yw,NearestMipmapLinearFilter:ul,NearestMipmapNearestFilter:hl,NeverDepth:X_,NeverStencilFunc:Dw,NoBlending:Qr,NoColorSpace:Sw,NoToneMapping:Lr,NormalAnimationBlendMode:ad,NormalBlending:pa,NotEqualDepth:eb,NotEqualStencilFunc:Fw,NumberKeyframeTrack:ya,Object3D:Jt,ObjectLoader:ZE,ObjectSpaceNormalMap:Pb,OctahedronBufferGeometry:iA,OctahedronGeometry:yl,OneFactor:B_,OneMinusDstAlphaFactor:W_,OneMinusDstColorFactor:K_,OneMinusSrcAlphaFactor:Dm,OneMinusSrcColorFactor:H_,OrthographicCamera:Ea,PCFShadowMap:rd,PCFSoftShadowMap:Rm,PMREMGenerator:um,Path:Uc,PerspectiveCamera:Ri,Plane:$r,PlaneBufferGeometry:sA,PlaneGeometry:co,PlaneHelper:OS,PointLight:ph,PointLightHelper:LS,Points:bd,PointsMaterial:eh,PolarGridHelper:IS,PolyhedronBufferGeometry:rA,PolyhedronGeometry:ho,PositionalAudio:rS,PropertyBinding:cn,PropertyMixer:S0,QuadraticBezierCurve:Zm,QuadraticBezierCurve3:Jm,Quaternion:Vn,QuaternionKeyframeTrack:Rr,QuaternionLinearInterpolant:g0,REVISION:sd,RGBADepthPacking:Ab,RGBAFormat:Xs,RGBAIntegerFormat:wb,RGBA_ASTC_10x10_Format:rm,RGBA_ASTC_10x5_Format:nm,RGBA_ASTC_10x6_Format:im,RGBA_ASTC_10x8_Format:sm,RGBA_ASTC_12x10_Format:om,RGBA_ASTC_12x12_Format:am,RGBA_ASTC_4x4_Format:Xf,RGBA_ASTC_5x4_Format:$f,RGBA_ASTC_5x5_Format:Yf,RGBA_ASTC_6x5_Format:Zf,RGBA_ASTC_6x6_Format:Jf,RGBA_ASTC_8x5_Format:Qf,RGBA_ASTC_8x6_Format:em,RGBA_ASTC_8x8_Format:tm,RGBA_BPTC_Format:lm,RGBA_ETC2_EAC_Format:qf,RGBA_PVRTC_2BPPV1_Format:jf,RGBA_PVRTC_4BPPV1_Format:Wf,RGBA_S3TC_DXT1_Format:Uu,RGBA_S3TC_DXT3_Format:Hu,RGBA_S3TC_DXT5_Format:Gu,RGBFormat:pb,RGB_ETC1_Format:xb,RGB_ETC2_Format:Kf,RGB_PVRTC_2BPPV1_Format:Gf,RGB_PVRTC_4BPPV1_Format:Hf,RGB_S3TC_DXT1_Format:Bu,RGFormat:_b,RGIntegerFormat:bb,RawShaderMaterial:a0,Ray:Zc,Raycaster:A0,RectAreaLight:w0,RedFormat:vb,RedIntegerFormat:gb,ReinhardToneMapping:sb,RepeatWrapping:mr,ReplaceStencilOp:Pw,ReverseSubtractEquation:O_,RingBufferGeometry:oA,RingGeometry:ah,SRGBColorSpace:ds,Scene:Km,ShaderChunk:Tt,ShaderLib:fr,ShaderMaterial:Ds,ShadowMaterial:o0,Shape:ga,ShapeBufferGeometry:aA,ShapeGeometry:lh,ShapePath:FS,ShapeUtils:kr,ShortType:lb,Skeleton:wl,SkeletonHelper:TS,SkinnedMesh:gd,Source:ua,Sphere:ao,SphereBufferGeometry:lA,SphereGeometry:Go,Spherical:MS,SphericalHarmonics3:x0,SplineCurve:Qm,SpotLight:Md,SpotLightHelper:PS,Sprite:Kb,SpriteMaterial:qm,SrcAlphaFactor:Im,SrcAlphaSaturateFactor:q_,SrcColorFactor:U_,StaticCopyUsage:Kw,StaticDrawUsage:Oc,StaticReadUsage:Gw,StereoCamera:tS,StreamCopyUsage:Xw,StreamDrawUsage:Hw,StreamReadUsage:jw,StringKeyframeTrack:Ta,SubtractEquation:N_,SubtractiveBlending:Of,TOUCH:ww,TangentSpaceNormalMap:so,TetrahedronBufferGeometry:cA,TetrahedronGeometry:ch,Texture:Kn,TextureLoader:Cl,TorusBufferGeometry:hA,TorusGeometry:hh,TorusKnotBufferGeometry:uA,TorusKnotGeometry:uh,Triangle:Ks,TriangleFanDrawMode:pl,TriangleStripDrawMode:ld,TrianglesDrawMode:Eb,TubeBufferGeometry:dA,TubeGeometry:dh,UVMapping:od,Uint16BufferAttribute:Bm,Uint32BufferAttribute:Um,Uint8BufferAttribute:Cx,Uint8ClampedBufferAttribute:Mx,Uniform:dv,UniformsGroup:xS,UniformsLib:tt,UniformsUtils:Ib,UnsignedByteType:Fo,UnsignedInt248Type:fa,UnsignedIntType:Do,UnsignedShort4444Type:hb,UnsignedShort5551Type:ub,UnsignedShortType:Vm,VSMShadowMap:la,Vector2:De,Vector3:X,Vector4:wn,VectorKeyframeTrack:Ca,VideoTexture:cE,WebGL1Renderer:Wb,WebGL3DRenderTarget:dx,WebGLArrayRenderTarget:ux,WebGLCubeRenderTarget:zb,WebGLMultipleRenderTargets:px,WebGLMultisampleRenderTarget:jS,WebGLRenderTarget:$s,WebGLRenderer:jm,WebGLUtils:Ub,WireframeGeometry:r0,WrapAroundEnding:Nc,ZeroCurvatureEnding:ca,ZeroFactor:F_,ZeroSlopeEnding:ha,ZeroStencilOp:Aw,_SRGBAFormat:Qu,sRGBEncoding:vn},Symbol.toStringTag,{value:"Module"}));class fv extends ps{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new _A(t)}),this.register(function(t){return new EA(t)}),this.register(function(t){return new SA(t)}),this.register(function(t){return new wA(t)}),this.register(function(t){return new xA(t)}),this.register(function(t){return new yA(t)}),this.register(function(t){return new CA(t)}),this.register(function(t){return new gA(t)}),this.register(function(t){return new MA(t)}),this.register(function(t){return new bA(t)}),this.register(function(t){return new mA(t)}),this.register(function(t){return new AA(t)})}load(e,t,n,i){const o=this;let a;this.resourcePath!==""?a=this.resourcePath:this.path!==""?a=this.path:a=Is.extractUrlBase(e),this.manager.itemStart(e);const c=function(d){i?i(d):console.error(d),o.manager.itemError(e),o.manager.itemEnd(e)},u=new ss(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(d){try{o.parse(d,a,function(v){t(v),o.manager.itemEnd(e)},c)}catch(v){c(v)}},n,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let o;const a={},c={};if(typeof e=="string")o=e;else if(Is.decodeText(new Uint8Array(e,0,4))===k0){try{a[sn.KHR_BINARY_GLTF]=new PA(e)}catch(g){i&&i(g);return}o=a[sn.KHR_BINARY_GLTF].content}else o=Is.decodeText(new Uint8Array(e));const u=JSON.parse(o);if(u.asset===void 0||u.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const d=new UA(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let v=0;v<this.pluginCallbacks.length;v++){const g=this.pluginCallbacks[v](d);c[g.name]=g,a[g.name]=!0}if(u.extensionsUsed)for(let v=0;v<u.extensionsUsed.length;++v){const g=u.extensionsUsed[v],b=u.extensionsRequired||[];switch(g){case sn.KHR_MATERIALS_UNLIT:a[g]=new vA;break;case sn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[g]=new kA;break;case sn.KHR_DRACO_MESH_COMPRESSION:a[g]=new TA(u,this.dracoLoader);break;case sn.KHR_TEXTURE_TRANSFORM:a[g]=new LA;break;case sn.KHR_MESH_QUANTIZATION:a[g]=new RA;break;default:b.indexOf(g)>=0&&c[g]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}d.setExtensions(a),d.setPlugins(c),d.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,o){n.parse(e,t,i,o)})}}function fA(){let h={};return{get:function(e){return h[e]},add:function(e,t){h[e]=t},remove:function(e){delete h[e]},removeAll:function(){h={}}}}const sn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class mA{constructor(e){this.parser=e,this.name=sn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const o=t.json,u=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let d;const v=new $e(16777215);u.color!==void 0&&v.fromArray(u.color);const g=u.range!==void 0?u.range:0;switch(u.type){case"directional":d=new fh(v),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new ph(v),d.distance=g;break;case"spot":d=new Md(v),d.distance=g,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,d.angle=u.spot.outerConeAngle,d.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return d.position.set(0,0,0),d.decay=2,u.intensity!==void 0&&(d.intensity=u.intensity),d.name=t.createUniqueName(u.name||"light_"+e),i=Promise.resolve(d),t.cache.add(n,i),i}createNodeAttachment(e){const t=this,n=this.parser,o=n.json.nodes[e],c=(o.extensions&&o.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(u){return n._getNodeRef(t.cache,c,u)})}}class vA{constructor(){this.name=sn.KHR_MATERIALS_UNLIT}getMaterialType(){return wi}extendParams(e,t,n){const i=[];e.color=new $e(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const a=o.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}o.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",o.baseColorTexture,vn))}return Promise.all(i)}}class gA{constructor(e){this.parser=e,this.name=sn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=i.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class _A{constructor(e){this.parser=e,this.name=sn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const c=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new De(c,c)}return Promise.all(o)}}class bA{constructor(e){this.parser=e,this.name=sn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(o)}}class wA{constructor(e){this.parser=e,this.name=sn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new $e(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];return a.sheenColorFactor!==void 0&&t.sheenColor.fromArray(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,vn)),a.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(o)}}class xA{constructor(e){this.parser=e,this.name=sn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(o)}}class yA{constructor(e){this.parser=e,this.name=sn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const c=a.attenuationColor||[1,1,1];return t.attenuationColor=new $e(c[0],c[1],c[2]),Promise.all(o)}}class CA{constructor(e){this.parser=e,this.name=sn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:$i}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=i.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class MA{constructor(e){this.parser=e,this.name=sn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const c=a.specularColorFactor||[1,1,1];return t.specularColor=new $e(c[0],c[1],c[2]),a.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,vn)),Promise.all(o)}}class EA{constructor(e){this.parser=e,this.name=sn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const o=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,a)}}class SA{constructor(e){this.parser=e,this.name=sn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],c=i.images[a.source];let u=n.textureLoader;if(c.uri){const d=n.options.manager.getHandler(c.uri);d!==null&&(u=d)}return this.detectSupport().then(function(d){if(d)return n.loadTextureImage(e,a.source,u);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class AA{constructor(e){this.name=sn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(c){const u=i.byteOffset||0,d=i.byteLength||0,v=i.count,g=i.byteStride,b=new Uint8Array(c,u,d);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(v,g,b,i.mode,i.filter).then(function(y){return y.buffer}):a.ready.then(function(){const y=new ArrayBuffer(v*g);return a.decodeGltfBuffer(new Uint8Array(y),v,g,b,i.mode,i.filter),y})})}else return null}}const k0="glTF",yc=12,i_={JSON:1313821514,BIN:5130562};class PA{constructor(e){this.name=sn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,yc);if(this.header={magic:Is.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==k0)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-yc,i=new DataView(e,yc);let o=0;for(;o<n;){const a=i.getUint32(o,!0);o+=4;const c=i.getUint32(o,!0);if(o+=4,c===i_.JSON){const u=new Uint8Array(e,yc+o,a);this.content=Is.decodeText(u)}else if(c===i_.BIN){const u=yc+o;this.body=e.slice(u,u+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class TA{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=sn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,c={},u={},d={};for(const v in a){const g=bm[v]||v.toLowerCase();c[g]=a[v]}for(const v in e.attributes){const g=bm[v]||v.toLowerCase();if(a[v]!==void 0){const b=n.accessors[e.attributes[v]],y=Kc[b.componentType];d[g]=y.name,u[g]=b.normalized===!0}}return t.getDependency("bufferView",o).then(function(v){return new Promise(function(g){i.decodeDracoFile(v,function(b){for(const y in b.attributes){const S=b.attributes[y],E=u[y];E!==void 0&&(S.normalized=E)}g(b)},c,d)})})}}class LA{constructor(){this.name=sn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class _m extends Wo{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),c={specular:{value:new $e().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(u){for(const d in c)u.uniforms[d]=c[d];u.fragmentShader=u.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(u){c.specular.value=u}},specularMap:{get:function(){return c.specularMap.value},set:function(u){c.specularMap.value=u,u?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(u){c.glossiness.value=u}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(u){c.glossinessMap.value=u,u?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class kA{constructor(){this.name=sn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return _m}extendParams(e,t,n){const i=t.extensions[this.name];e.color=new $e(1,1,1),e.opacity=1;const o=[];if(Array.isArray(i.diffuseFactor)){const a=i.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(i.diffuseTexture!==void 0&&o.push(n.assignTexture(e,"map",i.diffuseTexture,vn)),e.emissive=new $e(0,0,0),e.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,e.specular=new $e(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){const a=i.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",a)),o.push(n.assignTexture(e,"specularMap",a,vn))}return Promise.all(o)}createMaterial(e){const t=new _m(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=so,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class RA{constructor(){this.name=sn.KHR_MESH_QUANTIZATION}}class R0 extends Aa{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=e*i*3+i;for(let a=0;a!==i;a++)t[a]=n[o+a];return t}interpolate_(e,t,n,i){const o=this.resultBuffer,a=this.sampleValues,c=this.valueSize,u=c*2,d=c*3,v=i-t,g=(n-t)/v,b=g*g,y=b*g,S=e*d,E=S-d,M=-2*y+3*b,L=y-b,R=1-M,z=L-b+g;for(let V=0;V!==c;V++){const H=a[E+V+c],B=a[E+V+u]*v,j=a[S+V+c],F=a[S+V]*v;o[V]=R*H+z*B+M*j+L*F}return o}}const IA=new Vn;class DA extends R0{interpolate_(e,t,n,i){const o=super.interpolate_(e,t,n,i);return IA.fromArray(o).normalize().toArray(o),o}}const qr={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Kc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},s_={9728:ei,9729:Ln,9984:hl,9985:$c,9986:ul,9987:gr},r_={33071:qi,33648:ba,10497:mr},o_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bm={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Po={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},zA={CUBICSPLINE:void 0,LINEAR:to,STEP:xa},Lf={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function VA(h){return h.DefaultMaterial===void 0&&(h.DefaultMaterial=new Wo({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:eo})),h.DefaultMaterial}function Cc(h,e,t){for(const n in t.extensions)h[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function ra(h,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(h.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function NA(h,e,t){let n=!1,i=!1,o=!1;for(let d=0,v=e.length;d<v;d++){const g=e[d];if(g.POSITION!==void 0&&(n=!0),g.NORMAL!==void 0&&(i=!0),g.COLOR_0!==void 0&&(o=!0),n&&i&&o)break}if(!n&&!i&&!o)return Promise.resolve(h);const a=[],c=[],u=[];for(let d=0,v=e.length;d<v;d++){const g=e[d];if(n){const b=g.POSITION!==void 0?t.getDependency("accessor",g.POSITION):h.attributes.position;a.push(b)}if(i){const b=g.NORMAL!==void 0?t.getDependency("accessor",g.NORMAL):h.attributes.normal;c.push(b)}if(o){const b=g.COLOR_0!==void 0?t.getDependency("accessor",g.COLOR_0):h.attributes.color;u.push(b)}}return Promise.all([Promise.all(a),Promise.all(c),Promise.all(u)]).then(function(d){const v=d[0],g=d[1],b=d[2];return n&&(h.morphAttributes.position=v),i&&(h.morphAttributes.normal=g),o&&(h.morphAttributes.color=b),h.morphTargetsRelative=!0,h})}function OA(h,e){if(h.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)h.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(h.morphTargetInfluences.length===t.length){h.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)h.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function FA(h){const e=h.extensions&&h.extensions[sn.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+a_(e.attributes):t=h.indices+":"+a_(h.attributes)+":"+h.mode,t}function a_(h){let e="";const t=Object.keys(h).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+h[t[n]]+";";return e}function wm(h){switch(h){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function BA(h){return h.search(/\.jpe?g($|\?)/i)>0||h.search(/^data\:image\/jpeg/)===0?"image/jpeg":h.search(/\.webp($|\?)/i)>0||h.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class UA{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new fA,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,o=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||n||i&&o<98?this.textureLoader=new Cl(this.options.manager):this.textureLoader=new av(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ss(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const c={scene:a[0][i.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:i.asset,parser:n,userData:{}};Cc(o,c,i),ra(c,i),Promise.all(n._invokeAll(function(u){return u.afterRoot&&u.afterRoot(c)})).then(function(){e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,o=t.length;i<o;i++){const a=t[i].joints;for(let c=0,u=a.length;c<u;c++)e[a[c]].isBone=!0}for(let i=0,o=e.length;i<o;i++){const a=e[i];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),o=(a,c)=>{const u=this.associations.get(a);u!=null&&this.associations.set(c,u);for(const[d,v]of a.children.entries())o(v,c.children[d])};return o(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const o=e(t[i]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(o,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[sn.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(o,a){n.load(Is.resolveURL(t.uri,i.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);const o=[];return i.bufferView!==void 0?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),i.sparse!==void 0&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(a){const c=a[0],u=o_[i.type],d=Kc[i.componentType],v=d.BYTES_PER_ELEMENT,g=v*u,b=i.byteOffset||0,y=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,S=i.normalized===!0;let E,M;if(y&&y!==g){const L=Math.floor(b/y),R="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+L+":"+i.count;let z=t.cache.get(R);z||(E=new d(c,L*y,i.count*y/v),z=new bl(E,y/v),t.cache.add(R,z)),M=new no(z,u,b%y/v,S)}else c===null?E=new d(i.count*u):E=new d(c,b,i.count*u),M=new pn(E,u,S);if(i.sparse!==void 0){const L=o_.SCALAR,R=Kc[i.sparse.indices.componentType],z=i.sparse.indices.byteOffset||0,V=i.sparse.values.byteOffset||0,H=new R(a[1],z,i.sparse.count*L),B=new d(a[2],V,i.sparse.count*u);c!==null&&(M=new pn(M.array.slice(),M.itemSize,M.normalized));for(let j=0,F=H.length;j<F;j++){const W=H[j];if(M.setX(W,B[j*u]),u>=2&&M.setY(W,B[j*u+1]),u>=3&&M.setZ(W,B[j*u+2]),u>=4&&M.setW(W,B[j*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return M})}loadTexture(e){const t=this.json,n=this.options,o=t.textures[e].source,a=t.images[o];let c=this.textureLoader;if(a.uri){const u=n.manager.getHandler(a.uri);u!==null&&(c=u)}return this.loadTextureImage(e,o,c)}loadTextureImage(e,t,n){const i=this,o=this.json,a=o.textures[e],c=o.images[t],u=(c.uri||c.bufferView)+":"+a.sampler;if(this.textureCache[u])return this.textureCache[u];const d=this.loadImageSource(t,n).then(function(v){v.flipY=!1,a.name&&(v.name=a.name);const b=(o.samplers||{})[a.sampler]||{};return v.magFilter=s_[b.magFilter]||Ln,v.minFilter=s_[b.minFilter]||gr,v.wrapS=r_[b.wrapS]||mr,v.wrapT=r_[b.wrapT]||mr,i.associations.set(v,{textures:e}),v}).catch(function(){return null});return this.textureCache[u]=d,d}loadImageSource(e,t){const n=this,i=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(g=>g.clone());const a=i.images[e],c=self.URL||self.webkitURL;let u=a.uri||"",d=!1;if(a.bufferView!==void 0)u=n.getDependency("bufferView",a.bufferView).then(function(g){d=!0;const b=new Blob([g],{type:a.mimeType});return u=c.createObjectURL(b),u});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const v=Promise.resolve(u).then(function(g){return new Promise(function(b,y){let S=b;t.isImageBitmapLoader===!0&&(S=function(E){const M=new Kn(E);M.needsUpdate=!0,b(M)}),t.load(Is.resolveURL(g,o.path),S,void 0,y)})}).then(function(g){return d===!0&&c.revokeObjectURL(u),g.userData.mimeType=a.mimeType||BA(a.uri),g}).catch(function(g){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),g});return this.sourceCache[e]=v,v}assignTexture(e,t,n,i){const o=this;return this.getDependency("texture",n.index).then(function(a){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),o.extensions[sn.KHR_TEXTURE_TRANSFORM]){const c=n.extensions!==void 0?n.extensions[sn.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const u=o.associations.get(a);a=o.extensions[sn.KHR_TEXTURE_TRANSFORM].extendTexture(a,c),o.associations.set(a,u)}}return i!==void 0&&(a.encoding=i),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+n.uuid;let u=this.cache.get(c);u||(u=new eh,ti.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(c,u)),n=u}else if(e.isLine){const c="LineBasicMaterial:"+n.uuid;let u=this.cache.get(c);u||(u=new Fi,ti.prototype.copy.call(u,n),u.color.copy(n.color),this.cache.add(c,u)),n=u}if(i||o||a){let c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),i&&(c+="derivative-tangents:"),o&&(c+="vertex-colors:"),a&&(c+="flat-shading:");let u=this.cache.get(c);u||(u=n.clone(),o&&(u.vertexColors=!0),a&&(u.flatShading=!0),i&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(c,u),this.associations.set(u,this.associations.get(n))),n=u}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return Wo}loadMaterial(e){const t=this,n=this.json,i=this.extensions,o=n.materials[e];let a;const c={},u=o.extensions||{},d=[];if(u[sn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const g=i[sn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=g.getMaterialType(),d.push(g.extendParams(c,o,t))}else if(u[sn.KHR_MATERIALS_UNLIT]){const g=i[sn.KHR_MATERIALS_UNLIT];a=g.getMaterialType(),d.push(g.extendParams(c,o,t))}else{const g=o.pbrMetallicRoughness||{};if(c.color=new $e(1,1,1),c.opacity=1,Array.isArray(g.baseColorFactor)){const b=g.baseColorFactor;c.color.fromArray(b),c.opacity=b[3]}g.baseColorTexture!==void 0&&d.push(t.assignTexture(c,"map",g.baseColorTexture,vn)),c.metalness=g.metallicFactor!==void 0?g.metallicFactor:1,c.roughness=g.roughnessFactor!==void 0?g.roughnessFactor:1,g.metallicRoughnessTexture!==void 0&&(d.push(t.assignTexture(c,"metalnessMap",g.metallicRoughnessTexture)),d.push(t.assignTexture(c,"roughnessMap",g.metallicRoughnessTexture))),a=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(e)}),d.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(e,c)})))}o.doubleSided===!0&&(c.side=qs);const v=o.alphaMode||Lf.OPAQUE;if(v===Lf.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,v===Lf.MASK&&(c.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==wi&&(d.push(t.assignTexture(c,"normalMap",o.normalTexture)),c.normalScale=new De(1,1),o.normalTexture.scale!==void 0)){const g=o.normalTexture.scale;c.normalScale.set(g,g)}return o.occlusionTexture!==void 0&&a!==wi&&(d.push(t.assignTexture(c,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==wi&&(c.emissive=new $e().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&a!==wi&&d.push(t.assignTexture(c,"emissiveMap",o.emissiveTexture,vn)),Promise.all(d).then(function(){let g;return a===_m?g=i[sn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):g=new a(c),o.name&&(g.name=o.name),ra(g,o),t.associations.set(g,{materials:e}),o.extensions&&Cc(i,g,o),g})}createUniqueName(e){const t=cn.sanitizeNodeName(e||"");let n=t;for(let i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function o(c){return n[sn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(u){return l_(u,c,t)})}const a=[];for(let c=0,u=e.length;c<u;c++){const d=e[c],v=FA(d),g=i[v];if(g)a.push(g.promise);else{let b;d.extensions&&d.extensions[sn.KHR_DRACO_MESH_COMPRESSION]?b=o(d):b=l_(new jt,d,t),i[v]={primitive:d,promise:b},a.push(b)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,i=this.extensions,o=n.meshes[e],a=o.primitives,c=[];for(let u=0,d=a.length;u<d;u++){const v=a[u].material===void 0?VA(this.cache):this.getDependency("material",a[u].material);c.push(v)}return c.push(t.loadGeometries(a)),Promise.all(c).then(function(u){const d=u.slice(0,u.length-1),v=u[u.length-1],g=[];for(let y=0,S=v.length;y<S;y++){const E=v[y],M=a[y];let L;const R=d[y];if(M.mode===qr.TRIANGLES||M.mode===qr.TRIANGLE_STRIP||M.mode===qr.TRIANGLE_FAN||M.mode===void 0)L=o.isSkinnedMesh===!0?new gd(E,R):new Bn(E,R),L.isSkinnedMesh===!0&&!L.geometry.attributes.skinWeight.normalized&&L.normalizeSkinWeights(),M.mode===qr.TRIANGLE_STRIP?L.geometry=c_(L.geometry,ld):M.mode===qr.TRIANGLE_FAN&&(L.geometry=c_(L.geometry,pl));else if(M.mode===qr.LINES)L=new Ys(E,R);else if(M.mode===qr.LINE_STRIP)L=new vr(E,R);else if(M.mode===qr.LINE_LOOP)L=new _d(E,R);else if(M.mode===qr.POINTS)L=new bd(E,R);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+M.mode);Object.keys(L.geometry.morphAttributes).length>0&&OA(L,o),L.name=t.createUniqueName(o.name||"mesh_"+e),ra(L,o),M.extensions&&Cc(i,L,M),t.assignFinalMaterial(L),g.push(L)}for(let y=0,S=g.length;y<S;y++)t.associations.set(g[y],{meshes:e,primitives:y});if(g.length===1)return g[0];const b=new Ls;t.associations.set(b,{meshes:e});for(let y=0,S=g.length;y<S;y++)b.add(g[y]);return b})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Ri(cd.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new Ea(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),ra(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(i){return n.inverseBindMatrices=i,n})}loadAnimation(e){const n=this.json.animations[e],i=[],o=[],a=[],c=[],u=[];for(let d=0,v=n.channels.length;d<v;d++){const g=n.channels[d],b=n.samplers[g.sampler],y=g.target,S=y.node,E=n.parameters!==void 0?n.parameters[b.input]:b.input,M=n.parameters!==void 0?n.parameters[b.output]:b.output;i.push(this.getDependency("node",S)),o.push(this.getDependency("accessor",E)),a.push(this.getDependency("accessor",M)),c.push(b),u.push(y)}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(u)]).then(function(d){const v=d[0],g=d[1],b=d[2],y=d[3],S=d[4],E=[];for(let L=0,R=v.length;L<R;L++){const z=v[L],V=g[L],H=b[L],B=y[L],j=S[L];if(z===void 0)continue;z.updateMatrix();let F;switch(Po[j.path]){case Po.weights:F=ya;break;case Po.rotation:F=Rr;break;case Po.position:case Po.scale:default:F=Ca;break}const W=z.name?z.name:z.uuid,Z=B.interpolation!==void 0?zA[B.interpolation]:to,se=[];Po[j.path]===Po.weights?z.traverse(function(oe){oe.morphTargetInfluences&&se.push(oe.name?oe.name:oe.uuid)}):se.push(W);let we=H.array;if(H.normalized){const oe=wm(we.constructor),ne=new Float32Array(we.length);for(let ce=0,ve=we.length;ce<ve;ce++)ne[ce]=we[ce]*oe;we=ne}for(let oe=0,ne=se.length;oe<ne;oe++){const ce=new F(se[oe]+"."+Po[j.path],V.array,we,Z);B.interpolation==="CUBICSPLINE"&&(ce.createInterpolant=function(de){const he=this instanceof Rr?DA:R0;return new he(this.times,this.values,this.getValueSize()/3,de)},ce.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),E.push(ce)}}const M=n.name?n.name:"animation_"+e;return new Ma(M,void 0,E)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(o){const a=n._getNodeRef(n.meshCache,i.mesh,o);return i.weights!==void 0&&a.traverse(function(c){if(c.isMesh)for(let u=0,d=i.weights.length;u<d;u++)c.morphTargetInfluences[u]=i.weights[u]}),a})}loadNode(e){const t=this.json,n=this.extensions,i=this,o=t.nodes[e],a=o.name?i.createUniqueName(o.name):"";return function(){const c=[],u=i._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(e)});return u&&c.push(u),o.camera!==void 0&&c.push(i.getDependency("camera",o.camera).then(function(d){return i._getNodeRef(i.cameraCache,o.camera,d)})),i._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(e)}).forEach(function(d){c.push(d)}),Promise.all(c)}().then(function(c){let u;if(o.isBone===!0?u=new Qc:c.length>1?u=new Ls:c.length===1?u=c[0]:u=new Jt,u!==c[0])for(let d=0,v=c.length;d<v;d++)u.add(c[d]);if(o.name&&(u.userData.name=o.name,u.name=a),ra(u,o),o.extensions&&Cc(n,u,o),o.matrix!==void 0){const d=new It;d.fromArray(o.matrix),u.applyMatrix4(d)}else o.translation!==void 0&&u.position.fromArray(o.translation),o.rotation!==void 0&&u.quaternion.fromArray(o.rotation),o.scale!==void 0&&u.scale.fromArray(o.scale);return i.associations.has(u)||i.associations.set(u,{}),i.associations.get(u).nodes=e,u})}loadScene(e){const t=this.json,n=this.extensions,i=this.json.scenes[e],o=this,a=new Ls;i.name&&(a.name=o.createUniqueName(i.name)),ra(a,i),i.extensions&&Cc(n,a,i);const c=i.nodes||[],u=[];for(let d=0,v=c.length;d<v;d++)u.push(I0(c[d],a,t,o));return Promise.all(u).then(function(){const d=v=>{const g=new Map;for(const[b,y]of o.associations)(b instanceof ti||b instanceof Kn)&&g.set(b,y);return v.traverse(b=>{const y=o.associations.get(b);y!=null&&g.set(b,y)}),g};return o.associations=d(a),a})}}function I0(h,e,t,n){const i=t.nodes[h];return n.getDependency("node",h).then(function(o){if(i.skin===void 0)return o;let a;return n.getDependency("skin",i.skin).then(function(c){a=c;const u=[];for(let d=0,v=a.joints.length;d<v;d++)u.push(n.getDependency("node",a.joints[d]));return Promise.all(u)}).then(function(c){return o.traverse(function(u){if(!u.isMesh)return;const d=[],v=[];for(let g=0,b=c.length;g<b;g++){const y=c[g];if(y){d.push(y);const S=new It;a.inverseBindMatrices!==void 0&&S.fromArray(a.inverseBindMatrices.array,g*16),v.push(S)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',a.joints[g])}u.bind(new wl(d,v),u.matrixWorld)}),o})}).then(function(o){e.add(o);const a=[];if(i.children){const c=i.children;for(let u=0,d=c.length;u<d;u++){const v=c[u];a.push(I0(v,o,t,n))}}return Promise.all(a)})}function HA(h,e,t){const n=e.attributes,i=new oo;if(n.POSITION!==void 0){const c=t.json.accessors[n.POSITION],u=c.min,d=c.max;if(u!==void 0&&d!==void 0){if(i.set(new X(u[0],u[1],u[2]),new X(d[0],d[1],d[2])),c.normalized){const v=wm(Kc[c.componentType]);i.min.multiplyScalar(v),i.max.multiplyScalar(v)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const c=new X,u=new X;for(let d=0,v=o.length;d<v;d++){const g=o[d];if(g.POSITION!==void 0){const b=t.json.accessors[g.POSITION],y=b.min,S=b.max;if(y!==void 0&&S!==void 0){if(u.setX(Math.max(Math.abs(y[0]),Math.abs(S[0]))),u.setY(Math.max(Math.abs(y[1]),Math.abs(S[1]))),u.setZ(Math.max(Math.abs(y[2]),Math.abs(S[2]))),b.normalized){const E=wm(Kc[b.componentType]);u.multiplyScalar(E)}c.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(c)}h.boundingBox=i;const a=new ao;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,h.boundingSphere=a}function l_(h,e,t){const n=e.attributes,i=[];function o(a,c){return t.getDependency("accessor",a).then(function(u){h.setAttribute(c,u)})}for(const a in n){const c=bm[a]||a.toLowerCase();c in h.attributes||i.push(o(n[a],c))}if(e.indices!==void 0&&!h.index){const a=t.getDependency("accessor",e.indices).then(function(c){h.setIndex(c)});i.push(a)}return ra(h,e),HA(h,e,t),Promise.all(i).then(function(){return e.targets!==void 0?NA(h,e.targets,t):h})}function c_(h,e){let t=h.getIndex();if(t===null){const a=[],c=h.getAttribute("position");if(c!==void 0){for(let u=0;u<c.count;u++)a.push(u);h.setIndex(a),t=h.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),h}const n=t.count-2,i=[];if(e===pl)for(let a=1;a<=n;a++)i.push(t.getX(0)),i.push(t.getX(a)),i.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(i.push(t.getX(a)),i.push(t.getX(a+1)),i.push(t.getX(a+2))):(i.push(t.getX(a+2)),i.push(t.getX(a+1)),i.push(t.getX(a)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=h.clone();return o.setIndex(i),o}io.enabled=!0;const Ad=new Cd,GA=new cv(Ad),WA=new ss(Ad),jA=new fv(Ad),KA=new Cl(Ad);GA.setPath("/audio/");WA.setPath("/file/");jA.setPath("/glb/");KA.setPath("/textures/");const bi=new jm({alpha:!1,antialias:!0,depth:!0,powerPreference:"high-performance",stencil:!0});bi.debug.checkShaderErrors=!0;bi.physicallyCorrectLights=!0;bi.xr.enabled=!1;bi.outputEncoding=vn;bi.toneMapping=zm;switch(bi.shadowMap.enabled=!0,"basic"){case"pcf":bi.shadowMap.type=rd;break;case"pcf_soft":bi.shadowMap.type=Rm;break;case"vsm":bi.shadowMap.type=la;break;default:bi.shadowMap.type=z_;break}document.body.append(bi.domElement);const Rc=new Set;let mv=!1;const oi={A:0,B:0,X:0,Y:0,back:0,connected:!1,leftBumper:0,leftStickButton:0,leftStickX:0,leftStickY:0,leftTrigger:0,padX:0,padY:0,rightBumper:0,rightStickButton:0,rightStickX:0,rightStickY:0,rightTrigger:0,start:0},h_=({axes:h,buttons:e})=>{oi.leftStickX=h[0],oi.leftStickY=h[1],oi.rightStickX=h[2],oi.rightStickY=h[3],oi.A=e[0].value,oi.B=e[1].value,oi.X=e[2].value,oi.Y=e[3].value,oi.leftBumper=e[4].value,oi.rightBumper=e[5].value,oi.leftTrigger=e[6].value,oi.rightTrigger=e[7].value,oi.back=e[8].value,oi.start=e[9].value,oi.leftStickButton=e[10].value,oi.rightStickButton=e[11].value,oi.padY=-e[12].value||e[13].value,oi.padX=-e[14].value||e[15].value},qA=()=>{if(!oi.connected||mv)return;const[h,e]=window.navigator.getGamepads();h!==null&&h_(h),e!==null&&h_(e)},xm=(h,e)=>{switch(h.toLowerCase()){}},XA=h=>{const e=h.key.toLowerCase();mv=!0,Rc.add(e);for(const t of Rc)xm(t)},$A=h=>{const e=h.key.toLowerCase();Rc.delete(e),xm(e);for(const t of Rc)xm(t);Rc.size===0&&(mv=!1)},YA=()=>{oi.connected=!1},ZA=()=>{const[h,e]=navigator.getGamepads();h===null&&e===null||(oi.connected=!0,window.addEventListener("gamepaddisconnected",YA))};window.addEventListener("keydown",XA,{passive:!0}),window.addEventListener("keyup",$A,{passive:!0}),window.addEventListener("gamepadconnected",ZA,{passive:!0});var Xi={};Xi.d=(h,e)=>{for(var t in e)Xi.o(e,t)&&!Xi.o(h,t)&&Object.defineProperty(h,t,{enumerable:!0,get:e[t]})};Xi.o=(h,e)=>Object.prototype.hasOwnProperty.call(h,e);Xi.r=h=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})};var zs={};Xi.d(zs,{g1:()=>Td,gO:()=>Dc,km:()=>Pd,zV:()=>qc,ol:()=>kv,uM:()=>Ld,N1:()=>nw,xv:()=>Lv,PH:()=>Rd,UH:()=>kd,ZP:()=>SP,Vx:()=>iw});var Pd={};Xi.r(Pd);Xi.d(Pd,{COLUMN:()=>Id,COLUMN_REVERSE:()=>z0,ROW:()=>Ic,ROW_REVERSE:()=>D0,contentDirection:()=>V0});var Td={};Xi.r(Td);Xi.d(Td,{CENTER:()=>gv,END:()=>_v,START:()=>vv,STRETCH:()=>N0,alignItems:()=>O0,warnAboutDeprecatedAlignItems:()=>F0});var Ld={};Xi.r(Ld);Xi.d(Ld,{CENTER:()=>wv,END:()=>xv,SPACE_AROUND:()=>yv,SPACE_BETWEEN:()=>Cv,SPACE_EVENLY:()=>Mv,START:()=>bv,justifyContent:()=>B0});var kd={};Xi.r(kd);Xi.d(kd,{NORMAL:()=>Dd,NOWRAP:()=>mh,PRE:()=>zd,PRE_LINE:()=>Ml,PRE_WRAP:()=>Vd,WHITE_CHARS:()=>ym,collapseWhitespaceOnInlines:()=>W0,collapseWhitespaceOnString:()=>U0,newlineBreakability:()=>H0,shouldBreak:()=>G0});var Rd={};Xi.r(Rd);Xi.d(Rd,{CENTER:()=>Sv,JUSTIFY:()=>Av,JUSTIFY_CENTER:()=>$0,JUSTIFY_LEFT:()=>X0,JUSTIFY_RIGHT:()=>td,LEFT:()=>K0,RIGHT:()=>q0,textAlign:()=>Y0});var JA=h=>{var e={};return Xi.d(e,h),e};const on=JA({BufferAttribute:()=>pn,BufferGeometry:()=>jt,CanvasTexture:()=>$b,Color:()=>$e,FileLoader:()=>ss,LinearFilter:()=>Ln,Mesh:()=>Bn,Object3D:()=>Jt,Plane:()=>$r,PlaneGeometry:()=>co,ShaderMaterial:()=>Ds,TextureLoader:()=>Cl,Vector2:()=>De,Vector3:()=>X}),Ic="row",D0="row-reverse",Id="column",z0="column-reverse";function V0(h,e,t,n){let i=t,o="getWidth",a="x",c="y";e.indexOf(Id)===0&&(o="getHeight",a="y",c="x");for(let u=0;u<h.childrenBoxes.length;u++){const d=h.childrenBoxes[u],v=d.id,g=d[o](),b=d.margin||0;i+=b*n,h.childrenPos[v]={[a]:i+g/2*n,[c]:0},i+=n*(g+b)}}const vv="start",gv="center",_v="end",N0="stretch";function O0(h,e){const t=h.getAlignItems();QA.indexOf(t)===-1&&console.warn(`alignItems === '${t}' is not supported`);let n="getWidth",i="x";e.indexOf(Ic)===0&&(n="getHeight",i="y");const o=h[n]()/2-(h.padding||0);h.childrenBoxes.forEach(a=>{let c;switch(t){case _v:case"right":case"bottom":e.indexOf(Ic)===0?c=-o+a[n]()/2+(a.margin||0):c=o-a[n]()/2-(a.margin||0);break;case vv:case"left":case"top":e.indexOf(Ic)===0?c=o-a[n]()/2-(a.margin||0):c=-o+a[n]()/2+(a.margin||0);break}h.childrenPos[a.id][i]=c||0})}function F0(h){eP.indexOf(h)!==-1&&console.warn(`alignItems === '${h}' is deprecated and will be remove in 7.x.x. Fallback are 'start'|'end'`)}const QA=[vv,gv,_v,N0,"top","right","bottom","left"],eP=["top","right","bottom","left"],bv="start",wv="center",xv="end",yv="space-around",Cv="space-between",Mv="space-evenly";function B0(h,e,t,n){const i=h.getJustifyContent();tP.indexOf(i)===-1&&console.warn(`justifyContent === '${i}' is not supported`);const o=e.indexOf("row")===0?"width":"height",a=h.getChildrenSideSum(o),u=(o==="width"?h.getInnerWidth():h.getInnerHeight())-a,d=t*2-a*Math.sign(t),v=nP(i,d),g=iP(h.childrenBoxes,u,i,n),b=e.indexOf("row")===0?"x":"y";h.childrenBoxes.forEach((y,S)=>{h.childrenPos[y.id][b]-=v-g[S]})}const tP=[bv,wv,xv,yv,Cv,Mv];function nP(h,e){switch(h){case xv:return e;case wv:return e/2}return 0}function iP(h,e,t,n){const i=Array(h.length).fill(0);if(e>0)switch(t){case Cv:if(h.length>1){const o=e/(h.length-1)*n;i[0]=0;for(let a=1;a<h.length;a++)i[a]=o*a}break;case Mv:if(h.length>1){const o=e/(h.length+1)*n;for(let a=0;a<h.length;a++)i[a]=o*(a+1)}break;case yv:if(h.length>1){const o=e/h.length*n,a=o/2;i[0]=a;for(let c=1;c<h.length;c++)i[c]=a+o*c}break}return i}function Ev(h){return class extends h{constructor(t){super(t),this.isBoxComponent=!0,this.childrenPos={}}getInnerWidth(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.width-(this.padding*2||0)||this.getChildrenSideSum("width");case"column":case"column-reverse":return this.getHighestChildSizeOn("width");default:console.error(`Invalid contentDirection : ${t}`);break}}getInnerHeight(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.getHighestChildSizeOn("height");case"column":case"column-reverse":return this.height-(this.padding*2||0)||this.getChildrenSideSum("height");default:console.error(`Invalid contentDirection : ${t}`);break}}getChildrenSideSum(t){return this.childrenBoxes.reduce((n,i)=>{const o=i.margin*2||0,a=t==="width"?i.getWidth()+o:i.getHeight()+o;return n+a},0)}setPosFromParentRecords(){this.parentUI&&this.parentUI.childrenPos[this.id]&&(this.position.x=this.parentUI.childrenPos[this.id].x,this.position.y=this.parentUI.childrenPos[this.id].y)}computeChildrenPosition(){if(this.children.length>0){const t=this.getContentDirection();let n;switch(t){case Ic:n=-this.getInnerWidth()/2;break;case D0:n=this.getInnerWidth()/2;break;case Id:n=this.getInnerHeight()/2;break;case z0:n=-this.getInnerHeight()/2;break}const i=-Math.sign(n);V0(this,t,n,i),B0(this,t,n,i),O0(this,t)}}getHighestChildSizeOn(t){return this.childrenBoxes.reduce((n,i)=>{const o=i.margin||0,a=t==="width"?i.getWidth()+o*2:i.getHeight()+o*2;return Math.max(n,a)},0)}getWidth(){return this.parentUI&&this.parentUI.getAlignItems()==="stretch"&&this.parentUI.getContentDirection().indexOf("column")!==-1?this.parentUI.getWidth()-(this.parentUI.padding*2||0):this.width||this.getInnerWidth()+(this.padding*2||0)}getHeight(){return this.parentUI&&this.parentUI.getAlignItems()==="stretch"&&this.parentUI.getContentDirection().indexOf("row")!==-1?this.parentUI.getHeight()-(this.parentUI.padding*2||0):this.height||this.getInnerHeight()+(this.padding*2||0)}}}const ym={"	":"	","\n":`
`,"\r":"\r"," ":" "},Dd="normal",mh="nowrap",zd="pre",Ml="pre-line",Vd="pre-wrap",U0=function(h,e){switch(e){case mh:case Dd:h=h.replace(/\n/g," ");case Ml:h=h.replace(/[ ]{2,}/g," ");break}return h},H0=function(h){switch(h){case zd:case Vd:case Ml:return"mandatory"}},G0=function(h,e,t,n){const i=h[e];switch(n.WHITESPACE){case Dd:case Ml:case Vd:if(i.lineBreak==="mandatory")return!0;const o=i.kerning?i.kerning:0,a=i.xoffset?i.xoffset:0,c=i.xadvance?i.xadvance:i.width;if(t+c+a+o>n.INNER_WIDTH)return!0;const u=j0(h,e,n);return sP(h[e-1],t,u,n);case zd:return i.lineBreak==="mandatory";case mh:default:return!1}},W0=function(h,e){const t=h[0],n=h[h.length-1];switch(e){case Vd:t.glyph&&t.glyph===`
`&&h.length>1&&d_([t],h[1]),n.glyph&&n.glyph===`
`&&h.length>1&&u_([n],h[h.length-2]);break;case Ml:case mh:case Dd:let i=[],o;for(let a=0;a<h.length;a++){const c=h[a];if(c.glyph&&ym[c.glyph]&&h.length>a){i.push(c),o=h[a+1];continue}break}d_(i,o),i=[],o=null;for(let a=h.length-1;a>0;a--){const c=h[a];if(c.glyph&&ym[c.glyph]&&a>0){i.push(c),o=h[a-1];continue}break}u_(i,o);break;case zd:break;default:return console.warn(`whiteSpace: '${e}' is not valid`),0}return t.offsetX};function u_(h,e){if(e)for(let t=0;t<h.length;t++){const n=h[t];n.width=0,n.height=0,n.offsetX=e.offsetX+e.width}}function d_(h,e){if(e)for(let t=0;t<h.length;t++){const n=h[t];n.width=0,n.height=0,n.offsetX=e.offsetX}}function j0(h,e,t,n){if(n=n||0,!h[e])return n;const i=h[e],o=i.kerning?i.kerning:0,a=i.xoffset?i.xoffset:0,c=i.xadvance?i.xadvance:i.width;return i.lineBreak?n+c:j0(h,e+1,t,n+c+t.LETTERSPACING+a+o)}function sP(h,e,t,n){return!h||!h.glyph||e+t<n.INNER_WIDTH?!1:n.BREAKON.indexOf(h.glyph)>-1}const K0="left",q0="right",Sv="center",Av="justify",X0="justify-left",td="justify-right",$0="justify-center";function Y0(h,e,t){for(let n=0;n<h.length;n++){const i=h[n],o=rP(i,e,t,n===h.length-1);for(let a=0;a<i.length;a++)i[a].offsetX+=o}if(e.indexOf(Av)===0)for(let n=0;n<h.length;n++){const i=h[n];if(e.indexOf("-")!==-1&&n===h.length-1)return;const o=t-i.width;if(o<=0)return;let a=0;for(let v=1;v<i.length-1;v++)a+=i[v].glyph===" "?1:0;const c=o/a;let u=1;e===td&&(i.reverse(),u=-1);let d=0;for(let v=1;v<=i.length-1;v++){const g=i[v];g.offsetX+=d*u,d+=g.glyph===" "?c:0}e===td&&i.reverse()}}const rP=(h,e,t,n)=>{switch(e){case X0:case Av:case K0:return-t/2;case td:case q0:return-h.width+t/2;case Sv:return-h.width/2;case $0:return n?-h.width/2:-t/2;default:console.warn(`textAlign: '${e}' is not valid`)}};function Z0(h){return class extends h{computeInlinesPosition(){const t=this.getWidth()-(this.padding*2||0),n=this.getHeight()-(this.padding*2||0),i=this.getJustifyContent(),o=this.getTextAlign(),a=this.getInterLine(),c=this.computeLines();let u=c.reduce((v,g,b,y)=>{const S=g.lineHeight-g.lineBase;return g.forEach(E=>{E.offsetY=v-g.lineHeight+S+y[0].lineHeight}),v-g.lineHeight-a},0)+a;u=Math.abs(u);const d=(()=>{switch(i){case"start":return n/2-c[0].lineHeight;case"end":return u-c[0].lineHeight-n/2+(c[c.length-1].lineHeight-c[c.length-1].lineHeight);case"center":return u/2-c[0].lineHeight;default:console.warn(`justifyContent: '${i}' is not valid`)}})();c.forEach(v=>{v.forEach(g=>{g.offsetY+=d})}),Y0(c,o,t),this.lines=c}calculateBestFit(t){if(this.childrenInlines.length!==0)switch(t){case"grow":this.calculateGrowFit();break;case"shrink":this.calculateShrinkFit();break;case"auto":this.calculateAutoFit();break}}calculateGrowFit(){const t=this.getHeight()-(this.padding*2||0);let n=1;const i=.075,o=this.childrenInlines.find(v=>v.isText);let a=1,c=2,u=o._fitFontSize?o._fitFontSize/o.getFontSize():1,d;do if(d=this.calculateHeight(u),d>t){if(u<=a){this.childrenInlines.forEach(v=>{v.isInlineBlock||(v._fitFontSize=v.getFontSize())});break}c=u,u-=(c-a)/2}else{if(Math.abs(t-d)<i)break;Math.abs(u-c)<5e-10&&(c*=2),a=u,u+=(c-a)/2}while(++n<=10)}calculateShrinkFit(){const t=this.getHeight()-(this.padding*2||0);let n=1;const i=.075,o=this.childrenInlines.find(v=>v.isText);let a=0,c=1,u=o._fitFontSize?o._fitFontSize/o.getFontSize():1,d;do if(d=this.calculateHeight(u),d>t)c=u,u-=(c-a)/2;else{if(u>=c){this.childrenInlines.forEach(v=>{v.isInlineBlock||(v._fitFontSize=v.getFontSize())});break}if(Math.abs(t-d)<i)break;a=u,u+=(c-a)/2}while(++n<=10)}calculateAutoFit(){const t=this.getHeight()-(this.padding*2||0);let n=1;const i=.075,o=this.childrenInlines.find(v=>v.isText);let a=0,c=2,u=o._fitFontSize?o._fitFontSize/o.getFontSize():1,d;do if(d=this.calculateHeight(u),d>t)c=u,u-=(c-a)/2;else{if(Math.abs(t-d)<i)break;Math.abs(u-c)<5e-10&&(c*=2),a=u,u+=(c-a)/2}while(++n<=10)}computeLines(){const t=this.getWidth()-(this.padding*2||0),n=[[]];return this.childrenInlines.reduce((i,o)=>{if(!o.inlines)return;const a=o._fitFontSize||o.getFontSize(),c=o.isText?o.getLetterSpacing()*a:0,u=o.getWhiteSpace(),d=o.getBreakOn(),v={WHITESPACE:u,LETTERSPACING:c,BREAKON:d,INNER_WIDTH:t};return o.inlines.reduce((b,y,S,E)=>{const M=y.kerning?y.kerning:0,L=y.xoffset?y.xoffset:0,R=y.xadvance?y.xadvance:y.width;return G0(E,S,b,v)?(n.push([y]),y.offsetX=L,y.width===0?0:R+c):(n[n.length-1].push(y),y.offsetX=b+L+M,b+R+M+c)},i)},0),n.forEach(i=>{if(i.lineHeight=i.reduce((a,c)=>{const u=c.lineHeight!==void 0?c.lineHeight:c.height;return Math.max(a,u)},0),i.lineBase=i.reduce((a,c)=>{const u=c.lineBase!==void 0?c.lineBase:c.height;return Math.max(a,u)},0),i.width=0,i[0]){const a=this.getWhiteSpace(),c=W0(i,a);i.forEach(u=>{u.offsetX-=c}),i.width=this.computeLineWidth(i)}}),n}calculateHeight(t){this.childrenInlines.forEach(a=>{a.isInlineBlock||(a._fitFontSize=a.getFontSize()*t,a.calculateInlines(a._fitFontSize))});const n=this.computeLines(),i=this.getInterLine(),o=n.reduce((a,c)=>a-c.lineHeight-i,0)+i;return Math.abs(o)}computeLineWidth(t){const n=t[0],i=t[t.length-1];return i.offsetX+i.width+n.offsetX}}}const oP=new on.FileLoader,Cm=[],Xu={},aP=new on.TextureLoader,Mm=[],$u={},is={};function lP(h,e){typeof e=="string"?hP(h,e):(is[h.id]||(is[h.id]={component:h}),Pv(e),is[h.id].json=e,h._updateFontFamily(e))}function cP(h,e){Mm.indexOf(e)===-1&&(Mm.push(e),aP.load(e,t=>{t.generateMipmaps=!1,t.minFilter=on.LinearFilter,t.magFilter=on.LinearFilter,$u[e]=t;for(const n of Object.keys(is))e===is[n].textureURL&&is[n].component._updateFontTexture(t)})),is[h.id]||(is[h.id]={component:h}),is[h.id].textureURL=e,$u[e]&&h._updateFontTexture($u[e])}function J0(h){const e=is[h.id];return!e&&h.parentUI?J0(h.parentUI):e}function hP(h,e){Cm.indexOf(e)===-1&&(Cm.push(e),oP.load(e,t=>{const n=JSON.parse(t);Pv(n),Xu[e]=n;for(const i of Object.keys(is))e===is[i].jsonURL&&is[i].component._updateFontFamily(n)})),is[h.id]||(is[h.id]={component:h}),is[h.id].jsonURL=e,Xu[e]&&h._updateFontFamily(Xu[e])}function Pv(h){if(h._kernings)return;const e={};for(let t=0;t<h.kernings.length;t++){const n=h.kernings[t];if(n.amount===0)continue;const i=String.fromCharCode(n.first,n.second);e[i]=n.amount}h._kernings=e}function uP(h,e,t){t.generateMipmaps=!1,t.minFilter=on.LinearFilter,t.magFilter=on.LinearFilter,Cm.push(h),Xu[h]=e,Pv(e),t&&(Mm.push(h),$u[h]=t)}const dP={setFontFamily:lP,setFontTexture:cP,getFontOf:J0,addFont:uP},qc=dP;class _a{static requestUpdate(e,t,n,i){e.traverse(o=>{o.isUI&&(this.requestedUpdates[o.id]?(t&&(this.requestedUpdates[o.id].updateParsing=!0),n&&(this.requestedUpdates[o.id].updateLayout=!0),i&&(this.requestedUpdates[o.id].updateInner=!0)):this.requestedUpdates[o.id]={updateParsing:t,updateLayout:n,updateInner:i,needCallback:t||n||i})})}static register(e){this.components.includes(e)||this.components.push(e)}static disposeOf(e){const t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)}static update(){if(Object.keys(this.requestedUpdates).length>0){const e=this.components.filter(t=>!t.parentUI);e.forEach(t=>this.traverseParsing(t)),e.forEach(t=>this.traverseUpdates(t))}}static traverseParsing(e){const t=this.requestedUpdates[e.id];t&&t.updateParsing&&(e.parseParams(),t.updateParsing=!1),e.childrenUIs.forEach(n=>this.traverseParsing(n))}static traverseUpdates(e){const t=this.requestedUpdates[e.id];delete this.requestedUpdates[e.id],t&&t.updateLayout&&(t.updateLayout=!1,e.updateLayout()),t&&t.updateInner&&(t.updateInner=!1,e.updateInner()),e.childrenUIs.forEach(n=>{this.traverseUpdates(n)}),t&&t.needCallback&&e.onAfterUpdate()}}_a.components=[];_a.requestedUpdates={};const Ki={container:null,fontFamily:null,fontSize:.05,fontKerning:"normal",bestFit:"none",offset:.01,interLine:.01,breakOn:`- ,.:?!
`,whiteSpace:Ml,contentDirection:Id,alignItems:gv,justifyContent:bv,textAlign:Sv,textType:"MSDF",fontColor:new on.Color(16777215),fontOpacity:1,fontPXRange:4,fontSupersampling:!0,borderRadius:.01,borderWidth:0,borderColor:new on.Color("black"),borderOpacity:1,backgroundSize:"cover",backgroundColor:new on.Color(2236962),backgroundWhiteColor:new on.Color(16777215),backgroundOpacity:.8,backgroundOpaqueOpacity:1,getDefaultTexture:pP,hiddenOverflow:!1,letterSpacing:0};let Nu;function pP(){if(!Nu){const h=document.createElement("canvas").getContext("2d");h.canvas.width=1,h.canvas.height=1,h.fillStyle="#ffffff",h.fillRect(0,0,1,1),Nu=new on.CanvasTexture(h.canvas),Nu.isDefault=!0}return Nu}function Nd(h){return class extends h{constructor(t){super(t),this.states={},this.currentState=void 0,this.isUI=!0,this.autoLayout=!0,this.childrenUIs=[],this.childrenBoxes=[],this.childrenTexts=[],this.childrenInlines=[],this.parentUI=null,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI)}getClippingPlanes(){const t=[];if(this.parentUI){if(this.isBlock&&this.parentUI.getHiddenOverflow()){const n=this.parentUI.getHeight()/2-(this.parentUI.padding||0),i=this.parentUI.getWidth()/2-(this.parentUI.padding||0),o=[new on.Plane(new on.Vector3(0,1,0),n),new on.Plane(new on.Vector3(0,-1,0),n),new on.Plane(new on.Vector3(1,0,0),i),new on.Plane(new on.Vector3(-1,0,0),i)];o.forEach(a=>{a.applyMatrix4(this.parent.matrixWorld)}),t.push(...o)}this.parentUI.parentUI&&t.push(...this.parentUI.getClippingPlanes())}return t}getHighestParent(){return this.parentUI?this.parent.getHighestParent():this}_getProperty(t){return this[t]===void 0&&this.parentUI?this.parent._getProperty(t):this[t]!==void 0?this[t]:Ki[t]}getFontSize(){return this._getProperty("fontSize")}getFontKerning(){return this._getProperty("fontKerning")}getLetterSpacing(){return this._getProperty("letterSpacing")}getFontTexture(){return this.fontTexture===void 0&&this.parentUI?this.parent._getProperty("fontTexture"):this.fontTexture!==void 0?this.fontTexture:Ki.getDefaultTexture()}getFontFamily(){return this._getProperty("fontFamily")}getBreakOn(){return this._getProperty("breakOn")}getWhiteSpace(){return this._getProperty("whiteSpace")}getTextAlign(){return this._getProperty("textAlign")}getTextType(){return this._getProperty("textType")}getFontColor(){return this._getProperty("fontColor")}getFontSupersampling(){return this._getProperty("fontSupersampling")}getFontOpacity(){return this._getProperty("fontOpacity")}getFontPXRange(){return this._getProperty("fontPXRange")}getBorderRadius(){return this._getProperty("borderRadius")}getBorderWidth(){return this._getProperty("borderWidth")}getBorderColor(){return this._getProperty("borderColor")}getBorderOpacity(){return this._getProperty("borderOpacity")}getContainer(){return!this.threeOBJ&&this.parent?this.parent.getContainer():this.threeOBJ?this:Ki.container}getParentsNumber(t){return t=t||0,this.parentUI?this.parentUI.getParentsNumber(t+1):t}getBackgroundOpacity(){return!this.backgroundOpacity&&this.backgroundOpacity!==0?Ki.backgroundOpacity:this.backgroundOpacity}getBackgroundColor(){return this.backgroundColor||Ki.backgroundColor}getBackgroundTexture(){return this.backgroundTexture||Ki.getDefaultTexture()}getAlignContent(){return this.alignContent||Ki.alignContent}getAlignItems(){return this.alignItems||Ki.alignItems}getContentDirection(){return this.contentDirection||Ki.contentDirection}getJustifyContent(){return this.justifyContent||Ki.justifyContent}getInterLine(){return this.interLine===void 0?Ki.interLine:this.interLine}getOffset(){return this.offset===void 0?Ki.offset:this.offset}getBackgroundSize(){return this.backgroundSize===void 0?Ki.backgroundSize:this.backgroundSize}getHiddenOverflow(){return this.hiddenOverflow===void 0?Ki.hiddenOverflow:this.hiddenOverflow}getBestFit(){return this.bestFit===void 0?Ki.bestFit:this.bestFit}_rebuildChildrenLists(){this.childrenUIs=this.children.filter(t=>t.isUI),this.childrenBoxes=this.children.filter(t=>t.isBoxComponent),this.childrenInlines=this.children.filter(t=>t.isInline),this.childrenTexts=this.children.filter(t=>t.isText)}_rebuildParentUI=()=>{this.parent&&this.parent.isUI?this.parentUI=this.parent:this.parentUI=null};add(){for(const n of Object.keys(arguments))arguments[n].isInline&&this.update(null,!0);const t=super.add(...arguments);return this._rebuildChildrenLists(),t}remove(){for(const n of Object.keys(arguments))arguments[n].isInline&&this.update(null,!0);const t=super.remove(...arguments);return this._rebuildChildrenLists(),t}update(t,n,i){_a.requestUpdate(this,t,n,i)}onAfterUpdate(){}_updateFontFamily(t){this.fontFamily=t,this.traverse(n=>{n.isUI&&n.update(!0,!0,!1)}),this.getHighestParent().update(!1,!0,!1)}_updateFontTexture(t){this.fontTexture=t,this.getHighestParent().update(!1,!0,!1)}set(t){let n,i,o;if(_a.register(this),!(!t||JSON.stringify(t)===JSON.stringify({}))){t.alignContent&&(t.alignItems=t.alignContent,t.textAlign||(t.textAlign=t.alignContent),console.warn("`alignContent` property has been deprecated, please rely on `alignItems` and `textAlign` instead."),delete t.alignContent),t.alignItems&&F0(t.alignItems);for(const a of Object.keys(t))if(this[a]!=t[a])switch(a){case"content":case"fontSize":case"fontKerning":case"breakOn":case"whiteSpace":this.isText&&(n=!0),i=!0,this[a]=t[a];break;case"bestFit":this.isBlock&&(n=!0,i=!0),this[a]=t[a];break;case"width":case"height":case"padding":(this.isInlineBlock||this.isBlock&&this.getBestFit()!="none")&&(n=!0),i=!0,this[a]=t[a];break;case"letterSpacing":case"interLine":this.isBlock&&this.getBestFit()!="none"&&(n=!0),i=!0,this[a]=t[a];break;case"margin":case"contentDirection":case"justifyContent":case"alignContent":case"alignItems":case"textAlign":case"textType":i=!0,this[a]=t[a];break;case"fontColor":case"fontOpacity":case"fontSupersampling":case"offset":case"backgroundColor":case"backgroundOpacity":case"backgroundTexture":case"backgroundSize":case"borderRadius":case"borderWidth":case"borderColor":case"borderOpacity":o=!0,this[a]=t[a];break;case"hiddenOverflow":this[a]=t[a];break}t.fontFamily&&qc.setFontFamily(this,t.fontFamily),t.fontTexture&&qc.setFontTexture(this,t.fontTexture),this.parentUI&&this.parentUI.getBestFit()!="none"&&this.parentUI.update(!0,!0,!1),this.update(n,i,o),i&&this.getHighestParent().update(!1,!0,!1)}}setupState(t){this.states[t.state]={attributes:t.attributes,onSet:t.onSet}}setState(t){const n=this.states[t];if(!n){console.warn(`state "${t}" does not exist within this component:`,this.name);return}t!==this.currentState&&(this.currentState=t,n.onSet&&n.onSet(),n.attributes&&this.set(n.attributes))}clear(){this.traverse(t=>{_a.disposeOf(t),t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()})}}}function Tv(h){return class extends h{constructor(t){super(t),this.textUniforms={u_texture:{value:this.getFontTexture()},u_color:{value:this.getFontColor()},u_opacity:{value:this.getFontOpacity()},u_pxRange:{value:this.getFontPXRange()},u_useRGSS:{value:this.getFontSupersampling()}},this.backgroundUniforms={u_texture:{value:this.getBackgroundTexture()},u_color:{value:this.getBackgroundColor()},u_opacity:{value:this.getBackgroundOpacity()},u_backgroundMapping:{value:this.getBackgroundSize()},u_borderWidth:{value:this.getBorderWidth()},u_borderColor:{value:this.getBorderColor()},u_borderRadiusTopLeft:{value:this.getBorderRadius()},u_borderRadiusTopRight:{value:this.getBorderRadius()},u_borderRadiusBottomRight:{value:this.getBorderRadius()},u_borderRadiusBottomLeft:{value:this.getBorderRadius()},u_borderOpacity:{value:this.getBorderOpacity()},u_size:{value:new on.Vector2(1,1)},u_tSize:{value:new on.Vector2(1,1)}}}updateBackgroundMaterial(){this.backgroundUniforms.u_texture.value=this.getBackgroundTexture(),this.backgroundUniforms.u_tSize.value.set(this.backgroundUniforms.u_texture.value.image.width,this.backgroundUniforms.u_texture.value.image.height),this.size&&this.backgroundUniforms.u_size.value.copy(this.size),this.backgroundUniforms.u_texture.value.isDefault?(this.backgroundUniforms.u_color.value=this.getBackgroundColor(),this.backgroundUniforms.u_opacity.value=this.getBackgroundOpacity()):(this.backgroundUniforms.u_color.value=this.backgroundColor||Ki.backgroundWhiteColor,this.backgroundUniforms.u_opacity.value=!this.backgroundOpacity&&this.backgroundOpacity!==0?Ki.backgroundOpaqueOpacity:this.backgroundOpacity),this.backgroundUniforms.u_backgroundMapping.value=(()=>{switch(this.getBackgroundSize()){case"stretch":return 0;case"contain":return 1;case"cover":return 2}})();const t=this.getBorderRadius();this.backgroundUniforms.u_borderWidth.value=this.getBorderWidth(),this.backgroundUniforms.u_borderColor.value=this.getBorderColor(),this.backgroundUniforms.u_borderOpacity.value=this.getBorderOpacity(),Array.isArray(t)?(this.backgroundUniforms.u_borderRadiusTopLeft.value=t[0],this.backgroundUniforms.u_borderRadiusTopRight.value=t[1],this.backgroundUniforms.u_borderRadiusBottomRight.value=t[2],this.backgroundUniforms.u_borderRadiusBottomLeft.value=t[3]):(this.backgroundUniforms.u_borderRadiusTopLeft.value=t,this.backgroundUniforms.u_borderRadiusTopRight.value=t,this.backgroundUniforms.u_borderRadiusBottomRight.value=t,this.backgroundUniforms.u_borderRadiusBottomLeft.value=t)}updateTextMaterial(){this.textUniforms.u_texture.value=this.getFontTexture(),this.textUniforms.u_color.value=this.getFontColor(),this.textUniforms.u_opacity.value=this.getFontOpacity(),this.textUniforms.u_pxRange.value=this.getFontPXRange(),this.textUniforms.u_useRGSS.value=this.getFontSupersampling()}getBackgroundMaterial(){return(!this.backgroundMaterial||!this.backgroundUniforms)&&(this.backgroundMaterial=this._makeBackgroundMaterial()),this.backgroundMaterial}getFontMaterial(){return(!this.fontMaterial||!this.textUniforms)&&(this.fontMaterial=this._makeTextMaterial()),this.fontMaterial}_makeTextMaterial(){return new on.ShaderMaterial({uniforms:this.textUniforms,transparent:!0,clipping:!0,vertexShader:fP,fragmentShader:mP,extensions:{derivatives:!0}})}_makeBackgroundMaterial(){return new on.ShaderMaterial({uniforms:this.backgroundUniforms,transparent:!0,clipping:!0,vertexShader:vP,fragmentShader:gP,extensions:{derivatives:!0}})}updateClippingPlanes(t){const n=t!==void 0?t:this.getClippingPlanes();JSON.stringify(n)!==JSON.stringify(this.clippingPlanes)&&(this.clippingPlanes=n,this.fontMaterial&&(this.fontMaterial.clippingPlanes=this.clippingPlanes),this.backgroundMaterial&&(this.backgroundMaterial.clippingPlanes=this.clippingPlanes))}}}const fP=`
varying vec2 vUv;

#include <clipping_planes_pars_vertex>

void main() {

	vUv = uv;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	gl_Position.z -= 0.00001;

	#include <clipping_planes_vertex>

}
`,mP=`

uniform sampler2D u_texture;
uniform vec3 u_color;
uniform float u_opacity;
uniform float u_pxRange;
uniform bool u_useRGSS;

varying vec2 vUv;

#include <clipping_planes_pars_fragment>

// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field

float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}

float screenPxRange() {
	vec2 unitRange = vec2(u_pxRange)/vec2(textureSize(u_texture, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUv);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}

float tap(vec2 offsetUV) {
	vec3 msd = texture( u_texture, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}

void main() {

	float alpha;

	if ( u_useRGSS ) {

		// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
		// per pixel partial derivatives
		vec2 dx = dFdx(vUv);
		vec2 dy = dFdy(vUv);

		// rotated grid uv offsets
		vec2 uvOffsets = vec2(0.125, 0.375);
		vec2 offsetUV = vec2(0.0, 0.0);

		// supersampled using 2x2 rotated grid
		alpha = 0.0;
		offsetUV.xy = vUv + uvOffsets.x * dx + uvOffsets.y * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv - uvOffsets.x * dx - uvOffsets.y * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv + uvOffsets.y * dx - uvOffsets.x * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv - uvOffsets.y * dx + uvOffsets.x * dy;
		alpha += tap(offsetUV);
		alpha *= 0.25;

	} else {

		alpha = tap( vUv );

	}


	// apply the opacity
	alpha *= u_opacity;

	// this is useful to avoid z-fighting when quads overlap because of kerning
	if ( alpha < 0.02) discard;


	gl_FragColor = vec4( u_color, alpha );

	#include <clipping_planes_fragment>

}
`,vP=`
varying vec2 vUv;

#include <clipping_planes_pars_vertex>

void main() {

	vUv = uv;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,gP=`

uniform sampler2D u_texture;
uniform vec3 u_color;
uniform float u_opacity;

uniform float u_borderRadiusTopLeft;
uniform float u_borderRadiusTopRight;
uniform float u_borderRadiusBottomLeft;
uniform float u_borderRadiusBottomRight;
uniform float u_borderWidth;
uniform vec3 u_borderColor;
uniform float u_borderOpacity;
uniform vec2 u_size;
uniform vec2 u_tSize;
uniform int u_backgroundMapping;

varying vec2 vUv;

#include <clipping_planes_pars_fragment>

float getEdgeDist() {
	vec2 ndc = vec2( vUv.x * 2.0 - 1.0, vUv.y * 2.0 - 1.0 );
	vec2 planeSpaceCoord = vec2( u_size.x * 0.5 * ndc.x, u_size.y * 0.5 * ndc.y );
	vec2 corner = u_size * 0.5;
	vec2 offsetCorner = corner - abs( planeSpaceCoord );
	float innerRadDist = min( offsetCorner.x, offsetCorner.y ) * -1.0;
	if (vUv.x < 0.5 && vUv.y >= 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopLeft, 0.0 ) ) - u_borderRadiusTopLeft;
		float s = step( innerRadDist * -1.0, u_borderRadiusTopLeft );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x >= 0.5 && vUv.y >= 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopRight, 0.0 ) ) - u_borderRadiusTopRight;
		float s = step( innerRadDist * -1.0, u_borderRadiusTopRight );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x >= 0.5 && vUv.y < 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomRight, 0.0 ) ) - u_borderRadiusBottomRight;
		float s = step( innerRadDist * -1.0, u_borderRadiusBottomRight );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x < 0.5 && vUv.y < 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomLeft, 0.0 ) ) - u_borderRadiusBottomLeft;
		float s = step( innerRadDist * -1.0, u_borderRadiusBottomLeft );
		return mix( innerRadDist, roundedDist, s );
	}
}

vec4 sampleTexture() {
	float textureRatio = u_tSize.x / u_tSize.y;
	float panelRatio = u_size.x / u_size.y;
	vec2 uv = vUv;
	if ( u_backgroundMapping == 1 ) { // contain
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ( panelRatio / textureRatio );
			newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ( textureRatio / panelRatio );
			newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
			uv.y = newY;
		}
	} else if ( u_backgroundMapping == 2 ) { // cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ( textureRatio / panelRatio );
			newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ( panelRatio / textureRatio );
			newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
			uv.x = newX;
		}
	}
	return texture2D( u_texture, uv ).rgba;
}

void main() {

	float edgeDist = getEdgeDist();
	float change = fwidth( edgeDist );

	vec4 textureSample = sampleTexture();
	vec3 blendedColor = textureSample.rgb * u_color;

	float alpha = smoothstep( change, 0.0, edgeDist );
	float blendedOpacity = u_opacity * textureSample.a * alpha;

	vec4 frameColor = vec4( blendedColor, blendedOpacity );

	if ( u_borderWidth <= 0.0 ) {
		gl_FragColor = frameColor;
	} else {
		vec4 borderColor = vec4( u_borderColor, u_borderOpacity * alpha );
		float stp = smoothstep( edgeDist + change, edgeDist, u_borderWidth * -1.0 );
		gl_FragColor = mix( frameColor, borderColor, stp );
	}

	#include <clipping_planes_fragment>
}
`;class Q0 extends on.Mesh{constructor(e){const t=new on.PlaneGeometry;super(t,e),this.castShadow=!0,this.receiveShadow=!0,this.name="MeshUI-Frame"}}let Yu=null;function vl(...h){if(!Yu)throw new Error("Cannot use mixins with Base null");let e=Yu;Yu=null;let t=h.length,n;for(;--t>=0;)n=h[t],e=n(e);return e}vl.withBase=h=>(Yu=h,vl);class Dc extends vl.withBase(on.Object3D)(Ev,Z0,Tv,Nd){constructor(e){super(e),this.isBlock=!0,this.size=new on.Vector2(1,1),this.frame=new Q0(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){const e=this.getBestFit();e!="none"&&this.childrenTexts.length?this.calculateBestFit(e):this.childrenTexts.forEach(t=>{t._fitFontSize=void 0})}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(!e||!t){console.warn("Block got no dimension from its parameters or from children parameters");return}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.autoLayout&&this.setPosFromParentRecords(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.parentUI&&(this.position.z=this.getOffset())}updateInner(){this.parentUI&&(this.position.z=this.getOffset()),this.frame&&this.updateBackgroundMaterial()}}function ew(h){return class extends h{constructor(t){super(t),this.isInline=!0}}}function _P(h,e=!1){const t=h[0].index!==null,n=new Set(Object.keys(h[0].attributes)),i=new Set(Object.keys(h[0].morphAttributes)),o={},a={},c=h[0].morphTargetsRelative,u=new on.BufferGeometry;let d=0;for(let v=0;v<h.length;++v){const g=h[v];let b=0;if(t!==(g.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+v+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const y in g.attributes){if(!n.has(y))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+v+'. All geometries must have compatible attributes; make sure "'+y+'" attribute exists among all geometries, or in none of them.'),null;o[y]===void 0&&(o[y]=[]),o[y].push(g.attributes[y]),b++}if(b!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+v+". Make sure all geometries have the same number of attributes."),null;if(c!==g.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+v+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const y in g.morphAttributes){if(!i.has(y))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+v+".  .morphAttributes must be consistent throughout all geometries."),null;a[y]===void 0&&(a[y]=[]),a[y].push(g.morphAttributes[y])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(g.userData),e){let y;if(t)y=g.index.count;else if(g.attributes.position!==void 0)y=g.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+v+". The geometry must have either an index or a position attribute"),null;u.addGroup(d,y,v),d+=y}}if(t){let v=0;const g=[];for(let b=0;b<h.length;++b){const y=h[b].index;for(let S=0;S<y.count;++S)g.push(y.getX(S)+v);v+=h[b].attributes.position.count}u.setIndex(g)}for(const v in o){const g=p_(o[v]);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+v+" attribute."),null;u.setAttribute(v,g)}for(const v in a){const g=a[v][0].length;if(g===0)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[v]=[];for(let b=0;b<g;++b){const y=[];for(let E=0;E<a[v].length;++E)y.push(a[v][E][b]);const S=p_(y);if(!S)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+v+" morphAttribute."),null;u.morphAttributes[v].push(S)}}return u}function p_(h){let e,t,n,i=0;for(let c=0;c<h.length;++c){const u=h[c];if(u.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=u.array.constructor),e!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=u.itemSize),t!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=u.normalized),n!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=u.array.length}const o=new e(i);let a=0;for(let c=0;c<h.length;++c)o.set(h[c].array,a),a+=h[c].array.length;return new on.BufferAttribute(o,t,n)}class bP extends on.PlaneGeometry{constructor(e,t){const n=e.glyph,i=e.fontSize;super(i,i),n.match(/\s/g)===null?(t.info.charset.indexOf(n)===-1&&console.error(`The character '${n}' is not included in the font characters set.`),this.mapUVs(t,n),this.transformGeometry(t,i,n,e)):(this.nullifyUVs(),this.scale(0,0,1),this.translate(0,i/2,0))}mapUVs(e,t){const n=e.chars.find(v=>v.char===t),i=e.common,o=n.x/i.scaleW,a=(n.x+n.width)/i.scaleW,c=1-(n.y+n.height)/i.scaleH,u=1-n.y/i.scaleH,d=this.attributes.uv;for(let v=0;v<d.count;v++){let g=d.getX(v),b=d.getY(v);[g,b]=(()=>{switch(v){case 0:return[o,u];case 1:return[a,u];case 2:return[o,c];case 3:return[a,c]}})(),d.setXY(v,g,b)}}nullifyUVs(){const e=this.attributes.uv;for(let t=0;t<e.count;t++)e.setXY(t,0,0)}transformGeometry(e,t,n,i){const o=e.chars.find(d=>d.char===n),a=e.common,c=o.height/a.lineHeight,u=o.width*c/o.height;this.scale(u,c,1),this.translate(i.width/2,i.height/2-i.anchor,0)}}function wP(h){const e=h.font,t=h.fontSize,n=h.glyph,i=t/e.info.size,o=e.chars.find(g=>g.char===n);let a=o?o.width*i:t/3,c=o?o.height*i:0;a===0&&(a=o?o.xadvance*i:t),c===0&&(c=t*.7),n===`
`&&(a=0);const u=o?o.xadvance*i:a,d=o?o.xoffset*i:0,v=o?(o.yoffset+o.height-e.common.base)*t/e.common.lineHeight:0;return{width:a,height:c,anchor:v,xadvance:u,xoffset:d}}function xP(h,e){const t=h._kernings;return t[e]?t[e]:0}function yP(){const h=[];this.inlines.forEach((n,i)=>{h[i]=new bP(n,this.getFontFamily()),h[i].translate(n.offsetX,n.offsetY,0)});const e=_P(h);return new on.Mesh(e,this.getFontMaterial())}const kf={getGlyphDimensions:wP,getGlyphPairKerning:xP,buildText:yP};function CP(h){return class extends h{createText(){const t=this,n=(()=>{switch(this.getTextType()){case"MSDF":return kf.buildText.call(this);default:console.warn(`'${this.getTextType()}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}})();return n.renderOrder=1/0,n.onBeforeRender=function(){t.updateClippingPlanes&&t.updateClippingPlanes()},n}getGlyphDimensions(t){switch(t.textType){case"MSDF":return kf.getGlyphDimensions(t);default:console.warn(`'${t.textType}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}}getGlyphPairKerning(t,n,i){switch(t){case"MSDF":return kf.getGlyphPairKerning(n,i);default:console.warn(`'${t}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}}}}function tw(h){h.children.forEach(e=>{e.children.length>0&&tw(e),h.remove(e),_a.disposeOf(e),e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),h.children=[]}const MP=tw;class Lv extends vl.withBase(on.Object3D)(ew,CP,Tv,Nd){constructor(e){super(e),this.isText=!0,this.set(e)}parseParams(){this.calculateInlines(this._fitFontSize||this.getFontSize())}updateLayout(){MP(this),this.inlines&&(this.textContent=this.createText(),this.updateTextMaterial(),this.add(this.textContent)),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.textContent&&this.updateTextMaterial()}calculateInlines(e){const t=this.content,n=this.getFontFamily(),i=this.getBreakOn(),o=this.getTextType(),a=this.getWhiteSpace();if(!n||typeof n=="string"){qc.getFontOf(this)||console.warn("no font was found");return}if(!this.content){this.inlines=null;return}if(!o){console.error(`You must provide a 'textType' attribute so three-mesh-ui knows how to render your text.
 See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);return}const c=U0(t,a),u=Array.from?Array.from(c):String(c).split(""),d=e/n.info.size,v=n.common.lineHeight*d,g=n.common.base*d,b=u.map(y=>{const S=this.getGlyphDimensions({textType:o,glyph:y,font:n,fontSize:e});let E=null;return a!==mh&&(i.includes(y)||y.match(/\s/g))&&(E="possible"),y.match(/\n/g)&&(E=H0(a)),{height:S.height,width:S.width,anchor:S.anchor,xadvance:S.xadvance,xoffset:S.xoffset,lineBreak:E,glyph:y,fontSize:e,lineHeight:v,lineBase:g}});if(this.getFontKerning()!=="none")for(let y=1;y<b.length;y++){const S=b[y],E=b[y-1].glyph+b[y].glyph,M=this.getGlyphPairKerning(o,n,E);S.kerning=M*(e/n.info.size)}this.inlines=b}}class kv extends vl.withBase(on.Object3D)(ew,Ev,Z0,Tv,Nd){constructor(e){super(e),this.isInlineBlock=!0,this.size=new on.Vector2(1,1),this.frame=new Q0(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){this.width||console.warn("inlineBlock has no width. Set to 0.3 by default"),this.height||console.warn("inlineBlock has no height. Set to 0.3 by default"),this.inlines=[{height:this.height||.3,width:this.width||.3,anchor:0,lineBreak:"possible"}]}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(this.inlines){const n=this.inlines[0];this.position.set(n.width/2,n.height/2,0),this.position.x+=n.offsetX,this.position.y+=n.offsetY}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.frame&&this.updateBackgroundMaterial()}}const To={fr:[[[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]}],[{width:.2,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],eng:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],ru:[[[{width:1/12,chars:[{lowerCase:"й",upperCase:"Й"},{lowerCase:"q",upperCase:"Q"}]},{width:1/12,chars:[{lowerCase:"ц",upperCase:"Ц"},{lowerCase:"w",upperCase:"W"}]},{width:1/12,chars:[{lowerCase:"у",upperCase:"У"},{lowerCase:"e",upperCase:"E"}]},{width:1/12,chars:[{lowerCase:"к",upperCase:"К"},{lowerCase:"r",upperCase:"R"}]},{width:1/12,chars:[{lowerCase:"е",upperCase:"Е"},{lowerCase:"t",upperCase:"T"}]},{width:1/12,chars:[{lowerCase:"н",upperCase:"Н"},{lowerCase:"y",upperCase:"Y"}]},{width:1/12,chars:[{lowerCase:"г",upperCase:"Г"},{lowerCase:"u",upperCase:"U"}]},{width:1/12,chars:[{lowerCase:"ш",upperCase:"Ш"},{lowerCase:"i",upperCase:"I"}]},{width:1/12,chars:[{lowerCase:"щ",upperCase:"Щ"},{lowerCase:"o",upperCase:"O"}]},{width:1/12,chars:[{lowerCase:"з",upperCase:"З"},{lowerCase:"p",upperCase:"P"}]},{width:1/12,chars:[{lowerCase:"х",upperCase:"Х"},{lowerCase:"{",upperCase:"["}]},{width:1/12,chars:[{lowerCase:"ъ",upperCase:"Ъ"},{lowerCase:"}",upperCase:"]"}]}],[{width:1/12,chars:[{lowerCase:"ф",upperCase:"Ф"},{lowerCase:"a",upperCase:"A"}]},{width:1/12,chars:[{lowerCase:"ы",upperCase:"Ы"},{lowerCase:"s",upperCase:"S"}]},{width:1/12,chars:[{lowerCase:"в",upperCase:"В"},{lowerCase:"d",upperCase:"D"}]},{width:1/12,chars:[{lowerCase:"а",upperCase:"А"},{lowerCase:"f",upperCase:"F"}]},{width:1/12,chars:[{lowerCase:"п",upperCase:"П"},{lowerCase:"g",upperCase:"G"}]},{width:1/12,chars:[{lowerCase:"р",upperCase:"Р"},{lowerCase:"h",upperCase:"H"}]},{width:1/12,chars:[{lowerCase:"о",upperCase:"О"},{lowerCase:"j",upperCase:"J"}]},{width:1/12,chars:[{lowerCase:"л",upperCase:"Л"},{lowerCase:"k",upperCase:"K"}]},{width:1/12,chars:[{lowerCase:"д",upperCase:"Д"},{lowerCase:"l",upperCase:"L"}]},{width:1/12,chars:[{lowerCase:"ж",upperCase:"Ж"},{lowerCase:":",upperCase:";"}]},{width:1/12,chars:[{lowerCase:"э",upperCase:"Э"},{lowerCase:'"',upperCase:"'"}]},{width:1/12,chars:[{lowerCase:"ё",upperCase:"Ё"},{lowerCase:"|",upperCase:"\\"}]}],[{width:1.5/12,command:"shift",chars:[{icon:"shift"}]},{width:1/12,chars:[{lowerCase:"я",upperCase:"Я"},{lowerCase:"z",upperCase:"Z"}]},{width:1/12,chars:[{lowerCase:"ч",upperCase:"Ч"},{lowerCase:"x",upperCase:"X"}]},{width:1/12,chars:[{lowerCase:"с",upperCase:"С"},{lowerCase:"c",upperCase:"C"}]},{width:1/12,chars:[{lowerCase:"м",upperCase:"М"},{lowerCase:"v",upperCase:"V"}]},{width:1/12,chars:[{lowerCase:"и",upperCase:"И"},{lowerCase:"b",upperCase:"B"}]},{width:1/12,chars:[{lowerCase:"т",upperCase:"Т"},{lowerCase:"n",upperCase:"N"}]},{width:1/12,chars:[{lowerCase:"ь",upperCase:"Ь"},{lowerCase:"m",upperCase:"M"}]},{width:1/12,chars:[{lowerCase:"б",upperCase:"Б"},{lowerCase:",",upperCase:""}]},{width:1/12,chars:[{lowerCase:"ю",upperCase:"Ю"},{lowerCase:".",upperCase:""}]},{width:1.5/12,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.3,command:"switch",chars:[{lowerCase:"АБВ"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],de:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"ü",upperCase:"Ü"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"ö",upperCase:"Ö"}]},{width:1/11,chars:[{lowerCase:"ä",upperCase:"Ä"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],es:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"ñ",upperCase:"Ñ"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],el:[[[{width:.1,chars:[{lowerCase:";",upperCase:":"},{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"ς",upperCase:"ς"},{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"ε",upperCase:"Ε"},{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"ρ",upperCase:"Ρ"},{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"τ",upperCase:"Τ"},{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"υ",upperCase:"Υ"},{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"θ",upperCase:"Θ"},{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"ι",upperCase:"Ι"},{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"ο",upperCase:"Ο"},{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"π",upperCase:"Π"},{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"α",upperCase:"Α"},{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"σ",upperCase:"Σ"},{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"δ",upperCase:"Δ"},{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"φ",upperCase:"Φ"},{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"γ",upperCase:"Γ"},{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"η",upperCase:"Η"},{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"ξ",upperCase:"Ξ"},{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"κ",upperCase:"Κ"},{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"λ",upperCase:"Λ"},{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"ζ",upperCase:"Ζ"},{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"χ",upperCase:"Χ"},{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"ψ",upperCase:"Ψ"},{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"ω",upperCase:"Ω"},{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"β",upperCase:"Β"},{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"ν",upperCase:"Ν"},{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"μ",upperCase:"Μ"},{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],nord:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"å",upperCase:"Å"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"æ",upperCase:"Æ"}]},{width:1/11,chars:[{lowerCase:"ø",upperCase:"Ø"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]]},EP=new on.TextureLoader;class nw extends vl.withBase(on.Object3D)(Ev,Nd){constructor(e){e||(e={}),e.width||(e.width=1),e.height||(e.height=.4),e.margin||(e.margin=.003),e.padding||(e.padding=.01),super(e),this.currentPanel=0,this.isLowerCase=!0,this.charsetCount=1;let t;if(e.language||navigator.language)switch(e.language||navigator.language){case"fr":case"fr-CH":case"fr-CA":t=To.fr;break;case"ru":this.charsetCount=2,t=To.ru;break;case"de":case"de-DE":case"de-AT":case"de-LI":case"de-CH":t=To.de;break;case"es":case"es-419":case"es-AR":case"es-CL":case"es-CO":case"es-ES":case"es-CR":case"es-US":case"es-HN":case"es-MX":case"es-PE":case"es-UY":case"es-VE":t=To.es;break;case"el":this.charsetCount=2,t=To.el;break;case"nord":t=To.nord;break;default:t=To.eng;break}else t=To.eng;this.keys=[],this.panels=t.map(n=>{const i=e.height/n.length-e.margin*2,o=new Dc({width:e.width+e.padding*2,height:e.height+e.padding*2,offset:0,padding:e.padding,fontFamily:e.fontFamily,fontTexture:e.fontTexture,backgroundColor:e.backgroundColor,backgroundOpacity:e.backgroundOpacity});return o.charset=0,o.add(...n.map(a=>{const c=new Dc({width:e.width,height:i,margin:e.margin,contentDirection:"row",justifyContent:"center"});c.frame.visible=!1;const u=[];return a.forEach(d=>{const v=new Dc({width:e.width*d.width-e.margin*2,height:i,margin:e.margin,justifyContent:"center",offset:0}),g=d.chars[o.charset].lowerCase||d.chars[o.charset].icon||"undif";if(g==="enter"&&e.enterTexture||g==="shift"&&e.shiftTexture||g==="backspace"&&e.backspaceTexture){const b=(()=>{switch(g){case"backspace":return e.backspaceTexture;case"enter":return e.enterTexture;case"shift":return e.shiftTexture;default:console.warn("There is no icon image for this key")}})();EP.load(b,y=>{v.add(new kv({width:v.width*.65,height:v.height*.65,backgroundSize:"contain",backgroundTexture:y}))})}else v.add(new Lv({content:g,offset:0}));v.type="Key",v.info=d,v.info.input=g,v.panel=o,u.push(v),this.keys.push(v)}),c.add(...u),c})),o}),this.add(this.panels[0]),this.set(e)}setNextPanel(){this.panels.forEach(e=>{this.remove(e)}),this.currentPanel=(this.currentPanel+1)%this.panels.length,this.add(this.panels[this.currentPanel]),this.update(!0,!0,!0)}setNextCharset(){this.panels[this.currentPanel].charset=(this.panels[this.currentPanel].charset+1)%this.charsetCount,this.keys.forEach(e=>{if(!this.panels[this.currentPanel].getObjectById(e.id))return;const n=e.info.chars[e.panel.charset]||e.info.chars[0],i=this.isLowerCase||!n.upperCase?n.lowerCase:n.upperCase;if(!e.childrenTexts.length)return;const o=e.childrenTexts[0];e.info.input=i,o.set({content:i}),o.update(!0,!0,!0)})}toggleCase(){this.isLowerCase=!this.isLowerCase,this.keys.forEach(e=>{const t=e.info.chars[e.panel.charset]||e.info.chars[0],n=this.isLowerCase||!t.upperCase?t.lowerCase:t.upperCase;if(!e.childrenTexts.length)return;const i=e.childrenTexts[0];e.info.input=n,i.set({content:n}),i.update(!0,!0,!0)})}parseParams(){}updateLayout(){}updateInner(){}}const iw=()=>_a.update(),sw={Block:Dc,Text:Lv,InlineBlock:kv,Keyboard:nw,FontLibrary:qc,update:iw,TextAlign:Rd,Whitespace:kd,JustifyContent:Ld,AlignItems:Td,ContentDirection:Pd};typeof global<"u"&&(global.ThreeMeshUI=sw);const SP=sw;zs.g1;zs.gO;zs.km;zs.zV;zs.ol;zs.uM;zs.N1;zs.xv;zs.PH;zs.UH;zs.ZP;var AP=zs.Vx;const El=new Km,f_=window.innerWidth/window.innerHeight,La=new Ea(2*f_/-2,2*f_/2,2/2,2/-2,.1,100);La.userData.size=2;La.name="defaultCamera";const rw=new Ls;rw.add(La);El.add(rw);new It;new X;const PP=(h=16774582,e=.5)=>new ov(h,e),ow=(h=15712368,e=2.5,t=2,n=50)=>{const i=new fh(h,e);return i.castShadow=!0,i.shadow.camera.near=t,i.shadow.camera.far=n,i.shadow.mapSize.width=2048,i.shadow.mapSize.height=2048,i},TP=(h=15712368,e=2,t=2,n=50)=>{const i=new ph(h,e);return i.castShadow=!0,i.shadow.camera.near=t,i.shadow.camera.far=n,i.shadow.mapSize.width=2048,i.shadow.mapSize.height=2048,i.shadow.radius=8,i.shadow.bias=-1e-4,i},LP=TP();LP.castShadow=!0;const kP=ow();kP.castShadow=!0;const m_=Math.min(window.devicePixelRatio,1.5),RP=()=>{const h=bi.domElement,e=h.clientWidth*m_|0,t=h.clientHeight*m_|0;if(h.width!==e||h.height!==t){const i=h.clientWidth/h.clientHeight;{const o=La;o.left=o.userData.size*i/-2,o.right=o.userData.size*i/2,o.top=o.userData.size/2,o.bottom=o.userData.size/-2,o.updateProjectionMatrix()}bi.xr.isPresenting||bi.setSize(e,t,!1)}},Em=[],IP=(h,e)=>{RP(),qA();for(let t=0,n=Em.length;t<n;t+=1)Em[t](h,e);bi.render(El,La)},DP=()=>{bi.setAnimationLoop(IP)},zP=h=>{Em.push(h)};zP(()=>{AP()});const Jn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function aw(h){const e=await fetch(h);if(e.ok)return e.json();throw new Error(e.statusText)}async function VP(h){if(!h)throw new Error("No basePath supplied");return await aw(`${h}/profilesList.json`)}async function NP(h,e,t=null,n=!0){if(!h)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const i=await VP(e);let o;if(h.profiles.some(u=>{const d=i[u];return d&&(o={profileId:u,profilePath:`${e}/${d.path}`,deprecated:!!d.deprecated}),!!o}),!o){if(!t)throw new Error("No matching profile name found");const u=i[t];if(!u)throw new Error(`No matching profile name found and default profile "${t}" missing.`);o={profileId:t,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}}const a=await aw(o.profilePath);let c;if(n){let u;if(h.handedness==="any"?u=a.layouts[Object.keys(a.layouts)[0]]:u=a.layouts[h.handedness],!u)throw new Error(`No matching handedness, ${h.handedness}, in profile ${o.profileId}`);u.assetPath&&(c=o.profilePath.replace("profile.json",u.assetPath))}return{profile:a,assetPath:c}}const OP={xAxis:0,yAxis:0,button:0,state:Jn.ComponentState.DEFAULT};function FP(h=0,e=0){let t=h,n=e;if(Math.sqrt(h*h+e*e)>1){const a=Math.atan2(e,h);t=Math.cos(a),n=Math.sin(a)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}class BP{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Jn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(OP)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:i}){const{normalizedXAxis:o,normalizedYAxis:a}=FP(e,t);switch(this.componentProperty){case Jn.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?o:.5;break;case Jn.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?a:.5;break;case Jn.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case Jn.ComponentProperty.STATE:this.valueNodeProperty===Jn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class UP{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{const i=new BP(t.visualResponses[n]);this.visualResponses[n]=i}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Jn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Jn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Jn.ComponentState.PRESSED:(t.touched||this.values.button>Jn.ButtonTouchThreshold)&&(this.values.state=Jn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Jn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Jn.AxisTouchThreshold&&(this.values.state=Jn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Jn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Jn.AxisTouchThreshold&&(this.values.state=Jn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class HP{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{const o=this.layoutDescription.components[i];this.components[i]=new UP(i,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const GP="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",WP="generic-trigger";class jP extends Jt{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(n=>{const{valueNode:i,minNode:o,maxNode:a,value:c,valueNodeProperty:u}=n;i&&(u===Jn.VisualResponseProperty.VISIBILITY?i.visible=c:u===Jn.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(o.quaternion,a.quaternion,c),i.position.lerpVectors(o.position,a.position,c)))})}))}}function KP(h,e){Object.values(h.components).forEach(t=>{const{type:n,touchPointNodeName:i,visualResponses:o}=t;if(n===Jn.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const a=new Go(.001),c=new wi({color:255}),u=new Bn(a,c);t.touchPointNode.add(u)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(o).forEach(a=>{const{valueNodeName:c,minNodeName:u,maxNodeName:d,valueNodeProperty:v}=a;if(v===Jn.VisualResponseProperty.TRANSFORM){if(a.minNode=e.getObjectByName(u),a.maxNode=e.getObjectByName(d),!a.minNode){console.warn(`Could not find ${u} in the model`);return}if(!a.maxNode){console.warn(`Could not find ${d} in the model`);return}}a.valueNode=e.getObjectByName(c),a.valueNode||console.warn(`Could not find ${c} in the model`)})})}function v_(h,e){KP(h.motionController,e),h.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=h.envMap,t.material.needsUpdate=!0)}),h.add(e)}class qP{constructor(e=null){this.gltfLoader=e,this.path=GP,this._assetCache={},this.gltfLoader||(this.gltfLoader=new fv)}createControllerModel(e){const t=new jP;let n=null;return e.addEventListener("connected",i=>{const o=i.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||NP(o,this.path,WP).then(({profile:a,assetPath:c})=>{t.motionController=new HP(o,a,c);const u=this._assetCache[t.motionController.assetUrl];if(u)n=u.scene.clone(),v_(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,d=>{this._assetCache[t.motionController.assetUrl]=d,n=d.scene.clone(),v_(t,n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(a=>{console.warn(a)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}}new A0;new It;new X;const Rv=[],XP=new qP;let nd=-1;bi.xr.addEventListener("sessionstart",()=>{bi.xr.getReferenceSpace()});const $P=`
uniform float time;
varying vec2 vUv;
void main(){
  float sinx = sin(time) / 8. + 0.3;
  float strength = 1.0 - step(0.01, abs(distance(vUv, vec2(0.5)) - sinx));
  gl_FragColor = vec4(strength);
}`,YP=`
varying vec2 vUv;
void main(){
  vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,ZP=new co(.5,.5).rotateX(-Math.PI/2),Od=new Ds({fragmentShader:$P,uniforms:{time:{value:0}},vertexShader:YP});Od.polygonOffset=!0;Od.polygonOffsetFactor=-1;Od.transparent=!0;const lw=new Bn(ZP,Od);lw.name="Teleport Marker";lw.visible=!1;const JP=h=>{nd=h.target.userData.index,Rv[nd].visible=!0},QP=h=>{const{index:e}=h.target.userData;nd===e&&(nd=-1),Rv[e].visible=!1};for(let h=0;h<2;h+=1){const e=new jt,t=new Fi({blending:Zu,transparent:!0,vertexColors:!0});e.setAttribute("position",new bt([0,0,0,0,0,-1],3)),e.setAttribute("color",new bt([.5,.5,.5,0,0,0],3));const n=new vr(e,t);n.name=`XR Controller ${h} Ray Line`,n.visible=!1,Rv.push(n);const i=bi.xr.getController(h);i.addEventListener("selectstart",JP),i.addEventListener("selectend",QP),i.addEventListener("connected",()=>i.add(n)),i.addEventListener("disconnected",()=>i.remove(i.children[0])),i.name=`XR Controller ${h+1}`,i.userData.index=h;const o=bi.xr.getControllerGrip(h);o.add(XP.createControllerModel(o)),o.name=`XR Controller Grip ${h+1}`}const eT=.5*(Math.sqrt(3)-1),Mc=(3-Math.sqrt(3))/6,g_=h=>Math.floor(h)|0,__=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Iv(h=Math.random){const e=tT(h),t=new Float64Array(e).map(i=>__[i%12*2]),n=new Float64Array(e).map(i=>__[i%12*2+1]);return function(o,a){let c=0,u=0,d=0;const v=(o+a)*eT,g=g_(o+v),b=g_(a+v),y=(g+b)*Mc,S=g-y,E=b-y,M=o-S,L=a-E;let R,z;M>L?(R=1,z=0):(R=0,z=1);const V=M-R+Mc,H=L-z+Mc,B=M-1+2*Mc,j=L-1+2*Mc,F=g&255,W=b&255;let Z=.5-M*M-L*L;if(Z>=0){const oe=F+e[W],ne=t[oe],ce=n[oe];Z*=Z,c=Z*Z*(ne*M+ce*L)}let se=.5-V*V-H*H;if(se>=0){const oe=F+R+e[W+z],ne=t[oe],ce=n[oe];se*=se,u=se*se*(ne*V+ce*H)}let we=.5-B*B-j*j;if(we>=0){const oe=F+1+e[W+1],ne=t[oe],ce=n[oe];we*=we,d=we*we*(ne*B+ce*j)}return 70*(c+u+d)}}function tT(h){const t=new Uint8Array(512);for(let n=0;n<512/2;n++)t[n]=n;for(let n=0;n<512/2-1;n++){const i=n+~~(h()*(256-n)),o=t[n];t[n]=t[i],t[i]=o}for(let n=256;n<512;n++)t[n]=t[n-256];return t}Iv();Iv();Iv();new Ho;new X(0,0,-1),new X(0,1,0),new X(0,0,0);`${Tt.logdepthbuf_pars_vertex}${Tt.fog_pars_vertex}${Tt.logdepthbuf_vertex}`,Tt.fog_vertex,`${Tt.fog_vertex}`;`${Tt.fog_pars_fragment}${Tt.logdepthbuf_pars_fragment}${Tt.logdepthbuf_fragment}${Tt.fog_fragment}`;new De;new X;var vh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Sm={exports:{}};/*! Tweakpane 3.1.9 (c) 2016 cocopon, licensed under the MIT license. */(function(h,e){(function(t,n){n(e)})(vh,function(t){class n{constructor(r){const[s,l]=r.split("-"),p=s.split(".");this.major=parseInt(p[0],10),this.minor=parseInt(p[1],10),this.patch=parseInt(p[2],10),this.prerelease=l??null}toString(){const r=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[r,this.prerelease].join("-"):r}}class i{constructor(r){this.controller_=r}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(r){this.controller_.viewProps.set("disabled",r)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(r){this.controller_.viewProps.set("hidden",r)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class o{constructor(r){this.target=r}}class a extends o{constructor(r,s,l,p){super(r),this.value=s,this.presetKey=l,this.last=p??!0}}class c extends o{constructor(r,s,l){super(r),this.value=s,this.presetKey=l}}class u extends o{constructor(r,s){super(r),this.expanded=s}}class d extends o{constructor(r,s){super(r),this.index=s}}function v(m){return m==null}function g(m,r){if(m.length!==r.length)return!1;for(let s=0;s<m.length;s++)if(m[s]!==r[s])return!1;return!0}function b(m,r){let s=m;do{const l=Object.getOwnPropertyDescriptor(s,r);if(l&&(l.set!==void 0||l.writable===!0))return!0;s=Object.getPrototypeOf(s)}while(s!==null);return!1}const y={alreadydisposed:()=>"View has been already disposed",invalidparams:m=>`Invalid parameters for '${m.name}'`,nomatchingcontroller:m=>`No matching controller for '${m.key}'`,nomatchingview:m=>`No matching view for '${JSON.stringify(m.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:m=>`Property '${m.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class S{static alreadyDisposed(){return new S({type:"alreadydisposed"})}static notBindable(){return new S({type:"notbindable"})}static propertyNotFound(r){return new S({type:"propertynotfound",context:{name:r}})}static shouldNeverHappen(){return new S({type:"shouldneverhappen"})}constructor(r){var s;this.message=(s=y[r.type](r.context))!==null&&s!==void 0?s:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=r.type}}class E{constructor(r,s,l){this.obj_=r,this.key_=s,this.presetKey_=l??s}static isBindable(r){return!(r===null||typeof r!="object"&&typeof r!="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(r){this.obj_[this.key_]=r}writeProperty(r,s){const l=this.read();if(!E.isBindable(l))throw S.notBindable();if(!(r in l))throw S.propertyNotFound(r);l[r]=s}}class M extends i{get label(){return this.controller_.props.get("label")}set label(r){this.controller_.props.set("label",r)}get title(){var r;return(r=this.controller_.valueController.props.get("title"))!==null&&r!==void 0?r:""}set title(r){this.controller_.valueController.props.set("title",r)}on(r,s){const l=s.bind(this);return this.controller_.valueController.emitter.on(r,()=>{l(new o(this))}),this}}class L{constructor(){this.observers_={}}on(r,s){let l=this.observers_[r];return l||(l=this.observers_[r]=[]),l.push({handler:s}),this}off(r,s){const l=this.observers_[r];return l&&(this.observers_[r]=l.filter(p=>p.handler!==s)),this}emit(r,s){const l=this.observers_[r];l&&l.forEach(p=>{p.handler(s)})}}const R="tp";function z(m){return(r,s)=>[R,"-",m,"v",r?`_${r}`:"",s?`-${s}`:""].join("")}function V(m,r){return s=>r(m(s))}function H(m){return m.rawValue}function B(m,r){m.emitter.on("change",V(H,r)),r(m.rawValue)}function j(m,r,s){B(m.value(r),s)}function F(m,r,s){s?m.classList.add(r):m.classList.remove(r)}function W(m,r){return s=>{F(m,r,s)}}function Z(m,r){B(m,s=>{r.textContent=s??""})}const se=z("btn");class we{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(se()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("button");l.classList.add(se("b")),s.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l;const p=r.createElement("div");p.classList.add(se("t")),Z(s.props.value("title"),p),this.buttonElement.appendChild(p)}}class oe{constructor(r,s){this.emitter=new L,this.onClick_=this.onClick_.bind(this),this.props=s.props,this.viewProps=s.viewProps,this.view=new we(r,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ne{constructor(r,s){var l;this.constraint_=s?.constraint,this.equals_=(l=s?.equals)!==null&&l!==void 0?l:(p,P)=>p===P,this.emitter=new L,this.rawValue_=r}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(r){this.setRawValue(r,{forceEmit:!1,last:!0})}setRawValue(r,s){const l=s??{forceEmit:!1,last:!0},p=this.constraint_?this.constraint_.constrain(r):r,P=this.rawValue_;this.equals_(P,p)&&!l.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=p,this.emitter.emit("change",{options:l,previousRawValue:P,rawValue:p,sender:this}))}}class ce{constructor(r){this.emitter=new L,this.value_=r}get rawValue(){return this.value_}set rawValue(r){this.setRawValue(r,{forceEmit:!1,last:!0})}setRawValue(r,s){const l=s??{forceEmit:!1,last:!0},p=this.value_;p===r&&!l.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=r,this.emitter.emit("change",{options:l,previousRawValue:p,rawValue:this.value_,sender:this}))}}function ve(m,r){const s=r?.constraint,l=r?.equals;return!s&&!l?new ce(m):new ne(m,r)}class de{constructor(r){this.emitter=new L,this.valMap_=r;for(const s in this.valMap_)this.valMap_[s].emitter.on("change",()=>{this.emitter.emit("change",{key:s,sender:this})})}static createCore(r){return Object.keys(r).reduce((s,l)=>Object.assign(s,{[l]:ve(r[l])}),{})}static fromObject(r){const s=this.createCore(r);return new de(s)}get(r){return this.valMap_[r].rawValue}set(r,s){this.valMap_[r].rawValue=s}value(r){return this.valMap_[r]}}function he(m,r){return Object.keys(r).reduce((l,p)=>{if(l===void 0)return;const P=r[p],U=P(m[p]);return U.succeeded?Object.assign(Object.assign({},l),{[p]:U.value}):void 0},{})}function ue(m,r){return m.reduce((s,l)=>{if(s===void 0)return;const p=r(l);if(!(!p.succeeded||p.value===void 0))return[...s,p.value]},[])}function me(m){return m===null?!1:typeof m=="object"}function ze(m){return r=>s=>{if(!r&&s===void 0)return{succeeded:!1,value:void 0};if(r&&s===void 0)return{succeeded:!0,value:void 0};const l=m(s);return l!==void 0?{succeeded:!0,value:l}:{succeeded:!1,value:void 0}}}function Te(m){return{custom:r=>ze(r)(m),boolean:ze(r=>typeof r=="boolean"?r:void 0)(m),number:ze(r=>typeof r=="number"?r:void 0)(m),string:ze(r=>typeof r=="string"?r:void 0)(m),function:ze(r=>typeof r=="function"?r:void 0)(m),constant:r=>ze(s=>s===r?r:void 0)(m),raw:ze(r=>r)(m),object:r=>ze(s=>{if(me(s))return he(s,r)})(m),array:r=>ze(s=>{if(Array.isArray(s))return ue(s,r)})(m)}}const Re={optional:Te(!0),required:Te(!1)};function Ie(m,r){const s=Re.required.object(r)(m);return s.succeeded?s.value:void 0}function rt(m){console.warn([`Missing '${m.key}' of ${m.target} in ${m.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function Ae(m){return m&&m.parentElement&&m.parentElement.removeChild(m),null}class pt{constructor(r){this.value_=r}static create(r){return[new pt(r),(s,l)=>{r.setRawValue(s,l)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const nt=z("");function Et(m,r){return W(m,nt(void 0,r))}class He extends de{constructor(r){var s;super(r),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=pt.create(ve(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(s=this.get("parent"))===null||s===void 0||s.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(r){var s,l,p;const P=r??{};return new He(de.createCore({disabled:(s=P.disabled)!==null&&s!==void 0?s:!1,disposed:!1,hidden:(l=P.hidden)!==null&&l!==void 0?l:!1,parent:(p=P.parent)!==null&&p!==void 0?p:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(r){B(this.globalDisabled_,Et(r,"disabled")),j(this,"hidden",Et(r,"hidden"))}bindDisabled(r){B(this.globalDisabled_,s=>{r.disabled=s})}bindTabIndex(r){B(this.globalDisabled_,s=>{r.tabIndex=s?-1:0})}handleDispose(r){this.value("disposed").emitter.on("change",s=>{s&&r()})}getGlobalDisabled_(){const r=this.get("parent");return(r?r.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(r){var s;r.previousRawValue?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(s=this.get("parent"))===null||s===void 0||s.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function mt(){return["veryfirst","first","last","verylast"]}const ke=z(""),xe={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Ve{constructor(r){this.parent_=null,this.blade=r.blade,this.view=r.view,this.viewProps=r.viewProps;const s=this.view.element;this.blade.value("positions").emitter.on("change",()=>{mt().forEach(l=>{s.classList.remove(ke(void 0,xe[l]))}),this.blade.get("positions").forEach(l=>{s.classList.add(ke(void 0,xe[l]))})}),this.viewProps.handleDispose(()=>{Ae(s)})}get parent(){return this.parent_}set parent(r){if(this.parent_=r,!("parent"in this.viewProps.valMap_)){rt({key:"parent",target:He.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const Ye="http://www.w3.org/2000/svg";function Oe(m){m.offsetHeight}function St(m,r){const s=m.style.transition;m.style.transition="none",r(),m.style.transition=s}function vt(m){return m.ontouchstart!==void 0}function dt(){return globalThis}function en(){return dt().document}function Xt(m){const r=m.ownerDocument.defaultView;return r&&"document"in r?m.getContext("2d",{willReadFrequently:!0}):null}const Q={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function q(m,r){const s=m.createElementNS(Ye,"svg");return s.innerHTML=Q[r],s}function ge(m,r,s){m.insertBefore(r,m.children[s])}function Ne(m){m.parentElement&&m.parentElement.removeChild(m)}function je(m){for(;m.children.length>0;)m.removeChild(m.children[0])}function Ze(m){for(;m.childNodes.length>0;)m.removeChild(m.childNodes[0])}function wt(m){return m.relatedTarget?m.relatedTarget:"explicitOriginalTarget"in m?m.explicitOriginalTarget:null}const qe=z("lbl");function Pe(m,r){const s=m.createDocumentFragment();return r.split(`
`).map(l=>m.createTextNode(l)).forEach((l,p)=>{p>0&&s.appendChild(m.createElement("br")),s.appendChild(l)}),s}class ct{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(qe()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("div");l.classList.add(qe("l")),j(s.props,"label",P=>{v(P)?this.element.classList.add(qe(void 0,"nol")):(this.element.classList.remove(qe(void 0,"nol")),Ze(l),l.appendChild(Pe(r,P)))}),this.element.appendChild(l),this.labelElement=l;const p=r.createElement("div");p.classList.add(qe("v")),this.element.appendChild(p),this.valueElement=p}}class ft extends Ve{constructor(r,s){const l=s.valueController.viewProps;super(Object.assign(Object.assign({},s),{view:new ct(r,{props:s.props,viewProps:l}),viewProps:l})),this.props=s.props,this.valueController=s.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const lt={id:"button",type:"blade",accept(m){const r=Re,s=Ie(m,{title:r.required.string,view:r.required.constant("button"),label:r.optional.string});return s?{params:s}:null},controller(m){return new ft(m.document,{blade:m.blade,props:de.fromObject({label:m.params.label}),valueController:new oe(m.document,{props:de.fromObject({title:m.params.title}),viewProps:m.viewProps})})},api(m){return!(m.controller instanceof ft)||!(m.controller.valueController instanceof oe)?null:new M(m.controller)}};class gt extends Ve{constructor(r){super(r),this.value=r.value}}function yt(){return new de({positions:ve([],{equals:g})})}class Dt extends de{constructor(r){super(r)}static create(r){const s={completed:!0,expanded:r,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},l=de.createCore(s);return new Dt(l)}get styleExpanded(){var r;return(r=this.get("temporaryExpanded"))!==null&&r!==void 0?r:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const r=this.get("expandedHeight");return this.get("shouldFixHeight")&&!v(r)?`${r}px`:"auto"}bindExpandedClass(r,s){const l=()=>{this.styleExpanded?r.classList.add(s):r.classList.remove(s)};j(this,"expanded",l),j(this,"temporaryExpanded",l)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function ie(m,r){let s=0;return St(r,()=>{m.set("expandedHeight",null),m.set("temporaryExpanded",!0),Oe(r),s=r.clientHeight,m.set("temporaryExpanded",null),Oe(r)}),s}function at(m,r){r.style.height=m.styleHeight}function Ge(m,r){m.value("expanded").emitter.on("beforechange",()=>{if(m.set("completed",!1),v(m.get("expandedHeight"))){const s=ie(m,r);s>0&&m.set("expandedHeight",s)}m.set("shouldFixHeight",!0),Oe(r)}),m.emitter.on("change",()=>{at(m,r)}),at(m,r),r.addEventListener("transitionend",s=>{s.propertyName==="height"&&m.cleanUpTransition()})}class Le extends i{constructor(r,s){super(r),this.rackApi_=s}}function We(m,r){return m.addBlade(Object.assign(Object.assign({},r),{view:"button"}))}function _t(m,r){return m.addBlade(Object.assign(Object.assign({},r),{view:"folder"}))}function Yt(m,r){const s=r??{};return m.addBlade(Object.assign(Object.assign({},s),{view:"separator"}))}function an(m,r){return m.addBlade(Object.assign(Object.assign({},r),{view:"tab"}))}class xn{constructor(r){this.emitter=new L,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=r}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(r){for(const s of this.allItems())if(r(s))return s;return null}includes(r){return this.cache_.has(r)}add(r,s){if(this.includes(r))throw S.shouldNeverHappen();const l=s!==void 0?s:this.items_.length;this.items_.splice(l,0,r),this.cache_.add(r);const p=this.extract_(r);p&&(p.emitter.on("add",this.onSubListAdd_),p.emitter.on("remove",this.onSubListRemove_),p.allItems().forEach(P=>{this.cache_.add(P)})),this.emitter.emit("add",{index:l,item:r,root:this,target:this})}remove(r){const s=this.items_.indexOf(r);if(s<0)return;this.items_.splice(s,1),this.cache_.delete(r);const l=this.extract_(r);l&&(l.emitter.off("add",this.onSubListAdd_),l.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:s,item:r,root:this,target:this})}onSubListAdd_(r){this.cache_.add(r.item),this.emitter.emit("add",{index:r.index,item:r.item,root:this,target:r.target})}onSubListRemove_(r){this.cache_.delete(r.item),this.emitter.emit("remove",{index:r.index,item:r.item,root:this,target:r.target})}}class Gt extends i{constructor(r){super(r),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new L,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(r){this.controller_.props.set("label",r)}on(r,s){const l=s.bind(this);return this.emitter_.on(r,p=>{l(p.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(r){const s=r.sender.target.read();this.emitter_.emit("change",{event:new a(this,s,this.controller_.binding.target.presetKey,r.options.last)})}}class Bt extends ft{constructor(r,s){super(r,s),this.binding=s.binding}}class Ft extends i{constructor(r){super(r),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new L,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(r){this.controller_.props.set("label",r)}on(r,s){const l=s.bind(this);return this.emitter_.on(r,p=>{l(p.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(r){const s=r.sender.target.read();this.emitter_.emit("update",{event:new c(this,s,this.controller_.binding.target.presetKey)})}}class ln extends ft{constructor(r,s){super(r,s),this.binding=s.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function tn(m){return m instanceof Nn?m.apiSet_:m instanceof Le?m.rackApi_.apiSet_:null}function xi(m,r){const s=m.find(l=>l.controller_===r);if(!s)throw S.shouldNeverHappen();return s}function yi(m,r,s){if(!E.isBindable(m))throw S.notBindable();return new E(m,r,s)}class Nn extends i{constructor(r,s){super(r),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new L,this.apiSet_=new xn(tn),this.pool_=s;const l=this.controller_.rack;l.emitter.on("add",this.onRackAdd_),l.emitter.on("remove",this.onRackRemove_),l.emitter.on("inputchange",this.onRackInputChange_),l.emitter.on("monitorupdate",this.onRackMonitorUpdate_),l.children.forEach(p=>{this.setUpApi_(p)})}get children(){return this.controller_.rack.children.map(r=>xi(this.apiSet_,r))}addInput(r,s,l){const p=l??{},P=this.controller_.view.element.ownerDocument,U=this.pool_.createInput(P,yi(r,s,p.presetKey),p),ee=new Gt(U);return this.add(ee,p.index)}addMonitor(r,s,l){const p=l??{},P=this.controller_.view.element.ownerDocument,U=this.pool_.createMonitor(P,yi(r,s),p),ee=new Ft(U);return this.add(ee,p.index)}addFolder(r){return _t(this,r)}addButton(r){return We(this,r)}addSeparator(r){return Yt(this,r)}addTab(r){return an(this,r)}add(r,s){this.controller_.rack.add(r.controller_,s);const l=this.apiSet_.find(p=>p.controller_===r.controller_);return l&&this.apiSet_.remove(l),this.apiSet_.add(r),r}remove(r){this.controller_.rack.remove(r.controller_)}addBlade(r){const s=this.controller_.view.element.ownerDocument,l=this.pool_.createBlade(s,r),p=this.pool_.createBladeApi(l);return this.add(p,r.index)}on(r,s){const l=s.bind(this);return this.emitter_.on(r,p=>{l(p.event)}),this}setUpApi_(r){this.apiSet_.find(s=>s.controller_===r)||this.apiSet_.add(this.pool_.createBladeApi(r))}onRackAdd_(r){this.setUpApi_(r.bladeController)}onRackRemove_(r){if(r.isRoot){const s=xi(this.apiSet_,r.bladeController);this.apiSet_.remove(s)}}onRackInputChange_(r){const s=r.bladeController;if(s instanceof Bt){const l=xi(this.apiSet_,s),p=s.binding;this.emitter_.emit("change",{event:new a(l,p.target.read(),p.target.presetKey,r.options.last)})}else if(s instanceof gt){const l=xi(this.apiSet_,s);this.emitter_.emit("change",{event:new a(l,s.value.rawValue,void 0,r.options.last)})}}onRackMonitorUpdate_(r){if(!(r.bladeController instanceof ln))throw S.shouldNeverHappen();const s=xi(this.apiSet_,r.bladeController),l=r.bladeController.binding;this.emitter_.emit("update",{event:new c(s,l.target.read(),l.target.presetKey)})}}class yn extends Le{constructor(r,s){super(r,new Nn(r.rackController,s)),this.emitter_=new L,this.controller_.foldable.value("expanded").emitter.on("change",l=>{this.emitter_.emit("fold",{event:new u(this,l.sender.rawValue)})}),this.rackApi_.on("change",l=>{this.emitter_.emit("change",{event:l})}),this.rackApi_.on("update",l=>{this.emitter_.emit("update",{event:l})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(r){this.controller_.foldable.set("expanded",r)}get title(){return this.controller_.props.get("title")}set title(r){this.controller_.props.set("title",r)}get children(){return this.rackApi_.children}addInput(r,s,l){return this.rackApi_.addInput(r,s,l)}addMonitor(r,s,l){return this.rackApi_.addMonitor(r,s,l)}addFolder(r){return this.rackApi_.addFolder(r)}addButton(r){return this.rackApi_.addButton(r)}addSeparator(r){return this.rackApi_.addSeparator(r)}addTab(r){return this.rackApi_.addTab(r)}add(r,s){return this.rackApi_.add(r,s)}remove(r){this.rackApi_.remove(r)}addBlade(r){return this.rackApi_.addBlade(r)}on(r,s){const l=s.bind(this);return this.emitter_.on(r,p=>{l(p.event)}),this}}class $ extends Ve{constructor(r){super({blade:r.blade,view:r.view,viewProps:r.rackController.viewProps}),this.rackController=r.rackController}}class pe{constructor(r,s){const l=z(s.viewName);this.element=r.createElement("div"),this.element.classList.add(l()),s.viewProps.bindClassModifiers(this.element)}}function Me(m,r){for(let s=0;s<m.length;s++){const l=m[s];if(l instanceof Bt&&l.binding===r)return l}return null}function le(m,r){for(let s=0;s<m.length;s++){const l=m[s];if(l instanceof ln&&l.binding===r)return l}return null}function Se(m,r){for(let s=0;s<m.length;s++){const l=m[s];if(l instanceof gt&&l.value===r)return l}return null}function ut(m){return m instanceof xt?m.rack:m instanceof $?m.rackController.rack:null}function At(m){const r=ut(m);return r?r.bcSet_:null}class zt{constructor(r){var s,l;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new L,this.blade_=(s=r.blade)!==null&&s!==void 0?s:null,(l=this.blade_)===null||l===void 0||l.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=r.viewProps,this.bcSet_=new xn(At),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(r,s){var l;(l=r.parent)===null||l===void 0||l.remove(r),b(r,"parent")?r.parent=this:(r.parent_=this,rt({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(r,s)}remove(r){b(r,"parent")?r.parent=null:(r.parent_=null,rt({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(r)}find(r){return this.bcSet_.allItems().filter(s=>s instanceof r)}onSetAdd_(r){this.updatePositions_();const s=r.target===r.root;if(this.emitter.emit("add",{bladeController:r.item,index:r.index,isRoot:s,sender:this}),!s)return;const l=r.item;if(l.viewProps.emitter.on("change",this.onChildViewPropsChange_),l.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),l.viewProps.handleDispose(this.onChildDispose_),l instanceof Bt)l.binding.emitter.on("change",this.onChildInputChange_);else if(l instanceof ln)l.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(l instanceof gt)l.value.emitter.on("change",this.onChildValueChange_);else{const p=ut(l);if(p){const P=p.emitter;P.on("layout",this.onDescendantLayout_),P.on("inputchange",this.onDescendantInputChange_),P.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(r){this.updatePositions_();const s=r.target===r.root;if(this.emitter.emit("remove",{bladeController:r.item,isRoot:s,sender:this}),!s)return;const l=r.item;if(l instanceof Bt)l.binding.emitter.off("change",this.onChildInputChange_);else if(l instanceof ln)l.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(l instanceof gt)l.value.emitter.off("change",this.onChildValueChange_);else{const p=ut(l);if(p){const P=p.emitter;P.off("layout",this.onDescendantLayout_),P.off("inputchange",this.onDescendantInputChange_),P.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const r=this.bcSet_.items.filter(p=>!p.viewProps.get("hidden")),s=r[0],l=r[r.length-1];this.bcSet_.items.forEach(p=>{const P=[];p===s&&(P.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&P.push("veryfirst")),p===l&&(P.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&P.push("verylast")),p.blade.set("positions",P)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(r){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(r=>r.viewProps.get("disposed")).forEach(r=>{this.bcSet_.remove(r)})}onChildInputChange_(r){const s=Me(this.find(Bt),r.sender);if(!s)throw S.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:s,options:r.options,sender:this})}onChildMonitorUpdate_(r){const s=le(this.find(ln),r.sender);if(!s)throw S.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:s,sender:this})}onChildValueChange_(r){const s=Se(this.find(gt),r.sender);if(!s)throw S.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:s,options:r.options,sender:this})}onDescendantLayout_(r){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(r){this.emitter.emit("inputchange",{bladeController:r.bladeController,options:r.options,sender:this})}onDescendantMonitorUpdate_(r){this.emitter.emit("monitorupdate",{bladeController:r.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class xt extends Ve{constructor(r,s){super(Object.assign(Object.assign({},s),{view:new pe(r,{viewName:"brk",viewProps:s.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const l=new zt({blade:s.root?void 0:s.blade,viewProps:s.viewProps});l.emitter.on("add",this.onRackAdd_),l.emitter.on("remove",this.onRackRemove_),this.rack=l,this.viewProps.handleDispose(()=>{for(let p=this.rack.children.length-1;p>=0;p--)this.rack.children[p].viewProps.set("disposed",!0)})}onRackAdd_(r){r.isRoot&&ge(this.view.element,r.bladeController.view.element,r.index)}onRackRemove_(r){r.isRoot&&Ne(r.bladeController.view.element)}}const Pt=z("cnt");class Je{constructor(r,s){var l;this.className_=z((l=s.viewName)!==null&&l!==void 0?l:"fld"),this.element=r.createElement("div"),this.element.classList.add(this.className_(),Pt()),s.viewProps.bindClassModifiers(this.element),this.foldable_=s.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),j(this.foldable_,"completed",W(this.element,this.className_(void 0,"cpl")));const p=r.createElement("button");p.classList.add(this.className_("b")),j(s.props,"title",Fe=>{v(Fe)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),s.viewProps.bindDisabled(p),this.element.appendChild(p),this.buttonElement=p;const P=r.createElement("div");P.classList.add(this.className_("i")),this.element.appendChild(P);const U=r.createElement("div");U.classList.add(this.className_("t")),Z(s.props.value("title"),U),this.buttonElement.appendChild(U),this.titleElement=U;const ee=r.createElement("div");ee.classList.add(this.className_("m")),this.buttonElement.appendChild(ee);const _e=s.containerElement;_e.classList.add(this.className_("c")),this.element.appendChild(_e),this.containerElement=_e}}class et extends ${constructor(r,s){var l;const p=Dt.create((l=s.expanded)!==null&&l!==void 0?l:!0),P=new xt(r,{blade:s.blade,root:s.root,viewProps:s.viewProps});super(Object.assign(Object.assign({},s),{rackController:P,view:new Je(r,{containerElement:P.view.element,foldable:p,props:s.props,viewName:s.root?"rot":void 0,viewProps:s.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=s.props,this.foldable=p,Ge(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Ct={id:"folder",type:"blade",accept(m){const r=Re,s=Ie(m,{title:r.required.string,view:r.required.constant("folder"),expanded:r.optional.boolean});return s?{params:s}:null},controller(m){return new et(m.document,{blade:m.blade,expanded:m.params.expanded,props:de.fromObject({title:m.params.title}),viewProps:m.viewProps})},api(m){return m.controller instanceof et?new yn(m.controller,m.pool):null}};class it extends gt{constructor(r,s){const l=s.valueController.viewProps;super(Object.assign(Object.assign({},s),{value:s.valueController.value,view:new ct(r,{props:s.props,viewProps:l}),viewProps:l})),this.props=s.props,this.valueController=s.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class ht extends i{}const Qt=z("spr");class ot{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(Qt()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("hr");l.classList.add(Qt("r")),this.element.appendChild(l)}}class Ue extends Ve{constructor(r,s){super(Object.assign(Object.assign({},s),{view:new ot(r,{viewProps:s.viewProps})}))}}const Cn={id:"separator",type:"blade",accept(m){const r=Ie(m,{view:Re.required.constant("separator")});return r?{params:r}:null},controller(m){return new Ue(m.document,{blade:m.blade,viewProps:m.viewProps})},api(m){return m.controller instanceof Ue?new ht(m.controller):null}},Ht=z("tbi");class Ut{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(Ht()),s.viewProps.bindClassModifiers(this.element),j(s.props,"selected",P=>{P?this.element.classList.add(Ht(void 0,"sel")):this.element.classList.remove(Ht(void 0,"sel"))});const l=r.createElement("button");l.classList.add(Ht("b")),s.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l;const p=r.createElement("div");p.classList.add(Ht("t")),Z(s.props.value("title"),p),this.buttonElement.appendChild(p),this.titleElement=p}}class fn{constructor(r,s){this.emitter=new L,this.onClick_=this.onClick_.bind(this),this.props=s.props,this.viewProps=s.viewProps,this.view=new Ut(r,{props:s.props,viewProps:s.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Mn{constructor(r,s){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new fn(r,{props:s.itemProps,viewProps:He.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new xt(r,{blade:yt(),viewProps:He.create()}),this.props=s.props,j(this.props,"selected",l=>{this.itemController.props.set("selected",l),this.contentController.viewProps.set("hidden",!l)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Ci{constructor(r,s){this.controller_=r,this.rackApi_=s}get title(){var r;return(r=this.controller_.itemController.props.get("title"))!==null&&r!==void 0?r:""}set title(r){this.controller_.itemController.props.set("title",r)}get selected(){return this.controller_.props.get("selected")}set selected(r){this.controller_.props.set("selected",r)}get children(){return this.rackApi_.children}addButton(r){return this.rackApi_.addButton(r)}addFolder(r){return this.rackApi_.addFolder(r)}addSeparator(r){return this.rackApi_.addSeparator(r)}addTab(r){return this.rackApi_.addTab(r)}add(r,s){this.rackApi_.add(r,s)}remove(r){this.rackApi_.remove(r)}addInput(r,s,l){return this.rackApi_.addInput(r,s,l)}addMonitor(r,s,l){return this.rackApi_.addMonitor(r,s,l)}addBlade(r){return this.rackApi_.addBlade(r)}}class mn extends Le{constructor(r,s){super(r,new Nn(r.rackController,s)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new L,this.pageApiMap_=new Map,this.rackApi_.on("change",l=>{this.emitter_.emit("change",{event:l})}),this.rackApi_.on("update",l=>{this.emitter_.emit("update",{event:l})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(l=>{this.setUpPageApi_(l)})}get pages(){return this.controller_.pageSet.items.map(r=>{const s=this.pageApiMap_.get(r);if(!s)throw S.shouldNeverHappen();return s})}addPage(r){const s=this.controller_.view.element.ownerDocument,l=new Mn(s,{itemProps:de.fromObject({selected:!1,title:r.title}),props:de.fromObject({selected:!1})});this.controller_.add(l,r.index);const p=this.pageApiMap_.get(l);if(!p)throw S.shouldNeverHappen();return p}removePage(r){this.controller_.remove(r)}on(r,s){const l=s.bind(this);return this.emitter_.on(r,p=>{l(p.event)}),this}setUpPageApi_(r){const s=this.rackApi_.apiSet_.find(p=>p.controller_===r.contentController);if(!s)throw S.shouldNeverHappen();const l=new Ci(r,s);this.pageApiMap_.set(r,l)}onPageAdd_(r){this.setUpPageApi_(r.item)}onPageRemove_(r){if(!this.pageApiMap_.get(r.item))throw S.shouldNeverHappen();this.pageApiMap_.delete(r.item)}onSelect_(r){this.emitter_.emit("select",{event:new d(this,r.rawValue)})}}const On=-1;class Un{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=ve(!0),this.selectedIndex=ve(On),this.items_=[]}add(r,s){const l=s??this.items_.length;this.items_.splice(l,0,r),r.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(r){const s=this.items_.indexOf(r);s<0||(this.items_.splice(s,1),r.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=On,this.empty.rawValue=!0;return}const r=this.items_.findIndex(s=>s.rawValue);r<0?(this.items_.forEach((s,l)=>{s.rawValue=l===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((s,l)=>{s.rawValue=l===r}),this.selectedIndex.rawValue=r),this.empty.rawValue=!1}onItemSelectedChange_(r){if(r.rawValue){const s=this.items_.findIndex(l=>l===r.sender);this.items_.forEach((l,p)=>{l.rawValue=p===s}),this.selectedIndex.rawValue=s}else this.keepSelection_()}}const un=z("tab");class Hn{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(un(),Pt()),s.viewProps.bindClassModifiers(this.element),B(s.empty,W(this.element,un(void 0,"nop")));const l=r.createElement("div");l.classList.add(un("t")),this.element.appendChild(l),this.itemsElement=l;const p=r.createElement("div");p.classList.add(un("i")),this.element.appendChild(p);const P=s.contentsElement;P.classList.add(un("c")),this.element.appendChild(P),this.contentsElement=P}}class kn extends ${constructor(r,s){const l=new xt(r,{blade:s.blade,viewProps:s.viewProps}),p=new Un;super({blade:s.blade,rackController:l,view:new Hn(r,{contentsElement:l.view.element,empty:p.empty,viewProps:s.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new xn(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=p}get pageSet(){return this.pageSet_}add(r,s){this.pageSet_.add(r,s)}remove(r){this.pageSet_.remove(this.pageSet_.items[r])}onPageAdd_(r){const s=r.item;ge(this.view.itemsElement,s.itemController.view.element,r.index),s.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(s.contentController,r.index),this.tab.add(s.props.value("selected"))}onPageRemove_(r){const s=r.item;Ne(s.itemController.view.element),s.itemController.viewProps.set("parent",null),this.rackController.rack.remove(s.contentController),this.tab.remove(s.props.value("selected"))}}const Rn={id:"tab",type:"blade",accept(m){const r=Re,s=Ie(m,{pages:r.required.array(r.required.object({title:r.required.string})),view:r.required.constant("tab")});return!s||s.pages.length===0?null:{params:s}},controller(m){const r=new kn(m.document,{blade:m.blade,viewProps:m.viewProps});return m.params.pages.forEach(s=>{const l=new Mn(m.document,{itemProps:de.fromObject({selected:!1,title:s.title}),props:de.fromObject({selected:!1})});r.add(l)}),r},api(m){return m.controller instanceof kn?new mn(m.controller,m.pool):null}};function Yi(m,r){const s=m.accept(r.params);if(!s)return null;const l=Re.optional.boolean(r.params.disabled).value,p=Re.optional.boolean(r.params.hidden).value;return m.controller({blade:yt(),document:r.document,params:Object.assign(Object.assign({},s.params),{disabled:l,hidden:p}),viewProps:He.create({disabled:l,hidden:p})})}class rs{constructor(){this.disabled=!1,this.emitter=new L}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class gn{constructor(r,s){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=r,this.emitter=new L,this.interval_=s,this.setTimer_()}get disabled(){return this.disabled_}set disabled(r){this.disabled_=r,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const r=this.doc_.defaultView;r&&r.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const r=this.doc_.defaultView;r&&(this.timerId_=r.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class ni{constructor(r){this.onValueChange_=this.onValueChange_.bind(this),this.reader=r.reader,this.writer=r.writer,this.emitter=new L,this.value=r.value,this.value.emitter.on("change",this.onValueChange_),this.target=r.target,this.read()}read(){const r=this.target.read();r!==void 0&&(this.value.rawValue=this.reader(r))}write_(r){this.writer(this.target,r)}onValueChange_(r){this.write_(r.rawValue),this.emitter.emit("change",{options:r.options,rawValue:r.rawValue,sender:this})}}function Pn(m,r){for(;m.length<r;)m.push(void 0)}function qt(m){const r=[];return Pn(r,m),ve(r)}function Vs(m){const r=m.indexOf(void 0);return r<0?m:m.slice(0,r)}function Zi(m,r){const s=[...Vs(m),r];return s.length>m.length?s.splice(0,s.length-m.length):Pn(s,m.length),s}class Fn{constructor(r){this.onTick_=this.onTick_.bind(this),this.reader_=r.reader,this.target=r.target,this.emitter=new L,this.value=r.value,this.ticker=r.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const r=this.target.read();if(r===void 0)return;const s=this.value.rawValue,l=this.reader_(r);this.value.rawValue=Zi(s,l),this.emitter.emit("update",{rawValue:l,sender:this})}onTick_(r){this.read()}}class os{constructor(r){this.constraints=r}constrain(r){return this.constraints.reduce((s,l)=>l.constrain(s),r)}}function Gn(m,r){if(m instanceof r)return m;if(m instanceof os){const s=m.constraints.reduce((l,p)=>l||(p instanceof r?p:null),null);if(s)return s}return null}class En{constructor(r){this.values=de.fromObject({max:r.max,min:r.min})}constrain(r){const s=this.values.get("max"),l=this.values.get("min");return Math.min(Math.max(r,l),s)}}class li{constructor(r){this.values=de.fromObject({options:r})}get options(){return this.values.get("options")}constrain(r){const s=this.values.get("options");return s.length===0||s.filter(l=>l.value===r).length>0?r:s[0].value}}class Bi{constructor(r){this.values=de.fromObject({max:r.max,min:r.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(r){const s=this.values.get("max"),l=this.values.get("min");let p=r;return v(l)||(p=Math.max(p,l)),v(s)||(p=Math.min(p,s)),p}}class qn{constructor(r,s=0){this.step=r,this.origin=s}constrain(r){const s=this.origin%this.step,l=Math.round((r-s)/this.step);return s+l*this.step}}const Xn=z("lst");class Ji{constructor(r,s){this.onValueChange_=this.onValueChange_.bind(this),this.props_=s.props,this.element=r.createElement("div"),this.element.classList.add(Xn()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("select");l.classList.add(Xn("s")),j(this.props_,"options",P=>{je(l),P.forEach((U,ee)=>{const _e=r.createElement("option");_e.dataset.index=String(ee),_e.textContent=U.text,_e.value=String(U.value),l.appendChild(_e)})}),s.viewProps.bindDisabled(l),this.element.appendChild(l),this.selectElement=l;const p=r.createElement("div");p.classList.add(Xn("m")),p.appendChild(q(r,"dropdown")),this.element.appendChild(p),s.value.emitter.on("change",this.onValueChange_),this.value_=s.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Mi{constructor(r,s){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=s.props,this.value=s.value,this.viewProps=s.viewProps,this.view=new Ji(r,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(r){const s=r.currentTarget.selectedOptions.item(0);if(!s)return;const l=Number(s.dataset.index);this.value.rawValue=this.props.get("options")[l].value}}const Ei=z("pop");class Ns{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(Ei()),s.viewProps.bindClassModifiers(this.element),B(s.shows,W(this.element,Ei(void 0,"v")))}}class Os{constructor(r,s){this.shows=ve(!1),this.viewProps=s.viewProps,this.view=new Ns(r,{shows:this.shows,viewProps:this.viewProps})}}const ci=z("txt");class Si{constructor(r,s){this.onChange_=this.onChange_.bind(this),this.element=r.createElement("div"),this.element.classList.add(ci()),s.viewProps.bindClassModifiers(this.element),this.props_=s.props,this.props_.emitter.on("change",this.onChange_);const l=r.createElement("input");l.classList.add(ci("i")),l.type="text",s.viewProps.bindDisabled(l),this.element.appendChild(l),this.inputElement=l,s.value.emitter.on("change",this.onChange_),this.value_=s.value,this.refresh()}refresh(){const r=this.props_.get("formatter");this.inputElement.value=r(this.value_.rawValue)}onChange_(){this.refresh()}}class Qi{constructor(r,s){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=s.parser,this.props=s.props,this.value=s.value,this.viewProps=s.viewProps,this.view=new Si(r,{props:s.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(r){const s=r.currentTarget.value,l=this.parser_(s);v(l)||(this.value.rawValue=l),this.view.refresh()}}function Ui(m){return String(m)}function hi(m){return m==="false"?!1:!!m}function $n(m){return Ui(m)}class fs{constructor(r){this.text=r}evaluate(){return Number(this.text)}toString(){return this.text}}const Fs={"**":(m,r)=>Math.pow(m,r),"*":(m,r)=>m*r,"/":(m,r)=>m/r,"%":(m,r)=>m%r,"+":(m,r)=>m+r,"-":(m,r)=>m-r,"<<":(m,r)=>m<<r,">>":(m,r)=>m>>r,">>>":(m,r)=>m>>>r,"&":(m,r)=>m&r,"^":(m,r)=>m^r,"|":(m,r)=>m|r};class Zs{constructor(r,s,l){this.left=s,this.operator=r,this.right=l}evaluate(){const r=Fs[this.operator];if(!r)throw new Error(`unexpected binary operator: '${this.operator}`);return r(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ai={"+":m=>m,"-":m=>-m,"~":m=>~m};class ms{constructor(r,s){this.operator=r,this.expression=s}evaluate(){const r=Ai[this.operator];if(!r)throw new Error(`unexpected unary operator: '${this.operator}`);return r(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Hi(m){return(r,s)=>{for(let l=0;l<m.length;l++){const p=m[l](r,s);if(p!=="")return p}return""}}function Yn(m,r){var s;const l=m.substr(r).match(/^\s+/);return(s=l&&l[0])!==null&&s!==void 0?s:""}function Pi(m,r){const s=m.substr(r,1);return s.match(/^[1-9]$/)?s:""}function Gi(m,r){var s;const l=m.substr(r).match(/^[0-9]+/);return(s=l&&l[0])!==null&&s!==void 0?s:""}function G(m,r){const s=Gi(m,r);if(s!=="")return s;const l=m.substr(r,1);if(r+=1,l!=="-"&&l!=="+")return"";const p=Gi(m,r);return p===""?"":l+p}function _(m,r){const s=m.substr(r,1);if(r+=1,s.toLowerCase()!=="e")return"";const l=G(m,r);return l===""?"":s+l}function f(m,r){const s=m.substr(r,1);if(s==="0")return s;const l=Pi(m,r);return r+=l.length,l===""?"":l+Gi(m,r)}function C(m,r){const s=f(m,r);if(r+=s.length,s==="")return"";const l=m.substr(r,1);if(r+=l.length,l!==".")return"";const p=Gi(m,r);return r+=p.length,s+l+p+_(m,r)}function D(m,r){const s=m.substr(r,1);if(r+=s.length,s!==".")return"";const l=Gi(m,r);return r+=l.length,l===""?"":s+l+_(m,r)}function K(m,r){const s=f(m,r);return r+=s.length,s===""?"":s+_(m,r)}const te=Hi([C,D,K]);function fe(m,r){var s;const l=m.substr(r).match(/^[01]+/);return(s=l&&l[0])!==null&&s!==void 0?s:""}function be(m,r){const s=m.substr(r,2);if(r+=s.length,s.toLowerCase()!=="0b")return"";const l=fe(m,r);return l===""?"":s+l}function Ee(m,r){var s;const l=m.substr(r).match(/^[0-7]+/);return(s=l&&l[0])!==null&&s!==void 0?s:""}function Be(m,r){const s=m.substr(r,2);if(r+=s.length,s.toLowerCase()!=="0o")return"";const l=Ee(m,r);return l===""?"":s+l}function st(m,r){var s;const l=m.substr(r).match(/^[0-9a-f]+/i);return(s=l&&l[0])!==null&&s!==void 0?s:""}function Lt(m,r){const s=m.substr(r,2);if(r+=s.length,s.toLowerCase()!=="0x")return"";const l=st(m,r);return l===""?"":s+l}const Ot=Hi([be,Be,Lt]),$t=Hi([Ot,te]);function dn(m,r){const s=$t(m,r);return r+=s.length,s===""?null:{evaluable:new fs(s),cursor:r}}function kt(m,r){const s=m.substr(r,1);if(r+=s.length,s!=="(")return null;const l=wr(m,r);if(!l)return null;r=l.cursor,r+=Yn(m,r).length;const p=m.substr(r,1);return r+=p.length,p!==")"?null:{evaluable:l.evaluable,cursor:r}}function Kt(m,r){var s;return(s=dn(m,r))!==null&&s!==void 0?s:kt(m,r)}function ui(m,r){const s=Kt(m,r);if(s)return s;const l=m.substr(r,1);if(r+=l.length,l!=="+"&&l!=="-"&&l!=="~")return null;const p=ui(m,r);return p?(r=p.cursor,{cursor:r,evaluable:new ms(l,p.evaluable)}):null}function zr(m,r,s){s+=Yn(r,s).length;const l=m.filter(p=>r.startsWith(p,s))[0];return l?(s+=l.length,s+=Yn(r,s).length,{cursor:s,operator:l}):null}function uo(m,r){return(s,l)=>{const p=m(s,l);if(!p)return null;l=p.cursor;let P=p.evaluable;for(;;){const U=zr(r,s,l);if(!U)break;l=U.cursor;const ee=m(s,l);if(!ee)return null;l=ee.cursor,P=new Zs(U.operator,P,ee.evaluable)}return P?{cursor:l,evaluable:P}:null}}const vs=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((m,r)=>uo(m,r),ui);function wr(m,r){return r+=Yn(m,r).length,vs(m,r)}function Js(m){const r=wr(m,0);return!r||r.cursor+Yn(m,r.cursor).length!==m.length?null:r.evaluable}function ii(m){var r;return(r=Js(m)?.evaluate())!==null&&r!==void 0?r:null}function Vi(m){if(typeof m=="number")return m;if(typeof m=="string"){const r=ii(m);if(!v(r))return r}return 0}function Wi(m){return String(m)}function Wn(m){return r=>r.toFixed(Math.max(Math.min(m,20),0))}const In=Wn(0);function Bs(m){return In(m)+"%"}function gs(m){return String(m)}function Qs(m){return m}function Ni({primary:m,secondary:r,forward:s,backward:l}){let p=!1;function P(U){p||(p=!0,U(),p=!1)}m.emitter.on("change",U=>{P(()=>{r.setRawValue(s(m,r),U.options)})}),r.emitter.on("change",U=>{P(()=>{m.setRawValue(l(m,r),U.options)}),P(()=>{r.setRawValue(s(m,r),U.options)})}),P(()=>{r.setRawValue(s(m,r),{forceEmit:!1,last:!0})})}function Tn(m,r){const s=m*(r.altKey?.1:1)*(r.shiftKey?10:1);return r.upKey?+s:r.downKey?-s:0}function Sn(m){return{altKey:m.altKey,downKey:m.key==="ArrowDown",shiftKey:m.shiftKey,upKey:m.key==="ArrowUp"}}function di(m){return{altKey:m.altKey,downKey:m.key==="ArrowLeft",shiftKey:m.shiftKey,upKey:m.key==="ArrowRight"}}function pi(m){return m==="ArrowUp"||m==="ArrowDown"}function xr(m){return pi(m)||m==="ArrowLeft"||m==="ArrowRight"}function _s(m,r){var s,l;const p=r.ownerDocument.defaultView,P=r.getBoundingClientRect();return{x:m.pageX-(((s=p&&p.scrollX)!==null&&s!==void 0?s:0)+P.left),y:m.pageY-(((l=p&&p.scrollY)!==null&&l!==void 0?l:0)+P.top)}}class as{constructor(r){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=r,this.emitter=new L,r.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),r.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),r.addEventListener("touchend",this.onTouchEnd_),r.addEventListener("mousedown",this.onMouseDown_)}computePosition_(r){const s=this.elem_.getBoundingClientRect();return{bounds:{width:s.width,height:s.height},point:r?{x:r.x,y:r.y}:null}}onMouseDown_(r){var s;r.preventDefault(),(s=r.currentTarget)===null||s===void 0||s.focus();const l=this.elem_.ownerDocument;l.addEventListener("mousemove",this.onDocumentMouseMove_),l.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:r.altKey,data:this.computePosition_(_s(r,this.elem_)),sender:this,shiftKey:r.shiftKey})}onDocumentMouseMove_(r){this.emitter.emit("move",{altKey:r.altKey,data:this.computePosition_(_s(r,this.elem_)),sender:this,shiftKey:r.shiftKey})}onDocumentMouseUp_(r){const s=this.elem_.ownerDocument;s.removeEventListener("mousemove",this.onDocumentMouseMove_),s.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:r.altKey,data:this.computePosition_(_s(r,this.elem_)),sender:this,shiftKey:r.shiftKey})}onTouchStart_(r){r.preventDefault();const s=r.targetTouches.item(0),l=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:r.altKey,data:this.computePosition_(s?{x:s.clientX-l.left,y:s.clientY-l.top}:void 0),sender:this,shiftKey:r.shiftKey}),this.lastTouch_=s}onTouchMove_(r){const s=r.targetTouches.item(0),l=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:r.altKey,data:this.computePosition_(s?{x:s.clientX-l.left,y:s.clientY-l.top}:void 0),sender:this,shiftKey:r.shiftKey}),this.lastTouch_=s}onTouchEnd_(r){var s;const l=(s=r.targetTouches.item(0))!==null&&s!==void 0?s:this.lastTouch_,p=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:r.altKey,data:this.computePosition_(l?{x:l.clientX-p.left,y:l.clientY-p.top}:void 0),sender:this,shiftKey:r.shiftKey})}}function rn(m,r,s,l,p){const P=(m-r)/(s-r);return l+P*(p-l)}function Wt(m){return String(m.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function _n(m,r,s){return Math.min(Math.max(m,r),s)}function bn(m,r){return(m%r+r)%r}const Dn=z("txt");class fi{constructor(r,s){this.onChange_=this.onChange_.bind(this),this.props_=s.props,this.props_.emitter.on("change",this.onChange_),this.element=r.createElement("div"),this.element.classList.add(Dn(),Dn(void 0,"num")),s.arrayPosition&&this.element.classList.add(Dn(void 0,s.arrayPosition)),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("input");l.classList.add(Dn("i")),l.type="text",s.viewProps.bindDisabled(l),this.element.appendChild(l),this.inputElement=l,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=s.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Dn()),this.inputElement.classList.add(Dn("i"));const p=r.createElement("div");p.classList.add(Dn("k")),this.element.appendChild(p),this.knobElement=p;const P=r.createElementNS(Ye,"svg");P.classList.add(Dn("g")),this.knobElement.appendChild(P);const U=r.createElementNS(Ye,"path");U.classList.add(Dn("gb")),P.appendChild(U),this.guideBodyElem_=U;const ee=r.createElementNS(Ye,"path");ee.classList.add(Dn("gh")),P.appendChild(ee),this.guideHeadElem_=ee;const _e=r.createElement("div");_e.classList.add(z("tt")()),this.knobElement.appendChild(_e),this.tooltipElem_=_e,s.value.emitter.on("change",this.onChange_),this.value=s.value,this.refresh()}onDraggingChange_(r){if(r.rawValue===null){this.element.classList.remove(Dn(void 0,"drg"));return}this.element.classList.add(Dn(void 0,"drg"));const s=r.rawValue/this.props_.get("draggingScale"),l=s+(s>0?-1:s<0?1:0),p=_n(-l,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${l+p},0 L${l},4 L${l+p},8`,`M ${s},-1 L${s},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${s},4`);const P=this.props_.get("formatter");this.tooltipElem_.textContent=P(this.value.rawValue),this.tooltipElem_.style.left=`${s}px`}refresh(){const r=this.props_.get("formatter");this.inputElement.value=r(this.value.rawValue)}onChange_(){this.refresh()}}class Ti{constructor(r,s){var l;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=s.baseStep,this.parser_=s.parser,this.props=s.props,this.sliderProps_=(l=s.sliderProps)!==null&&l!==void 0?l:null,this.value=s.value,this.viewProps=s.viewProps,this.dragging_=ve(null),this.view=new fi(r,{arrayPosition:s.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const p=new as(this.view.knobElement);p.emitter.on("down",this.onPointerDown_),p.emitter.on("move",this.onPointerMove_),p.emitter.on("up",this.onPointerUp_)}constrainValue_(r){var s,l;const p=(s=this.sliderProps_)===null||s===void 0?void 0:s.get("minValue"),P=(l=this.sliderProps_)===null||l===void 0?void 0:l.get("maxValue");let U=r;return p!==void 0&&(U=Math.max(U,p)),P!==void 0&&(U=Math.min(U,P)),U}onInputChange_(r){const s=r.currentTarget.value,l=this.parser_(s);v(l)||(this.value.rawValue=this.constrainValue_(l)),this.view.refresh()}onInputKeyDown_(r){const s=Tn(this.baseStep_,Sn(r));s!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+s),{forceEmit:!1,last:!1})}onInputKeyUp_(r){Tn(this.baseStep_,Sn(r))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(r){if(!r.point)return null;const s=r.point.x-r.bounds.width/2;return this.constrainValue_(this.originRawValue_+s*this.props.get("draggingScale"))}onPointerMove_(r){const s=this.computeDraggingValue_(r.data);s!==null&&(this.value.setRawValue(s,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(r){const s=this.computeDraggingValue_(r.data);s!==null&&(this.value.setRawValue(s,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const bs=z("sld");class yr{constructor(r,s){this.onChange_=this.onChange_.bind(this),this.props_=s.props,this.props_.emitter.on("change",this.onChange_),this.element=r.createElement("div"),this.element.classList.add(bs()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("div");l.classList.add(bs("t")),s.viewProps.bindTabIndex(l),this.element.appendChild(l),this.trackElement=l;const p=r.createElement("div");p.classList.add(bs("k")),this.trackElement.appendChild(p),this.knobElement=p,s.value.emitter.on("change",this.onChange_),this.value=s.value,this.update_()}update_(){const r=_n(rn(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${r}%`}onChange_(){this.update_()}}class mi{constructor(r,s){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=s.baseStep,this.value=s.value,this.viewProps=s.viewProps,this.props=s.props,this.view=new yr(r,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new as(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(r,s){r.point&&this.value.setRawValue(rn(_n(r.point.x,0,r.bounds.width),0,r.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),s)}onPointerDownOrMove_(r){this.handlePointerEvent_(r.data,{forceEmit:!1,last:!1})}onPointerUp_(r){this.handlePointerEvent_(r.data,{forceEmit:!0,last:!0})}onKeyDown_(r){const s=Tn(this.baseStep_,di(r));s!==0&&this.value.setRawValue(this.value.rawValue+s,{forceEmit:!1,last:!1})}onKeyUp_(r){Tn(this.baseStep_,di(r))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const er=z("sldtxt");class tr{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(er());const l=r.createElement("div");l.classList.add(er("s")),this.sliderView_=s.sliderView,l.appendChild(this.sliderView_.element),this.element.appendChild(l);const p=r.createElement("div");p.classList.add(er("t")),this.textView_=s.textView,p.appendChild(this.textView_.element),this.element.appendChild(p)}}class nr{constructor(r,s){this.value=s.value,this.viewProps=s.viewProps,this.sliderC_=new mi(r,{baseStep:s.baseStep,props:s.sliderProps,value:s.value,viewProps:this.viewProps}),this.textC_=new Ti(r,{baseStep:s.baseStep,parser:s.parser,props:s.textProps,sliderProps:s.sliderProps,value:s.value,viewProps:s.viewProps}),this.view=new tr(r,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function ws(m,r){m.write(r)}function si(m){const r=Re;if(Array.isArray(m))return r.required.array(r.required.object({text:r.required.string,value:r.required.raw}))(m).value;if(typeof m=="object")return r.required.raw(m).value}function Es(m){if(m==="inline"||m==="popup")return m}function ji(m){const r=Re;return r.required.object({max:r.optional.number,min:r.optional.number,step:r.optional.number})(m).value}function vi(m){if(Array.isArray(m))return m;const r=[];return Object.keys(m).forEach(s=>{r.push({text:s,value:m[s]})}),r}function ir(m){return v(m)?null:new li(vi(m))}function Cr(m){const r=m?Gn(m,qn):null;return r?r.step:null}function Ss(m,r){const s=m&&Gn(m,qn);return s?Wt(s.step):Math.max(Wt(r),2)}function ls(m){return Cr(m)??1}function gi(m,r){var s;const l=m&&Gn(m,qn),p=Math.abs((s=l?.step)!==null&&s!==void 0?s:r);return p===0?.1:Math.pow(10,Math.floor(Math.log10(p))-1)}const es=z("ckb");class sr{constructor(r,s){this.onValueChange_=this.onValueChange_.bind(this),this.element=r.createElement("div"),this.element.classList.add(es()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("label");l.classList.add(es("l")),this.element.appendChild(l);const p=r.createElement("input");p.classList.add(es("i")),p.type="checkbox",l.appendChild(p),this.inputElement=p,s.viewProps.bindDisabled(this.inputElement);const P=r.createElement("div");P.classList.add(es("w")),l.appendChild(P);const U=q(r,"check");P.appendChild(U),s.value.emitter.on("change",this.onValueChange_),this.value=s.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class rr{constructor(r,s){this.onInputChange_=this.onInputChange_.bind(this),this.value=s.value,this.viewProps=s.viewProps,this.view=new sr(r,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(r){const s=r.currentTarget;this.value.rawValue=s.checked}}function po(m){const r=[],s=ir(m.options);return s&&r.push(s),new os(r)}const I={id:"input-bool",type:"input",accept:(m,r)=>{if(typeof m!="boolean")return null;const s=Ie(r,{options:Re.optional.custom(si)});return s?{initialValue:m,params:s}:null},binding:{reader:m=>hi,constraint:m=>po(m.params),writer:m=>ws},controller:m=>{const r=m.document,s=m.value,l=m.constraint,p=l&&Gn(l,li);return p?new Mi(r,{props:new de({options:p.values.value("options")}),value:s,viewProps:m.viewProps}):new rr(r,{value:s,viewProps:m.viewProps})}},x=z("col");class T{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(x()),s.foldable.bindExpandedClass(this.element,x(void 0,"expanded")),j(s.foldable,"completed",W(this.element,x(void 0,"cpl")));const l=r.createElement("div");l.classList.add(x("h")),this.element.appendChild(l);const p=r.createElement("div");p.classList.add(x("s")),l.appendChild(p),this.swatchElement=p;const P=r.createElement("div");if(P.classList.add(x("t")),l.appendChild(P),this.textElement=P,s.pickerLayout==="inline"){const U=r.createElement("div");U.classList.add(x("p")),this.element.appendChild(U),this.pickerElement=U}else this.pickerElement=null}}function O(m,r,s){const l=_n(m/255,0,1),p=_n(r/255,0,1),P=_n(s/255,0,1),U=Math.max(l,p,P),ee=Math.min(l,p,P),_e=U-ee;let Fe=0,Qe=0;const Mt=(ee+U)/2;return _e!==0&&(Qe=_e/(1-Math.abs(U+ee-1)),l===U?Fe=(p-P)/_e:p===U?Fe=2+(P-l)/_e:Fe=4+(l-p)/_e,Fe=Fe/6+(Fe<0?1:0)),[Fe*360,Qe*100,Mt*100]}function J(m,r,s){const l=(m%360+360)%360,p=_n(r/100,0,1),P=_n(s/100,0,1),U=(1-Math.abs(2*P-1))*p,ee=U*(1-Math.abs(l/60%2-1)),_e=P-U/2;let Fe,Qe,Mt;return l>=0&&l<60?[Fe,Qe,Mt]=[U,ee,0]:l>=60&&l<120?[Fe,Qe,Mt]=[ee,U,0]:l>=120&&l<180?[Fe,Qe,Mt]=[0,U,ee]:l>=180&&l<240?[Fe,Qe,Mt]=[0,ee,U]:l>=240&&l<300?[Fe,Qe,Mt]=[ee,0,U]:[Fe,Qe,Mt]=[U,0,ee],[(Fe+_e)*255,(Qe+_e)*255,(Mt+_e)*255]}function ae(m,r,s){const l=_n(m/255,0,1),p=_n(r/255,0,1),P=_n(s/255,0,1),U=Math.max(l,p,P),ee=Math.min(l,p,P),_e=U-ee;let Fe;_e===0?Fe=0:U===l?Fe=60*(((p-P)/_e%6+6)%6):U===p?Fe=60*((P-l)/_e+2):Fe=60*((l-p)/_e+4);const Qe=U===0?0:_e/U,Mt=U;return[Fe,Qe*100,Mt*100]}function ye(m,r,s){const l=bn(m,360),p=_n(r/100,0,1),P=_n(s/100,0,1),U=P*p,ee=U*(1-Math.abs(l/60%2-1)),_e=P-U;let Fe,Qe,Mt;return l>=0&&l<60?[Fe,Qe,Mt]=[U,ee,0]:l>=60&&l<120?[Fe,Qe,Mt]=[ee,U,0]:l>=120&&l<180?[Fe,Qe,Mt]=[0,U,ee]:l>=180&&l<240?[Fe,Qe,Mt]=[0,ee,U]:l>=240&&l<300?[Fe,Qe,Mt]=[ee,0,U]:[Fe,Qe,Mt]=[U,0,ee],[(Fe+_e)*255,(Qe+_e)*255,(Mt+_e)*255]}function Xe(m,r,s){const l=s+r*(100-Math.abs(2*s-100))/200;return[m,l!==0?r*(100-Math.abs(2*s-100))/l:0,s+r*(100-Math.abs(2*s-100))/(2*100)]}function k(m,r,s){const l=100-Math.abs(s*(200-r)/100-100);return[m,l!==0?r*s/l:0,s*(200-r)/(2*100)]}function w(m){return[m[0],m[1],m[2]]}function A(m,r){return[m[0],m[1],m[2],r]}const N={hsl:{hsl:(m,r,s)=>[m,r,s],hsv:Xe,rgb:J},hsv:{hsl:k,hsv:(m,r,s)=>[m,r,s],rgb:ye},rgb:{hsl:O,hsv:ae,rgb:(m,r,s)=>[m,r,s]}};function Y(m,r){return[r==="float"?1:m==="rgb"?255:360,r==="float"?1:m==="rgb"?255:100,r==="float"?1:m==="rgb"?255:100]}function re(m,r){return m===r?r:bn(m,r)}function Ce(m,r,s){var l;const p=Y(r,s);return[r==="rgb"?_n(m[0],0,p[0]):re(m[0],p[0]),_n(m[1],0,p[1]),_n(m[2],0,p[2]),_n((l=m[3])!==null&&l!==void 0?l:1,0,1)]}function Ke(m,r,s,l){const p=Y(r,s),P=Y(r,l);return m.map((U,ee)=>U/p[ee]*P[ee])}function nn(m,r,s){const l=Ke(m,r.mode,r.type,"int"),p=N[r.mode][s.mode](...l);return Ke(p,s.mode,"int",s.type)}function Li(m,r){return typeof m!="object"||v(m)?!1:r in m&&typeof m[r]=="number"}class Rt{static black(r="int"){return new Rt([0,0,0],"rgb",r)}static fromObject(r,s="int"){const l="a"in r?[r.r,r.g,r.b,r.a]:[r.r,r.g,r.b];return new Rt(l,"rgb",s)}static toRgbaObject(r,s="int"){return r.toRgbaObject(s)}static isRgbColorObject(r){return Li(r,"r")&&Li(r,"g")&&Li(r,"b")}static isRgbaColorObject(r){return this.isRgbColorObject(r)&&Li(r,"a")}static isColorObject(r){return this.isRgbColorObject(r)}static equals(r,s){if(r.mode!==s.mode)return!1;const l=r.comps_,p=s.comps_;for(let P=0;P<l.length;P++)if(l[P]!==p[P])return!1;return!0}constructor(r,s,l="int"){this.mode=s,this.type=l,this.comps_=Ce(r,s,l)}getComponents(r,s="int"){return A(nn(w(this.comps_),{mode:this.mode,type:this.type},{mode:r??this.mode,type:s}),this.comps_[3])}toRgbaObject(r="int"){const s=this.getComponents("rgb",r);return{r:s[0],g:s[1],b:s[2],a:s[3]}}}const Vt=z("colp");class Us{constructor(r,s){this.alphaViews_=null,this.element=r.createElement("div"),this.element.classList.add(Vt()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("div");l.classList.add(Vt("hsv"));const p=r.createElement("div");p.classList.add(Vt("sv")),this.svPaletteView_=s.svPaletteView,p.appendChild(this.svPaletteView_.element),l.appendChild(p);const P=r.createElement("div");P.classList.add(Vt("h")),this.hPaletteView_=s.hPaletteView,P.appendChild(this.hPaletteView_.element),l.appendChild(P),this.element.appendChild(l);const U=r.createElement("div");if(U.classList.add(Vt("rgb")),this.textView_=s.textView,U.appendChild(this.textView_.element),this.element.appendChild(U),s.alphaViews){this.alphaViews_={palette:s.alphaViews.palette,text:s.alphaViews.text};const ee=r.createElement("div");ee.classList.add(Vt("a"));const _e=r.createElement("div");_e.classList.add(Vt("ap")),_e.appendChild(this.alphaViews_.palette.element),ee.appendChild(_e);const Fe=r.createElement("div");Fe.classList.add(Vt("at")),Fe.appendChild(this.alphaViews_.text.element),ee.appendChild(Fe),this.element.appendChild(ee)}}get allFocusableElements(){const r=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(s=>s.inputElement)];return this.alphaViews_&&r.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),r}}function Al(m){return m==="int"?"int":m==="float"?"float":void 0}function Pl(m){const r=Re;return Ie(m,{alpha:r.optional.boolean,color:r.optional.object({alpha:r.optional.boolean,type:r.optional.custom(Al)}),expanded:r.optional.boolean,picker:r.optional.custom(Es)})}function or(m){return m?.1:1}function cs(m){var r;return(r=m.color)===null||r===void 0?void 0:r.type}function Vr(m,r){return m.alpha===r.alpha&&m.mode===r.mode&&m.notation===r.notation&&m.type===r.type}function xs(m,r){const s=m.match(/^(.+)%$/);return Math.min(s?parseFloat(s[1])*.01*r:parseFloat(m),r)}const ys={deg:m=>m,grad:m=>m*360/400,rad:m=>m*360/(2*Math.PI),turn:m=>m*360};function _h(m){const r=m.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!r)return parseFloat(m);const s=parseFloat(r[1]),l=r[2];return ys[l](s)}function Tl(m){const r=m.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!r)return null;const s=[xs(r[1],255),xs(r[2],255),xs(r[3],255)];return isNaN(s[0])||isNaN(s[1])||isNaN(s[2])?null:s}function Ll(m){return r=>{const s=Tl(r);return s?new Rt(s,"rgb",m):null}}function kl(m){const r=m.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!r)return null;const s=[xs(r[1],255),xs(r[2],255),xs(r[3],255),xs(r[4],1)];return isNaN(s[0])||isNaN(s[1])||isNaN(s[2])||isNaN(s[3])?null:s}function Rl(m){return r=>{const s=kl(r);return s?new Rt(s,"rgb",m):null}}function Il(m){const r=m.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!r)return null;const s=[_h(r[1]),xs(r[2],100),xs(r[3],100)];return isNaN(s[0])||isNaN(s[1])||isNaN(s[2])?null:s}function Dl(m){return r=>{const s=Il(r);return s?new Rt(s,"hsl",m):null}}function zl(m){const r=m.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!r)return null;const s=[_h(r[1]),xs(r[2],100),xs(r[3],100),xs(r[4],1)];return isNaN(s[0])||isNaN(s[1])||isNaN(s[2])||isNaN(s[3])?null:s}function Vl(m){return r=>{const s=zl(r);return s?new Rt(s,"hsl",m):null}}function Nl(m){const r=m.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(r)return[parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16),parseInt(r[3]+r[3],16)];const s=m.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return s?[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]:null}function bh(m){const r=Nl(m);return r?new Rt(r,"rgb","int"):null}function wh(m){const r=m.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(r)return[parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16),parseInt(r[3]+r[3],16),rn(parseInt(r[4]+r[4],16),0,255,0,1)];const s=m.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return s?[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16),rn(parseInt(s[4],16),0,255,0,1)]:null}function xh(m){const r=wh(m);return r?new Rt(r,"rgb","int"):null}function yh(m){const r=m.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!r)return null;const s=[parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])];return isNaN(s[0])||isNaN(s[1])||isNaN(s[2])?null:s}function Ol(m){return r=>{const s=yh(r);return s?new Rt(s,"rgb",m):null}}function Fl(m){const r=m.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!r)return null;const s=[parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]),parseFloat(r[4])];return isNaN(s[0])||isNaN(s[1])||isNaN(s[2])||isNaN(s[3])?null:s}function Bl(m){return r=>{const s=Fl(r);return s?new Rt(s,"rgb",m):null}}const Ch=[{parser:Nl,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:wh,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Tl,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:kl,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Il,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:zl,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:yh,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Fl,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Ud(m){return Ch.reduce((r,{parser:s,result:l})=>r||(s(m)?l:null),null)}function Ul(m,r="int"){const s=Ud(m);return s?s.notation==="hex"&&r!=="float"?Object.assign(Object.assign({},s),{type:"int"}):s.notation==="func"?Object.assign(Object.assign({},s),{type:r}):null:null}const ka={int:[bh,xh,Ll("int"),Rl("int"),Dl("int"),Vl("int"),Ol("int"),Bl("int")],float:[Ll("float"),Rl("float"),Dl("float"),Vl("float"),Ol("float"),Bl("float")]};function Mh(m){const r=ka[m];return s=>typeof s!="string"?Rt.black(m):r.reduce((p,P)=>p||P(s),null)??Rt.black(m)}function Hl(m){const r=ka[m];return s=>r.reduce((l,p)=>l||p(s),null)}function Ra(m){const r=_n(Math.floor(m),0,255).toString(16);return r.length===1?`0${r}`:r}function Gl(m,r="#"){const s=w(m.getComponents("rgb")).map(Ra).join("");return`${r}${s}`}function Ia(m,r="#"){const s=m.getComponents("rgb"),l=[s[0],s[1],s[2],s[3]*255].map(Ra).join("");return`${r}${l}`}function Da(m,r){const s=Wn(r==="float"?2:0);return`rgb(${w(m.getComponents("rgb",r)).map(l=>s(l)).join(", ")})`}function Eh(m){return r=>Da(r,m)}function za(m,r){const s=Wn(2),l=Wn(r==="float"?2:0);return`rgba(${m.getComponents("rgb",r).map((p,P)=>(P===3?s:l)(p)).join(", ")})`}function Va(m){return r=>za(r,m)}function Hd(m){const r=[Wn(0),Bs,Bs];return`hsl(${w(m.getComponents("hsl")).map((s,l)=>r[l](s)).join(", ")})`}function Gd(m){const r=[Wn(0),Bs,Bs,Wn(2)];return`hsla(${m.getComponents("hsl").map((s,l)=>r[l](s)).join(", ")})`}function Sh(m,r){const s=Wn(r==="float"?2:0),l=["r","g","b"];return`{${w(m.getComponents("rgb",r)).map((p,P)=>`${l[P]}: ${s(p)}`).join(", ")}}`}function Ah(m){return r=>Sh(r,m)}function Ph(m,r){const s=Wn(2),l=Wn(r==="float"?2:0),p=["r","g","b","a"];return`{${m.getComponents("rgb",r).map((P,U)=>{const ee=U===3?s:l;return`${p[U]}: ${ee(P)}`}).join(", ")}}`}function Th(m){return r=>Ph(r,m)}const Wd=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Gl},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Ia},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Hd},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Gd},...["int","float"].reduce((m,r)=>[...m,{format:{alpha:!1,mode:"rgb",notation:"func",type:r},stringifier:Eh(r)},{format:{alpha:!0,mode:"rgb",notation:"func",type:r},stringifier:Va(r)},{format:{alpha:!1,mode:"rgb",notation:"object",type:r},stringifier:Ah(r)},{format:{alpha:!0,mode:"rgb",notation:"object",type:r},stringifier:Th(r)}],[])];function Wl(m){return Wd.reduce((r,s)=>r||(Vr(s.format,m)?s.stringifier:null),null)}const Nr=z("apl");class Ko{constructor(r,s){this.onValueChange_=this.onValueChange_.bind(this),this.value=s.value,this.value.emitter.on("change",this.onValueChange_),this.element=r.createElement("div"),this.element.classList.add(Nr()),s.viewProps.bindClassModifiers(this.element),s.viewProps.bindTabIndex(this.element);const l=r.createElement("div");l.classList.add(Nr("b")),this.element.appendChild(l);const p=r.createElement("div");p.classList.add(Nr("c")),l.appendChild(p),this.colorElem_=p;const P=r.createElement("div");P.classList.add(Nr("m")),this.element.appendChild(P),this.markerElem_=P;const U=r.createElement("div");U.classList.add(Nr("p")),this.markerElem_.appendChild(U),this.previewElem_=U,this.update_()}update_(){const r=this.value.rawValue,s=r.getComponents("rgb"),l=new Rt([s[0],s[1],s[2],0],"rgb"),p=new Rt([s[0],s[1],s[2],255],"rgb"),P=["to right",za(l),za(p)];this.colorElem_.style.background=`linear-gradient(${P.join(",")})`,this.previewElem_.style.backgroundColor=za(r);const U=rn(s[3],0,1,0,100);this.markerElem_.style.left=`${U}%`}onValueChange_(){this.update_()}}class jd{constructor(r,s){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=s.value,this.viewProps=s.viewProps,this.view=new Ko(r,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new as(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(r,s){if(!r.point)return;const l=r.point.x/r.bounds.width,p=this.value.rawValue,[P,U,ee]=p.getComponents("hsv");this.value.setRawValue(new Rt([P,U,ee,l],"hsv"),s)}onPointerDown_(r){this.handlePointerEvent_(r.data,{forceEmit:!1,last:!1})}onPointerMove_(r){this.handlePointerEvent_(r.data,{forceEmit:!1,last:!1})}onPointerUp_(r){this.handlePointerEvent_(r.data,{forceEmit:!0,last:!0})}onKeyDown_(r){const s=Tn(or(!0),di(r));if(s===0)return;const l=this.value.rawValue,[p,P,U,ee]=l.getComponents("hsv");this.value.setRawValue(new Rt([p,P,U,ee+s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(r){Tn(or(!0),di(r))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const fo=z("coltxt");function mo(m){const r=m.createElement("select"),s=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return r.appendChild(s.reduce((l,p)=>{const P=m.createElement("option");return P.textContent=p.text,P.value=p.value,l.appendChild(P),l},m.createDocumentFragment())),r}class Kd{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(fo()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("div");l.classList.add(fo("m")),this.modeElem_=mo(r),this.modeElem_.classList.add(fo("ms")),l.appendChild(this.modeSelectElement),s.viewProps.bindDisabled(this.modeElem_);const p=r.createElement("div");p.classList.add(fo("mm")),p.appendChild(q(r,"dropdown")),l.appendChild(p),this.element.appendChild(l);const P=r.createElement("div");P.classList.add(fo("w")),this.element.appendChild(P),this.textsElem_=P,this.textViews_=s.textViews,this.applyTextViews_(),B(s.colorMode,U=>{this.modeElem_.value=U})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(r){this.textViews_=r,this.applyTextViews_()}applyTextViews_(){je(this.textsElem_);const r=this.element.ownerDocument;this.textViews_.forEach(s=>{const l=r.createElement("div");l.classList.add(fo("c")),l.appendChild(s.element),this.textsElem_.appendChild(l)})}}function qd(m){return Wn(m==="float"?2:0)}function Xd(m,r,s){const l=Y(m,r)[s];return new En({min:0,max:l})}function jl(m,r,s){return new Ti(m,{arrayPosition:s===0?"fst":s===3-1?"lst":"mid",baseStep:or(!1),parser:r.parser,props:de.fromObject({draggingScale:r.colorType==="float"?.01:1,formatter:qd(r.colorType)}),value:ve(0,{constraint:Xd(r.colorMode,r.colorType,s)}),viewProps:r.viewProps})}class Kl{constructor(r,s){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=s.colorType,this.parser_=s.parser,this.value=s.value,this.viewProps=s.viewProps,this.colorMode=ve(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(r),this.view=new Kd(r,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(r){const s={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},l=[jl(r,s,0),jl(r,s,1),jl(r,s,2)];return l.forEach((p,P)=>{Ni({primary:this.value,secondary:p.value,forward:U=>U.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[P],backward:(U,ee)=>{const _e=this.colorMode.rawValue,Fe=U.rawValue.getComponents(_e,this.colorType_);return Fe[P]=ee.rawValue,new Rt(A(w(Fe),Fe[3]),_e,this.colorType_)}})}),l}onModeSelectChange_(r){const s=r.currentTarget;this.colorMode.rawValue=s.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const ql=z("hpl");class Xl{constructor(r,s){this.onValueChange_=this.onValueChange_.bind(this),this.value=s.value,this.value.emitter.on("change",this.onValueChange_),this.element=r.createElement("div"),this.element.classList.add(ql()),s.viewProps.bindClassModifiers(this.element),s.viewProps.bindTabIndex(this.element);const l=r.createElement("div");l.classList.add(ql("c")),this.element.appendChild(l);const p=r.createElement("div");p.classList.add(ql("m")),this.element.appendChild(p),this.markerElem_=p,this.update_()}update_(){const r=this.value.rawValue,[s]=r.getComponents("hsv");this.markerElem_.style.backgroundColor=Da(new Rt([s,100,100],"hsv"));const l=rn(s,0,360,0,100);this.markerElem_.style.left=`${l}%`}onValueChange_(){this.update_()}}class $d{constructor(r,s){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=s.value,this.viewProps=s.viewProps,this.view=new Xl(r,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new as(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(r,s){if(!r.point)return;const l=rn(_n(r.point.x,0,r.bounds.width),0,r.bounds.width,0,360),p=this.value.rawValue,[,P,U,ee]=p.getComponents("hsv");this.value.setRawValue(new Rt([l,P,U,ee],"hsv"),s)}onPointerDown_(r){this.handlePointerEvent_(r.data,{forceEmit:!1,last:!1})}onPointerMove_(r){this.handlePointerEvent_(r.data,{forceEmit:!1,last:!1})}onPointerUp_(r){this.handlePointerEvent_(r.data,{forceEmit:!0,last:!0})}onKeyDown_(r){const s=Tn(or(!1),di(r));if(s===0)return;const l=this.value.rawValue,[p,P,U,ee]=l.getComponents("hsv");this.value.setRawValue(new Rt([p+s,P,U,ee],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(r){Tn(or(!1),di(r))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const $l=z("svp"),Na=64;class Lh{constructor(r,s){this.onValueChange_=this.onValueChange_.bind(this),this.value=s.value,this.value.emitter.on("change",this.onValueChange_),this.element=r.createElement("div"),this.element.classList.add($l()),s.viewProps.bindClassModifiers(this.element),s.viewProps.bindTabIndex(this.element);const l=r.createElement("canvas");l.height=Na,l.width=Na,l.classList.add($l("c")),this.element.appendChild(l),this.canvasElement=l;const p=r.createElement("div");p.classList.add($l("m")),this.element.appendChild(p),this.markerElem_=p,this.update_()}update_(){const r=Xt(this.canvasElement);if(!r)return;const s=this.value.rawValue.getComponents("hsv"),l=this.canvasElement.width,p=this.canvasElement.height,P=r.getImageData(0,0,l,p),U=P.data;for(let Fe=0;Fe<p;Fe++)for(let Qe=0;Qe<l;Qe++){const Mt=rn(Qe,0,l,0,100),Zt=rn(Fe,0,p,100,0),hs=ye(s[0],Mt,Zt),Hs=(Fe*l+Qe)*4;U[Hs]=hs[0],U[Hs+1]=hs[1],U[Hs+2]=hs[2],U[Hs+3]=255}r.putImageData(P,0,0);const ee=rn(s[1],0,100,0,100);this.markerElem_.style.left=`${ee}%`;const _e=rn(s[2],0,100,100,0);this.markerElem_.style.top=`${_e}%`}onValueChange_(){this.update_()}}class Yd{constructor(r,s){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=s.value,this.viewProps=s.viewProps,this.view=new Lh(r,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new as(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(r,s){if(!r.point)return;const l=rn(r.point.x,0,r.bounds.width,0,100),p=rn(r.point.y,0,r.bounds.height,100,0),[P,,,U]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Rt([P,l,p,U],"hsv"),s)}onPointerDown_(r){this.handlePointerEvent_(r.data,{forceEmit:!1,last:!1})}onPointerMove_(r){this.handlePointerEvent_(r.data,{forceEmit:!1,last:!1})}onPointerUp_(r){this.handlePointerEvent_(r.data,{forceEmit:!0,last:!0})}onKeyDown_(r){xr(r.key)&&r.preventDefault();const[s,l,p,P]=this.value.rawValue.getComponents("hsv"),U=or(!1),ee=Tn(U,di(r)),_e=Tn(U,Sn(r));ee===0&&_e===0||this.value.setRawValue(new Rt([s,l+ee,p+_e,P],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(r){const s=or(!1),l=Tn(s,di(r)),p=Tn(s,Sn(r));l===0&&p===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Zd{constructor(r,s){this.value=s.value,this.viewProps=s.viewProps,this.hPaletteC_=new $d(r,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Yd(r,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=s.supportsAlpha?{palette:new jd(r,{value:this.value,viewProps:this.viewProps}),text:new Ti(r,{parser:ii,baseStep:.1,props:de.fromObject({draggingScale:.01,formatter:Wn(2)}),value:ve(0,{constraint:new En({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ni({primary:this.value,secondary:this.alphaIcs_.text.value,forward:l=>l.rawValue.getComponents()[3],backward:(l,p)=>{const P=l.rawValue.getComponents();return P[3]=p.rawValue,new Rt(P,l.rawValue.mode)}}),this.textC_=new Kl(r,{colorType:s.colorType,parser:ii,value:this.value,viewProps:this.viewProps}),this.view=new Us(r,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:s.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Yl=z("colsw");class Zl{constructor(r,s){this.onValueChange_=this.onValueChange_.bind(this),s.value.emitter.on("change",this.onValueChange_),this.value=s.value,this.element=r.createElement("div"),this.element.classList.add(Yl()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("div");l.classList.add(Yl("sw")),this.element.appendChild(l),this.swatchElem_=l;const p=r.createElement("button");p.classList.add(Yl("b")),s.viewProps.bindDisabled(p),this.element.appendChild(p),this.buttonElement=p,this.update_()}update_(){const r=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ia(r)}onValueChange_(){this.update_()}}class Jd{constructor(r,s){this.value=s.value,this.viewProps=s.viewProps,this.view=new Zl(r,{value:this.value,viewProps:this.viewProps})}}class Jl{constructor(r,s){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=s.value,this.viewProps=s.viewProps,this.foldable_=Dt.create(s.expanded),this.swatchC_=new Jd(r,{value:this.value,viewProps:this.viewProps});const l=this.swatchC_.view.buttonElement;l.addEventListener("blur",this.onButtonBlur_),l.addEventListener("click",this.onButtonClick_),this.textC_=new Qi(r,{parser:s.parser,props:de.fromObject({formatter:s.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new T(r,{foldable:this.foldable_,pickerLayout:s.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=s.pickerLayout==="popup"?new Os(r,{viewProps:this.viewProps}):null;const p=new Zd(r,{colorType:s.colorType,supportsAlpha:s.supportsAlpha,value:this.value,viewProps:this.viewProps});p.view.allFocusableElements.forEach(P=>{P.addEventListener("blur",this.onPopupChildBlur_),P.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=p,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(p.view.element),Ni({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:P=>P.rawValue,backward:(P,U)=>U.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ge(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(r){if(!this.popC_)return;const s=this.view.element,l=r.relatedTarget;(!l||!s.contains(l))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(r){if(!this.popC_)return;const s=this.popC_.view.element,l=wt(r);l&&s.contains(l)||l&&l===this.swatchC_.view.buttonElement&&!vt(s.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(r){this.popC_?r.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&r.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Ql(m,r){return Rt.isColorObject(m)?Rt.fromObject(m,r):Rt.black(r)}function Qd(m){return w(m.getComponents("rgb")).reduce((r,s)=>r<<8|Math.floor(s)&255,0)}function ep(m){return m.getComponents("rgb").reduce((r,s,l)=>{const p=Math.floor(l===3?s*255:s)&255;return r<<8|p},0)>>>0}function tp(m){return new Rt([m>>16&255,m>>8&255,m&255],"rgb")}function np(m){return new Rt([m>>24&255,m>>16&255,m>>8&255,rn(m&255,0,255,0,1)],"rgb")}function ip(m){return typeof m!="number"?Rt.black():tp(m)}function sp(m){return typeof m!="number"?Rt.black():np(m)}function rp(m){const r=Wl(m);return r?(s,l)=>{ws(s,r(l))}:null}function op(m){const r=m?ep:Qd;return(s,l)=>{ws(s,r(l))}}function ap(m,r,s){const l=r.toRgbaObject(s);m.writeProperty("r",l.r),m.writeProperty("g",l.g),m.writeProperty("b",l.b),m.writeProperty("a",l.a)}function lp(m,r,s){const l=r.toRgbaObject(s);m.writeProperty("r",l.r),m.writeProperty("g",l.g),m.writeProperty("b",l.b)}function cp(m,r){return(s,l)=>{m?ap(s,l,r):lp(s,l,r)}}function ec(m){var r;return!!(m?.alpha||!((r=m?.color)===null||r===void 0)&&r.alpha)}function tc(m){return m?r=>Ia(r,"0x"):r=>Gl(r,"0x")}function hp(m){return"color"in m||"view"in m&&m.view==="color"}const up={id:"input-color-number",type:"input",accept:(m,r)=>{if(typeof m!="number"||!hp(r))return null;const s=Pl(r);return s?{initialValue:m,params:s}:null},binding:{reader:m=>ec(m.params)?sp:ip,equals:Rt.equals,writer:m=>op(ec(m.params))},controller:m=>{const r=ec(m.params),s="expanded"in m.params?m.params.expanded:void 0,l="picker"in m.params?m.params.picker:void 0;return new Jl(m.document,{colorType:"int",expanded:s??!1,formatter:tc(r),parser:Hl("int"),pickerLayout:l??"popup",supportsAlpha:r,value:m.value,viewProps:m.viewProps})}};function dp(m){return Rt.isRgbaColorObject(m)}function pp(m){return r=>Ql(r,m)}function fp(m,r){return s=>m?Ph(s,r):Sh(s,r)}const mp={id:"input-color-object",type:"input",accept:(m,r)=>{if(!Rt.isColorObject(m))return null;const s=Pl(r);return s?{initialValue:m,params:s}:null},binding:{reader:m=>pp(cs(m.params)),equals:Rt.equals,writer:m=>cp(dp(m.initialValue),cs(m.params))},controller:m=>{var r;const s=Rt.isRgbaColorObject(m.initialValue),l="expanded"in m.params?m.params.expanded:void 0,p="picker"in m.params?m.params.picker:void 0,P=(r=cs(m.params))!==null&&r!==void 0?r:"int";return new Jl(m.document,{colorType:P,expanded:l??!1,formatter:fp(s,P),parser:Hl(P),pickerLayout:p??"popup",supportsAlpha:s,value:m.value,viewProps:m.viewProps})}},vp={id:"input-color-string",type:"input",accept:(m,r)=>{if(typeof m!="string"||"view"in r&&r.view==="text")return null;const s=Ul(m,cs(r));if(!s||!Wl(s))return null;const l=Pl(r);return l?{initialValue:m,params:l}:null},binding:{reader:m=>{var r;return Mh((r=cs(m.params))!==null&&r!==void 0?r:"int")},equals:Rt.equals,writer:m=>{const r=Ul(m.initialValue,cs(m.params));if(!r)throw S.shouldNeverHappen();const s=rp(r);if(!s)throw S.notBindable();return s}},controller:m=>{const r=Ul(m.initialValue,cs(m.params));if(!r)throw S.shouldNeverHappen();const s=Wl(r);if(!s)throw S.shouldNeverHappen();const l="expanded"in m.params?m.params.expanded:void 0,p="picker"in m.params?m.params.picker:void 0;return new Jl(m.document,{colorType:r.type,expanded:l??!1,formatter:s,parser:Hl(r.type),pickerLayout:p??"popup",supportsAlpha:r.alpha,value:m.value,viewProps:m.viewProps})}};class Mr{constructor(r){this.components=r.components,this.asm_=r.assembly}constrain(r){const s=this.asm_.toComponents(r).map((l,p)=>{var P,U;return(U=(P=this.components[p])===null||P===void 0?void 0:P.constrain(l))!==null&&U!==void 0?U:l});return this.asm_.fromComponents(s)}}const ar=z("pndtxt");class kh{constructor(r,s){this.textViews=s.textViews,this.element=r.createElement("div"),this.element.classList.add(ar()),this.textViews.forEach(l=>{const p=r.createElement("div");p.classList.add(ar("a")),p.appendChild(l.element),this.element.appendChild(p)})}}function gp(m,r,s){return new Ti(m,{arrayPosition:s===0?"fst":s===r.axes.length-1?"lst":"mid",baseStep:r.axes[s].baseStep,parser:r.parser,props:r.axes[s].textProps,value:ve(0,{constraint:r.axes[s].constraint}),viewProps:r.viewProps})}class nc{constructor(r,s){this.value=s.value,this.viewProps=s.viewProps,this.acs_=s.axes.map((l,p)=>gp(r,s,p)),this.acs_.forEach((l,p)=>{Ni({primary:this.value,secondary:l.value,forward:P=>s.assembly.toComponents(P.rawValue)[p],backward:(P,U)=>{const ee=s.assembly.toComponents(P.rawValue);return ee[p]=U.rawValue,s.assembly.fromComponents(ee)}})}),this.view=new kh(r,{textViews:this.acs_.map(l=>l.view)})}}function Oa(m,r){return"step"in m&&!v(m.step)?new qn(m.step,r):null}function ic(m){return!v(m.max)&&!v(m.min)?new En({max:m.max,min:m.min}):!v(m.max)||!v(m.min)?new Bi({max:m.max,min:m.min}):null}function Rh(m){const r=Gn(m,En);if(r)return[r.values.get("min"),r.values.get("max")];const s=Gn(m,Bi);return s?[s.minValue,s.maxValue]:[void 0,void 0]}function _p(m,r){const s=[],l=Oa(m,r);l&&s.push(l);const p=ic(m);p&&s.push(p);const P=ir(m.options);return P&&s.push(P),new os(s)}const bp={id:"input-number",type:"input",accept:(m,r)=>{if(typeof m!="number")return null;const s=Re,l=Ie(r,{format:s.optional.function,max:s.optional.number,min:s.optional.number,options:s.optional.custom(si),step:s.optional.number});return l?{initialValue:m,params:l}:null},binding:{reader:m=>Vi,constraint:m=>_p(m.params,m.initialValue),writer:m=>ws},controller:m=>{var r;const s=m.value,l=m.constraint,p=l&&Gn(l,li);if(p)return new Mi(m.document,{props:new de({options:p.values.value("options")}),value:s,viewProps:m.viewProps});const P=(r="format"in m.params?m.params.format:void 0)!==null&&r!==void 0?r:Wn(Ss(l,s.rawValue)),U=l&&Gn(l,En);return U?new nr(m.document,{baseStep:ls(l),parser:ii,sliderProps:new de({maxValue:U.values.value("max"),minValue:U.values.value("min")}),textProps:de.fromObject({draggingScale:gi(l,s.rawValue),formatter:P}),value:s,viewProps:m.viewProps}):new Ti(m.document,{baseStep:ls(l),parser:ii,props:de.fromObject({draggingScale:gi(l,s.rawValue),formatter:P}),value:s,viewProps:m.viewProps})}};class Er{constructor(r=0,s=0){this.x=r,this.y=s}getComponents(){return[this.x,this.y]}static isObject(r){if(v(r))return!1;const s=r.x,l=r.y;return!(typeof s!="number"||typeof l!="number")}static equals(r,s){return r.x===s.x&&r.y===s.y}toObject(){return{x:this.x,y:this.y}}}const lr={toComponents:m=>m.getComponents(),fromComponents:m=>new Er(...m)},Or=z("p2d");class vo{constructor(r,s){this.element=r.createElement("div"),this.element.classList.add(Or()),s.viewProps.bindClassModifiers(this.element),B(s.expanded,W(this.element,Or(void 0,"expanded")));const l=r.createElement("div");l.classList.add(Or("h")),this.element.appendChild(l);const p=r.createElement("button");p.classList.add(Or("b")),p.appendChild(q(r,"p2dpad")),s.viewProps.bindDisabled(p),l.appendChild(p),this.buttonElement=p;const P=r.createElement("div");if(P.classList.add(Or("t")),l.appendChild(P),this.textElement=P,s.pickerLayout==="inline"){const U=r.createElement("div");U.classList.add(Or("p")),this.element.appendChild(U),this.pickerElement=U}else this.pickerElement=null}}const Sr=z("p2dp");class Ar{constructor(r,s){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=s.invertsY,this.maxValue_=s.maxValue,this.element=r.createElement("div"),this.element.classList.add(Sr()),s.layout==="popup"&&this.element.classList.add(Sr(void 0,"p")),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("div");l.classList.add(Sr("p")),s.viewProps.bindTabIndex(l),this.element.appendChild(l),this.padElement=l;const p=r.createElementNS(Ye,"svg");p.classList.add(Sr("g")),this.padElement.appendChild(p),this.svgElem_=p;const P=r.createElementNS(Ye,"line");P.classList.add(Sr("ax")),P.setAttributeNS(null,"x1","0"),P.setAttributeNS(null,"y1","50%"),P.setAttributeNS(null,"x2","100%"),P.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(P);const U=r.createElementNS(Ye,"line");U.classList.add(Sr("ax")),U.setAttributeNS(null,"x1","50%"),U.setAttributeNS(null,"y1","0"),U.setAttributeNS(null,"x2","50%"),U.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(U);const ee=r.createElementNS(Ye,"line");ee.classList.add(Sr("l")),ee.setAttributeNS(null,"x1","50%"),ee.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(ee),this.lineElem_=ee;const _e=r.createElement("div");_e.classList.add(Sr("m")),this.padElement.appendChild(_e),this.markerElem_=_e,s.value.emitter.on("change",this.onValueChange_),this.value=s.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[r,s]=this.value.rawValue.getComponents(),l=this.maxValue_,p=rn(r,-l,+l,0,100),P=rn(s,-l,+l,0,100),U=this.invertsY_?100-P:P;this.lineElem_.setAttributeNS(null,"x2",`${p}%`),this.lineElem_.setAttributeNS(null,"y2",`${U}%`),this.markerElem_.style.left=`${p}%`,this.markerElem_.style.top=`${U}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Ih(m,r,s){return[Tn(r[0],di(m)),Tn(r[1],Sn(m))*(s?1:-1)]}class Dh{constructor(r,s){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=s.value,this.viewProps=s.viewProps,this.baseSteps_=s.baseSteps,this.maxValue_=s.maxValue,this.invertsY_=s.invertsY,this.view=new Ar(r,{invertsY:this.invertsY_,layout:s.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new as(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(r,s){if(!r.point)return;const l=this.maxValue_,p=rn(r.point.x,0,r.bounds.width,-l,+l),P=rn(this.invertsY_?r.bounds.height-r.point.y:r.point.y,0,r.bounds.height,-l,+l);this.value.setRawValue(new Er(p,P),s)}onPointerDown_(r){this.handlePointerEvent_(r.data,{forceEmit:!1,last:!1})}onPointerMove_(r){this.handlePointerEvent_(r.data,{forceEmit:!1,last:!1})}onPointerUp_(r){this.handlePointerEvent_(r.data,{forceEmit:!0,last:!0})}onPadKeyDown_(r){xr(r.key)&&r.preventDefault();const[s,l]=Ih(r,this.baseSteps_,this.invertsY_);s===0&&l===0||this.value.setRawValue(new Er(this.value.rawValue.x+s,this.value.rawValue.y+l),{forceEmit:!1,last:!1})}onPadKeyUp_(r){const[s,l]=Ih(r,this.baseSteps_,this.invertsY_);s===0&&l===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class wp{constructor(r,s){var l,p;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=s.value,this.viewProps=s.viewProps,this.foldable_=Dt.create(s.expanded),this.popC_=s.pickerLayout==="popup"?new Os(r,{viewProps:this.viewProps}):null;const P=new Dh(r,{baseSteps:[s.axes[0].baseStep,s.axes[1].baseStep],invertsY:s.invertsY,layout:s.pickerLayout,maxValue:s.maxValue,value:this.value,viewProps:this.viewProps});P.view.allFocusableElements.forEach(U=>{U.addEventListener("blur",this.onPopupChildBlur_),U.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=P,this.textC_=new nc(r,{assembly:lr,axes:s.axes,parser:s.parser,value:this.value,viewProps:this.viewProps}),this.view=new vo(r,{expanded:this.foldable_.value("expanded"),pickerLayout:s.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(l=this.view.buttonElement)===null||l===void 0||l.addEventListener("blur",this.onPadButtonBlur_),(p=this.view.buttonElement)===null||p===void 0||p.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ni({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:U=>U.rawValue,backward:(U,ee)=>ee.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ge(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(r){if(!this.popC_)return;const s=this.view.element,l=r.relatedTarget;(!l||!s.contains(l))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(r){if(!this.popC_)return;const s=this.popC_.view.element,l=wt(r);l&&s.contains(l)||l&&l===this.view.buttonElement&&!vt(s.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(r){this.popC_?r.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&r.key==="Escape"&&this.view.buttonElement.focus()}}class go{constructor(r=0,s=0,l=0){this.x=r,this.y=s,this.z=l}getComponents(){return[this.x,this.y,this.z]}static isObject(r){if(v(r))return!1;const s=r.x,l=r.y,p=r.z;return!(typeof s!="number"||typeof l!="number"||typeof p!="number")}static equals(r,s){return r.x===s.x&&r.y===s.y&&r.z===s.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Fr={toComponents:m=>m.getComponents(),fromComponents:m=>new go(...m)};function zh(m){return go.isObject(m)?new go(m.x,m.y,m.z):new go}function xp(m,r){m.writeProperty("x",r.x),m.writeProperty("y",r.y),m.writeProperty("z",r.z)}function yp(m,r){return new Mr({assembly:Fr,components:[cr("x"in m?m.x:void 0,r.x),cr("y"in m?m.y:void 0,r.y),cr("z"in m?m.z:void 0,r.z)]})}function sc(m,r){return{baseStep:ls(r),constraint:r,textProps:de.fromObject({draggingScale:gi(r,m),formatter:Wn(Ss(r,m))})}}const rc={id:"input-point3d",type:"input",accept:(m,r)=>{if(!go.isObject(m))return null;const s=Re,l=Ie(r,{x:s.optional.custom(ji),y:s.optional.custom(ji),z:s.optional.custom(ji)});return l?{initialValue:m,params:l}:null},binding:{reader:m=>zh,constraint:m=>yp(m.params,m.initialValue),equals:go.equals,writer:m=>xp},controller:m=>{const r=m.value,s=m.constraint;if(!(s instanceof Mr))throw S.shouldNeverHappen();return new nc(m.document,{assembly:Fr,axes:[sc(r.rawValue.x,s.components[0]),sc(r.rawValue.y,s.components[1]),sc(r.rawValue.z,s.components[2])],parser:ii,value:r,viewProps:m.viewProps})}};class _o{constructor(r=0,s=0,l=0,p=0){this.x=r,this.y=s,this.z=l,this.w=p}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(r){if(v(r))return!1;const s=r.x,l=r.y,p=r.z,P=r.w;return!(typeof s!="number"||typeof l!="number"||typeof p!="number"||typeof P!="number")}static equals(r,s){return r.x===s.x&&r.y===s.y&&r.z===s.z&&r.w===s.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Br={toComponents:m=>m.getComponents(),fromComponents:m=>new _o(...m)};function Vh(m){return _o.isObject(m)?new _o(m.x,m.y,m.z,m.w):new _o}function Cp(m,r){m.writeProperty("x",r.x),m.writeProperty("y",r.y),m.writeProperty("z",r.z),m.writeProperty("w",r.w)}function Mp(m,r){return new Mr({assembly:Br,components:[cr("x"in m?m.x:void 0,r.x),cr("y"in m?m.y:void 0,r.y),cr("z"in m?m.z:void 0,r.z),cr("w"in m?m.w:void 0,r.w)]})}function Ep(m,r){return{baseStep:ls(r),constraint:r,textProps:de.fromObject({draggingScale:gi(r,m),formatter:Wn(Ss(r,m))})}}const Sp={id:"input-point4d",type:"input",accept:(m,r)=>{if(!_o.isObject(m))return null;const s=Re,l=Ie(r,{x:s.optional.custom(ji),y:s.optional.custom(ji),z:s.optional.custom(ji),w:s.optional.custom(ji)});return l?{initialValue:m,params:l}:null},binding:{reader:m=>Vh,constraint:m=>Mp(m.params,m.initialValue),equals:_o.equals,writer:m=>Cp},controller:m=>{const r=m.value,s=m.constraint;if(!(s instanceof Mr))throw S.shouldNeverHappen();return new nc(m.document,{assembly:Br,axes:r.rawValue.getComponents().map((l,p)=>Ep(l,s.components[p])),parser:ii,value:r,viewProps:m.viewProps})}};function Ap(m){const r=[],s=ir(m.options);return s&&r.push(s),new os(r)}const Pp={id:"input-string",type:"input",accept:(m,r)=>{if(typeof m!="string")return null;const s=Ie(r,{options:Re.optional.custom(si)});return s?{initialValue:m,params:s}:null},binding:{reader:m=>gs,constraint:m=>Ap(m.params),writer:m=>ws},controller:m=>{const r=m.document,s=m.value,l=m.constraint,p=l&&Gn(l,li);return p?new Mi(r,{props:new de({options:p.values.value("options")}),value:s,viewProps:m.viewProps}):new Qi(r,{parser:P=>P,props:de.fromObject({formatter:Qs}),value:s,viewProps:m.viewProps})}},qo={monitor:{defaultInterval:200,defaultLineCount:3}},bo=z("mll");class Nh{constructor(r,s){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=s.formatter,this.element=r.createElement("div"),this.element.classList.add(bo()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("textarea");l.classList.add(bo("i")),l.style.height=`calc(var(--bld-us) * ${s.lineCount})`,l.readOnly=!0,s.viewProps.bindDisabled(l),this.element.appendChild(l),this.textareaElem_=l,s.value.emitter.on("change",this.onValueUpdate_),this.value=s.value,this.update_()}update_(){const r=this.textareaElem_,s=r.scrollTop===r.scrollHeight-r.clientHeight,l=[];this.value.rawValue.forEach(p=>{p!==void 0&&l.push(this.formatter_(p))}),r.textContent=l.join(`
`),s&&(r.scrollTop=r.scrollHeight)}onValueUpdate_(){this.update_()}}class oc{constructor(r,s){this.value=s.value,this.viewProps=s.viewProps,this.view=new Nh(r,{formatter:s.formatter,lineCount:s.lineCount,value:this.value,viewProps:this.viewProps})}}const Fa=z("sgl");class Oh{constructor(r,s){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=s.formatter,this.element=r.createElement("div"),this.element.classList.add(Fa()),s.viewProps.bindClassModifiers(this.element);const l=r.createElement("input");l.classList.add(Fa("i")),l.readOnly=!0,l.type="text",s.viewProps.bindDisabled(l),this.element.appendChild(l),this.inputElement=l,s.value.emitter.on("change",this.onValueUpdate_),this.value=s.value,this.update_()}update_(){const r=this.value.rawValue,s=r[r.length-1];this.inputElement.value=s!==void 0?this.formatter_(s):""}onValueUpdate_(){this.update_()}}class ac{constructor(r,s){this.value=s.value,this.viewProps=s.viewProps,this.view=new Oh(r,{formatter:s.formatter,value:this.value,viewProps:this.viewProps})}}const lc={id:"monitor-bool",type:"monitor",accept:(m,r)=>{if(typeof m!="boolean")return null;const s=Ie(r,{lineCount:Re.optional.number});return s?{initialValue:m,params:s}:null},binding:{reader:m=>hi},controller:m=>{var r;return m.value.rawValue.length===1?new ac(m.document,{formatter:$n,value:m.value,viewProps:m.viewProps}):new oc(m.document,{formatter:$n,lineCount:(r=m.params.lineCount)!==null&&r!==void 0?r:qo.monitor.defaultLineCount,value:m.value,viewProps:m.viewProps})}},Pr=z("grl");class Tr{constructor(r,s){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=r.createElement("div"),this.element.classList.add(Pr()),s.viewProps.bindClassModifiers(this.element),this.formatter_=s.formatter,this.props_=s.props,this.cursor_=s.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const l=r.createElementNS(Ye,"svg");l.classList.add(Pr("g")),l.style.height=`calc(var(--bld-us) * ${s.lineCount})`,this.element.appendChild(l),this.svgElem_=l;const p=r.createElementNS(Ye,"polyline");this.svgElem_.appendChild(p),this.lineElem_=p;const P=r.createElement("div");P.classList.add(Pr("t"),z("tt")()),this.element.appendChild(P),this.tooltipElem_=P,s.value.emitter.on("change",this.onValueUpdate_),this.value=s.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const r=this.svgElem_.getBoundingClientRect(),s=this.value.rawValue.length-1,l=this.props_.get("minValue"),p=this.props_.get("maxValue"),P=[];this.value.rawValue.forEach((Qe,Mt)=>{if(Qe===void 0)return;const Zt=rn(Mt,0,s,0,r.width),hs=rn(Qe,l,p,r.height,0);P.push([Zt,hs].join(","))}),this.lineElem_.setAttributeNS(null,"points",P.join(" "));const U=this.tooltipElem_,ee=this.value.rawValue[this.cursor_.rawValue];if(ee===void 0){U.classList.remove(Pr("t","a"));return}const _e=rn(this.cursor_.rawValue,0,s,0,r.width),Fe=rn(ee,l,p,r.height,0);U.style.left=`${_e}px`,U.style.top=`${Fe}px`,U.textContent=`${this.formatter_(ee)}`,U.classList.contains(Pr("t","a"))||(U.classList.add(Pr("t","a"),Pr("t","in")),Oe(U),U.classList.remove(Pr("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Tp{constructor(r,s){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=s.props,this.value=s.value,this.viewProps=s.viewProps,this.cursor_=ve(-1),this.view=new Tr(r,{cursor:this.cursor_,formatter:s.formatter,lineCount:s.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!vt(r))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const l=new as(this.view.element);l.emitter.on("down",this.onGraphPointerDown_),l.emitter.on("move",this.onGraphPointerMove_),l.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(r){const s=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(rn(r.offsetX,0,s.width,0,this.value.rawValue.length))}onGraphPointerDown_(r){this.onGraphPointerMove_(r)}onGraphPointerMove_(r){if(!r.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(rn(r.data.point.x,0,r.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function cc(m){return"format"in m&&!v(m.format)?m.format:Wn(2)}function hc(m){var r;return m.value.rawValue.length===1?new ac(m.document,{formatter:cc(m.params),value:m.value,viewProps:m.viewProps}):new oc(m.document,{formatter:cc(m.params),lineCount:(r=m.params.lineCount)!==null&&r!==void 0?r:qo.monitor.defaultLineCount,value:m.value,viewProps:m.viewProps})}function Lp(m){var r,s,l;return new Tp(m.document,{formatter:cc(m.params),lineCount:(r=m.params.lineCount)!==null&&r!==void 0?r:qo.monitor.defaultLineCount,props:de.fromObject({maxValue:(s="max"in m.params?m.params.max:null)!==null&&s!==void 0?s:100,minValue:(l="min"in m.params?m.params.min:null)!==null&&l!==void 0?l:0}),value:m.value,viewProps:m.viewProps})}function Fh(m){return"view"in m&&m.view==="graph"}const Bh={id:"monitor-number",type:"monitor",accept:(m,r)=>{if(typeof m!="number")return null;const s=Re,l=Ie(r,{format:s.optional.function,lineCount:s.optional.number,max:s.optional.number,min:s.optional.number,view:s.optional.string});return l?{initialValue:m,params:l}:null},binding:{defaultBufferSize:m=>Fh(m)?64:1,reader:m=>Vi},controller:m=>Fh(m.params)?Lp(m):hc(m)},kp={id:"monitor-string",type:"monitor",accept:(m,r)=>{if(typeof m!="string")return null;const s=Re,l=Ie(r,{lineCount:s.optional.number,multiline:s.optional.boolean});return l?{initialValue:m,params:l}:null},binding:{reader:m=>gs},controller:m=>{var r;const s=m.value;return s.rawValue.length>1||"multiline"in m.params&&m.params.multiline?new oc(m.document,{formatter:Qs,lineCount:(r=m.params.lineCount)!==null&&r!==void 0?r:qo.monitor.defaultLineCount,value:s,viewProps:m.viewProps}):new ac(m.document,{formatter:Qs,value:s,viewProps:m.viewProps})}};function Rp(m,r){var s;const l=m.accept(r.target.read(),r.params);if(v(l))return null;const p=Re,P={target:r.target,initialValue:l.initialValue,params:l.params},U=m.binding.reader(P),ee=m.binding.constraint?m.binding.constraint(P):void 0,_e=ve(U(l.initialValue),{constraint:ee,equals:m.binding.equals}),Fe=new ni({reader:U,target:r.target,value:_e,writer:m.binding.writer(P)}),Qe=p.optional.boolean(r.params.disabled).value,Mt=p.optional.boolean(r.params.hidden).value,Zt=m.controller({constraint:ee,document:r.document,initialValue:l.initialValue,params:l.params,value:Fe.value,viewProps:He.create({disabled:Qe,hidden:Mt})});return new Bt(r.document,{binding:Fe,blade:yt(),props:de.fromObject({label:"label"in r.params?(s=p.optional.string(r.params.label).value)!==null&&s!==void 0?s:null:r.target.key}),valueController:Zt})}function Ip(m,r){return r===0?new rs:new gn(m,r??qo.monitor.defaultInterval)}function Dp(m,r){var s,l,p;const P=Re,U=m.accept(r.target.read(),r.params);if(v(U))return null;const ee={target:r.target,initialValue:U.initialValue,params:U.params},_e=m.binding.reader(ee),Fe=(l=(s=P.optional.number(r.params.bufferSize).value)!==null&&s!==void 0?s:m.binding.defaultBufferSize&&m.binding.defaultBufferSize(U.params))!==null&&l!==void 0?l:1,Qe=P.optional.number(r.params.interval).value,Mt=new Fn({reader:_e,target:r.target,ticker:Ip(r.document,Qe),value:qt(Fe)}),Zt=P.optional.boolean(r.params.disabled).value,hs=P.optional.boolean(r.params.hidden).value,Hs=m.controller({document:r.document,params:U.params,value:Mt.value,viewProps:He.create({disabled:Zt,hidden:hs})});return new ln(r.document,{binding:Mt,blade:yt(),props:de.fromObject({label:"label"in r.params?(p=P.optional.string(r.params.label).value)!==null&&p!==void 0?p:null:r.target.key}),valueController:Hs})}class zp{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(r){r.type==="blade"?this.pluginsMap_.blades.unshift(r):r.type==="input"?this.pluginsMap_.inputs.unshift(r):r.type==="monitor"&&this.pluginsMap_.monitors.unshift(r)}createInput(r,s,l){const p=s.read();if(v(p))throw new S({context:{key:s.key},type:"nomatchingcontroller"});const P=this.pluginsMap_.inputs.reduce((U,ee)=>U??Rp(ee,{document:r,target:s,params:l}),null);if(P)return P;throw new S({context:{key:s.key},type:"nomatchingcontroller"})}createMonitor(r,s,l){const p=this.pluginsMap_.monitors.reduce((P,U)=>P??Dp(U,{document:r,params:l,target:s}),null);if(p)return p;throw new S({context:{key:s.key},type:"nomatchingcontroller"})}createBlade(r,s){const l=this.pluginsMap_.blades.reduce((p,P)=>p??Yi(P,{document:r,params:s}),null);if(!l)throw new S({type:"nomatchingview",context:{params:s}});return l}createBladeApi(r){if(r instanceof Bt)return new Gt(r);if(r instanceof ln)return new Ft(r);if(r instanceof xt)return new Nn(r,this);const s=this.pluginsMap_.blades.reduce((l,p)=>l??p.api({controller:r,pool:this}),null);if(!s)throw S.shouldNeverHappen();return s}}function Vp(){const m=new zp;return[Fp,rc,Sp,Pp,bp,vp,mp,up,I,lc,kp,Bh,lt,Ct,Cn,Rn].forEach(r=>{m.register(r)}),m}function Np(m){return Er.isObject(m)?new Er(m.x,m.y):new Er}function Op(m,r){m.writeProperty("x",r.x),m.writeProperty("y",r.y)}function cr(m,r){if(!m)return;const s=[],l=Oa(m,r);l&&s.push(l);const p=ic(m);return p&&s.push(p),new os(s)}function hr(m,r){return new Mr({assembly:lr,components:[cr("x"in m?m.x:void 0,r.x),cr("y"in m?m.y:void 0,r.y)]})}function Uh(m,r){const[s,l]=m?Rh(m):[];if(!v(s)||!v(l))return Math.max(Math.abs(s??0),Math.abs(l??0));const p=ls(m);return Math.max(Math.abs(p)*10,Math.abs(r)*10)}function Hh(m,r){const s=r instanceof Mr?r.components[0]:void 0,l=r instanceof Mr?r.components[1]:void 0,p=Uh(s,m.x),P=Uh(l,m.y);return Math.max(p,P)}function Gh(m,r){return{baseStep:ls(r),constraint:r,textProps:de.fromObject({draggingScale:gi(r,m),formatter:Wn(Ss(r,m))})}}function Wh(m){if(!("y"in m))return!1;const r=m.y;return r&&"inverted"in r?!!r.inverted:!1}const Fp={id:"input-point2d",type:"input",accept:(m,r)=>{if(!Er.isObject(m))return null;const s=Re,l=Ie(r,{expanded:s.optional.boolean,picker:s.optional.custom(Es),x:s.optional.custom(ji),y:s.optional.object({inverted:s.optional.boolean,max:s.optional.number,min:s.optional.number,step:s.optional.number})});return l?{initialValue:m,params:l}:null},binding:{reader:m=>Np,constraint:m=>hr(m.params,m.initialValue),equals:Er.equals,writer:m=>Op},controller:m=>{const r=m.document,s=m.value,l=m.constraint;if(!(l instanceof Mr))throw S.shouldNeverHappen();const p="expanded"in m.params?m.params.expanded:void 0,P="picker"in m.params?m.params.picker:void 0;return new wp(r,{axes:[Gh(s.rawValue.x,l.components[0]),Gh(s.rawValue.y,l.components[1])],expanded:p??!1,invertsY:Wh(m.params),maxValue:Hh(s.rawValue,l),parser:ii,pickerLayout:P??"popup",value:s,viewProps:m.viewProps})}};class jh extends i{constructor(r){super(r),this.emitter_=new L,this.controller_.valueController.value.emitter.on("change",s=>{this.emitter_.emit("change",{event:new a(this,s.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(r){this.controller_.props.set("label",r)}get options(){return this.controller_.valueController.props.get("options")}set options(r){this.controller_.valueController.props.set("options",r)}get value(){return this.controller_.valueController.value.rawValue}set value(r){this.controller_.valueController.value.rawValue=r}on(r,s){const l=s.bind(this);return this.emitter_.on(r,p=>{l(p.event)}),this}}class uc extends i{constructor(r){super(r),this.emitter_=new L,this.controller_.valueController.value.emitter.on("change",s=>{this.emitter_.emit("change",{event:new a(this,s.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(r){this.controller_.props.set("label",r)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(r){this.controller_.valueController.sliderController.props.set("maxValue",r)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(r){this.controller_.valueController.sliderController.props.set("minValue",r)}get value(){return this.controller_.valueController.value.rawValue}set value(r){this.controller_.valueController.value.rawValue=r}on(r,s){const l=s.bind(this);return this.emitter_.on(r,p=>{l(p.event)}),this}}class dc extends i{constructor(r){super(r),this.emitter_=new L,this.controller_.valueController.value.emitter.on("change",s=>{this.emitter_.emit("change",{event:new a(this,s.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(r){this.controller_.props.set("label",r)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(r){this.controller_.valueController.props.set("formatter",r)}get value(){return this.controller_.valueController.value.rawValue}set value(r){this.controller_.valueController.value.rawValue=r}on(r,s){const l=s.bind(this);return this.emitter_.on(r,p=>{l(p.event)}),this}}const Kh=function(){return{id:"list",type:"blade",accept(m){const r=Re,s=Ie(m,{options:r.required.custom(si),value:r.required.raw,view:r.required.constant("list"),label:r.optional.string});return s?{params:s}:null},controller(m){const r=new li(vi(m.params.options)),s=ve(m.params.value,{constraint:r}),l=new Mi(m.document,{props:new de({options:r.values.value("options")}),value:s,viewProps:m.viewProps});return new it(m.document,{blade:m.blade,props:de.fromObject({label:m.params.label}),valueController:l})},api(m){return!(m.controller instanceof it)||!(m.controller.valueController instanceof Mi)?null:new jh(m.controller)}}}();function Bp(m){return m.reduce((r,s)=>Object.assign(r,{[s.presetKey]:s.read()}),{})}function Up(m,r){m.forEach(s=>{const l=r[s.target.presetKey];l!==void 0&&s.writer(s.target,s.reader(l))})}class Hp extends yn{constructor(r,s){super(r,s)}get element(){return this.controller_.view.element}importPreset(r){const s=this.controller_.rackController.rack.find(Bt).map(l=>l.binding);Up(s,r),this.refresh()}exportPreset(){const r=this.controller_.rackController.rack.find(Bt).map(s=>s.binding.target);return Bp(r)}refresh(){this.controller_.rackController.rack.find(Bt).forEach(r=>{r.binding.read()}),this.controller_.rackController.rack.find(ln).forEach(r=>{r.binding.read()})}}class Gp extends et{constructor(r,s){super(r,{expanded:s.expanded,blade:s.blade,props:s.props,root:!0,viewProps:s.viewProps})}}const Wp={id:"slider",type:"blade",accept(m){const r=Re,s=Ie(m,{max:r.required.number,min:r.required.number,view:r.required.constant("slider"),format:r.optional.function,label:r.optional.string,value:r.optional.number});return s?{params:s}:null},controller(m){var r,s;const l=(r=m.params.value)!==null&&r!==void 0?r:0,p=new En({max:m.params.max,min:m.params.min}),P=new nr(m.document,{baseStep:1,parser:ii,sliderProps:new de({maxValue:p.values.value("max"),minValue:p.values.value("min")}),textProps:de.fromObject({draggingScale:gi(void 0,l),formatter:(s=m.params.format)!==null&&s!==void 0?s:Wi}),value:ve(l,{constraint:p}),viewProps:m.viewProps});return new it(m.document,{blade:m.blade,props:de.fromObject({label:m.params.label}),valueController:P})},api(m){return!(m.controller instanceof it)||!(m.controller.valueController instanceof nr)?null:new uc(m.controller)}},jp=function(){return{id:"text",type:"blade",accept(m){const r=Re,s=Ie(m,{parse:r.required.function,value:r.required.raw,view:r.required.constant("text"),format:r.optional.function,label:r.optional.string});return s?{params:s}:null},controller(m){var r;const s=new Qi(m.document,{parser:m.params.parse,props:de.fromObject({formatter:(r=m.params.format)!==null&&r!==void 0?r:l=>String(l)}),value:ve(m.params.value),viewProps:m.viewProps});return new it(m.document,{blade:m.blade,props:de.fromObject({label:m.params.label}),valueController:s})},api(m){return!(m.controller instanceof it)||!(m.controller.valueController instanceof Qi)?null:new dc(m.controller)}}}();function Kp(m){const r=m.createElement("div");return r.classList.add(z("dfw")()),m.body&&m.body.appendChild(r),r}function qh(m,r,s){if(m.querySelector(`style[data-tp-style=${r}]`))return;const l=m.createElement("style");l.dataset.tpStyle=r,l.textContent=s,m.head.appendChild(l)}class Xh extends Hp{constructor(r){var s,l;const p=r??{},P=(s=p.document)!==null&&s!==void 0?s:en(),U=Vp(),ee=new Gp(P,{expanded:p.expanded,blade:yt(),props:de.fromObject({title:p.title}),viewProps:He.create()});super(ee,U),this.pool_=U,this.containerElem_=(l=p.container)!==null&&l!==void 0?l:Kp(P),this.containerElem_.appendChild(this.element),this.doc_=P,this.usesDefaultWrapper_=!p.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw S.alreadyDisposed();return this.doc_}dispose(){const r=this.containerElem_;if(!r)throw S.alreadyDisposed();if(this.usesDefaultWrapper_){const s=r.parentElement;s&&s.removeChild(r)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(r){("plugin"in r?[r.plugin]:"plugins"in r?r.plugins:[]).forEach(s=>{this.pool_.register(s),this.embedPluginStyle_(s)})}embedPluginStyle_(r){r.css&&qh(this.document,`plugin-${r.id}`,r.css)}setUpDefaultPlugins_(){qh(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(r=>{this.embedPluginStyle_(r)}),this.registerPlugin({plugins:[Wp,Kh,Rn,jp]})}}const qp=new n("3.1.9");t.BladeApi=i,t.ButtonApi=M,t.FolderApi=yn,t.InputBindingApi=Gt,t.ListApi=jh,t.MonitorBindingApi=Ft,t.Pane=Xh,t.SeparatorApi=ht,t.SliderApi=uc,t.TabApi=mn,t.TabPageApi=Ci,t.TextApi=dc,t.TpChangeEvent=a,t.VERSION=qp,Object.defineProperty(t,"__esModule",{value:!0})})})(Sm,Sm.exports);var Fd=Sm.exports;function b_(h,e){if(e===Eb)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),h;if(e===pl||e===ld){let t=h.getIndex();if(t===null){const a=[],c=h.getAttribute("position");if(c!==void 0){for(let u=0;u<c.count;u++)a.push(u);h.setIndex(a),t=h.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),h}const n=t.count-2,i=[];if(e===pl)for(let a=1;a<=n;a++)i.push(t.getX(0)),i.push(t.getX(a)),i.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(i.push(t.getX(a)),i.push(t.getX(a+1)),i.push(t.getX(a+2))):(i.push(t.getX(a+2)),i.push(t.getX(a+1)),i.push(t.getX(a)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=h.clone();return o.setIndex(i),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),h}class cw extends ps{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new oT(t)}),this.register(function(t){return new fT(t)}),this.register(function(t){return new mT(t)}),this.register(function(t){return new vT(t)}),this.register(function(t){return new lT(t)}),this.register(function(t){return new cT(t)}),this.register(function(t){return new hT(t)}),this.register(function(t){return new uT(t)}),this.register(function(t){return new rT(t)}),this.register(function(t){return new dT(t)}),this.register(function(t){return new aT(t)}),this.register(function(t){return new pT(t)}),this.register(function(t){return new iT(t)}),this.register(function(t){return new gT(t)}),this.register(function(t){return new _T(t)})}load(e,t,n,i){const o=this;let a;this.resourcePath!==""?a=this.resourcePath:this.path!==""?a=this.path:a=Is.extractUrlBase(e),this.manager.itemStart(e);const c=function(d){i?i(d):console.error(d),o.manager.itemError(e),o.manager.itemEnd(e)},u=new ss(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(d){try{o.parse(d,a,function(v){t(v),o.manager.itemEnd(e)},c)}catch(v){c(v)}},n,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let o;const a={},c={},u=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(u.decode(new Uint8Array(e,0,4))===hw){try{a[hn.KHR_BINARY_GLTF]=new bT(e)}catch(v){i&&i(v);return}o=JSON.parse(a[hn.KHR_BINARY_GLTF].content)}else o=JSON.parse(u.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const d=new RT(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let v=0;v<this.pluginCallbacks.length;v++){const g=this.pluginCallbacks[v](d);c[g.name]=g,a[g.name]=!0}if(o.extensionsUsed)for(let v=0;v<o.extensionsUsed.length;++v){const g=o.extensionsUsed[v],b=o.extensionsRequired||[];switch(g){case hn.KHR_MATERIALS_UNLIT:a[g]=new sT;break;case hn.KHR_DRACO_MESH_COMPRESSION:a[g]=new wT(o,this.dracoLoader);break;case hn.KHR_TEXTURE_TRANSFORM:a[g]=new xT;break;case hn.KHR_MESH_QUANTIZATION:a[g]=new yT;break;default:b.indexOf(g)>=0&&c[g]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}d.setExtensions(a),d.setPlugins(c),d.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,o){n.parse(e,t,i,o)})}}function nT(){let h={};return{get:function(e){return h[e]},add:function(e,t){h[e]=t},remove:function(e){delete h[e]},removeAll:function(){h={}}}}const hn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class iT{constructor(e){this.parser=e,this.name=hn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let c;const u=new $e(16777215);a.color!==void 0&&u.fromArray(a.color);const d=a.range!==void 0?a.range:0;switch(a.type){case"directional":c=new fh(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new ph(u),c.distance=d;break;case"spot":c=new Md(u),c.distance=d,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,c.angle=a.spot.outerConeAngle,c.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return c.position.set(0,0,0),c.decay=2,Ro(c,a),a.intensity!==void 0&&(c.intensity=a.intensity),c.name=t.createUniqueName(a.name||"light_"+e),i=Promise.resolve(c),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],o=(i.extensions&&i.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return n._getNodeRef(t.cache,o,a)})}}class sT{constructor(){this.name=hn.KHR_MATERIALS_UNLIT}getMaterialType(){return wi}extendParams(e,t,n){const i=[];e.color=new $e(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const a=o.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}o.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",o.baseColorTexture,ds))}return Promise.all(i)}}class rT{constructor(e){this.parser=e,this.name=hn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class oT{constructor(e){this.parser=e,this.name=hn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const c=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new De(c,c)}return Promise.all(o)}}class aT{constructor(e){this.parser=e,this.name=hn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(o)}}class lT{constructor(e){this.parser=e,this.name=hn.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new $e(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];return a.sheenColorFactor!==void 0&&t.sheenColor.fromArray(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,ds)),a.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(o)}}class cT{constructor(e){this.parser=e,this.name=hn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(o)}}class hT{constructor(e){this.parser=e,this.name=hn.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const c=a.attenuationColor||[1,1,1];return t.attenuationColor=new $e(c[0],c[1],c[2]),Promise.all(o)}}class uT{constructor(e){this.parser=e,this.name=hn.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class dT{constructor(e){this.parser=e,this.name=hn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const c=a.specularColorFactor||[1,1,1];return t.specularColor=new $e(c[0],c[1],c[2]),a.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,ds)),Promise.all(o)}}class pT{constructor(e){this.parser=e,this.name=hn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:$i}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&o.push(n.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(o)}}class fT{constructor(e){this.parser=e,this.name=hn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const o=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,a)}}class mT{constructor(e){this.parser=e,this.name=hn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],c=i.images[a.source];let u=n.textureLoader;if(c.uri){const d=n.options.manager.getHandler(c.uri);d!==null&&(u=d)}return this.detectSupport().then(function(d){if(d)return n.loadTextureImage(e,a.source,u);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class vT{constructor(e){this.parser=e,this.name=hn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],c=i.images[a.source];let u=n.textureLoader;if(c.uri){const d=n.options.manager.getHandler(c.uri);d!==null&&(u=d)}return this.detectSupport().then(function(d){if(d)return n.loadTextureImage(e,a.source,u);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class gT{constructor(e){this.name=hn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(c){const u=i.byteOffset||0,d=i.byteLength||0,v=i.count,g=i.byteStride,b=new Uint8Array(c,u,d);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(v,g,b,i.mode,i.filter).then(function(y){return y.buffer}):a.ready.then(function(){const y=new ArrayBuffer(v*g);return a.decodeGltfBuffer(new Uint8Array(y),v,g,b,i.mode,i.filter),y})})}else return null}}class _T{constructor(e){this.name=hn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const u of i.primitives)if(u.mode!==Ws.TRIANGLES&&u.mode!==Ws.TRIANGLE_STRIP&&u.mode!==Ws.TRIANGLE_FAN&&u.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],c={};for(const u in o)a.push(this.parser.getDependency("accessor",o[u]).then(d=>(c[u]=d,c[u])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(u=>{const d=u.pop(),v=d.isGroup?d.children:[d],g=u[0].count,b=[];for(const y of v){const S=new It,E=new X,M=new Vn,L=new X(1,1,1),R=new Xm(y.geometry,y.material,g);for(let z=0;z<g;z++)c.TRANSLATION&&E.fromBufferAttribute(c.TRANSLATION,z),c.ROTATION&&M.fromBufferAttribute(c.ROTATION,z),c.SCALE&&L.fromBufferAttribute(c.SCALE,z),R.setMatrixAt(z,S.compose(E,M,L));for(const z in c)z!=="TRANSLATION"&&z!=="ROTATION"&&z!=="SCALE"&&y.geometry.setAttribute(z,c[z]);Jt.prototype.copy.call(R,y),this.parser.assignFinalMaterial(R),b.push(R)}return d.isGroup?(d.clear(),d.add(...b),d):b[0]}))}}const hw="glTF",Ec=12,w_={JSON:1313821514,BIN:5130562};class bT{constructor(e){this.name=hn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ec),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==hw)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-Ec,o=new DataView(e,Ec);let a=0;for(;a<i;){const c=o.getUint32(a,!0);a+=4;const u=o.getUint32(a,!0);if(a+=4,u===w_.JSON){const d=new Uint8Array(e,Ec+a,c);this.content=n.decode(d)}else if(u===w_.BIN){const d=Ec+a;this.body=e.slice(d,d+c)}a+=c}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class wT{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=hn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,c={},u={},d={};for(const v in a){const g=Am[v]||v.toLowerCase();c[g]=a[v]}for(const v in e.attributes){const g=Am[v]||v.toLowerCase();if(a[v]!==void 0){const b=n.accessors[e.attributes[v]],y=cl[b.componentType];d[g]=y.name,u[g]=b.normalized===!0}}return t.getDependency("bufferView",o).then(function(v){return new Promise(function(g){i.decodeDracoFile(v,function(b){for(const y in b.attributes){const S=b.attributes[y],E=u[y];E!==void 0&&(S.normalized=E)}g(b)},c,d)})})}}class xT{constructor(){this.name=hn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class yT{constructor(){this.name=hn.KHR_MESH_QUANTIZATION}}class uw extends Aa{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=e*i*3+i;for(let a=0;a!==i;a++)t[a]=n[o+a];return t}interpolate_(e,t,n,i){const o=this.resultBuffer,a=this.sampleValues,c=this.valueSize,u=c*2,d=c*3,v=i-t,g=(n-t)/v,b=g*g,y=b*g,S=e*d,E=S-d,M=-2*y+3*b,L=y-b,R=1-M,z=L-b+g;for(let V=0;V!==c;V++){const H=a[E+V+c],B=a[E+V+u]*v,j=a[S+V+c],F=a[S+V]*v;o[V]=R*H+z*B+M*j+L*F}return o}}const CT=new Vn;class MT extends uw{interpolate_(e,t,n,i){const o=super.interpolate_(e,t,n,i);return CT.fromArray(o).normalize().toArray(o),o}}const Ws={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},cl={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},x_={9728:ei,9729:Ln,9984:hl,9985:$c,9986:ul,9987:gr},y_={33071:qi,33648:ba,10497:mr},Rf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Am={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Lo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ET={CUBICSPLINE:void 0,LINEAR:to,STEP:xa},If={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ST(h){return h.DefaultMaterial===void 0&&(h.DefaultMaterial=new Wo({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:eo})),h.DefaultMaterial}function na(h,e,t){for(const n in t.extensions)h[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Ro(h,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(h.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function AT(h,e,t){let n=!1,i=!1,o=!1;for(let d=0,v=e.length;d<v;d++){const g=e[d];if(g.POSITION!==void 0&&(n=!0),g.NORMAL!==void 0&&(i=!0),g.COLOR_0!==void 0&&(o=!0),n&&i&&o)break}if(!n&&!i&&!o)return Promise.resolve(h);const a=[],c=[],u=[];for(let d=0,v=e.length;d<v;d++){const g=e[d];if(n){const b=g.POSITION!==void 0?t.getDependency("accessor",g.POSITION):h.attributes.position;a.push(b)}if(i){const b=g.NORMAL!==void 0?t.getDependency("accessor",g.NORMAL):h.attributes.normal;c.push(b)}if(o){const b=g.COLOR_0!==void 0?t.getDependency("accessor",g.COLOR_0):h.attributes.color;u.push(b)}}return Promise.all([Promise.all(a),Promise.all(c),Promise.all(u)]).then(function(d){const v=d[0],g=d[1],b=d[2];return n&&(h.morphAttributes.position=v),i&&(h.morphAttributes.normal=g),o&&(h.morphAttributes.color=b),h.morphTargetsRelative=!0,h})}function PT(h,e){if(h.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)h.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(h.morphTargetInfluences.length===t.length){h.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)h.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function TT(h){let e;const t=h.extensions&&h.extensions[hn.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Df(t.attributes):e=h.indices+":"+Df(h.attributes)+":"+h.mode,h.targets!==void 0)for(let n=0,i=h.targets.length;n<i;n++)e+=":"+Df(h.targets[n]);return e}function Df(h){let e="";const t=Object.keys(h).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+h[t[n]]+";";return e}function Pm(h){switch(h){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function LT(h){return h.search(/\.jpe?g($|\?)/i)>0||h.search(/^data\:image\/jpeg/)===0?"image/jpeg":h.search(/\.webp($|\?)/i)>0||h.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const kT=new It;class RT{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new nT,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,o=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,o=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&o<98?this.textureLoader=new Cl(this.options.manager):this.textureLoader=new av(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ss(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const c={scene:a[0][i.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:i.asset,parser:n,userData:{}};na(o,c,i),Ro(c,i),Promise.all(n._invokeAll(function(u){return u.afterRoot&&u.afterRoot(c)})).then(function(){e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,o=t.length;i<o;i++){const a=t[i].joints;for(let c=0,u=a.length;c<u;c++)e[a[c]].isBone=!0}for(let i=0,o=e.length;i<o;i++){const a=e[i];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),o=(a,c)=>{const u=this.associations.get(a);u!=null&&this.associations.set(c,u);for(const[d,v]of a.children.entries())o(v,c.children[d])};return o(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const o=e(t[i]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":i=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(o,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[hn.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(o,a){n.load(Is.resolveURL(t.uri,i.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const a=Rf[i.type],c=cl[i.componentType],u=i.normalized===!0,d=new c(i.count*a);return Promise.resolve(new pn(d,a,u))}const o=[];return i.bufferView!==void 0?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),i.sparse!==void 0&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(a){const c=a[0],u=Rf[i.type],d=cl[i.componentType],v=d.BYTES_PER_ELEMENT,g=v*u,b=i.byteOffset||0,y=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,S=i.normalized===!0;let E,M;if(y&&y!==g){const L=Math.floor(b/y),R="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+L+":"+i.count;let z=t.cache.get(R);z||(E=new d(c,L*y,i.count*y/v),z=new bl(E,y/v),t.cache.add(R,z)),M=new no(z,u,b%y/v,S)}else c===null?E=new d(i.count*u):E=new d(c,b,i.count*u),M=new pn(E,u,S);if(i.sparse!==void 0){const L=Rf.SCALAR,R=cl[i.sparse.indices.componentType],z=i.sparse.indices.byteOffset||0,V=i.sparse.values.byteOffset||0,H=new R(a[1],z,i.sparse.count*L),B=new d(a[2],V,i.sparse.count*u);c!==null&&(M=new pn(M.array.slice(),M.itemSize,M.normalized));for(let j=0,F=H.length;j<F;j++){const W=H[j];if(M.setX(W,B[j*u]),u>=2&&M.setY(W,B[j*u+1]),u>=3&&M.setZ(W,B[j*u+2]),u>=4&&M.setW(W,B[j*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return M})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,o=t.images[i];let a=this.textureLoader;if(o.uri){const c=n.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,n){const i=this,o=this.json,a=o.textures[e],c=o.images[t],u=(c.uri||c.bufferView)+":"+a.sampler;if(this.textureCache[u])return this.textureCache[u];const d=this.loadImageSource(t,n).then(function(v){v.flipY=!1,v.name=a.name||c.name||"",v.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(v.name=c.uri);const g=(o.samplers||{})[a.sampler]||{};return v.magFilter=x_[g.magFilter]||Ln,v.minFilter=x_[g.minFilter]||gr,v.wrapS=y_[g.wrapS]||mr,v.wrapT=y_[g.wrapT]||mr,i.associations.set(v,{textures:e}),v}).catch(function(){return null});return this.textureCache[u]=d,d}loadImageSource(e,t){const n=this,i=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(g=>g.clone());const a=i.images[e],c=self.URL||self.webkitURL;let u=a.uri||"",d=!1;if(a.bufferView!==void 0)u=n.getDependency("bufferView",a.bufferView).then(function(g){d=!0;const b=new Blob([g],{type:a.mimeType});return u=c.createObjectURL(b),u});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const v=Promise.resolve(u).then(function(g){return new Promise(function(b,y){let S=b;t.isImageBitmapLoader===!0&&(S=function(E){const M=new Kn(E);M.needsUpdate=!0,b(M)}),t.load(Is.resolveURL(g,o.path),S,void 0,y)})}).then(function(g){return d===!0&&c.revokeObjectURL(u),g.userData.mimeType=a.mimeType||LT(a.uri),g}).catch(function(g){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),g});return this.sourceCache[e]=v,v}assignTexture(e,t,n,i){const o=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),o.extensions[hn.KHR_TEXTURE_TRANSFORM]){const c=n.extensions!==void 0?n.extensions[hn.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const u=o.associations.get(a);a=o.extensions[hn.KHR_TEXTURE_TRANSFORM].extendTexture(a,c),o.associations.set(a,u)}}return i!==void 0&&(a.colorSpace=i),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+n.uuid;let u=this.cache.get(c);u||(u=new eh,ti.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(c,u)),n=u}else if(e.isLine){const c="LineBasicMaterial:"+n.uuid;let u=this.cache.get(c);u||(u=new Fi,ti.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,this.cache.add(c,u)),n=u}if(i||o||a){let c="ClonedMaterial:"+n.uuid+":";i&&(c+="derivative-tangents:"),o&&(c+="vertex-colors:"),a&&(c+="flat-shading:");let u=this.cache.get(c);u||(u=n.clone(),o&&(u.vertexColors=!0),a&&(u.flatShading=!0),i&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(c,u),this.associations.set(u,this.associations.get(n))),n=u}e.material=n}getMaterialType(){return Wo}loadMaterial(e){const t=this,n=this.json,i=this.extensions,o=n.materials[e];let a;const c={},u=o.extensions||{},d=[];if(u[hn.KHR_MATERIALS_UNLIT]){const g=i[hn.KHR_MATERIALS_UNLIT];a=g.getMaterialType(),d.push(g.extendParams(c,o,t))}else{const g=o.pbrMetallicRoughness||{};if(c.color=new $e(1,1,1),c.opacity=1,Array.isArray(g.baseColorFactor)){const b=g.baseColorFactor;c.color.fromArray(b),c.opacity=b[3]}g.baseColorTexture!==void 0&&d.push(t.assignTexture(c,"map",g.baseColorTexture,ds)),c.metalness=g.metallicFactor!==void 0?g.metallicFactor:1,c.roughness=g.roughnessFactor!==void 0?g.roughnessFactor:1,g.metallicRoughnessTexture!==void 0&&(d.push(t.assignTexture(c,"metalnessMap",g.metallicRoughnessTexture)),d.push(t.assignTexture(c,"roughnessMap",g.metallicRoughnessTexture))),a=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(e)}),d.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(e,c)})))}o.doubleSided===!0&&(c.side=qs);const v=o.alphaMode||If.OPAQUE;if(v===If.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,v===If.MASK&&(c.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==wi&&(d.push(t.assignTexture(c,"normalMap",o.normalTexture)),c.normalScale=new De(1,1),o.normalTexture.scale!==void 0)){const g=o.normalTexture.scale;c.normalScale.set(g,g)}return o.occlusionTexture!==void 0&&a!==wi&&(d.push(t.assignTexture(c,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==wi&&(c.emissive=new $e().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&a!==wi&&d.push(t.assignTexture(c,"emissiveMap",o.emissiveTexture,ds)),Promise.all(d).then(function(){const g=new a(c);return o.name&&(g.name=o.name),Ro(g,o),t.associations.set(g,{materials:e}),o.extensions&&na(i,g,o),g})}createUniqueName(e){const t=cn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function o(c){return n[hn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(u){return C_(u,c,t)})}const a=[];for(let c=0,u=e.length;c<u;c++){const d=e[c],v=TT(d),g=i[v];if(g)a.push(g.promise);else{let b;d.extensions&&d.extensions[hn.KHR_DRACO_MESH_COMPRESSION]?b=o(d):b=C_(new jt,d,t),i[v]={primitive:d,promise:b},a.push(b)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,i=this.extensions,o=n.meshes[e],a=o.primitives,c=[];for(let u=0,d=a.length;u<d;u++){const v=a[u].material===void 0?ST(this.cache):this.getDependency("material",a[u].material);c.push(v)}return c.push(t.loadGeometries(a)),Promise.all(c).then(function(u){const d=u.slice(0,u.length-1),v=u[u.length-1],g=[];for(let y=0,S=v.length;y<S;y++){const E=v[y],M=a[y];let L;const R=d[y];if(M.mode===Ws.TRIANGLES||M.mode===Ws.TRIANGLE_STRIP||M.mode===Ws.TRIANGLE_FAN||M.mode===void 0)L=o.isSkinnedMesh===!0?new gd(E,R):new Bn(E,R),L.isSkinnedMesh===!0&&L.normalizeSkinWeights(),M.mode===Ws.TRIANGLE_STRIP?L.geometry=b_(L.geometry,ld):M.mode===Ws.TRIANGLE_FAN&&(L.geometry=b_(L.geometry,pl));else if(M.mode===Ws.LINES)L=new Ys(E,R);else if(M.mode===Ws.LINE_STRIP)L=new vr(E,R);else if(M.mode===Ws.LINE_LOOP)L=new _d(E,R);else if(M.mode===Ws.POINTS)L=new bd(E,R);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+M.mode);Object.keys(L.geometry.morphAttributes).length>0&&PT(L,o),L.name=t.createUniqueName(o.name||"mesh_"+e),Ro(L,o),M.extensions&&na(i,L,M),t.assignFinalMaterial(L),g.push(L)}for(let y=0,S=g.length;y<S;y++)t.associations.set(g[y],{meshes:e,primitives:y});if(g.length===1)return o.extensions&&na(i,g[0],o),g[0];const b=new Ls;o.extensions&&na(i,b,o),t.associations.set(b,{meshes:e});for(let y=0,S=g.length;y<S;y++)b.add(g[y]);return b})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Ri(cd.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new Ea(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Ro(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,o=t.joints.length;i<o;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const o=i.pop(),a=i,c=[],u=[];for(let d=0,v=a.length;d<v;d++){const g=a[d];if(g){c.push(g);const b=new It;o!==null&&b.fromArray(o.array,d*16),u.push(b)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[d])}return new wl(c,u)})}loadAnimation(e){const t=this.json.animations[e],n=t.name?t.name:"animation_"+e,i=[],o=[],a=[],c=[],u=[];for(let d=0,v=t.channels.length;d<v;d++){const g=t.channels[d],b=t.samplers[g.sampler],y=g.target,S=y.node,E=t.parameters!==void 0?t.parameters[b.input]:b.input,M=t.parameters!==void 0?t.parameters[b.output]:b.output;y.node!==void 0&&(i.push(this.getDependency("node",S)),o.push(this.getDependency("accessor",E)),a.push(this.getDependency("accessor",M)),c.push(b),u.push(y))}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(u)]).then(function(d){const v=d[0],g=d[1],b=d[2],y=d[3],S=d[4],E=[];for(let M=0,L=v.length;M<L;M++){const R=v[M],z=g[M],V=b[M],H=y[M],B=S[M];if(R===void 0)continue;R.updateMatrix();let j;switch(Lo[B.path]){case Lo.weights:j=ya;break;case Lo.rotation:j=Rr;break;case Lo.position:case Lo.scale:default:j=Ca;break}const F=R.name?R.name:R.uuid,W=H.interpolation!==void 0?ET[H.interpolation]:to,Z=[];Lo[B.path]===Lo.weights?R.traverse(function(we){we.morphTargetInfluences&&Z.push(we.name?we.name:we.uuid)}):Z.push(F);let se=V.array;if(V.normalized){const we=Pm(se.constructor),oe=new Float32Array(se.length);for(let ne=0,ce=se.length;ne<ce;ne++)oe[ne]=se[ne]*we;se=oe}for(let we=0,oe=Z.length;we<oe;we++){const ne=new j(Z[we]+"."+Lo[B.path],z.array,se,W);H.interpolation==="CUBICSPLINE"&&(ne.createInterpolant=function(ce){const ve=this instanceof Rr?MT:uw;return new ve(this.times,this.values,this.getValueSize()/3,ce)},ne.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),E.push(ne)}}return new Ma(n,void 0,E)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(o){const a=n._getNodeRef(n.meshCache,i.mesh,o);return i.weights!==void 0&&a.traverse(function(c){if(c.isMesh)for(let u=0,d=i.weights.length;u<d;u++)c.morphTargetInfluences[u]=i.weights[u]}),a})}loadNode(e){const t=this.json,n=this,i=t.nodes[e],o=n._loadNodeShallow(e),a=[],c=i.children||[];for(let d=0,v=c.length;d<v;d++)a.push(n.getDependency("node",c[d]));const u=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([o,Promise.all(a),u]).then(function(d){const v=d[0],g=d[1],b=d[2];b!==null&&v.traverse(function(y){y.isSkinnedMesh&&y.bind(b,kT)});for(let y=0,S=g.length;y<S;y++)v.add(g[y]);return v})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],a=o.name?i.createUniqueName(o.name):"",c=[],u=i._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(e)});return u&&c.push(u),o.camera!==void 0&&c.push(i.getDependency("camera",o.camera).then(function(d){return i._getNodeRef(i.cameraCache,o.camera,d)})),i._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(e)}).forEach(function(d){c.push(d)}),this.nodeCache[e]=Promise.all(c).then(function(d){let v;if(o.isBone===!0?v=new Qc:d.length>1?v=new Ls:d.length===1?v=d[0]:v=new Jt,v!==d[0])for(let g=0,b=d.length;g<b;g++)v.add(d[g]);if(o.name&&(v.userData.name=o.name,v.name=a),Ro(v,o),o.extensions&&na(n,v,o),o.matrix!==void 0){const g=new It;g.fromArray(o.matrix),v.applyMatrix4(g)}else o.translation!==void 0&&v.position.fromArray(o.translation),o.rotation!==void 0&&v.quaternion.fromArray(o.rotation),o.scale!==void 0&&v.scale.fromArray(o.scale);return i.associations.has(v)||i.associations.set(v,{}),i.associations.get(v).nodes=e,v}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,o=new Ls;n.name&&(o.name=i.createUniqueName(n.name)),Ro(o,n),n.extensions&&na(t,o,n);const a=n.nodes||[],c=[];for(let u=0,d=a.length;u<d;u++)c.push(i.getDependency("node",a[u]));return Promise.all(c).then(function(u){for(let v=0,g=u.length;v<g;v++)o.add(u[v]);const d=v=>{const g=new Map;for(const[b,y]of i.associations)(b instanceof ti||b instanceof Kn)&&g.set(b,y);return v.traverse(b=>{const y=i.associations.get(b);y!=null&&g.set(b,y)}),g};return i.associations=d(o),o})}}function IT(h,e,t){const n=e.attributes,i=new oo;if(n.POSITION!==void 0){const c=t.json.accessors[n.POSITION],u=c.min,d=c.max;if(u!==void 0&&d!==void 0){if(i.set(new X(u[0],u[1],u[2]),new X(d[0],d[1],d[2])),c.normalized){const v=Pm(cl[c.componentType]);i.min.multiplyScalar(v),i.max.multiplyScalar(v)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const c=new X,u=new X;for(let d=0,v=o.length;d<v;d++){const g=o[d];if(g.POSITION!==void 0){const b=t.json.accessors[g.POSITION],y=b.min,S=b.max;if(y!==void 0&&S!==void 0){if(u.setX(Math.max(Math.abs(y[0]),Math.abs(S[0]))),u.setY(Math.max(Math.abs(y[1]),Math.abs(S[1]))),u.setZ(Math.max(Math.abs(y[2]),Math.abs(S[2]))),b.normalized){const E=Pm(cl[b.componentType]);u.multiplyScalar(E)}c.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(c)}h.boundingBox=i;const a=new ao;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,h.boundingSphere=a}function C_(h,e,t){const n=e.attributes,i=[];function o(a,c){return t.getDependency("accessor",a).then(function(u){h.setAttribute(c,u)})}for(const a in n){const c=Am[a]||a.toLowerCase();c in h.attributes||i.push(o(n[a],c))}if(e.indices!==void 0&&!h.index){const a=t.getDependency("accessor",e.indices).then(function(c){h.setIndex(c)});i.push(a)}return Ro(h,e),IT(h,e,t),Promise.all(i).then(function(){return e.targets!==void 0?AT(h,e.targets,t):h})}const Qn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function dw(h){const e=await fetch(h);if(e.ok)return e.json();throw new Error(e.statusText)}async function DT(h){if(!h)throw new Error("No basePath supplied");return await dw(`${h}/profilesList.json`)}async function zT(h,e,t=null,n=!0){if(!h)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const i=await DT(e);let o;if(h.profiles.some(u=>{const d=i[u];return d&&(o={profileId:u,profilePath:`${e}/${d.path}`,deprecated:!!d.deprecated}),!!o}),!o){if(!t)throw new Error("No matching profile name found");const u=i[t];if(!u)throw new Error(`No matching profile name found and default profile "${t}" missing.`);o={profileId:t,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}}const a=await dw(o.profilePath);let c;if(n){let u;if(h.handedness==="any"?u=a.layouts[Object.keys(a.layouts)[0]]:u=a.layouts[h.handedness],!u)throw new Error(`No matching handedness, ${h.handedness}, in profile ${o.profileId}`);u.assetPath&&(c=o.profilePath.replace("profile.json",u.assetPath))}return{profile:a,assetPath:c}}const VT={xAxis:0,yAxis:0,button:0,state:Qn.ComponentState.DEFAULT};function NT(h=0,e=0){let t=h,n=e;if(Math.sqrt(h*h+e*e)>1){const i=Math.atan2(e,h);t=Math.cos(i),n=Math.sin(i)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}class OT{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Qn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(VT)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:i}){const{normalizedXAxis:o,normalizedYAxis:a}=NT(e,t);switch(this.componentProperty){case Qn.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?o:.5;break;case Qn.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?a:.5;break;case Qn.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case Qn.ComponentProperty.STATE:this.valueNodeProperty===Qn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class FT{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{const i=new OT(t.visualResponses[n]);this.visualResponses[n]=i}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Qn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Qn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Qn.ComponentState.PRESSED:(t.touched||this.values.button>Qn.ButtonTouchThreshold)&&(this.values.state=Qn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Qn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Qn.AxisTouchThreshold&&(this.values.state=Qn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Qn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Qn.AxisTouchThreshold&&(this.values.state=Qn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class BT{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{const o=this.layoutDescription.components[i];this.components[i]=new FT(i,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const UT="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",HT="generic-trigger";class GT extends Jt{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(n=>{const{valueNode:i,minNode:o,maxNode:a,value:c,valueNodeProperty:u}=n;i&&(u===Qn.VisualResponseProperty.VISIBILITY?i.visible=c:u===Qn.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(o.quaternion,a.quaternion,c),i.position.lerpVectors(o.position,a.position,c)))})}))}}function WT(h,e){Object.values(h.components).forEach(t=>{const{type:n,touchPointNodeName:i,visualResponses:o}=t;if(n===Qn.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const a=new Go(.001),c=new wi({color:255}),u=new Bn(a,c);t.touchPointNode.add(u)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(o).forEach(a=>{const{valueNodeName:c,minNodeName:u,maxNodeName:d,valueNodeProperty:v}=a;if(v===Qn.VisualResponseProperty.TRANSFORM){if(a.minNode=e.getObjectByName(u),a.maxNode=e.getObjectByName(d),!a.minNode){console.warn(`Could not find ${u} in the model`);return}if(!a.maxNode){console.warn(`Could not find ${d} in the model`);return}}a.valueNode=e.getObjectByName(c),a.valueNode||console.warn(`Could not find ${c} in the model`)})})}function M_(h,e){WT(h.motionController,e),h.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=h.envMap,t.material.needsUpdate=!0)}),h.add(e)}class jT{constructor(e=null){this.gltfLoader=e,this.path=UT,this._assetCache={},this.gltfLoader||(this.gltfLoader=new cw)}createControllerModel(e){const t=new GT;let n=null;return e.addEventListener("connected",i=>{const o=i.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||zT(o,this.path,HT).then(({profile:a,assetPath:c})=>{t.motionController=new BT(o,a,c);const u=this._assetCache[t.motionController.assetUrl];if(u)n=u.scene.clone(),M_(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,d=>{this._assetCache[t.motionController.assetUrl]=d,n=d.scene.clone(),M_(t,n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(a=>{console.warn(a)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}}new $e;var KT=`varying vec3 worldPosition;

uniform float uDistance;

void main() {
  vec3 pos = position.xzy * uDistance;
  pos.xz += cameraPosition.xz;

  worldPosition = pos;

  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
}`,qT=`varying vec3 worldPosition;

uniform float uCellSize;
uniform float uLargeCellSize;
uniform vec3 uColor;
uniform float uDistance;

float getGrid(float size) {
  vec2 r = worldPosition.xz / size;
  vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
  float line = min(grid.x, grid.y);

  return 1.0 - min(line, 1.0);
}

void main() {
  float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);

  float g1 = getGrid(uCellSize);
  float g2 = getGrid(uLargeCellSize);

  gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, 3.0));
  gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2);

  if (gl_FragColor.a <= 0.0) discard;
}`;class XT extends Bn{frustumCulled=!1;material;constructor(e=1,t=10,n="white",i=8e3){const o=new co,a=new Ds({side:qs,uniforms:{uCellSize:{value:e},uLargeCellSize:{value:t},uColor:{value:new $e(n)},uDistance:{value:i}},transparent:!0,vertexShader:KT,fragmentShader:qT,extensions:{derivatives:!0}});super(o,a),this.material=a}get cellSize(){return this.material.uniforms.uCellSize.value}set cellSize(e){this.material.uniforms.uCellSize.value=e}get largeCellSize(){return this.material.uniforms.uLargeCellSize.value}set largeCellSize(e){this.material.uniforms.uLargeCellSize.value=e}get color(){return this.material.uniforms.uColor.value}set color(e){this.material.uniforms.uColor.value=e}get distance(){return this.material.uniforms.uDistance.value}set distance(e){this.material.uniforms.uDistance.value=e}}new X;`${Tt.logdepthbuf_pars_vertex}${Tt.fog_pars_vertex}${Tt.logdepthbuf_vertex}`,Tt.fog_vertex,`${Tt.fog_vertex}`;`${Tt.fog_pars_fragment}${Tt.logdepthbuf_pars_fragment}${Tt.logdepthbuf_fragment}${Tt.fog_fragment}`;const Dv=(h,e)=>{if(e===0)return h;const t=h.replace("#","");let n=Number.parseInt(t.substring(0,2),16),i=Number.parseInt(t.substring(2,4),16),o=Number.parseInt(t.substring(4,6),16);n=Math.round(n*(1-e/100)),i=Math.round(i*(1-e/100)),o=Math.round(o*(1-e/100)),n=n<0?0:n>255?255:n,i=i<0?0:i>255?255:i,o=o<0?0:o>255?255:o;const a=`${n<16?"0":""}${n.toString(16)}`,c=`${i<16?"0":""}${i.toString(16)}`,u=`${o<16?"0":""}${o.toString(16)}`;return`#${a}${c}${u}`},$T="#ff3653",YT="#8adb00",ZT="#2c8fff";Dv($T,50);Dv(YT,50);Dv(ZT,50);new lo(.8,.05,.05).translate(.4,0,0);new X,new X,new X;performance.now();performance.now();Ts.enabled=!0;io.enabled=!0;new cv;new ss;new cw;new Cl;const E_=(h,e)=>localStorage.setItem(h,JSON.stringify(e)),Io=h=>{try{return JSON.parse(localStorage.getItem(h)??"null")}catch{return null}};new jT;new It;const JT=Fd.FolderApi.prototype.addFolder,QT=Fd.FolderApi.prototype.dispose;Fd.FolderApi.prototype.addFolder=function(h){const e=`${String(h.index??-1)}.${h.title}`,t=JT.call(this,{expanded:Io(`pane.${e}`)!==null,...h});return t.element.id=e,t.on("fold",n=>{const i=`pane.${e}`;n.expanded?E_(i,!0):E_(i,null)}),t};Fd.FolderApi.prototype.dispose=function(){QT.call(this)};var id=(h=>(h[h.NONE=0]="NONE",h[h.ORBIT=1]="ORBIT",h))(id||{});const eL=`*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.visible{visibility:visible}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.bottom-0{bottom:0}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-10{z-index:10}.z-50{z-index:50}.z-\\[100\\]{z-index:100}.inline{display:inline}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-\\[105px\\]{height:105px}.h-screen{height:100vh}.w-6{width:1.5rem}.w-\\[350px\\]{width:350px}.w-full{width:100%}.w-screen{width:100vw}.grow{flex-grow:1}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.resize{resize:both}.flex-col{flex-direction:column}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.bg-\\[\\#28292e\\]{--tw-bg-opacity: 1;background-color:rgb(40 41 46 / var(--tw-bg-opacity))}.bg-\\[\\#333\\]{--tw-bg-opacity: 1;background-color:rgb(51 51 51 / var(--tw-bg-opacity))}.bg-zinc-400{--tw-bg-opacity: 1;background-color:rgb(161 161 170 / var(--tw-bg-opacity))}.bg-zinc-600{--tw-bg-opacity: 1;background-color:rgb(82 82 91 / var(--tw-bg-opacity))}.fill-zinc-100{fill:#f4f4f5}.fill-zinc-400{fill:#a1a1aa}.p-1{padding:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\\.5{padding-top:.375rem;padding-bottom:.375rem}.font-mono{font-family:var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace)}.text-\\[11px\\]{font-size:11px}.text-zinc-400{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity))}.text-zinc-800{--tw-text-opacity: 1;color:rgb(39 39 42 / var(--tw-text-opacity))}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.blur{--tw-blur: blur(8px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}*{--bs-br: 0px !important;scrollbar-width:none}*::-webkit-scrollbar{display:none}.tp-grlv_g{height:30px!important}.tp-imgv{height:20px!important;transition:.2s!important}.tp-imgv:hover{height:80px!important}.tp-rotv_c{height:0!important;padding:0!important;margin-top:5px;width:100%!important}.stats .tp-rotv_c{height:auto!important}.orbit-controls-gizmo{position:absolute;top:10px;left:-90px;z-index:10}.hover\\:bg-\\[rgba\\(255\\,255\\,255\\,0\\.05\\)\\]:hover{background-color:#ffffff0d}.hover\\:bg-zinc-600:hover{--tw-bg-opacity: 1;background-color:rgb(82 82 91 / var(--tw-bg-opacity))}.hover\\:fill-zinc-100:hover{fill:#f4f4f5}.hover\\:fill-zinc-300:hover{fill:#d4d4d8}
`;var S_={exports:{}};(function(h,e){(function(t,n){n(e)})(vh,function(t){class n{constructor(x){this.controller_=x}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(x){this.controller_.viewProps.set("disabled",x)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(x){this.controller_.viewProps.set("hidden",x)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class i{constructor(x){this.target=x}}class o extends i{constructor(x,T,O,J){super(x),this.value=T,this.presetKey=O,this.last=J??!0}}function a(I){return I==null}const c={alreadydisposed:()=>"View has been already disposed",invalidparams:I=>`Invalid parameters for '${I.name}'`,nomatchingcontroller:I=>`No matching controller for '${I.key}'`,nomatchingview:I=>`No matching view for '${JSON.stringify(I.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:I=>`Property '${I.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class u{constructor(x){var T;this.message=(T=c[x.type](x.context))!==null&&T!==void 0?T:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=x.type}static alreadyDisposed(){return new u({type:"alreadydisposed"})}static notBindable(){return new u({type:"notbindable"})}static propertyNotFound(x){return new u({type:"propertynotfound",context:{name:x}})}static shouldNeverHappen(){return new u({type:"shouldneverhappen"})}}class d{constructor(){this.observers_={}}on(x,T){let O=this.observers_[x];return O||(O=this.observers_[x]=[]),O.push({handler:T}),this}off(x,T){const O=this.observers_[x];return O&&(this.observers_[x]=O.filter(J=>J.handler!==T)),this}emit(x,T){const O=this.observers_[x];O&&O.forEach(J=>{J.handler(T)})}}const v="tp";function g(I){return(x,T)=>[v,"-",I,"v",x?`_${x}`:"",T?`-${T}`:""].join("")}function b(I,x){return T=>x(I(T))}function y(I){return I.rawValue}function S(I,x){I.emitter.on("change",b(y,x)),x(I.rawValue)}function E(I,x,T){S(I.value(x),T)}function M(I,x,T){T?I.classList.add(x):I.classList.remove(x)}function L(I,x){return T=>{M(I,x,T)}}function R(I,x){S(I,T=>{x.textContent=T??""})}const z=g("btn");class V{constructor(x,T){this.element=x.createElement("div"),this.element.classList.add(z()),T.viewProps.bindClassModifiers(this.element);const O=x.createElement("button");O.classList.add(z("b")),T.viewProps.bindDisabled(O),this.element.appendChild(O),this.buttonElement=O;const J=x.createElement("div");J.classList.add(z("t")),R(T.props.value("title"),J),this.buttonElement.appendChild(J)}}class H{constructor(x,T){this.emitter=new d,this.onClick_=this.onClick_.bind(this),this.props=T.props,this.viewProps=T.viewProps,this.view=new V(x,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class B{constructor(x,T){var O;this.constraint_=T?.constraint,this.equals_=(O=T?.equals)!==null&&O!==void 0?O:(J,ae)=>J===ae,this.emitter=new d,this.rawValue_=x}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(x){this.setRawValue(x,{forceEmit:!1,last:!0})}setRawValue(x,T){const O=T??{forceEmit:!1,last:!0},J=this.constraint_?this.constraint_.constrain(x):x,ae=this.rawValue_;this.equals_(ae,J)&&!O.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=J,this.emitter.emit("change",{options:O,previousRawValue:ae,rawValue:J,sender:this}))}}class j{constructor(x){this.emitter=new d,this.value_=x}get rawValue(){return this.value_}set rawValue(x){this.setRawValue(x,{forceEmit:!1,last:!0})}setRawValue(x,T){const O=T??{forceEmit:!1,last:!0},J=this.value_;J===x&&!O.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=x,this.emitter.emit("change",{options:O,previousRawValue:J,rawValue:this.value_,sender:this}))}}function F(I,x){const T=x?.constraint,O=x?.equals;return!T&&!O?new j(I):new B(I,x)}class W{constructor(x){this.emitter=new d,this.valMap_=x;for(const T in this.valMap_)this.valMap_[T].emitter.on("change",()=>{this.emitter.emit("change",{key:T,sender:this})})}static createCore(x){return Object.keys(x).reduce((T,O)=>Object.assign(T,{[O]:F(x[O])}),{})}static fromObject(x){const T=this.createCore(x);return new W(T)}get(x){return this.valMap_[x].rawValue}set(x,T){this.valMap_[x].rawValue=T}value(x){return this.valMap_[x]}}function Z(I,x){return Object.keys(x).reduce((O,J)=>{if(O===void 0)return;const ae=x[J],ye=ae(I[J]);return ye.succeeded?Object.assign(Object.assign({},O),{[J]:ye.value}):void 0},{})}function se(I,x){return I.reduce((T,O)=>{if(T===void 0)return;const J=x(O);if(!(!J.succeeded||J.value===void 0))return[...T,J.value]},[])}function we(I){return I===null?!1:typeof I=="object"}function oe(I){return x=>T=>{if(!x&&T===void 0)return{succeeded:!1,value:void 0};if(x&&T===void 0)return{succeeded:!0,value:void 0};const O=I(T);return O!==void 0?{succeeded:!0,value:O}:{succeeded:!1,value:void 0}}}function ne(I){return{custom:x=>oe(x)(I),boolean:oe(x=>typeof x=="boolean"?x:void 0)(I),number:oe(x=>typeof x=="number"?x:void 0)(I),string:oe(x=>typeof x=="string"?x:void 0)(I),function:oe(x=>typeof x=="function"?x:void 0)(I),constant:x=>oe(T=>T===x?x:void 0)(I),raw:oe(x=>x)(I),object:x=>oe(T=>{if(we(T))return Z(T,x)})(I),array:x=>oe(T=>{if(Array.isArray(T))return se(T,x)})(I)}}const ce={optional:ne(!0),required:ne(!1)};function ve(I,x){const T=ce.required.object(x)(I);return T.succeeded?T.value:void 0}function de(I){console.warn([`Missing '${I.key}' of ${I.target} in ${I.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function he(I){return I&&I.parentElement&&I.parentElement.removeChild(I),null}class ue{constructor(x){this.value_=x}static create(x){return[new ue(x),(T,O)=>{x.setRawValue(T,O)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const me=g("");function ze(I,x){return L(I,me(void 0,x))}class Te extends W{constructor(x){var T;super(x),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=ue.create(F(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(T=this.get("parent"))===null||T===void 0||T.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(x){var T,O,J;const ae=x??{};return new Te(W.createCore({disabled:(T=ae.disabled)!==null&&T!==void 0?T:!1,disposed:!1,hidden:(O=ae.hidden)!==null&&O!==void 0?O:!1,parent:(J=ae.parent)!==null&&J!==void 0?J:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(x){S(this.globalDisabled_,ze(x,"disabled")),E(this,"hidden",ze(x,"hidden"))}bindDisabled(x){S(this.globalDisabled_,T=>{x.disabled=T})}bindTabIndex(x){S(this.globalDisabled_,T=>{x.tabIndex=T?-1:0})}handleDispose(x){this.value("disposed").emitter.on("change",T=>{T&&x()})}getGlobalDisabled_(){const x=this.get("parent");return(x?x.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(x){var T;x.previousRawValue?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(T=this.get("parent"))===null||T===void 0||T.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function Re(){return["veryfirst","first","last","verylast"]}const Ie=g(""),rt={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Ae{constructor(x){this.parent_=null,this.blade=x.blade,this.view=x.view,this.viewProps=x.viewProps;const T=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Re().forEach(O=>{T.classList.remove(Ie(void 0,rt[O]))}),this.blade.get("positions").forEach(O=>{T.classList.add(Ie(void 0,rt[O]))})}),this.viewProps.handleDispose(()=>{he(T)})}get parent(){return this.parent_}set parent(x){if(this.parent_=x,!("parent"in this.viewProps.valMap_)){de({key:"parent",target:Te.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const pt="http://www.w3.org/2000/svg";function nt(I){I.offsetHeight}function Et(I,x){const T=I.style.transition;I.style.transition="none",x(),I.style.transition=T}function He(I){return I.ontouchstart!==void 0}function mt(I){for(;I.childNodes.length>0;)I.removeChild(I.childNodes[0])}function ke(I){return I.relatedTarget?I.relatedTarget:"explicitOriginalTarget"in I?I.explicitOriginalTarget:null}const xe=g("lbl");function Ve(I,x){const T=I.createDocumentFragment();return x.split(`
`).map(O=>I.createTextNode(O)).forEach((O,J)=>{J>0&&T.appendChild(I.createElement("br")),T.appendChild(O)}),T}class Ye{constructor(x,T){this.element=x.createElement("div"),this.element.classList.add(xe()),T.viewProps.bindClassModifiers(this.element);const O=x.createElement("div");O.classList.add(xe("l")),E(T.props,"label",ae=>{a(ae)?this.element.classList.add(xe(void 0,"nol")):(this.element.classList.remove(xe(void 0,"nol")),mt(O),O.appendChild(Ve(x,ae)))}),this.element.appendChild(O),this.labelElement=O;const J=x.createElement("div");J.classList.add(xe("v")),this.element.appendChild(J),this.valueElement=J}}class Oe extends Ae{constructor(x,T){const O=T.valueController.viewProps;super(Object.assign(Object.assign({},T),{view:new Ye(x,{props:T.props,viewProps:O}),viewProps:O})),this.props=T.props,this.valueController=T.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class St extends Ae{constructor(x){super(x),this.value=x.value}}class vt extends W{constructor(x){super(x)}static create(x){const T={completed:!0,expanded:x,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},O=W.createCore(T);return new vt(O)}get styleExpanded(){var x;return(x=this.get("temporaryExpanded"))!==null&&x!==void 0?x:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const x=this.get("expandedHeight");return this.get("shouldFixHeight")&&!a(x)?`${x}px`:"auto"}bindExpandedClass(x,T){const O=()=>{this.styleExpanded?x.classList.add(T):x.classList.remove(T)};E(this,"expanded",O),E(this,"temporaryExpanded",O)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function dt(I){return vt.create(I)}function en(I,x){let T=0;return Et(x,()=>{I.set("expandedHeight",null),I.set("temporaryExpanded",!0),nt(x),T=x.clientHeight,I.set("temporaryExpanded",null),nt(x)}),T}function Xt(I,x){x.style.height=I.styleHeight}function Q(I,x){I.value("expanded").emitter.on("beforechange",()=>{I.set("completed",!1),a(I.get("expandedHeight"))&&I.set("expandedHeight",en(I,x)),I.set("shouldFixHeight",!0),nt(x)}),I.emitter.on("change",()=>{Xt(I,x)}),Xt(I,x),x.addEventListener("transitionend",T=>{T.propertyName==="height"&&I.cleanUpTransition()})}class q{constructor(x,T){const O=g(T.viewName);this.element=x.createElement("div"),this.element.classList.add(O()),T.viewProps.bindClassModifiers(this.element)}}class ge extends St{constructor(x,T){const O=T.valueController.viewProps;super(Object.assign(Object.assign({},T),{value:T.valueController.value,view:new Ye(x,{props:T.props,viewProps:O}),viewProps:O})),this.props=T.props,this.valueController=T.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ne{constructor(){this.disabled=!1,this.emitter=new d}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class je{constructor(x,T){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=x,this.emitter=new d,this.interval_=T,this.setTimer_()}get disabled(){return this.disabled_}set disabled(x){this.disabled_=x,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const x=this.doc_.defaultView;x&&x.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const x=this.doc_.defaultView;x&&(this.timerId_=x.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ze{constructor(x){this.constraints=x}constrain(x){return this.constraints.reduce((T,O)=>O.constrain(T),x)}}function wt(I,x){if(I instanceof x)return I;if(I instanceof Ze){const T=I.constraints.reduce((O,J)=>O||(J instanceof x?J:null),null);if(T)return T}return null}class qe{constructor(x){this.values=W.fromObject({max:x.max,min:x.min})}constrain(x){const T=this.values.get("max"),O=this.values.get("min");return Math.min(Math.max(x,O),T)}}class Pe{constructor(x){this.values=W.fromObject({max:x.max,min:x.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(x){const T=this.values.get("max"),O=this.values.get("min");let J=x;return a(O)||(J=Math.max(J,O)),a(T)||(J=Math.min(J,T)),J}}class ct{constructor(x,T=0){this.step=x,this.origin=T}constrain(x){const T=this.origin%this.step,O=Math.round((x-T)/this.step);return T+O*this.step}}const ft=g("pop");class lt{constructor(x,T){this.element=x.createElement("div"),this.element.classList.add(ft()),T.viewProps.bindClassModifiers(this.element),S(T.shows,L(this.element,ft(void 0,"v")))}}class gt{constructor(x,T){this.shows=F(!1),this.viewProps=T.viewProps,this.view=new lt(x,{shows:this.shows,viewProps:this.viewProps})}}const yt=g("txt");class Dt{constructor(x,T){this.onChange_=this.onChange_.bind(this),this.element=x.createElement("div"),this.element.classList.add(yt()),T.viewProps.bindClassModifiers(this.element),this.props_=T.props,this.props_.emitter.on("change",this.onChange_);const O=x.createElement("input");O.classList.add(yt("i")),O.type="text",T.viewProps.bindDisabled(O),this.element.appendChild(O),this.inputElement=O,T.value.emitter.on("change",this.onChange_),this.value_=T.value,this.refresh()}refresh(){const x=this.props_.get("formatter");this.inputElement.value=x(this.value_.rawValue)}onChange_(){this.refresh()}}class ie{constructor(x,T){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=T.parser,this.props=T.props,this.value=T.value,this.viewProps=T.viewProps,this.view=new Dt(x,{props:T.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(x){const T=x.currentTarget.value,O=this.parser_(T);a(O)||(this.value.rawValue=O),this.view.refresh()}}function at(I){return I==="false"?!1:!!I}class Ge{constructor(x){this.text=x}evaluate(){return Number(this.text)}toString(){return this.text}}const Le={"**":(I,x)=>Math.pow(I,x),"*":(I,x)=>I*x,"/":(I,x)=>I/x,"%":(I,x)=>I%x,"+":(I,x)=>I+x,"-":(I,x)=>I-x,"<<":(I,x)=>I<<x,">>":(I,x)=>I>>x,">>>":(I,x)=>I>>>x,"&":(I,x)=>I&x,"^":(I,x)=>I^x,"|":(I,x)=>I|x};class We{constructor(x,T,O){this.left=T,this.operator=x,this.right=O}evaluate(){const x=Le[this.operator];if(!x)throw new Error(`unexpected binary operator: '${this.operator}`);return x(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const _t={"+":I=>I,"-":I=>-I,"~":I=>~I};class Yt{constructor(x,T){this.operator=x,this.expression=T}evaluate(){const x=_t[this.operator];if(!x)throw new Error(`unexpected unary operator: '${this.operator}`);return x(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function an(I){return(x,T)=>{for(let O=0;O<I.length;O++){const J=I[O](x,T);if(J!=="")return J}return""}}function xn(I,x){var T;const O=I.substr(x).match(/^\s+/);return(T=O&&O[0])!==null&&T!==void 0?T:""}function Gt(I,x){const T=I.substr(x,1);return T.match(/^[1-9]$/)?T:""}function Bt(I,x){var T;const O=I.substr(x).match(/^[0-9]+/);return(T=O&&O[0])!==null&&T!==void 0?T:""}function Ft(I,x){const T=Bt(I,x);if(T!=="")return T;const O=I.substr(x,1);if(x+=1,O!=="-"&&O!=="+")return"";const J=Bt(I,x);return J===""?"":O+J}function ln(I,x){const T=I.substr(x,1);if(x+=1,T.toLowerCase()!=="e")return"";const O=Ft(I,x);return O===""?"":T+O}function tn(I,x){const T=I.substr(x,1);if(T==="0")return T;const O=Gt(I,x);return x+=O.length,O===""?"":O+Bt(I,x)}function xi(I,x){const T=tn(I,x);if(x+=T.length,T==="")return"";const O=I.substr(x,1);if(x+=O.length,O!==".")return"";const J=Bt(I,x);return x+=J.length,T+O+J+ln(I,x)}function yi(I,x){const T=I.substr(x,1);if(x+=T.length,T!==".")return"";const O=Bt(I,x);return x+=O.length,O===""?"":T+O+ln(I,x)}function Nn(I,x){const T=tn(I,x);return x+=T.length,T===""?"":T+ln(I,x)}const yn=an([xi,yi,Nn]);function $(I,x){var T;const O=I.substr(x).match(/^[01]+/);return(T=O&&O[0])!==null&&T!==void 0?T:""}function pe(I,x){const T=I.substr(x,2);if(x+=T.length,T.toLowerCase()!=="0b")return"";const O=$(I,x);return O===""?"":T+O}function Me(I,x){var T;const O=I.substr(x).match(/^[0-7]+/);return(T=O&&O[0])!==null&&T!==void 0?T:""}function le(I,x){const T=I.substr(x,2);if(x+=T.length,T.toLowerCase()!=="0o")return"";const O=Me(I,x);return O===""?"":T+O}function Se(I,x){var T;const O=I.substr(x).match(/^[0-9a-f]+/i);return(T=O&&O[0])!==null&&T!==void 0?T:""}function ut(I,x){const T=I.substr(x,2);if(x+=T.length,T.toLowerCase()!=="0x")return"";const O=Se(I,x);return O===""?"":T+O}const At=an([pe,le,ut]),zt=an([At,yn]);function xt(I,x){const T=zt(I,x);return x+=T.length,T===""?null:{evaluable:new Ge(T),cursor:x}}function Pt(I,x){const T=I.substr(x,1);if(x+=T.length,T!=="(")return null;const O=Qt(I,x);if(!O)return null;x=O.cursor,x+=xn(I,x).length;const J=I.substr(x,1);return x+=J.length,J!==")"?null:{evaluable:O.evaluable,cursor:x}}function Je(I,x){var T;return(T=xt(I,x))!==null&&T!==void 0?T:Pt(I,x)}function et(I,x){const T=Je(I,x);if(T)return T;const O=I.substr(x,1);if(x+=O.length,O!=="+"&&O!=="-"&&O!=="~")return null;const J=et(I,x);return J?(x=J.cursor,{cursor:x,evaluable:new Yt(O,J.evaluable)}):null}function Ct(I,x,T){T+=xn(x,T).length;const O=I.filter(J=>x.startsWith(J,T))[0];return O?(T+=O.length,T+=xn(x,T).length,{cursor:T,operator:O}):null}function it(I,x){return(T,O)=>{const J=I(T,O);if(!J)return null;O=J.cursor;let ae=J.evaluable;for(;;){const ye=Ct(x,T,O);if(!ye)break;O=ye.cursor;const Xe=I(T,O);if(!Xe)return null;O=Xe.cursor,ae=new We(ye.operator,ae,Xe.evaluable)}return ae?{cursor:O,evaluable:ae}:null}}const ht=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((I,x)=>it(I,x),et);function Qt(I,x){return x+=xn(I,x).length,ht(I,x)}function ot(I){const x=Qt(I,0);return!x||x.cursor+xn(I,x.cursor).length!==I.length?null:x.evaluable}function Ue(I){var x;return(x=ot(I)?.evaluate())!==null&&x!==void 0?x:null}function Cn(I){if(typeof I=="number")return I;if(typeof I=="string"){const x=Ue(I);if(!a(x))return x}return 0}function Ht(I){return x=>x.toFixed(Math.max(Math.min(I,20),0))}function Ut(I){return String(I)}function fn(I,x){for(;I.length<x;)I.push(void 0)}function Mn(I){const x=[];return fn(x,I),F(x)}function Ci(I){const x=I.indexOf(void 0);return x<0?I:I.slice(0,x)}function mn(I,x){const T=[...Ci(I),x];return T.length>I.length?T.splice(0,T.length-I.length):fn(T,I.length),T}function On({primary:I,secondary:x,forward:T,backward:O}){let J=!1;function ae(ye){J||(J=!0,ye(),J=!1)}I.emitter.on("change",ye=>{ae(()=>{x.setRawValue(T(I,x),ye.options)})}),x.emitter.on("change",ye=>{ae(()=>{I.setRawValue(O(I,x),ye.options)}),ae(()=>{x.setRawValue(T(I,x),ye.options)})}),ae(()=>{x.setRawValue(T(I,x),{forceEmit:!1,last:!0})})}function Un(I,x){const T=I*(x.altKey?.1:1)*(x.shiftKey?10:1);return x.upKey?+T:x.downKey?-T:0}function un(I){return{altKey:I.altKey,downKey:I.key==="ArrowDown",shiftKey:I.shiftKey,upKey:I.key==="ArrowUp"}}function Hn(I){return{altKey:I.altKey,downKey:I.key==="ArrowLeft",shiftKey:I.shiftKey,upKey:I.key==="ArrowRight"}}function kn(I){return I==="ArrowUp"||I==="ArrowDown"}function Rn(I){return kn(I)||I==="ArrowLeft"||I==="ArrowRight"}function Yi(I,x){var T,O;const J=x.ownerDocument.defaultView,ae=x.getBoundingClientRect();return{x:I.pageX-(((T=J&&J.scrollX)!==null&&T!==void 0?T:0)+ae.left),y:I.pageY-(((O=J&&J.scrollY)!==null&&O!==void 0?O:0)+ae.top)}}class rs{constructor(x){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=x,this.emitter=new d,x.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),x.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),x.addEventListener("touchend",this.onTouchEnd_),x.addEventListener("mousedown",this.onMouseDown_)}computePosition_(x){const T=this.elem_.getBoundingClientRect();return{bounds:{width:T.width,height:T.height},point:x?{x:x.x,y:x.y}:null}}onMouseDown_(x){var T;x.preventDefault(),(T=x.currentTarget)===null||T===void 0||T.focus();const O=this.elem_.ownerDocument;O.addEventListener("mousemove",this.onDocumentMouseMove_),O.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:x.altKey,data:this.computePosition_(Yi(x,this.elem_)),sender:this,shiftKey:x.shiftKey})}onDocumentMouseMove_(x){this.emitter.emit("move",{altKey:x.altKey,data:this.computePosition_(Yi(x,this.elem_)),sender:this,shiftKey:x.shiftKey})}onDocumentMouseUp_(x){const T=this.elem_.ownerDocument;T.removeEventListener("mousemove",this.onDocumentMouseMove_),T.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:x.altKey,data:this.computePosition_(Yi(x,this.elem_)),sender:this,shiftKey:x.shiftKey})}onTouchStart_(x){x.preventDefault();const T=x.targetTouches.item(0),O=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:x.altKey,data:this.computePosition_(T?{x:T.clientX-O.left,y:T.clientY-O.top}:void 0),sender:this,shiftKey:x.shiftKey}),this.lastTouch_=T}onTouchMove_(x){const T=x.targetTouches.item(0),O=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:x.altKey,data:this.computePosition_(T?{x:T.clientX-O.left,y:T.clientY-O.top}:void 0),sender:this,shiftKey:x.shiftKey}),this.lastTouch_=T}onTouchEnd_(x){var T;const O=(T=x.targetTouches.item(0))!==null&&T!==void 0?T:this.lastTouch_,J=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:x.altKey,data:this.computePosition_(O?{x:O.clientX-J.left,y:O.clientY-J.top}:void 0),sender:this,shiftKey:x.shiftKey})}}function gn(I,x,T,O,J){const ae=(I-x)/(T-x);return O+ae*(J-O)}function ni(I){return String(I.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Pn(I,x,T){return Math.min(Math.max(I,x),T)}const qt=g("txt");class Vs{constructor(x,T){this.onChange_=this.onChange_.bind(this),this.props_=T.props,this.props_.emitter.on("change",this.onChange_),this.element=x.createElement("div"),this.element.classList.add(qt(),qt(void 0,"num")),T.arrayPosition&&this.element.classList.add(qt(void 0,T.arrayPosition)),T.viewProps.bindClassModifiers(this.element);const O=x.createElement("input");O.classList.add(qt("i")),O.type="text",T.viewProps.bindDisabled(O),this.element.appendChild(O),this.inputElement=O,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=T.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(qt()),this.inputElement.classList.add(qt("i"));const J=x.createElement("div");J.classList.add(qt("k")),this.element.appendChild(J),this.knobElement=J;const ae=x.createElementNS(pt,"svg");ae.classList.add(qt("g")),this.knobElement.appendChild(ae);const ye=x.createElementNS(pt,"path");ye.classList.add(qt("gb")),ae.appendChild(ye),this.guideBodyElem_=ye;const Xe=x.createElementNS(pt,"path");Xe.classList.add(qt("gh")),ae.appendChild(Xe),this.guideHeadElem_=Xe;const k=x.createElement("div");k.classList.add(g("tt")()),this.knobElement.appendChild(k),this.tooltipElem_=k,T.value.emitter.on("change",this.onChange_),this.value=T.value,this.refresh()}onDraggingChange_(x){if(x.rawValue===null){this.element.classList.remove(qt(void 0,"drg"));return}this.element.classList.add(qt(void 0,"drg"));const T=x.rawValue/this.props_.get("draggingScale"),O=T+(T>0?-1:T<0?1:0),J=Pn(-O,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${O+J},0 L${O},4 L${O+J},8`,`M ${T},-1 L${T},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${T},4`);const ae=this.props_.get("formatter");this.tooltipElem_.textContent=ae(this.value.rawValue),this.tooltipElem_.style.left=`${T}px`}refresh(){const x=this.props_.get("formatter");this.inputElement.value=x(this.value.rawValue)}onChange_(){this.refresh()}}class Zi{constructor(x,T){var O;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=T.baseStep,this.parser_=T.parser,this.props=T.props,this.sliderProps_=(O=T.sliderProps)!==null&&O!==void 0?O:null,this.value=T.value,this.viewProps=T.viewProps,this.dragging_=F(null),this.view=new Vs(x,{arrayPosition:T.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const J=new rs(this.view.knobElement);J.emitter.on("down",this.onPointerDown_),J.emitter.on("move",this.onPointerMove_),J.emitter.on("up",this.onPointerUp_)}constrainValue_(x){var T,O;const J=(T=this.sliderProps_)===null||T===void 0?void 0:T.get("minValue"),ae=(O=this.sliderProps_)===null||O===void 0?void 0:O.get("maxValue");let ye=x;return J!==void 0&&(ye=Math.max(ye,J)),ae!==void 0&&(ye=Math.min(ye,ae)),ye}onInputChange_(x){const T=x.currentTarget.value,O=this.parser_(T);a(O)||(this.value.rawValue=this.constrainValue_(O)),this.view.refresh()}onInputKeyDown_(x){const T=Un(this.baseStep_,un(x));T!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+T),{forceEmit:!1,last:!1})}onInputKeyUp_(x){Un(this.baseStep_,un(x))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(x){if(!x.point)return null;const T=x.point.x-x.bounds.width/2;return this.constrainValue_(this.originRawValue_+T*this.props.get("draggingScale"))}onPointerMove_(x){const T=this.computeDraggingValue_(x.data);T!==null&&(this.value.setRawValue(T,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(x){const T=this.computeDraggingValue_(x.data);T!==null&&(this.value.setRawValue(T,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function Fn(I,x){I.write(x)}function os(I){const x=I?wt(I,ct):null;return x?x.step:null}function Gn(I,x){const T=I&&wt(I,ct);return T?ni(T.step):Math.max(ni(x),2)}function En(I){return os(I)??1}function li(I,x){var T;const O=I&&wt(I,ct),J=Math.abs((T=O?.step)!==null&&T!==void 0?T:x);return J===0?.1:Math.pow(10,Math.floor(Math.log10(J))-1)}function Bi(I){return[I[0],I[1],I[2]]}function qn(I,x){const T=Ht(x==="float"?2:0);return`rgb(${Bi(I.getComponents("rgb",x)).map(O=>T(O)).join(", ")})`}function Xn(I){return x=>qn(x,I)}function Ji(I,x){const T=Ht(2),O=Ht(x==="float"?2:0);return`rgba(${I.getComponents("rgb",x).map((J,ae)=>(ae===3?T:O)(J)).join(", ")})`}function Mi(I){return x=>Ji(x,I)}function Ei(I,x){const T=Ht(x==="float"?2:0),O=["r","g","b"];return`{${Bi(I.getComponents("rgb",x)).map((J,ae)=>`${O[ae]}: ${T(J)}`).join(", ")}}`}function Ns(I){return x=>Ei(x,I)}function Os(I,x){const T=Ht(2),O=Ht(x==="float"?2:0),J=["r","g","b","a"];return`{${I.getComponents("rgb",x).map((ae,ye)=>{const Xe=ye===3?T:O;return`${J[ye]}: ${Xe(ae)}`}).join(", ")}}`}function ci(I){return x=>Os(x,I)}[...["int","float"].reduce((I,x)=>[...I,{format:{alpha:!1,mode:"rgb",notation:"func",type:x},stringifier:Xn(x)},{format:{alpha:!0,mode:"rgb",notation:"func",type:x},stringifier:Mi(x)},{format:{alpha:!1,mode:"rgb",notation:"object",type:x},stringifier:Ns(x)},{format:{alpha:!0,mode:"rgb",notation:"object",type:x},stringifier:ci(x)}],[])];class Si{constructor(x){this.components=x.components,this.asm_=x.assembly}constrain(x){const T=this.asm_.toComponents(x).map((O,J)=>{var ae,ye;return(ye=(ae=this.components[J])===null||ae===void 0?void 0:ae.constrain(O))!==null&&ye!==void 0?ye:O});return this.asm_.fromComponents(T)}}const Qi=g("pndtxt");class Ui{constructor(x,T){this.textViews=T.textViews,this.element=x.createElement("div"),this.element.classList.add(Qi()),this.textViews.forEach(O=>{const J=x.createElement("div");J.classList.add(Qi("a")),J.appendChild(O.element),this.element.appendChild(J)})}}function hi(I,x,T){return new Zi(I,{arrayPosition:T===0?"fst":T===x.axes.length-1?"lst":"mid",baseStep:x.axes[T].baseStep,parser:x.parser,props:x.axes[T].textProps,value:F(0,{constraint:x.axes[T].constraint}),viewProps:x.viewProps})}class $n{constructor(x,T){this.value=T.value,this.viewProps=T.viewProps,this.acs_=T.axes.map((O,J)=>hi(x,T,J)),this.acs_.forEach((O,J)=>{On({primary:this.value,secondary:O.value,forward:ae=>T.assembly.toComponents(ae.rawValue)[J],backward:(ae,ye)=>{const Xe=T.assembly.toComponents(ae.rawValue);return Xe[J]=ye.rawValue,T.assembly.fromComponents(Xe)}})}),this.view=new Ui(x,{textViews:this.acs_.map(O=>O.view)})}}function fs(I,x){return"step"in I&&!a(I.step)?new ct(I.step,x):null}function Fs(I){return!a(I.max)&&!a(I.min)?new qe({max:I.max,min:I.min}):!a(I.max)||!a(I.min)?new Pe({max:I.max,min:I.min}):null}const Zs={monitor:{defaultInterval:200,defaultLineCount:3}},Ai=g("grl");class ms{constructor(x,T){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=x.createElement("div"),this.element.classList.add(Ai()),T.viewProps.bindClassModifiers(this.element),this.formatter_=T.formatter,this.props_=T.props,this.cursor_=T.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const O=x.createElementNS(pt,"svg");O.classList.add(Ai("g")),O.style.height=`calc(var(--bld-us) * ${T.lineCount})`,this.element.appendChild(O),this.svgElem_=O;const J=x.createElementNS(pt,"polyline");this.svgElem_.appendChild(J),this.lineElem_=J;const ae=x.createElement("div");ae.classList.add(Ai("t"),g("tt")()),this.element.appendChild(ae),this.tooltipElem_=ae,T.value.emitter.on("change",this.onValueUpdate_),this.value=T.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const x=this.svgElem_.getBoundingClientRect(),T=this.value.rawValue.length-1,O=this.props_.get("minValue"),J=this.props_.get("maxValue"),ae=[];this.value.rawValue.forEach((A,N)=>{if(A===void 0)return;const Y=gn(N,0,T,0,x.width),re=gn(A,O,J,x.height,0);ae.push([Y,re].join(","))}),this.lineElem_.setAttributeNS(null,"points",ae.join(" "));const ye=this.tooltipElem_,Xe=this.value.rawValue[this.cursor_.rawValue];if(Xe===void 0){ye.classList.remove(Ai("t","a"));return}const k=gn(this.cursor_.rawValue,0,T,0,x.width),w=gn(Xe,O,J,x.height,0);ye.style.left=`${k}px`,ye.style.top=`${w}px`,ye.textContent=`${this.formatter_(Xe)}`,ye.classList.contains(Ai("t","a"))||(ye.classList.add(Ai("t","a"),Ai("t","in")),nt(ye),ye.classList.remove(Ai("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Hi{constructor(x,T){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=T.props,this.value=T.value,this.viewProps=T.viewProps,this.cursor_=F(-1),this.view=new ms(x,{cursor:this.cursor_,formatter:T.formatter,lineCount:T.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!He(x))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const O=new rs(this.view.element);O.emitter.on("down",this.onGraphPointerDown_),O.emitter.on("move",this.onGraphPointerMove_),O.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(x){const T=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(gn(x.offsetX,0,T.width,0,this.value.rawValue.length))}onGraphPointerDown_(x){this.onGraphPointerMove_(x)}onGraphPointerMove_(x){if(!x.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(gn(x.data.point.x,0,x.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}class Yn{constructor(x){this.controller_=x}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(x){this.controller_.viewProps.set("disabled",x)}get title(){var x;return(x=this.controller_.props.get("title"))!==null&&x!==void 0?x:""}set title(x){this.controller_.props.set("title",x)}on(x,T){const O=T.bind(this);return this.controller_.emitter.on(x,()=>{O(new i(this))}),this}}class Pi extends i{constructor(x,T,O){super(x),this.cell=T,this.index=O}}class Gi extends n{constructor(x){super(x),this.cellToApiMap_=new Map,this.emitter_=new d;const T=this.controller_.valueController;T.cellControllers.forEach((O,J)=>{const ae=new Yn(O);this.cellToApiMap_.set(O,ae),O.emitter.on("click",()=>{const ye=J%T.size[0],Xe=Math.floor(J/T.size[0]);this.emitter_.emit("click",{event:new Pi(this,ae,[ye,Xe])})})})}cell(x,T){const O=this.controller_.valueController,J=O.cellControllers[T*O.size[0]+x];return this.cellToApiMap_.get(J)}on(x,T){const O=T.bind(this);return this.emitter_.on(x,J=>{O(J.event)}),this}}class G{constructor(x,T){this.size=T.size;const[O,J]=this.size,ae=[];for(let ye=0;ye<J;ye++)for(let Xe=0;Xe<O;Xe++){const k=new H(x,{props:W.fromObject(Object.assign({},T.cellConfig(Xe,ye))),viewProps:Te.create()});ae.push(k)}this.cellCs_=ae,this.viewProps=Te.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(ye=>{ye.viewProps.set("disposed",!0)})}),this.view=new q(x,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${O}, 1fr)`,this.cellCs_.forEach(ye=>{this.view.element.appendChild(ye.view.element)})}get cellControllers(){return this.cellCs_}}const _={id:"buttongrid",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(I){const x=ce,T=ve(I,{cells:x.required.function,size:x.required.array(x.required.number),view:x.required.constant("buttongrid"),label:x.optional.string});return T?{params:T}:null},controller(I){return new Oe(I.document,{blade:I.blade,props:W.fromObject({label:I.params.label}),valueController:new G(I.document,{cellConfig:I.params.cells,size:I.params.size})})},api(I){return!(I.controller instanceof Oe)||!(I.controller.valueController instanceof G)?null:new Gi(I.controller)}};class f extends n{get label(){return this.controller_.props.get("label")}set label(x){this.controller_.props.set("label",x)}get value(){return this.controller_.valueController.value.rawValue}set value(x){this.controller_.valueController.value.rawValue=x}on(x,T){const O=T.bind(this);return this.controller_.valueController.value.emitter.on(x,J=>{O(new o(this,J.rawValue,void 0,J.options.last))}),this}}function C(I,x,T){return I*(1-T)+x*T}const D=20,K=.001,te=100;function fe(I,x){let T=.25,O=.5,J=-1;for(let ae=0;ae<D;ae++){const[ye,Xe]=I.curve(O);if(O+=T*(ye<x?1:-1),J=Xe,T*=.5,Math.abs(x-ye)<K)break}return J}class be{constructor(x=0,T=0,O=1,J=1){this.cache_=[],this.comps_=[x,T,O,J]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(x){return a(x)||!Array.isArray(x)?!1:typeof x[0]=="number"&&typeof x[1]=="number"&&typeof x[2]=="number"&&typeof x[3]=="number"}static equals(x,T){return x.x1===T.x1&&x.y1===T.y1&&x.x2===T.x2&&x.y2===T.y2}curve(x){const T=C(0,this.x1,x),O=C(0,this.y1,x),J=C(this.x1,this.x2,x),ae=C(this.y1,this.y2,x),ye=C(this.x2,1,x),Xe=C(this.y2,1,x),k=C(T,J,x),w=C(O,ae,x),A=C(J,ye,x),N=C(ae,Xe,x);return[C(k,A,x),C(w,N,x)]}y(x){if(this.cache_.length===0){const T=[];for(let O=0;O<te;O++)T.push(fe(this,gn(O,0,te-1,0,1)));this.cache_=T}return this.cache_[Math.round(gn(Pn(x,0,1),0,1,0,te-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const Ee={toComponents:I=>I.toObject(),fromComponents:I=>new be(...I)};function Be(I){const x=Ht(2);return`cubic-bezier(${I.toObject().map(T=>x(T)).join(", ")})`}const st=[0,.5,.5,1];function Lt(I){const x=I.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!x)return new be(...st);const T=[x[1],x[2],x[3],x[4]].reduce((O,J)=>{if(!O)return null;const ae=Number(J);return isNaN(ae)?null:[...O,ae]},[]);return new be(...T??st)}const Ot=g("cbz");class $t{constructor(x,T){this.element=x.createElement("div"),this.element.classList.add(Ot()),T.viewProps.bindClassModifiers(this.element),T.foldable.bindExpandedClass(this.element,Ot(void 0,"expanded")),E(T.foldable,"completed",L(this.element,Ot(void 0,"cpl")));const O=x.createElement("div");O.classList.add(Ot("h")),this.element.appendChild(O);const J=x.createElement("button");J.classList.add(Ot("b")),T.viewProps.bindDisabled(J);const ae=x.createElementNS(pt,"svg");ae.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',J.appendChild(ae),O.appendChild(J),this.buttonElement=J;const ye=x.createElement("div");if(ye.classList.add(Ot("t")),O.appendChild(ye),this.textElement=ye,T.pickerLayout==="inline"){const Xe=x.createElement("div");Xe.classList.add(Ot("p")),this.element.appendChild(Xe),this.pickerElement=Xe}else this.pickerElement=null}}const dn=g("cbzp");class kt{constructor(x,T){this.element=x.createElement("div"),this.element.classList.add(dn()),T.viewProps.bindClassModifiers(this.element);const O=x.createElement("div");O.classList.add(dn("g")),this.element.appendChild(O),this.graphElement=O;const J=x.createElement("div");J.classList.add(dn("t")),this.element.appendChild(J),this.textElement=J}}function Kt(I,x){const T=new MutationObserver(J=>{for(const ae of J)ae.type==="childList"&&ae.addedNodes.forEach(ye=>{ye.contains(ye)&&(x(),T.disconnect())})}),O=I.ownerDocument;T.observe(O.body,{attributes:!0,childList:!0,subtree:!0})}const ui=g("cbzg");function zr(I,x){return T=>x(I(T))}class uo{constructor(x,T){this.element=x.createElement("div"),this.element.classList.add(ui()),T.viewProps.bindClassModifiers(this.element),T.viewProps.bindTabIndex(this.element);const O=x.createElement("div");O.classList.add(ui("p")),this.element.appendChild(O),this.previewElement=O;const J=x.createElementNS(pt,"svg");J.classList.add(ui("g")),this.element.appendChild(J),this.svgElem_=J;const ae=x.createElementNS(pt,"path");ae.classList.add(ui("u")),this.svgElem_.appendChild(ae),this.guideElem_=ae;const ye=x.createElementNS(pt,"polyline");ye.classList.add(ui("l")),this.svgElem_.appendChild(ye),this.lineElem_=ye,this.handleElems_=[x.createElement("div"),x.createElement("div")],this.handleElems_.forEach(Xe=>{Xe.classList.add(ui("h")),this.element.appendChild(Xe)}),this.vectorElems_=[x.createElementNS(pt,"line"),x.createElementNS(pt,"line")],this.vectorElems_.forEach(Xe=>{Xe.classList.add(ui("v")),this.svgElem_.appendChild(Xe)}),this.value_=T.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=T.selection,this.handleElems_.forEach((Xe,k)=>{S(this.sel_,zr(w=>w===k,L(Xe,ui("h","sel"))))}),Kt(this.element,()=>{this.refresh()})}getVertMargin_(x){return x*.25}valueToPosition(x,T){const O=this.element.getBoundingClientRect(),J=O.width,ae=O.height,ye=this.getVertMargin_(ae);return{x:gn(x,0,1,0,J),y:gn(T,0,1,ae-ye,ye)}}positionToValue(x,T){const O=this.element.getBoundingClientRect(),J=O.width,ae=O.height,ye=this.getVertMargin_(ae);return{x:Pn(gn(x,0,J,0,1),0,1),y:gn(T,ae-ye,ye,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(ae=>{const ye=this.valueToPosition(0,ae),Xe=this.valueToPosition(1,ae);return[`M ${ye.x},${ye.y}`,`L ${Xe.x},${Xe.y}`].join(" ")}).join(" "));const x=this.value_.rawValue,T=[];let O=0;for(;;){const ae=this.valueToPosition(...x.curve(O));if(T.push([ae.x,ae.y].join(",")),O>=1)break;O=Math.min(O+.05,1)}this.lineElem_.setAttributeNS(null,"points",T.join(" "));const J=x.toObject();[0,1].forEach(ae=>{const ye=this.valueToPosition(ae,ae),Xe=this.valueToPosition(J[ae*2],J[ae*2+1]),k=this.vectorElems_[ae];k.setAttributeNS(null,"x1",String(ye.x)),k.setAttributeNS(null,"y1",String(ye.y)),k.setAttributeNS(null,"x2",String(Xe.x)),k.setAttributeNS(null,"y2",String(Xe.y));const w=this.handleElems_[ae];w.style.left=`${Xe.x}px`,w.style.top=`${Xe.y}px`})}onValueChange_(){this.refresh()}}const vs=24,wr=400,Js=1e3,ii=g("cbzprv");class Vi{constructor(x,T){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=x.createElement("div"),this.element.classList.add(ii()),T.viewProps.bindClassModifiers(this.element);const O=x.createElementNS(pt,"svg");O.classList.add(ii("g")),this.element.appendChild(O),this.svgElem_=O;const J=x.createElementNS(pt,"path");J.classList.add(ii("t")),this.svgElem_.appendChild(J),this.ticksElem_=J;const ae=x.createElement("div");ae.classList.add(ii("m")),this.element.appendChild(ae),this.markerElem_=ae,this.value_=T.value,this.value_.emitter.on("change",this.onValueChange_),T.viewProps.handleDispose(this.onDispose_),Kt(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(ii("m","a")),this.startTime_=new Date().getTime()+wr,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(ii("m","a"))}onDispose_(){this.stop()}updateMarker_(x){const T=this.value_.rawValue.y(Pn(x,0,1));this.markerElem_.style.left=`${T*100}%`}refresh(){const x=this.svgElem_.getBoundingClientRect(),T=x.width,O=x.height,J=[],ae=this.value_.rawValue;for(let ye=0;ye<vs;ye++){const Xe=gn(ye,0,vs-1,0,1),k=gn(ae.y(Xe),0,1,0,T);J.push(`M ${k},0 v${O}`)}this.ticksElem_.setAttributeNS(null,"d",J.join(" "))}onTimer_(){if(this.startTime_===null)return;const x=new Date().getTime()-this.startTime_,T=x/Js;this.updateMarker_(T),x>Js+wr&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function Wi(I,x,T,O){const J=T-I,ae=O-x;return Math.sqrt(J*J+ae*ae)}function Wn(I,x,T,O){const J=Wi(I,x,T,O),ae=Math.atan2(O-x,T-I),ye=Math.round(ae/(Math.PI/4))*Math.PI/4;return{x:I+Math.cos(ye)*J,y:x+Math.sin(ye)*J}}class In{constructor(x,T){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=T.baseStep,this.value=T.value,this.sel_=F(0),this.viewProps=T.viewProps,this.view=new uo(x,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new Vi(x,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",J=>{J.stopImmediatePropagation(),J.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const O=new rs(this.view.element);O.emitter.on("down",this.onPointerDown_),O.emitter.on("move",this.onPointerMove_),O.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(x,T,O){const J=this.sel_.rawValue,ae=this.value.rawValue.toObject(),ye=this.view.positionToValue(x.x,x.y),Xe=T?Wn(J,J,ye.x,ye.y):ye;ae[J*2]=Xe.x,ae[J*2+1]=Xe.y,this.value.setRawValue(new be(...ae),O)}onPointerDown_(x){const T=x.data;if(!T.point)return;const O=this.value.rawValue,J=this.view.valueToPosition(O.x1,O.y1),ae=Wi(T.point.x,T.point.y,J.x,J.y),ye=this.view.valueToPosition(O.x2,O.y2),Xe=Wi(T.point.x,T.point.y,ye.x,ye.y);this.sel_.rawValue=ae<=Xe?0:1,this.updateValue_(T.point,x.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(x){const T=x.data;T.point&&this.updateValue_(T.point,x.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(x){const T=x.data;T.point&&this.updateValue_(T.point,x.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(x){Rn(x.key)&&x.preventDefault();const T=this.sel_.rawValue,O=this.value.rawValue.toObject();O[T*2]+=Un(this.baseStep_,Hn(x)),O[T*2+1]+=Un(this.baseStep_,un(x)),this.value.setRawValue(new be(...O),{forceEmit:!1,last:!1})}onKeyUp_(x){Rn(x.key)&&x.preventDefault();const T=Un(this.baseStep_,Hn(x)),O=Un(this.baseStep_,un(x));T===0&&O===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Bs{constructor(x,T){this.value=T.value,this.viewProps=T.viewProps,this.view=new kt(x,{viewProps:this.viewProps}),this.gc_=new In(x,{baseStep:T.axis.baseStep,value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const O=Object.assign(Object.assign({},T.axis),{constraint:new Pe({max:1,min:0})}),J=Object.assign(Object.assign({},T.axis),{constraint:void 0});this.tc_=new $n(x,{assembly:Ee,axes:[O,J,O,J],parser:Ue,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(x=>x.inputElement)]}refresh(){this.gc_.refresh()}}class gs{constructor(x,T){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=T.value,this.viewProps=T.viewProps,this.foldable_=dt(T.expanded),this.view=new $t(x,{foldable:this.foldable_,pickerLayout:T.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new ie(x,{parser:Lt,props:W.fromObject({formatter:Be}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=T.pickerLayout==="popup"?new gt(x,{viewProps:this.viewProps}):null;const O=new Bs(x,{axis:T.axis,value:this.value,viewProps:this.viewProps});O.allFocusableElements.forEach(J=>{J.addEventListener("blur",this.onPopupChildBlur_),J.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=O,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),S(this.popC_.shows,J=>{J&&O.refresh()}),On({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:J=>J.rawValue,backward:(J,ae)=>ae.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Q(this.foldable_,this.view.pickerElement))}onButtonBlur_(x){if(!this.popC_)return;const T=x.relatedTarget;(!T||!this.popC_.view.element.contains(T))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(x){if(!this.popC_)return;const T=this.popC_.view.element,O=ke(x);O&&T.contains(O)||O&&O===this.view.buttonElement&&!He(T.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(x){this.popC_&&x.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function Qs(){return new Si({assembly:Ee,components:[0,1,2,3].map(I=>I%2===0?new Pe({min:0,max:1}):void 0)})}const Ni={id:"cubic-bezier",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(I){const x=ce,T=ve(I,{value:x.required.array(x.required.number),view:x.required.constant("cubicbezier"),expanded:x.optional.boolean,label:x.optional.string,picker:x.optional.custom(O=>O==="inline"||O==="popup"?O:void 0)});return T?{params:T}:null},controller(I){var x,T;const O=new be(...I.params.value),J=F(O,{constraint:Qs(),equals:be.equals}),ae=new gs(I.document,{axis:{baseStep:.1,textProps:W.fromObject({draggingScale:.01,formatter:Ht(2)})},expanded:(x=I.params.expanded)!==null&&x!==void 0?x:!1,pickerLayout:(T=I.params.picker)!==null&&T!==void 0?T:"popup",value:J,viewProps:I.viewProps});return new ge(I.document,{blade:I.blade,props:W.fromObject({label:I.params.label}),valueController:ae})},api(I){return!(I.controller instanceof ge)||!(I.controller.valueController instanceof gs)?null:new f(I.controller)}};class Tn extends n{begin(){this.controller_.valueController.begin()}end(){this.controller_.valueController.end()}}const Sn=20;class di{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(x){this.start_=x.getTime()}calculateFps_(x){if(this.timestamps_.length===0)return null;const T=this.timestamps_[0];return 1e3*(this.frameCount_-T.frameCount)/(x-T.time)}compactTimestamps_(){if(this.timestamps_.length<=Sn)return;const x=this.timestamps_.length-Sn;this.timestamps_.splice(0,x);const T=this.timestamps_[0].frameCount;this.timestamps_.forEach(O=>{O.frameCount-=T}),this.frameCount_-=T}end(x){if(this.start_===null)return;const T=x.getTime();this.duration_=T-this.start_,this.start_=null,this.fps_=this.calculateFps_(T),this.timestamps_.push({frameCount:this.frameCount_,time:T}),++this.frameCount_,this.compactTimestamps_()}}const pi=g("fps");class xr{constructor(x,T){this.element=x.createElement("div"),this.element.classList.add(pi()),T.viewProps.bindClassModifiers(this.element),this.graphElement=x.createElement("div"),this.graphElement.classList.add(pi("g")),this.element.appendChild(this.graphElement);const O=x.createElement("div");O.classList.add(pi("l")),this.element.appendChild(O);const J=x.createElement("span");J.classList.add(pi("v")),J.textContent="--",O.appendChild(J),this.valueElement=J;const ae=x.createElement("span");ae.classList.add(pi("u")),ae.textContent="FPS",O.appendChild(ae)}}class _s{constructor(x,T){this.stopwatch_=new di,this.onTick_=this.onTick_.bind(this),this.ticker_=T.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.value_=T.value,this.viewProps=T.viewProps,this.view=new xr(x,{viewProps:this.viewProps}),this.graphC_=new Hi(x,{formatter:Ht(0),lineCount:T.lineCount,props:W.fromObject({maxValue:T.maxValue,minValue:T.minValue}),value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker_.dispose()})}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const x=this.stopwatch_.fps;if(x!==null){const T=this.value_.rawValue;this.value_.rawValue=mn(T,x),this.view.valueElement.textContent=x.toFixed(0)}}}function as(I,x){return x===0?new Ne:new je(I,x??Zs.monitor.defaultInterval)}const rn={id:"fpsgraph",type:"blade",accept(I){const x=ce,T=ve(I,{view:x.required.constant("fpsgraph"),interval:x.optional.number,label:x.optional.string,lineCount:x.optional.number,max:x.optional.number,min:x.optional.number});return T?{params:T}:null},controller(I){var x,T,O,J;const ae=(x=I.params.interval)!==null&&x!==void 0?x:500;return new Oe(I.document,{blade:I.blade,props:W.fromObject({label:I.params.label}),valueController:new _s(I.document,{lineCount:(T=I.params.lineCount)!==null&&T!==void 0?T:2,maxValue:(O=I.params.max)!==null&&O!==void 0?O:90,minValue:(J=I.params.min)!==null&&J!==void 0?J:0,ticker:as(I.document,ae),value:Mn(80),viewProps:I.viewProps})})},api(I){return!(I.controller instanceof Oe)||!(I.controller.valueController instanceof _s)?null:new Tn(I.controller)}};class Wt{constructor(x,T){this.min=x,this.max=T}static isObject(x){if(typeof x!="object"||x===null)return!1;const T=x.min,O=x.max;return!(typeof T!="number"||typeof O!="number")}static equals(x,T){return x.min===T.min&&x.max===T.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const _n={fromComponents:I=>new Wt(I[0],I[1]),toComponents:I=>[I.min,I.max]};class bn{constructor(x){this.edge=x}constrain(x){var T,O,J,ae,ye,Xe,k,w;if(x.min<=x.max)return new Wt((O=(T=this.edge)===null||T===void 0?void 0:T.constrain(x.min))!==null&&O!==void 0?O:x.min,(ae=(J=this.edge)===null||J===void 0?void 0:J.constrain(x.max))!==null&&ae!==void 0?ae:x.max);const A=(x.min+x.max)/2;return new Wt((Xe=(ye=this.edge)===null||ye===void 0?void 0:ye.constrain(A))!==null&&Xe!==void 0?Xe:A,(w=(k=this.edge)===null||k===void 0?void 0:k.constrain(A))!==null&&w!==void 0?w:A)}}const Dn=g("rsltxt");class fi{constructor(x,T){this.sliderView_=T.sliderView,this.textView_=T.textView,this.element=x.createElement("div"),this.element.classList.add(Dn());const O=x.createElement("div");O.classList.add(Dn("s")),O.appendChild(this.sliderView_.element),this.element.appendChild(O);const J=x.createElement("div");J.classList.add(Dn("t")),J.appendChild(this.textView_.element),this.element.appendChild(J)}}const Ti=g("rsl");class bs{constructor(x,T){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=T.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=x.createElement("div"),this.element.classList.add(Ti()),T.viewProps.bindClassModifiers(this.element),this.value_=T.value,this.value_.emitter.on("change",this.onValueChange_);const O=x.createElement("div");O.classList.add(Ti("t")),this.element.appendChild(O),this.trackElement=O;const J=x.createElement("div");J.classList.add(Ti("b")),O.appendChild(J),this.barElement=J;const ae=["min","max"].map(ye=>{const Xe=x.createElement("div");return Xe.classList.add(Ti("k"),Ti("k",ye)),O.appendChild(Xe),Xe});this.knobElements=[ae[0],ae[1]],this.update_()}valueToX_(x){const T=this.sliderProps_.get("minValue"),O=this.sliderProps_.get("maxValue");return Pn(gn(x,T,O,0,1),0,1)*100}update_(){const x=this.value_.rawValue;x.length===0?this.element.classList.add(Ti(void 0,"zero")):this.element.classList.remove(Ti(void 0,"zero"));const T=[this.valueToX_(x.min),this.valueToX_(x.max)];this.barElement.style.left=`${T[0]}%`,this.barElement.style.right=`${100-T[1]}%`,this.knobElements.forEach((O,J)=>{O.style.left=`${T[J]}%`})}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class yr{constructor(x,T){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=T.sliderProps,this.viewProps=T.viewProps,this.value=T.value,this.view=new bs(x,{sliderProps:this.sliderProps,value:this.value,viewProps:T.viewProps});const O=new rs(this.view.trackElement);O.emitter.on("down",this.onPointerDown_),O.emitter.on("move",this.onPointerMove_),O.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(x){if(!x.point)return null;const T=(x.point.x+this.ofs_())/x.bounds.width,O=this.sliderProps.get("minValue"),J=this.sliderProps.get("maxValue");return gn(T,0,1,O,J)}onPointerDown_(x){if(!x.data.point)return;const T=x.data.point.x/x.data.bounds.width,O=this.value.rawValue,J=this.sliderProps.get("minValue"),ae=this.sliderProps.get("maxValue"),ye=gn(O.min,J,ae,0,1),Xe=gn(O.max,J,ae,0,1);Math.abs(Xe-T)<=.025?this.grabbing_="max":Math.abs(ye-T)<=.025?this.grabbing_="min":T>=ye&&T<=Xe?(this.grabbing_="length",this.grabOffset_=gn(T-ye,0,1,0,ae-J)):T<ye?(this.grabbing_="min",this.onPointerMove_(x)):T>Xe&&(this.grabbing_="max",this.onPointerMove_(x))}applyPointToValue_(x,T){const O=this.valueFromData_(x);if(O===null)return;const J=this.sliderProps.get("minValue"),ae=this.sliderProps.get("maxValue");if(this.grabbing_==="min")this.value.setRawValue(new Wt(O,this.value.rawValue.max),T);else if(this.grabbing_==="max")this.value.setRawValue(new Wt(this.value.rawValue.min,O),T);else if(this.grabbing_==="length"){const ye=this.value.rawValue.length;let Xe=O-this.grabOffset_,k=Xe+ye;Xe<J?(Xe=J,k=J+ye):k>ae&&(Xe=ae-ye,k=ae),this.value.setRawValue(new Wt(Xe,k),T)}}onPointerMove_(x){this.applyPointToValue_(x.data,{forceEmit:!1,last:!1})}onPointerUp_(x){this.applyPointToValue_(x.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class mi{constructor(x,T){this.value=T.value,this.viewProps=T.viewProps,this.sc_=new yr(x,T);const O={baseStep:T.baseStep,constraint:T.constraint,textProps:W.fromObject({draggingScale:T.draggingScale,formatter:T.formatter})};this.tc_=new $n(x,{assembly:_n,axes:[O,O],parser:T.parser,value:this.value,viewProps:T.viewProps}),this.view=new fi(x,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function er(I){return Wt.isObject(I)?new Wt(I.min,I.max):new Wt(0,0)}function tr(I,x){I.writeProperty("max",x.max),I.writeProperty("min",x.min)}function nr(I){const x=[],T=Fs(I);T&&x.push(T);const O=fs(I);return O&&x.push(O),new bn(new Ze(x))}const ws={id:"input-interval",type:"input",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept:(I,x)=>{if(!Wt.isObject(I))return null;const T=ce,O=ve(x,{format:T.optional.function,max:T.optional.number,min:T.optional.number,step:T.optional.number});return O?{initialValue:new Wt(I.min,I.max),params:O}:null},binding:{reader:I=>er,constraint:I=>nr(I.params),equals:Wt.equals,writer:I=>tr},controller(I){var x;const T=I.value,O=I.constraint;if(!(O instanceof bn))throw u.shouldNeverHappen();const J=(T.rawValue.min+T.rawValue.max)/2,ae=(x=I.params.format)!==null&&x!==void 0?x:Ht(Gn(O.edge,J)),ye=O.edge&&wt(O.edge,qe);if(ye)return new mi(I.document,{baseStep:En(O.edge),constraint:O.edge,draggingScale:li(O.edge,J),formatter:ae,parser:Ue,sliderProps:new W({maxValue:ye.values.value("max"),minValue:ye.values.value("min")}),value:T,viewProps:I.viewProps});const Xe={baseStep:En(O.edge),constraint:O.edge,textProps:W.fromObject({draggingScale:J,formatter:ae})};return new $n(I.document,{assembly:_n,axes:[Xe,Xe],parser:Ue,value:T,viewProps:I.viewProps})}};class si{constructor(x){this.controller_=x}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(x){this.controller_.viewProps.set("disabled",x)}get title(){var x;return(x=this.controller_.props.get("title"))!==null&&x!==void 0?x:""}set title(x){this.controller_.props.set("title",x)}}class Es extends o{constructor(x,T,O,J,ae){super(x,J,ae),this.cell=T,this.index=O}}class ji extends n{constructor(x){super(x),this.cellToApiMap_=new Map,this.controller_.valueController.cellControllers.forEach(T=>{const O=new si(T);this.cellToApiMap_.set(T,O)})}get value(){return this.controller_.value}cell(x,T){const O=this.controller_.valueController,J=O.cellControllers[T*O.size[0]+x];return this.cellToApiMap_.get(J)}on(x,T){const O=T.bind(this);this.controller_.value.emitter.on(x,J=>{const ae=this.controller_.valueController,ye=ae.findCellByValue(J.rawValue);if(!ye)return;const Xe=this.cellToApiMap_.get(ye);if(!Xe)return;const k=ae.cellControllers.indexOf(ye);O(new Es(this,Xe,[k%ae.size[0],Math.floor(k/ae.size[0])],J.rawValue,void 0))})}}const vi=g("rad");class ir{constructor(x,T){this.element=x.createElement("div"),this.element.classList.add(vi()),T.viewProps.bindClassModifiers(this.element);const O=x.createElement("label");O.classList.add(vi("l")),this.element.appendChild(O);const J=x.createElement("input");J.classList.add(vi("i")),J.name=T.name,J.type="radio",T.viewProps.bindDisabled(J),O.appendChild(J),this.inputElement=J;const ae=x.createElement("div");ae.classList.add(vi("b")),O.appendChild(ae);const ye=x.createElement("div");ye.classList.add(vi("t")),ae.appendChild(ye),E(T.props,"title",Xe=>{ye.textContent=Xe})}}class Cr{constructor(x,T){this.props=T.props,this.viewProps=T.viewProps,this.view=new ir(x,{name:T.name,props:this.props,viewProps:this.viewProps})}}class Ss{constructor(x,T){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=T.size;const[O,J]=this.size;for(let ae=0;ae<J;ae++)for(let ye=0;ye<O;ye++){const Xe=new Cr(x,{name:T.groupName,props:W.fromObject(Object.assign({},T.cellConfig(ye,ae))),viewProps:Te.create()});this.cellCs_.push(Xe),this.cellValues_.push(T.cellConfig(ye,ae).value)}this.value=T.value,S(this.value,ae=>{const ye=this.findCellByValue(ae);ye&&(ye.view.inputElement.checked=!0)}),this.viewProps=Te.create(),this.view=new q(x,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${O}, 1fr)`,this.cellCs_.forEach(ae=>{ae.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(ae.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(x){const T=this.cellValues_.findIndex(O=>O===x);return T<0?null:this.cellCs_[T]}onCellInputChange_(x){const T=x.currentTarget,O=this.cellCs_.findIndex(J=>J.view.inputElement===T);O<0||(this.value.rawValue=this.cellValues_[O])}}const ls=function(){return{id:"radiogrid",type:"blade",accept(I){const x=ce,T=ve(I,{cells:x.required.function,groupName:x.required.string,size:x.required.array(x.required.number),value:x.required.raw,view:x.required.constant("radiogrid"),label:x.optional.string});return T?{params:T}:null},controller(I){return new ge(I.document,{blade:I.blade,props:W.fromObject({label:I.params.label}),valueController:new Ss(I.document,{groupName:I.params.groupName,cellConfig:I.params.cells,size:I.params.size,value:F(I.params.value)})})},api(I){return!(I.controller instanceof ge)||!(I.controller.valueController instanceof Ss)?null:new ji(I.controller)}}}();function gi(I){return{id:"input-radiogrid",type:"input",accept(x,T){if(!I.isType(x))return null;const O=ce,J=ve(T,{cells:O.required.function,groupName:O.required.string,size:O.required.array(O.required.number),view:O.required.constant("radiogrid")});return J?{initialValue:x,params:J}:null},binding:I.binding,controller:x=>new Ss(x.document,{cellConfig:x.params.cells,groupName:x.params.groupName,size:x.params.size,value:x.value})}}const es=gi({isType:I=>typeof I=="number",binding:{reader:I=>Cn,writer:I=>Fn}}),sr=gi({isType:I=>typeof I=="string",binding:{reader:I=>Ut,writer:I=>Fn}}),rr=gi({isType:I=>typeof I=="boolean",binding:{reader:I=>at,writer:I=>Fn}}),po=[_,Ni,rn,ws,ls,rr,es,sr];t.ButtonCellApi=Yn,t.ButtonGridApi=Gi,t.ButtonGridController=G,t.CubicBezier=be,t.CubicBezierApi=f,t.CubicBezierAssembly=Ee,t.CubicBezierController=gs,t.CubicBezierGraphController=In,t.CubicBezierGraphView=uo,t.CubicBezierPickerController=Bs,t.CubicBezierPickerView=kt,t.CubicBezierPreviewView=Vi,t.CubicBezierView=$t,t.FpsGraphBladeApi=Tn,t.FpsGraphController=_s,t.FpsView=xr,t.Fpswatch=di,t.Interval=Wt,t.IntervalAssembly=_n,t.IntervalConstraint=bn,t.RadioCellApi=si,t.RadioController=Cr,t.RadioGridApi=ji,t.RadioGridController=Ss,t.RadioView=ir,t.RangeSliderController=yr,t.RangeSliderTextController=mi,t.RangeSliderTextView=fi,t.RangeSliderView=bs,t.TpRadioGridChangeEvent=Es,t.plugins=po,Object.defineProperty(t,"__esModule",{value:!0})})})(S_,S_.exports);var A_={exports:{}};(function(h,e){(function(t,n){n(e)})(vh,function(t){const n="tp";function i(H){return(B,j)=>[n,"-",H,"v",B?`_${B}`:"",j?`-${j}`:""].join("")}function o(H,B){return Object.keys(B).reduce((F,W)=>{if(F===void 0)return;const Z=B[W],se=Z(H[W]);return se.succeeded?Object.assign(Object.assign({},F),{[W]:se.value}):void 0},{})}function a(H,B){return H.reduce((j,F)=>{if(j===void 0)return;const W=B(F);if(!(!W.succeeded||W.value===void 0))return[...j,W.value]},[])}function c(H){return H===null?!1:typeof H=="object"}function u(H){return B=>j=>{if(!B&&j===void 0)return{succeeded:!1,value:void 0};if(B&&j===void 0)return{succeeded:!0,value:void 0};const F=H(j);return F!==void 0?{succeeded:!0,value:F}:{succeeded:!1,value:void 0}}}function d(H){return{custom:B=>u(B)(H),boolean:u(B=>typeof B=="boolean"?B:void 0)(H),number:u(B=>typeof B=="number"?B:void 0)(H),string:u(B=>typeof B=="string"?B:void 0)(H),function:u(B=>typeof B=="function"?B:void 0)(H),constant:B=>u(j=>j===B?B:void 0)(H),raw:u(B=>B)(H),object:B=>u(j=>{if(c(j))return o(j,B)})(H),array:B=>u(j=>{if(Array.isArray(j))return a(j,B)})(H)}}const v={optional:d(!0),required:d(!1)};function g(H,B){const j=v.required.object(B)(H);return j.succeeded?j.value:void 0}function b(H,B,j,F){function W(Z){return Z instanceof j?Z:new j(function(se){se(Z)})}return new(j||(j=Promise))(function(Z,se){function we(ce){try{ne(F.next(ce))}catch(ve){se(ve)}}function oe(ce){try{ne(F.throw(ce))}catch(ve){se(ve)}}function ne(ce){ce.done?Z(ce.value):W(ce.value).then(we,oe)}ne((F=F.apply(H,B||[])).next())})}function y(){const H=document.createElement("canvas");H.width=128,H.height=64;const B=H.getContext("2d");return B.fillStyle="#222",B.fillRect(0,0,H.width,H.height),B.fillStyle="#ddd",B.font="monospaced",B.textAlign="center",B.textBaseline="middle",B.fillText("No image",H.width*.5,H.height*.5),new Promise(j=>{H.toBlob(F=>{const W=new Image;W.src=URL.createObjectURL(F),W.onload=()=>{j(W)}})})}function S(H){return b(this,void 0,void 0,function*(){const B=new Image;return B.crossOrigin="anonymous",new Promise(j=>{B.src=H,B.onload=()=>{j(B)}})})}function E(H){const B=document.createElement("canvas");B.width=H.width,B.height=H.height,B.getContext("2d").drawImage(H,0,0);const j=new Image;return new Promise(F=>{B.toBlob(W=>{j.src=URL.createObjectURL(W),j.onload=()=>{F(j)}})})}const M=i("img");class L{constructor(B,j){this.element=B.createElement("div"),this.element.classList.add(M()),j.viewProps.bindClassModifiers(this.element),this.input=B.createElement("input"),this.input.classList.add(M("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",j.extensions.join(",")),this.element.appendChild(this.input),this.image_=B.createElement("img"),this.image_.classList.add(M("image")),this.image_.classList.add(M(`image_${j.imageFit}`)),this.element.classList.add(M("area_root")),this.element.appendChild(this.image_)}changeImage(B){this.image_.src=B}changeDraggingState(B){const j=this.element;B?j?.classList.add(M("area_dragging")):j?.classList.remove(M("area_dragging"))}}class R{constructor(B,j){this.placeholderImage=null,this.value=j.value,this.viewProps=j.viewProps,this.view=new L(B,{viewProps:this.viewProps,extensions:j.extensions,imageFit:j.imageFit}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(B){const j=(B?.target).files;if(!j||!j.length)return;const F=j[0],W=URL.createObjectURL(F);this.setValue(W),this.updateImage(W)}onDrop(B){return b(this,void 0,void 0,function*(){B.preventDefault();try{const{dataTransfer:j}=B,F=j?.files[0];if(F){const W=URL.createObjectURL(F);this.updateImage(W),this.setValue(W)}else{const W=j?.getData("url");if(!W)throw new Error("No url");S(W).then(Z=>b(this,void 0,void 0,function*(){const se=yield E(Z);this.updateImage(se.src),this.setValue(se)}))}}catch(j){console.error("Could not parse the dropped image",j)}finally{this.view.changeDraggingState(!1)}})}onDragOver(B){B.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(B){return b(this,void 0,void 0,function*(){if(B instanceof HTMLImageElement)E(B).then(j=>{this.updateImage(j.src)});else if(typeof B=="string"){let j="";try{if(B==="placeholder")throw new Error("placeholder");new URL(B),j=(yield S(B)).src}catch{j=(yield this.handlePlaceholderImage()).src}finally{this.updateImage(j),this.setValue(j)}}})}updateImage(B){this.view.changeImage(B)}setValue(B){return b(this,void 0,void 0,function*(){B instanceof HTMLImageElement?this.value.setRawValue(B):B?this.value.setRawValue(yield S(B)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return b(this,void 0,void 0,function*(){return this.placeholderImage||(this.placeholderImage=yield y()),this.placeholderImage})}}const z=[".jpg",".png",".gif"],V={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:grid;height:calc(var(--bld-us) * 3);overflow:hidden;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:100%;height:100%;opacity:0}.tp-imgv_image{width:100%;height:100%;position:absolute;pointer-events:none;border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:6px;opacity:0.6}",accept(H,B){if(!(H instanceof HTMLImageElement||typeof H=="string"))return null;const j=v,F=g(B,{view:j.required.constant("input-image"),acceptUrl:j.optional.boolean,imageFit:j.optional.custom(W=>W==="contain"||W==="cover"?W:void 0),extensions:j.optional.array(j.required.string)});return F?{initialValue:H,params:F}:null},binding:{reader(H){return B=>B instanceof HTMLImageElement?B.src===""?"placeholder":B.src:typeof B=="string"?B:"placeholder"},writer(H){return(B,j)=>{B.write(j)}}},controller(H){var B,j;return new R(H.document,{value:H.value,imageFit:(B=H.params.imageFit)!==null&&B!==void 0?B:"cover",viewProps:H.viewProps,extensions:(j=H.params.extensions)!==null&&j!==void 0?j:z})}};t.plugin=V,Object.defineProperty(t,"__esModule",{value:!0})})})(A_,A_.exports);var P_={exports:{}};(function(h,e){(function(t,n){n(e)})(vh,function(t){function n(G){return G==null}const i={alreadydisposed:()=>"View has been already disposed",invalidparams:G=>`Invalid parameters for '${G.name}'`,nomatchingcontroller:G=>`No matching controller for '${G.key}'`,nomatchingview:G=>`No matching view for '${JSON.stringify(G.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:G=>`Property '${G.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class o{constructor(_){var f;this.message=(f=i[_.type](_.context))!==null&&f!==void 0?f:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=_.type}static alreadyDisposed(){return new o({type:"alreadydisposed"})}static notBindable(){return new o({type:"notbindable"})}static propertyNotFound(_){return new o({type:"propertynotfound",context:{name:_}})}static shouldNeverHappen(){return new o({type:"shouldneverhappen"})}}class a{constructor(){this.observers_={}}on(_,f){let C=this.observers_[_];return C||(C=this.observers_[_]=[]),C.push({handler:f}),this}off(_,f){const C=this.observers_[_];return C&&(this.observers_[_]=C.filter(D=>D.handler!==f)),this}emit(_,f){const C=this.observers_[_];C&&C.forEach(D=>{D.handler(f)})}}const c="tp";function u(G){return(_,f)=>[c,"-",G,"v",_?`_${_}`:"",f?`-${f}`:""].join("")}function d(G,_){return f=>_(G(f))}function v(G){return G.rawValue}function g(G,_){G.emitter.on("change",d(v,_)),_(G.rawValue)}function b(G,_,f){g(G.value(_),f)}function y(G,_,f){f?G.classList.add(_):G.classList.remove(_)}function S(G,_){return f=>{y(G,_,f)}}class E{constructor(_,f){var C;this.constraint_=f?.constraint,this.equals_=(C=f?.equals)!==null&&C!==void 0?C:(D,K)=>D===K,this.emitter=new a,this.rawValue_=_}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(_){this.setRawValue(_,{forceEmit:!1,last:!0})}setRawValue(_,f){const C=f??{forceEmit:!1,last:!0},D=this.constraint_?this.constraint_.constrain(_):_;this.equals_(this.rawValue_,D)&&!C.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=D,this.emitter.emit("change",{options:C,rawValue:D,sender:this}))}}class M{constructor(_){this.emitter=new a,this.value_=_}get rawValue(){return this.value_}set rawValue(_){this.setRawValue(_,{forceEmit:!1,last:!0})}setRawValue(_,f){const C=f??{forceEmit:!1,last:!0};this.value_===_&&!C.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=_,this.emitter.emit("change",{options:C,rawValue:this.value_,sender:this}))}}function L(G,_){const f=_?.constraint,C=_?.equals;return!f&&!C?new M(G):new E(G,_)}class R{constructor(_){this.emitter=new a,this.valMap_=_;for(const f in this.valMap_)this.valMap_[f].emitter.on("change",()=>{this.emitter.emit("change",{key:f,sender:this})})}static createCore(_){return Object.keys(_).reduce((f,C)=>Object.assign(f,{[C]:L(_[C])}),{})}static fromObject(_){const f=this.createCore(_);return new R(f)}get(_){return this.valMap_[_].rawValue}set(_,f){this.valMap_[_].rawValue=f}value(_){return this.valMap_[_]}}function z(G,_){return Object.keys(_).reduce((C,D)=>{if(C===void 0)return;const K=_[D],te=K(G[D]);return te.succeeded?Object.assign(Object.assign({},C),{[D]:te.value}):void 0},{})}function V(G,_){return G.reduce((f,C)=>{if(f===void 0)return;const D=_(C);if(!(!D.succeeded||D.value===void 0))return[...f,D.value]},[])}function H(G){return G===null?!1:typeof G=="object"}function B(G){return _=>f=>{if(!_&&f===void 0)return{succeeded:!1,value:void 0};if(_&&f===void 0)return{succeeded:!0,value:void 0};const C=G(f);return C!==void 0?{succeeded:!0,value:C}:{succeeded:!1,value:void 0}}}function j(G){return{custom:_=>B(_)(G),boolean:B(_=>typeof _=="boolean"?_:void 0)(G),number:B(_=>typeof _=="number"?_:void 0)(G),string:B(_=>typeof _=="string"?_:void 0)(G),function:B(_=>typeof _=="function"?_:void 0)(G),constant:_=>B(f=>f===_?_:void 0)(G),raw:B(_=>_)(G),object:_=>B(f=>{if(H(f))return z(f,_)})(G),array:_=>B(f=>{if(Array.isArray(f))return V(f,_)})(G)}}const F={optional:j(!0),required:j(!1)};function W(G,_){const f=F.required.object(_)(G);return f.succeeded?f.value:void 0}const Z="http://www.w3.org/2000/svg";function se(G){G.offsetHeight}function we(G,_){const f=G.style.transition;G.style.transition="none",_(),G.style.transition=f}function oe(G){return G.ontouchstart!==void 0}function ne(G){return G.relatedTarget?G.relatedTarget:"explicitOriginalTarget"in G?G.explicitOriginalTarget:null}class ce extends R{constructor(_){super(_)}static create(_){const f={completed:!0,expanded:_,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},C=R.createCore(f);return new ce(C)}get styleExpanded(){var _;return(_=this.get("temporaryExpanded"))!==null&&_!==void 0?_:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const _=this.get("expandedHeight");return this.get("shouldFixHeight")&&!n(_)?`${_}px`:"auto"}bindExpandedClass(_,f){b(this,"expanded",()=>{this.styleExpanded?_.classList.add(f):_.classList.remove(f)})}}function ve(G,_){let f=0;return we(_,()=>{G.set("expandedHeight",null),G.set("temporaryExpanded",!0),se(_),f=_.clientHeight,G.set("temporaryExpanded",null),se(_)}),f}function de(G,_){_.style.height=G.styleHeight}function he(G,_){G.value("expanded").emitter.on("beforechange",()=>{G.set("completed",!1),n(G.get("expandedHeight"))&&G.set("expandedHeight",ve(G,_)),G.set("shouldFixHeight",!0),se(_)}),G.emitter.on("change",()=>{de(G,_)}),de(G,_),_.addEventListener("transitionend",f=>{f.propertyName==="height"&&(G.set("shouldFixHeight",!1),G.set("expandedHeight",null),G.set("completed",!0))})}class ue{constructor(_){this.constraints=_}constrain(_){return this.constraints.reduce((f,C)=>C.constrain(f),_)}}class me{constructor(_){this.maxValue=_.max,this.minValue=_.min}constrain(_){let f=_;return n(this.minValue)||(f=Math.max(f,this.minValue)),n(this.maxValue)||(f=Math.min(f,this.maxValue)),f}}class ze{constructor(_){this.step=_}constrain(_){return(_<0?-Math.round(-_/this.step):Math.round(_/this.step))*this.step}}const Te=u("pop");class Re{constructor(_,f){this.element=_.createElement("div"),this.element.classList.add(Te()),f.viewProps.bindClassModifiers(this.element),g(f.shows,S(this.element,Te(void 0,"v")))}}class Ie{constructor(_,f){this.shows=L(!1),this.viewProps=f.viewProps,this.view=new Re(_,{shows:this.shows,viewProps:this.viewProps})}}class rt{constructor(_){this.text=_}evaluate(){return Number(this.text)}toString(){return this.text}}const Ae={"**":(G,_)=>Math.pow(G,_),"*":(G,_)=>G*_,"/":(G,_)=>G/_,"%":(G,_)=>G%_,"+":(G,_)=>G+_,"-":(G,_)=>G-_,"<<":(G,_)=>G<<_,">>":(G,_)=>G>>_,">>>":(G,_)=>G>>>_,"&":(G,_)=>G&_,"^":(G,_)=>G^_,"|":(G,_)=>G|_};class pt{constructor(_,f,C){this.left=f,this.operator=_,this.right=C}evaluate(){const _=Ae[this.operator];if(!_)throw new Error(`unexpected binary operator: '${this.operator}`);return _(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const nt={"+":G=>G,"-":G=>-G,"~":G=>~G};class Et{constructor(_,f){this.operator=_,this.expression=f}evaluate(){const _=nt[this.operator];if(!_)throw new Error(`unexpected unary operator: '${this.operator}`);return _(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function He(G){return(_,f)=>{for(let C=0;C<G.length;C++){const D=G[C](_,f);if(D!=="")return D}return""}}function mt(G,_){var f;const C=G.substr(_).match(/^\s+/);return(f=C&&C[0])!==null&&f!==void 0?f:""}function ke(G,_){const f=G.substr(_,1);return f.match(/^[1-9]$/)?f:""}function xe(G,_){var f;const C=G.substr(_).match(/^[0-9]+/);return(f=C&&C[0])!==null&&f!==void 0?f:""}function Ve(G,_){const f=xe(G,_);if(f!=="")return f;const C=G.substr(_,1);if(_+=1,C!=="-"&&C!=="+")return"";const D=xe(G,_);return D===""?"":C+D}function Ye(G,_){const f=G.substr(_,1);if(_+=1,f.toLowerCase()!=="e")return"";const C=Ve(G,_);return C===""?"":f+C}function Oe(G,_){const f=G.substr(_,1);if(f==="0")return f;const C=ke(G,_);return _+=C.length,C===""?"":C+xe(G,_)}function St(G,_){const f=Oe(G,_);if(_+=f.length,f==="")return"";const C=G.substr(_,1);if(_+=C.length,C!==".")return"";const D=xe(G,_);return _+=D.length,f+C+D+Ye(G,_)}function vt(G,_){const f=G.substr(_,1);if(_+=f.length,f!==".")return"";const C=xe(G,_);return _+=C.length,C===""?"":f+C+Ye(G,_)}function dt(G,_){const f=Oe(G,_);return _+=f.length,f===""?"":f+Ye(G,_)}const en=He([St,vt,dt]);function Xt(G,_){var f;const C=G.substr(_).match(/^[01]+/);return(f=C&&C[0])!==null&&f!==void 0?f:""}function Q(G,_){const f=G.substr(_,2);if(_+=f.length,f.toLowerCase()!=="0b")return"";const C=Xt(G,_);return C===""?"":f+C}function q(G,_){var f;const C=G.substr(_).match(/^[0-7]+/);return(f=C&&C[0])!==null&&f!==void 0?f:""}function ge(G,_){const f=G.substr(_,2);if(_+=f.length,f.toLowerCase()!=="0o")return"";const C=q(G,_);return C===""?"":f+C}function Ne(G,_){var f;const C=G.substr(_).match(/^[0-9a-f]+/i);return(f=C&&C[0])!==null&&f!==void 0?f:""}function je(G,_){const f=G.substr(_,2);if(_+=f.length,f.toLowerCase()!=="0x")return"";const C=Ne(G,_);return C===""?"":f+C}const Ze=He([Q,ge,je]),wt=He([Ze,en]);function qe(G,_){const f=wt(G,_);return _+=f.length,f===""?null:{evaluable:new rt(f),cursor:_}}function Pe(G,_){const f=G.substr(_,1);if(_+=f.length,f!=="(")return null;const C=Dt(G,_);if(!C)return null;_=C.cursor,_+=mt(G,_).length;const D=G.substr(_,1);return _+=D.length,D!==")"?null:{evaluable:C.evaluable,cursor:_}}function ct(G,_){return qe(G,_)||Pe(G,_)}function ft(G,_){const f=ct(G,_);if(f)return f;const C=G.substr(_,1);if(_+=C.length,C!=="+"&&C!=="-"&&C!=="~")return null;const D=ft(G,_);return D?(_=D.cursor,{cursor:_,evaluable:new Et(C,D.evaluable)}):null}function lt(G,_,f){f+=mt(_,f).length;const C=G.filter(D=>_.startsWith(D,f))[0];return C?(f+=C.length,f+=mt(_,f).length,{cursor:f,operator:C}):null}function gt(G,_){return(f,C)=>{const D=G(f,C);if(!D)return null;C=D.cursor;let K=D.evaluable;for(;;){const te=lt(_,f,C);if(!te)break;C=te.cursor;const fe=G(f,C);if(!fe)return null;C=fe.cursor,K=new pt(te.operator,K,fe.evaluable)}return K?{cursor:C,evaluable:K}:null}}const yt=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((G,_)=>gt(G,_),ft);function Dt(G,_){return _+=mt(G,_).length,yt(G,_)}function ie(G){const _=Dt(G,0);return!_||_.cursor+mt(G,_.cursor).length!==G.length?null:_.evaluable}function at(G){var _;return(_=ie(G)?.evaluate())!==null&&_!==void 0?_:null}function Ge(G){return _=>_.toFixed(Math.max(Math.min(G,20),0))}function Le({primary:G,secondary:_,forward:f,backward:C}){let D=!1;function K(te){D||(D=!0,te(),D=!1)}G.emitter.on("change",te=>{K(()=>{_.setRawValue(f(G,_),te.options)})}),_.emitter.on("change",te=>{K(()=>{G.setRawValue(C(G,_),te.options)}),K(()=>{_.setRawValue(f(G,_),te.options)})}),K(()=>{_.setRawValue(f(G,_),{forceEmit:!1,last:!0})})}function We(G,_){const f=G*(_.altKey?.1:1)*(_.shiftKey?10:1);return _.upKey?+f:_.downKey?-f:0}function _t(G){return{altKey:G.altKey,downKey:G.key==="ArrowDown",shiftKey:G.shiftKey,upKey:G.key==="ArrowUp"}}function Yt(G){return{altKey:G.altKey,downKey:G.key==="ArrowLeft",shiftKey:G.shiftKey,upKey:G.key==="ArrowRight"}}function an(G){return G==="ArrowUp"||G==="ArrowDown"}function xn(G){return an(G)||G==="ArrowLeft"||G==="ArrowRight"}function Gt(G,_){const f=_.ownerDocument.defaultView,C=_.getBoundingClientRect();return{x:G.pageX-((f&&f.scrollX||0)+C.left),y:G.pageY-((f&&f.scrollY||0)+C.top)}}class Bt{constructor(_){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=_,this.emitter=new a,_.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),_.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),_.addEventListener("touchend",this.onTouchEnd_),_.addEventListener("mousedown",this.onMouseDown_)}computePosition_(_){const f=this.elem_.getBoundingClientRect();return{bounds:{width:f.width,height:f.height},point:_?{x:_.x,y:_.y}:null}}onMouseDown_(_){var f;_.preventDefault(),(f=_.currentTarget)===null||f===void 0||f.focus();const C=this.elem_.ownerDocument;C.addEventListener("mousemove",this.onDocumentMouseMove_),C.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:_.altKey,data:this.computePosition_(Gt(_,this.elem_)),sender:this,shiftKey:_.shiftKey})}onDocumentMouseMove_(_){this.emitter.emit("move",{altKey:_.altKey,data:this.computePosition_(Gt(_,this.elem_)),sender:this,shiftKey:_.shiftKey})}onDocumentMouseUp_(_){const f=this.elem_.ownerDocument;f.removeEventListener("mousemove",this.onDocumentMouseMove_),f.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:_.altKey,data:this.computePosition_(Gt(_,this.elem_)),sender:this,shiftKey:_.shiftKey})}onTouchStart_(_){_.preventDefault();const f=_.targetTouches.item(0),C=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:_.altKey,data:this.computePosition_(f?{x:f.clientX-C.left,y:f.clientY-C.top}:void 0),sender:this,shiftKey:_.shiftKey}),this.lastTouch_=f}onTouchMove_(_){const f=_.targetTouches.item(0),C=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:_.altKey,data:this.computePosition_(f?{x:f.clientX-C.left,y:f.clientY-C.top}:void 0),sender:this,shiftKey:_.shiftKey}),this.lastTouch_=f}onTouchEnd_(_){var f;const C=(f=_.targetTouches.item(0))!==null&&f!==void 0?f:this.lastTouch_,D=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:_.altKey,data:this.computePosition_(C?{x:C.clientX-D.left,y:C.clientY-D.top}:void 0),sender:this,shiftKey:_.shiftKey})}}function Ft(G,_,f){return Math.min(Math.max(G,_),f)}const ln=u("txt");class tn{constructor(_,f){this.onChange_=this.onChange_.bind(this),this.props_=f.props,this.props_.emitter.on("change",this.onChange_),this.element=_.createElement("div"),this.element.classList.add(ln(),ln(void 0,"num")),f.arrayPosition&&this.element.classList.add(ln(void 0,f.arrayPosition)),f.viewProps.bindClassModifiers(this.element);const C=_.createElement("input");C.classList.add(ln("i")),C.type="text",f.viewProps.bindDisabled(C),this.element.appendChild(C),this.inputElement=C,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=f.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(ln()),this.inputElement.classList.add(ln("i"));const D=_.createElement("div");D.classList.add(ln("k")),this.element.appendChild(D),this.knobElement=D;const K=_.createElementNS(Z,"svg");K.classList.add(ln("g")),this.knobElement.appendChild(K);const te=_.createElementNS(Z,"path");te.classList.add(ln("gb")),K.appendChild(te),this.guideBodyElem_=te;const fe=_.createElementNS(Z,"path");fe.classList.add(ln("gh")),K.appendChild(fe),this.guideHeadElem_=fe;const be=_.createElement("div");be.classList.add(u("tt")()),this.knobElement.appendChild(be),this.tooltipElem_=be,f.value.emitter.on("change",this.onChange_),this.value=f.value,this.refresh()}onDraggingChange_(_){if(_.rawValue===null){this.element.classList.remove(ln(void 0,"drg"));return}this.element.classList.add(ln(void 0,"drg"));const f=_.rawValue/this.props_.get("draggingScale"),C=f+(f>0?-1:f<0?1:0),D=Ft(-C,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${C+D},0 L${C},4 L${C+D},8`,`M ${f},-1 L${f},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${f},4`);const K=this.props_.get("formatter");this.tooltipElem_.textContent=K(this.value.rawValue),this.tooltipElem_.style.left=`${f}px`}refresh(){const _=this.props_.get("formatter");this.inputElement.value=_(this.value.rawValue)}onChange_(){this.refresh()}}class xi{constructor(_,f){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=f.baseStep,this.parser_=f.parser,this.props=f.props,this.value=f.value,this.viewProps=f.viewProps,this.dragging_=L(null),this.view=new tn(_,{arrayPosition:f.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const C=new Bt(this.view.knobElement);C.emitter.on("down",this.onPointerDown_),C.emitter.on("move",this.onPointerMove_),C.emitter.on("up",this.onPointerUp_)}onInputChange_(_){const f=_.currentTarget.value,C=this.parser_(f);n(C)||(this.value.rawValue=C),this.view.refresh()}onInputKeyDown_(_){const f=We(this.baseStep_,_t(_));f!==0&&this.value.setRawValue(this.value.rawValue+f,{forceEmit:!1,last:!1})}onInputKeyUp_(_){We(this.baseStep_,_t(_))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(_){if(!_.point)return null;const f=_.point.x-_.bounds.width/2;return this.originRawValue_+f*this.props.get("draggingScale")}onPointerMove_(_){const f=this.computeDraggingValue_(_.data);f!==null&&(this.value.setRawValue(f,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(_){const f=this.computeDraggingValue_(_.data);f!==null&&(this.value.setRawValue(f,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function yi(G){if(G==="inline"||G==="popup")return G}function Nn(G){const _=F;return _.required.object({max:_.optional.number,min:_.optional.number,step:_.optional.number})(G).value}class yn{constructor(_){this.components=_.components,this.asm_=_.assembly}constrain(_){const f=this.asm_.toComponents(_).map((C,D)=>{var K,te;return(te=(K=this.components[D])===null||K===void 0?void 0:K.constrain(C))!==null&&te!==void 0?te:C});return this.asm_.fromComponents(f)}}const $=u("pndtxt");class pe{constructor(_,f){this.textViews=f.textViews,this.element=_.createElement("div"),this.element.classList.add($()),this.textViews.forEach(C=>{const D=_.createElement("div");D.classList.add($("a")),D.appendChild(C.element),this.element.appendChild(D)})}}function Me(G,_,f){return new xi(G,{arrayPosition:f===0?"fst":f===_.axes.length-1?"lst":"mid",baseStep:_.axes[f].baseStep,parser:_.parser,props:_.axes[f].textProps,value:L(0,{constraint:_.axes[f].constraint}),viewProps:_.viewProps})}class le{constructor(_,f){this.value=f.value,this.viewProps=f.viewProps,this.acs_=f.axes.map((C,D)=>Me(_,f,D)),this.acs_.forEach((C,D)=>{Le({primary:this.value,secondary:C.value,forward:K=>f.assembly.toComponents(K.rawValue)[D],backward:(K,te)=>{const fe=f.assembly.toComponents(K.rawValue);return fe[D]=te.rawValue,f.assembly.fromComponents(fe)}})}),this.view=new pe(_,{textViews:this.acs_.map(C=>C.view)})}}class Se{multiply(_){return this.format(this.quat.multiply(_.quat))}premultiply(_){return this.format(_.multiply(this))}slerp(_,f){return this.format(this.quat.slerp(_.quat,f))}}function ut(G,_,f){return Math.min(Math.max(G,_),f)}function At(G,_){return Math.floor(G/_)*_}function zt(G,_){return G-At(G,_)}function xt(G){return zt(G+Math.PI,Math.PI*2)-Math.PI}class Pt extends Se{constructor(_,f,C,D,K){super(),this.x=_??0,this.y=f??0,this.z=C??0,this.order=D??"XYZ",this.unit=K??"rad"}static fromQuaternion(_,f,C){const D=_.toMat3(),[K,te,fe,be]=f==="XYZ"?[0,1,2,1]:f==="XZY"?[0,2,1,-1]:f==="YXZ"?[1,0,2,-1]:f==="YZX"?[1,2,0,1]:f==="ZXY"?[2,0,1,1]:[2,1,0,-1],Ee=[0,0,0],Be=D[fe+K*3];return Ee[te]=-be*Math.asin(ut(Be,-1,1)),Math.abs(Be)<.999999?(Ee[K]=be*Math.atan2(D[fe+te*3],D[fe*4]),Ee[fe]=be*Math.atan2(D[te+K*3],D[K*4])):Ee[K]=be*Math.atan2(-D[te+fe*3],D[te*4]),Math.abs(Ee[K])+Math.abs(Ee[fe])>Math.PI&&(Ee[K]=xt(Ee[K]+Math.PI),Ee[te]=xt(Math.PI-Ee[te]),Ee[fe]=xt(Ee[fe]+Math.PI)),new Pt(...Ee,f).reunit(C)}get quat(){return Je.fromEuler(this)}getComponents(){return[this.x,this.y,this.z]}toEuler(_,f){return this.reorder(_).reunit(f)}format(_){return _ instanceof Pt?_.reorder(this.order):_.toEuler(this.order,this.unit)}reorder(_){return _===this.order?this:this.quat.toEuler(_,this.unit)}reunit(_){const f={deg:Math.PI/180,rad:1,turn:2*Math.PI}[this.unit],C={deg:180/Math.PI,rad:1,turn:.5/Math.PI}[_],D=f*C;return new Pt(D*this.x,D*this.y,D*this.z,this.order,_)}}class Je extends Se{constructor(_,f,C,D){super(),this.x=_??0,this.y=f??0,this.z=C??0,this.w=D??1}static fromAxisAngle(_,f){const C=f/2,D=Math.sin(C);return new Je(_.x*D,_.y*D,_.z*D,Math.cos(C))}static fromEuler(_){const f=_.reunit("rad"),[C,D,K,te]=f.order==="XYZ"?[0,1,2,1]:f.order==="XZY"?[0,2,1,-1]:f.order==="YXZ"?[1,0,2,-1]:f.order==="YZX"?[1,2,0,1]:f.order==="ZXY"?[2,0,1,1]:[2,1,0,-1],fe=f.getComponents(),be=.5*fe[C],Ee=.5*te*fe[D],Be=.5*fe[K],st=Math.cos(be),Lt=Math.cos(Ee),Ot=Math.cos(Be),$t=Math.sin(be),dn=Math.sin(Ee),kt=Math.sin(Be),Kt=[0,0,0,Ot*Lt*st+kt*dn*$t];return Kt[C]=Ot*Lt*$t-kt*dn*st,Kt[D]=te*(Ot*dn*st+kt*Lt*$t),Kt[K]=kt*Lt*st-Ot*dn*$t,new Je(...Kt)}static lookRotation(_,f){const{normal:C,tangent:D,binormal:K}=_.orthoNormalize(f),te=K.x,fe=D.x,be=C.x,Ee=K.y,Be=D.y,st=C.y,Lt=K.z,Ot=D.z,$t=C.z,dn=te+Be+$t;if(dn>0){const kt=.5/Math.sqrt(dn+1);return new Je((Ot-st)*kt,(be-Lt)*kt,(Ee-fe)*kt,.25/kt)}else if(te>Be&&te>$t){const kt=2*Math.sqrt(1+te-Be-$t);return new Je(.25*kt,(fe+Ee)/kt,(be+Lt)/kt,(Ot-st)/kt)}else if(Be>$t){const kt=2*Math.sqrt(1+Be-te-$t);return new Je((fe+Ee)/kt,.25*kt,(st+Ot)/kt,(be-Lt)/kt)}else{const kt=2*Math.sqrt(1+$t-te-Be);return new Je((be+Lt)/kt,(st+Ot)/kt,.25*kt,(Ee-fe)/kt)}}get quat(){return this}getComponents(){return[this.x,this.y,this.z,this.w]}toEuler(_,f){return Pt.fromQuaternion(this,_,f)}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const _=this.length;return _===0?new Je:new Je(this.x/_,this.y/_,this.z/_,this.w/_)}get negated(){return new Je(-this.x,-this.y,-this.z,-this.w)}get ban360s(){return this.w<0?this.negated:this}multiply(_){const f=_.quat;return new Je(this.w*f.x+this.x*f.w+this.y*f.z-this.z*f.y,this.w*f.y-this.x*f.z+this.y*f.w+this.z*f.x,this.w*f.z+this.x*f.y-this.y*f.x+this.z*f.w,this.w*f.w-this.x*f.x-this.y*f.y-this.z*f.z)}format(_){return _.quat}slerp(_,f){let C=_.quat;if(f===0)return this;if(f===1)return C;const D=this.ban360s;C=C.ban360s;let K=D.w*C.w+D.x*C.x+D.y*C.y+D.z*C.z;if(K<0&&(C=C.negated,K=-K),K>=1)return D;const te=1-K*K;if(te<=Number.EPSILON){const st=1-f;return new Je(st*D.x+f*C.x,st*D.y+f*C.y,st*D.z+f*C.z,st*D.w+f*C.w).normalized}const fe=Math.sqrt(te),be=Math.atan2(fe,K),Ee=Math.sin((1-f)*be)/fe,Be=Math.sin(f*be)/fe;return new Je(D.x*Ee+C.x*Be,D.y*Ee+C.y*Be,D.z*Ee+C.z*Be,D.w*Ee+C.w*Be)}toMat3(){const{x:_,y:f,z:C,w:D}=this;return[1-2*f*f-2*C*C,2*_*f+2*C*D,2*_*C-2*f*D,2*_*f-2*C*D,1-2*_*_-2*C*C,2*f*C+2*_*D,2*_*C+2*f*D,2*f*C-2*_*D,1-2*_*_-2*f*f]}}class et{constructor(){this.offset=[0,0,-5],this.fov=30,this.aspect=1,this.viewport=[0,0,1,1]}project(_){const f=(this.viewport[0]+this.viewport[2])*.5,C=(this.viewport[1]+this.viewport[3])*.5,D=this.viewport[2]-this.viewport[0],K=this.viewport[3]-this.viewport[1],te=1/Math.tan(this.fov*Math.PI/360),fe=-(_.z+this.offset[2]),be=f+(_.x+this.offset[0])/fe*te*D*.5/this.aspect,Ee=C-(_.y+this.offset[1])/fe*te*K*.5;return[be,Ee]}}class Ct{constructor(_,f,C){this.element=_.createElementNS(Z,"path"),this.vertices=f,this.projector=C}setRotation(_){let f="";return this.vertices.forEach((C,D)=>{const K=C.applyQuaternion(_),[te,fe]=this.projector.project(K);f+=`${D===0?"M":"L"}${te} ${fe}`}),this.element.setAttributeNS(null,"d",f),this}}class it{constructor(_,f,C){this.x=_??0,this.y=f??0,this.z=C??0}getComponents(){return[this.x,this.y,this.z]}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const _=this.length;return _===0?new it:new it(this.x/_,this.y/_,this.z/_)}get negated(){return new it(-this.x,-this.y,-this.z)}add(_){return new it(this.x+_.x,this.y+_.y,this.z+_.z)}sub(_){return new it(this.x-_.x,this.y-_.y,this.z-_.z)}scale(_){return new it(this.x*_,this.y*_,this.z*_)}dot(_){return this.x*_.x+this.y*_.y+this.z*_.z}cross(_){return new it(this.y*_.z-this.z*_.y,this.z*_.x-this.x*_.z,this.x*_.y-this.y*_.x)}orthoNormalize(_){const f=this.normalized;_=_.normalized;let C=f.dot(_);C===1&&(Math.abs(f.y)>Math.abs(f.z)?_=new it(0,0,1):_=new it(0,1,0),C=f.dot(_)),_=_.sub(f.scale(C)).normalized;const D=_.cross(f);return{normal:f,tangent:_,binormal:D}}applyQuaternion(_){const f=_.w*this.x+_.y*this.z-_.z*this.y,C=_.w*this.y+_.z*this.x-_.x*this.z,D=_.w*this.z+_.x*this.y-_.y*this.x,K=-_.x*this.x-_.y*this.y-_.z*this.z;return new it(f*_.w+K*-_.x+C*-_.z-D*-_.y,C*_.w+K*-_.y+D*-_.x-f*-_.z,D*_.w+K*-_.z+f*-_.y-C*-_.x)}}function ht(G,_){const f=_.z>0?new Je(0,0,0,1):new Je(0,0,1,0);return Math.abs(G.z)>.9999?f:Je.lookRotation(G,_)}function Qt(G,_,f,C,D,K=1){const te=[];for(let fe=0;fe<f;fe++){const be=G+_*fe/(f-1),Ee=new it;Ee[C]=K*Math.cos(be),Ee[D]=K*Math.sin(be),te.push(Ee)}return te}const ot=u("rotationgizmo"),Ue=new it(0,0,0),Cn=new it(1,0,0),Ht=new it(0,1,0),Ut=new it(0,0,1),fn=new it(0,0,-1),Mn=new it(.7,0,0),Ci=new it(0,.7,0),mn=new it(0,0,.7),On=new it(-.7,0,0),Un=new it(0,-.7,0),un=new it(0,0,-.7),Hn=new Je(0,0,0,1);function kn(G,_,f){const C=G.createElementNS(Z,"g"),D=G.createElementNS(Z,"circle");D.classList.add(ot(_)),D.setAttributeNS(null,"cx","0"),D.setAttributeNS(null,"cy","0"),D.setAttributeNS(null,"r","8"),C.appendChild(D);const K=G.createElementNS(Z,"text");return K.classList.add(ot("labeltext")),K.setAttributeNS(null,"y","4"),K.setAttributeNS(null,"text-anchor","middle"),K.setAttributeNS(null,"font-size","10"),K.textContent=f,C.appendChild(K),C}class Rn{constructor(_,f){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.onModeChange_=this.onModeChange_.bind(this),this.element=_.createElement("div"),this.element.classList.add(ot()),f.pickerLayout==="popup"&&this.element.classList.add(ot(void 0,"p"));const C=_.createElement("div");C.classList.add(ot("p")),f.viewProps.bindTabIndex(C),this.element.appendChild(C),this.padElement=C;const D=_.createElementNS(Z,"svg");D.classList.add(ot("g")),this.padElement.appendChild(D),this.svgElem_=D,this.projector_=new et,this.projector_.viewport=[0,0,136,136];const K=Qt(0,Math.PI,33,"x","y"),te=Qt(0,2*Math.PI,65,"x","y",1.1);this.xArcB_=new Ct(_,K,this.projector_),this.xArcB_.element.classList.add(ot("arcx")),this.svgElem_.appendChild(this.xArcB_.element),this.yArcB_=new Ct(_,K,this.projector_),this.yArcB_.element.classList.add(ot("arcy")),this.svgElem_.appendChild(this.yArcB_.element),this.zArcB_=new Ct(_,K,this.projector_),this.zArcB_.element.classList.add(ot("arcz")),this.svgElem_.appendChild(this.zArcB_.element),this.xArcBC_=new Ct(_,K,this.projector_),this.xArcBC_.element.classList.add(ot("arcc")),this.svgElem_.appendChild(this.xArcBC_.element),this.yArcBC_=new Ct(_,K,this.projector_),this.yArcBC_.element.classList.add(ot("arcc")),this.svgElem_.appendChild(this.yArcBC_.element),this.zArcBC_=new Ct(_,K,this.projector_),this.zArcBC_.element.classList.add(ot("arcc")),this.svgElem_.appendChild(this.zArcBC_.element);const fe=_.createElementNS(Z,"g");D.classList.add(ot("axes")),this.svgElem_.appendChild(fe),this.axesElem_=fe,this.xAxis_=new Ct(_,[Ue,Mn],this.projector_),this.xAxis_.element.classList.add(ot("axisx")),this.axesElem_.appendChild(this.xAxis_.element),this.yAxis_=new Ct(_,[Ue,Ci],this.projector_),this.yAxis_.element.classList.add(ot("axisy")),this.axesElem_.appendChild(this.yAxis_.element),this.zAxis_=new Ct(_,[Ue,mn],this.projector_),this.zAxis_.element.classList.add(ot("axisz")),this.axesElem_.appendChild(this.zAxis_.element),this.xnAxis_=new Ct(_,[Ue,On],this.projector_),this.xnAxis_.element.classList.add(ot("axisn")),this.axesElem_.appendChild(this.xnAxis_.element),this.ynAxis_=new Ct(_,[Ue,Un],this.projector_),this.ynAxis_.element.classList.add(ot("axisn")),this.axesElem_.appendChild(this.ynAxis_.element),this.znAxis_=new Ct(_,[Ue,un],this.projector_),this.znAxis_.element.classList.add(ot("axisn")),this.axesElem_.appendChild(this.znAxis_.element),this.xArcF_=new Ct(_,K,this.projector_),this.xArcF_.element.classList.add(ot("arcx")),this.svgElem_.appendChild(this.xArcF_.element),this.yArcF_=new Ct(_,K,this.projector_),this.yArcF_.element.classList.add(ot("arcy")),this.svgElem_.appendChild(this.yArcF_.element),this.zArcF_=new Ct(_,K,this.projector_),this.zArcF_.element.classList.add(ot("arcz")),this.svgElem_.appendChild(this.zArcF_.element),this.xArcFC_=new Ct(_,K,this.projector_),this.xArcFC_.element.classList.add(ot("arcc")),this.svgElem_.appendChild(this.xArcFC_.element),this.yArcFC_=new Ct(_,K,this.projector_),this.yArcFC_.element.classList.add(ot("arcc")),this.svgElem_.appendChild(this.yArcFC_.element),this.zArcFC_=new Ct(_,K,this.projector_),this.zArcFC_.element.classList.add(ot("arcc")),this.svgElem_.appendChild(this.zArcFC_.element),this.rArc_=new Ct(_,te,this.projector_),this.rArc_.element.classList.add(ot("arcr")),this.rArc_.setRotation(Hn),this.svgElem_.appendChild(this.rArc_.element),this.rArcC_=new Ct(_,te,this.projector_),this.rArcC_.element.classList.add(ot("arcc")),this.rArcC_.setRotation(Hn),this.svgElem_.appendChild(this.rArcC_.element);const be=_.createElementNS(Z,"g");D.classList.add(ot("labels")),this.svgElem_.appendChild(be),this.labelsElem_=be,this.xLabel=kn(_,"labelcirclex","X"),this.labelsElem_.appendChild(this.xLabel),this.yLabel=kn(_,"labelcircley","Y"),this.labelsElem_.appendChild(this.yLabel),this.zLabel=kn(_,"labelcirclez","Z"),this.labelsElem_.appendChild(this.zLabel),this.xnLabel=kn(_,"labelcirclen","-X"),this.labelsElem_.appendChild(this.xnLabel),this.ynLabel=kn(_,"labelcirclen","-Y"),this.labelsElem_.appendChild(this.ynLabel),this.znLabel=kn(_,"labelcirclen","-Z"),this.labelsElem_.appendChild(this.znLabel);const Ee=()=>{this.xArcB_.element.classList.add(ot("arcx_hover")),this.xArcF_.element.classList.add(ot("arcx_hover"))},Be=()=>{this.xArcB_.element.classList.remove(ot("arcx_hover")),this.xArcF_.element.classList.remove(ot("arcx_hover"))};this.xArcBC_.element.addEventListener("mouseenter",Ee),this.xArcBC_.element.addEventListener("mouseleave",Be),this.xArcFC_.element.addEventListener("mouseenter",Ee),this.xArcFC_.element.addEventListener("mouseleave",Be);const st=()=>{this.yArcB_.element.classList.add(ot("arcy_hover")),this.yArcF_.element.classList.add(ot("arcy_hover"))},Lt=()=>{this.yArcB_.element.classList.remove(ot("arcy_hover")),this.yArcF_.element.classList.remove(ot("arcy_hover"))};this.yArcBC_.element.addEventListener("mouseenter",st),this.yArcBC_.element.addEventListener("mouseleave",Lt),this.yArcFC_.element.addEventListener("mouseenter",st),this.yArcFC_.element.addEventListener("mouseleave",Lt);const Ot=()=>{this.zArcB_.element.classList.add(ot("arcz_hover")),this.zArcF_.element.classList.add(ot("arcz_hover"))},$t=()=>{this.zArcB_.element.classList.remove(ot("arcz_hover")),this.zArcF_.element.classList.remove(ot("arcz_hover"))};this.zArcBC_.element.addEventListener("mouseenter",Ot),this.zArcBC_.element.addEventListener("mouseleave",$t),this.zArcFC_.element.addEventListener("mouseenter",Ot),this.zArcFC_.element.addEventListener("mouseleave",$t);const dn=()=>{this.rArc_.element.classList.add(ot("arcr_hover"))},kt=()=>{this.rArc_.element.classList.remove(ot("arcr_hover"))};this.rArcC_.element.addEventListener("mouseenter",dn),this.rArcC_.element.addEventListener("mouseleave",kt),f.value.emitter.on("change",this.onValueChange_),this.value=f.value,f.mode.emitter.on("change",this.onModeChange_),this.mode_=f.mode,this.update_()}get xArcBElement(){return this.xArcBC_.element}get yArcBElement(){return this.yArcBC_.element}get zArcBElement(){return this.zArcBC_.element}get xArcFElement(){return this.xArcFC_.element}get yArcFElement(){return this.yArcFC_.element}get zArcFElement(){return this.zArcFC_.element}get rArcElement(){return this.rArcC_.element}get allFocusableElements(){return[this.padElement]}update_(){const _=this.value.rawValue.quat.normalized;this.xAxis_.setRotation(_),this.yAxis_.setRotation(_),this.zAxis_.setRotation(_),this.xnAxis_.setRotation(_),this.ynAxis_.setRotation(_),this.znAxis_.setRotation(_);const f=Cn.applyQuaternion(_),C=Ht.applyQuaternion(_),D=Ut.applyQuaternion(_),K=f.negated,te=C.negated,fe=D.negated;[{el:this.xAxis_.element,v:f},{el:this.yAxis_.element,v:C},{el:this.zAxis_.element,v:D},{el:this.xnAxis_.element,v:K},{el:this.ynAxis_.element,v:te},{el:this.znAxis_.element,v:fe}].map(({el:be,v:Ee})=>(this.axesElem_.removeChild(be),{el:be,v:Ee})).sort((be,Ee)=>be.v.z-Ee.v.z).forEach(({el:be})=>{this.axesElem_.appendChild(be)}),this.xArcB_.setRotation(ht(f,fn)),this.yArcB_.setRotation(ht(C,fn)),this.zArcB_.setRotation(ht(D,fn)),this.xArcBC_.setRotation(ht(f,fn)),this.yArcBC_.setRotation(ht(C,fn)),this.zArcBC_.setRotation(ht(D,fn)),this.xArcF_.setRotation(ht(f,Ut)),this.yArcF_.setRotation(ht(C,Ut)),this.zArcF_.setRotation(ht(D,Ut)),this.xArcFC_.setRotation(ht(f,Ut)),this.yArcFC_.setRotation(ht(C,Ut)),this.zArcFC_.setRotation(ht(D,Ut)),[{el:this.xLabel,v:Mn},{el:this.yLabel,v:Ci},{el:this.zLabel,v:mn},{el:this.xnLabel,v:On},{el:this.ynLabel,v:Un},{el:this.znLabel,v:un}].forEach(({el:be,v:Ee})=>{const[Be,st]=this.projector_.project(Ee.applyQuaternion(_));be.setAttributeNS(null,"transform",`translate( ${Be}, ${st} )`)}),[{el:this.xLabel,v:f},{el:this.yLabel,v:C},{el:this.zLabel,v:D},{el:this.xnLabel,v:K},{el:this.ynLabel,v:te},{el:this.znLabel,v:fe}].map(({el:be,v:Ee})=>(this.labelsElem_.removeChild(be),{el:be,v:Ee})).sort((be,Ee)=>be.v.z-Ee.v.z).forEach(({el:be})=>{this.labelsElem_.appendChild(be)})}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}onModeChange_(){const _=this.mode_.rawValue,f=_==="angle-x"?"add":"remove",C=_==="angle-y"?"add":"remove",D=_==="angle-z"?"add":"remove",K=_==="angle-r"?"add":"remove";this.xArcB_.element.classList[f](ot("arcx_active")),this.yArcB_.element.classList[C](ot("arcy_active")),this.zArcB_.element.classList[D](ot("arcz_active")),this.xArcF_.element.classList[f](ot("arcx_active")),this.yArcF_.element.classList[C](ot("arcy_active")),this.zArcF_.element.classList[D](ot("arcz_active")),this.rArc_.element.classList[K](ot("arcr_active"))}}function Yi(G){return ut(G,0,1)}function rs(G){if(G<=0)return 0;if(G>=1)return 1;const _=1-G,f=_*(_*(_*(_*(_*(_*(_*-6+7))))));return Yi(1-f)}function gn(G,_,f){return Yi((f-G)/(_-G))}const ni=1/Math.sqrt(2),Pn=new it(1,0,0),qt=new it(0,1,0),Vs=new it(0,0,1),Zi=new Je(0,0,0,1),Fn=new Je(ni,0,0,ni),os=new Je(0,-ni,0,ni),Gn=new Je(-ni,0,0,ni),En=new Je(0,ni,0,ni),li=new Je(0,1,0,0);class Bi{constructor(_,f){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=f.value,this.viewProps=f.viewProps,this.mode_=L("free"),this.view=new Rn(_,{value:this.value,mode:this.mode_,viewProps:this.viewProps,pickerLayout:f.pickerLayout}),this.ptHandler_=new Bt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);const C=new Bt(this.view.xArcBElement);C.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),C.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const D=new Bt(this.view.xArcFElement);D.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),D.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const K=new Bt(this.view.yArcBElement);K.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),K.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const te=new Bt(this.view.yArcFElement);te.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),te.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const fe=new Bt(this.view.zArcBElement);fe.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),fe.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const be=new Bt(this.view.zArcFElement);be.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),be.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const Ee=new Bt(this.view.rArcElement);Ee.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-r")),Ee.emitter.on("up",()=>this.changeModeIfNotAuto_("free")),[{el:this.view.xLabel,q:os},{el:this.view.yLabel,q:Fn},{el:this.view.zLabel,q:Zi},{el:this.view.xnLabel,q:En},{el:this.view.ynLabel,q:Gn},{el:this.view.znLabel,q:li}].forEach(({el:Be,q:st})=>{new Bt(Be).emitter.on("down",()=>this.autoRotate_(st))}),this.px_=null,this.py_=null,this.angleState_=null}handlePointerEvent_(_){if(!_.point)return;const f=this.mode_.rawValue,C=_.point.x,D=_.point.y;if(f!=="auto")if(f==="free"){if(this.px_!=null&&this.py_!=null){const K=C-this.px_,te=D-this.py_,fe=Math.sqrt(K*K+te*te);if(fe===0)return;const be=new it(te/fe,K/fe,0),Ee=Je.fromAxisAngle(be,fe/68);this.value.rawValue=this.value.rawValue.premultiply(Ee)}this.px_=C,this.py_=D}else if(f==="angle-r"){const K=_.bounds.width/2,te=_.bounds.height/2,fe=Math.atan2(D-te,C-K);if(this.angleState_==null){const be=new it(0,0,1);this.angleState_={initialRotation:this.value.rawValue,initialAngle:fe,axis:be,reverseAngle:!0}}else{const{initialRotation:be,initialAngle:Ee,axis:Be}=this.angleState_,st=-xt(fe-Ee),Lt=Je.fromAxisAngle(Be,st);this.value.rawValue=be.premultiply(Lt)}}else{const K=_.bounds.width/2,te=_.bounds.height/2,fe=Math.atan2(D-te,C-K);if(this.angleState_==null){const be=f==="angle-x"?Pn:f==="angle-y"?qt:Vs,Ee=be.applyQuaternion(this.value.rawValue.quat).z>0;this.angleState_={initialRotation:this.value.rawValue,initialAngle:fe,axis:be,reverseAngle:Ee}}else{const{initialRotation:be,initialAngle:Ee,axis:Be,reverseAngle:st}=this.angleState_;let Lt=xt(fe-Ee);Lt=st?-Lt:Lt;const Ot=Je.fromAxisAngle(Be,Lt);this.value.rawValue=be.multiply(Ot)}}}onPointerDown_(_){this.handlePointerEvent_(_.data)}onPointerMove_(_){this.handlePointerEvent_(_.data)}onPointerUp_(){this.px_=null,this.py_=null,this.angleState_=null}onPadKeyDown_(_){xn(_.key)&&_.preventDefault();const f=We(1,Yt(_)),C=We(1,_t(_));if(f!==0||C!==0){const D=new it(-C,f,0),K=Je.fromAxisAngle(D,Math.PI/16);this.value.rawValue=this.value.rawValue.premultiply(K)}}changeModeIfNotAuto_(_){this.mode_.rawValue!=="auto"&&(this.mode_.rawValue=_)}autoRotate_(_){this.mode_.rawValue="auto";const f=this.value.rawValue,C=Date.now(),D=()=>{const K=Date.now(),te=rs(gn(0,300,K-C));if(this.value.rawValue=f.slerp(_,te),te===1){this.mode_.rawValue="free";return}requestAnimationFrame(D)};requestAnimationFrame(D)}}const qn=u("rotationswatch"),Xn=new it(1,0,0),Ji=new it(0,1,0),Mi=new it(0,0,1),Ei=new Je(0,0,0,1);class Ns{constructor(_,f){this.onValueChange_=this.onValueChange_.bind(this),f.value.emitter.on("change",this.onValueChange_),this.value=f.value,this.element=_.createElement("div"),this.element.classList.add(qn()),f.viewProps.bindClassModifiers(this.element);const C=_.createElement("button");C.classList.add(qn("b")),f.viewProps.bindDisabled(C),this.element.appendChild(C),this.buttonElement=C;const D=_.createElementNS(Z,"svg");D.classList.add(qn("g")),C.appendChild(D),this.svgElem_=D,this.projector_=new et,this.projector_.viewport=[0,0,20,20];const K=Qt(0,Math.PI,33,"x","y"),te=Qt(0,2*Math.PI,65,"x","y");this.rArc_=new Ct(_,te,this.projector_),this.rArc_.element.classList.add(qn("arcr")),D.appendChild(this.rArc_.element),this.rArc_.setRotation(Ei),this.xArc_=new Ct(_,K,this.projector_),this.xArc_.element.classList.add(qn("arc")),D.appendChild(this.xArc_.element),this.yArc_=new Ct(_,K,this.projector_),this.yArc_.element.classList.add(qn("arc")),D.appendChild(this.yArc_.element),this.zArc_=new Ct(_,K,this.projector_),this.zArc_.element.classList.add(qn("arc")),D.appendChild(this.zArc_.element),this.update_()}update_(){const _=this.value.rawValue.quat.normalized,f=Xn.applyQuaternion(_),C=Ji.applyQuaternion(_),D=Mi.applyQuaternion(_);this.xArc_.setRotation(ht(f,Mi)),this.yArc_.setRotation(ht(C,Mi)),this.zArc_.setRotation(ht(D,Mi))}onValueChange_(){this.update_()}}class Os{constructor(_,f){this.value=f.value,this.viewProps=f.viewProps,this.view=new Ns(_,{value:this.value,viewProps:this.viewProps})}}const ci=u("rotation");class Si{constructor(_,f){this.element=_.createElement("div"),this.element.classList.add(ci()),f.foldable.bindExpandedClass(this.element,ci(void 0,"expanded")),b(f.foldable,"completed",S(this.element,ci(void 0,"cpl"))),f.rotationMode==="quaternion"&&this.element.classList.add(ci("quat"));const C=_.createElement("div");C.classList.add(ci("h")),this.element.appendChild(C);const D=_.createElement("div");D.classList.add(ci("s")),C.appendChild(D),this.swatchElement=D;const K=_.createElement("div");if(K.classList.add(ci("t")),C.appendChild(K),this.textElement=K,f.pickerLayout==="inline"){const te=_.createElement("div");te.classList.add(ci("g")),this.element.appendChild(te),this.pickerElement=te}else this.pickerElement=null}}class Qi{constructor(_,f){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=f.value,this.viewProps=f.viewProps,this.foldable_=ce.create(f.expanded),this.swatchC_=new Os(_,{value:this.value,viewProps:this.viewProps});const C=this.swatchC_.view.buttonElement;C.addEventListener("blur",this.onButtonBlur_),C.addEventListener("click",this.onButtonClick_),this.textC_=new le(_,{assembly:f.assembly,axes:f.axes,parser:f.parser,value:this.value,viewProps:this.viewProps}),this.view=new Si(_,{rotationMode:f.rotationMode,foldable:this.foldable_,pickerLayout:f.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=f.pickerLayout==="popup"?new Ie(_,{viewProps:this.viewProps}):null;const D=new Bi(_,{value:this.value,viewProps:this.viewProps,pickerLayout:f.pickerLayout});D.view.allFocusableElements.forEach(K=>{K.addEventListener("blur",this.onPopupChildBlur_),K.addEventListener("keydown",this.onPopupChildKeydown_)}),this.gizmoC_=D,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(D.view.element),Le({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:K=>K.rawValue,backward:(K,te)=>te.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.gizmoC_.view.element),he(this.foldable_,this.view.pickerElement))}onButtonBlur_(_){if(!this.popC_)return;const f=this.view.element,C=_.relatedTarget;(!C||!f.contains(C))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.gizmoC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(_){if(!this.popC_)return;const f=this.popC_.view.element,C=ne(_);C&&f.contains(C)||C&&C===this.swatchC_.view.buttonElement&&!oe(f.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(_){this.popC_?_.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&_.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Ui(G,_){const f=Math.pow(.1,G);return{baseStep:f,constraint:_,textProps:R.fromObject({draggingScale:f,formatter:Ge(G)})}}function hi(G){if(!G)return;const _=[];return n(G.step)||_.push(new ze(G.step)),(!n(G.max)||!n(G.min))&&_.push(new me({max:G.max,min:G.min})),new ue(_)}function $n(G,_){return{toComponents:f=>f.getComponents(),fromComponents:f=>new Pt(f[0],f[1],f[2],G,_)}}function fs(G,_,f){var C,D,K;return typeof((C=G)===null||C===void 0?void 0:C.x)=="number"&&typeof((D=G)===null||D===void 0?void 0:D.y)=="number"&&typeof((K=G)===null||K===void 0?void 0:K.z)=="number"?new Pt(G.x,G.y,G.z,_,f):new Pt(0,0,0,_,f)}function Fs(G){switch(G){case"XYZ":case"XZY":case"YXZ":case"YZX":case"ZXY":case"ZYX":return G;default:return}}function Zs(G){switch(G){case"rad":case"deg":case"turn":return G;default:return}}const Ai={id:"rotation",type:"input",css:".tp-rotationswatchv_b,.tp-rotationgizmov_p{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-rotationswatchv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-rotationswatchv_b:hover{background-color:var(--btn-bg-h)}.tp-rotationswatchv_b:focus{background-color:var(--btn-bg-f)}.tp-rotationswatchv_b:active{background-color:var(--btn-bg-a)}.tp-rotationswatchv_b:disabled{opacity:0.5}.tp-rotationgizmov_p{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-rotationgizmov_p:hover{background-color:var(--in-bg-h)}.tp-rotationgizmov_p:focus{background-color:var(--in-bg-f)}.tp-rotationgizmov_p:active{background-color:var(--in-bg-a)}.tp-rotationgizmov_p:disabled{opacity:0.5}.tp-rotationv{position:relative}.tp-rotationv_quat .tp-txtv_i{padding-left:0}.tp-rotationv_root{background-color:var(--mo-bg);width:100%;height:calc( 2.0 * var(--bld-us))}.tp-rotationv_h{display:flex}.tp-rotationv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us);margin-right:4px}.tp-rotationv_g{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-rotationv.tp-rotationv-expanded .tp-rotationv_g{margin-top:var(--bld-s);opacity:1}.tp-rotationv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-rotationswatchv path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationswatchv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-rotationswatchv_arc{fill:none;stroke:var(--btn-bg);stroke-width:1px}.tp-rotationswatchv_arcr{fill:var(--btn-fg);stroke:var(--btn-bg);stroke-width:1px}.tp-rotationgizmov{padding-left:calc(var(--bld-us) + 4px)}.tp-rotationgizmov path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationgizmov_p{cursor:move;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-rotationgizmov_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-rotationgizmov_axisx{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_axisy{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_axisz{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_axisn{stroke:var(--in-fg);stroke-width:2px}.tp-rotationgizmov_arcx{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_hover{stroke:#eb103f}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_active{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_arcy{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_hover{stroke:#4eeb10}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_active{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_arcz{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_hover{stroke:#1068eb}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_active{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_arcr{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_hover{stroke:#ebd510}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_active{stroke:#ebd510;stroke-width:2px}.tp-rotationgizmov_arcc{fill:none;stroke:transparent;stroke-width:5px;pointer-events:auto}.tp-rotationgizmov_labelcirclex{fill:#eb103f;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclex:hover{opacity:0.7}.tp-rotationgizmov_labelcircley{fill:#4eeb10;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcircley:hover{opacity:0.7}.tp-rotationgizmov_labelcirclez{fill:#1068eb;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclez:hover{opacity:0.7}.tp-rotationgizmov_labelcirclen{fill:var(--in-fg);cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclen:hover{opacity:0.7}.tp-rotationgizmov_labeltext{fill:var(--btn-fg);stroke:var(--btn-fg);stroke-width:1px}.tp-rotationgizmov_p:focus .tp-rotationgizmov_m{background-color:var(--in-fg);border-width:0}",accept(G,_){var f,C;const D=F,K=W(_,{view:D.required.constant("rotation"),label:D.optional.string,picker:D.optional.custom(yi),expanded:D.optional.boolean,rotationMode:D.required.constant("euler"),x:D.optional.custom(Nn),y:D.optional.custom(Nn),z:D.optional.custom(Nn),order:D.optional.custom(Fs),unit:D.optional.custom(Zs)});return K?{initialValue:fs(G,(f=K.order)!==null&&f!==void 0?f:"XYZ",(C=K.unit)!==null&&C!==void 0?C:"rad"),params:K}:null},binding:{reader({params:G}){return _=>{var f,C;return fs(_,(f=G.order)!==null&&f!==void 0?f:"XYZ",(C=G.unit)!==null&&C!==void 0?C:"rad")}},constraint({params:G}){var _,f;return new yn({assembly:$n((_=G.order)!==null&&_!==void 0?_:"XYZ",(f=G.unit)!==null&&f!==void 0?f:"rad"),components:[hi("x"in G?G.x:void 0),hi("y"in G?G.y:void 0),hi("z"in G?G.z:void 0)]})},writer(G){return(_,f)=>{_.writeProperty("x",f.x),_.writeProperty("y",f.y),_.writeProperty("z",f.z)}}},controller({document:G,value:_,constraint:f,params:C,viewProps:D}){var K,te;if(!(f instanceof yn))throw o.shouldNeverHappen();const fe="expanded"in C?C.expanded:void 0,be="picker"in C?C.picker:void 0,Ee=(K=C.unit)!==null&&K!==void 0?K:"rad",Be={rad:2,deg:0,turn:2}[Ee];return new Qi(G,{axes:[Ui(Be,f.components[0]),Ui(Be,f.components[1]),Ui(Be,f.components[2])],assembly:$n((te=C.order)!==null&&te!==void 0?te:"XYZ",Ee),rotationMode:"euler",expanded:fe??!1,parser:at,pickerLayout:be??"popup",value:_,viewProps:D})}},ms={toComponents:G=>[G.x,G.y,G.z,G.w],fromComponents:G=>new Je(G[0],G[1],G[2],G[3])};function Hi(G){return{baseStep:.01,constraint:G,textProps:R.fromObject({draggingScale:.01,formatter:_=>Math.abs(_)<.995?_.toFixed(2).replace("0.","."):_.toFixed(1)})}}function Yn(G){var _,f,C,D;return typeof((_=G)===null||_===void 0?void 0:_.x)=="number"&&typeof((f=G)===null||f===void 0?void 0:f.y)=="number"&&typeof((C=G)===null||C===void 0?void 0:C.z)=="number"&&typeof((D=G)===null||D===void 0?void 0:D.w)=="number"?new Je(G.x,G.y,G.z,G.w):new Je(0,0,0,1)}const Pi={id:"rotation",type:"input",css:".tp-rotationswatchv_b,.tp-rotationgizmov_p{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-rotationswatchv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-rotationswatchv_b:hover{background-color:var(--btn-bg-h)}.tp-rotationswatchv_b:focus{background-color:var(--btn-bg-f)}.tp-rotationswatchv_b:active{background-color:var(--btn-bg-a)}.tp-rotationswatchv_b:disabled{opacity:0.5}.tp-rotationgizmov_p{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-rotationgizmov_p:hover{background-color:var(--in-bg-h)}.tp-rotationgizmov_p:focus{background-color:var(--in-bg-f)}.tp-rotationgizmov_p:active{background-color:var(--in-bg-a)}.tp-rotationgizmov_p:disabled{opacity:0.5}.tp-rotationv{position:relative}.tp-rotationv_quat .tp-txtv_i{padding-left:0}.tp-rotationv_root{background-color:var(--mo-bg);width:100%;height:calc( 2.0 * var(--bld-us))}.tp-rotationv_h{display:flex}.tp-rotationv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us);margin-right:4px}.tp-rotationv_g{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-rotationv.tp-rotationv-expanded .tp-rotationv_g{margin-top:var(--bld-s);opacity:1}.tp-rotationv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-rotationswatchv path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationswatchv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-rotationswatchv_arc{fill:none;stroke:var(--btn-bg);stroke-width:1px}.tp-rotationswatchv_arcr{fill:var(--btn-fg);stroke:var(--btn-bg);stroke-width:1px}.tp-rotationgizmov{padding-left:calc(var(--bld-us) + 4px)}.tp-rotationgizmov path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationgizmov_p{cursor:move;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-rotationgizmov_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-rotationgizmov_axisx{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_axisy{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_axisz{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_axisn{stroke:var(--in-fg);stroke-width:2px}.tp-rotationgizmov_arcx{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_hover{stroke:#eb103f}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_active{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_arcy{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_hover{stroke:#4eeb10}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_active{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_arcz{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_hover{stroke:#1068eb}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_active{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_arcr{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_hover{stroke:#ebd510}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_active{stroke:#ebd510;stroke-width:2px}.tp-rotationgizmov_arcc{fill:none;stroke:transparent;stroke-width:5px;pointer-events:auto}.tp-rotationgizmov_labelcirclex{fill:#eb103f;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclex:hover{opacity:0.7}.tp-rotationgizmov_labelcircley{fill:#4eeb10;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcircley:hover{opacity:0.7}.tp-rotationgizmov_labelcirclez{fill:#1068eb;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclez:hover{opacity:0.7}.tp-rotationgizmov_labelcirclen{fill:var(--in-fg);cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclen:hover{opacity:0.7}.tp-rotationgizmov_labeltext{fill:var(--btn-fg);stroke:var(--btn-fg);stroke-width:1px}.tp-rotationgizmov_p:focus .tp-rotationgizmov_m{background-color:var(--in-fg);border-width:0}",accept(G,_){const f=F,C=W(_,{view:f.required.constant("rotation"),label:f.optional.string,picker:f.optional.custom(yi),expanded:f.optional.boolean,rotationMode:f.optional.constant("quaternion"),x:f.optional.custom(Nn),y:f.optional.custom(Nn),z:f.optional.custom(Nn),w:f.optional.custom(Nn)});return C?{initialValue:Yn(G),params:C}:null},binding:{reader(G){return _=>Yn(_)},constraint({params:G}){return new yn({assembly:ms,components:[hi("x"in G?G.x:void 0),hi("y"in G?G.y:void 0),hi("z"in G?G.z:void 0),hi("w"in G?G.w:void 0)]})},writer(G){return(_,f)=>{_.writeProperty("x",f.x),_.writeProperty("y",f.y),_.writeProperty("z",f.z),_.writeProperty("w",f.w)}}},controller({document:G,value:_,constraint:f,params:C,viewProps:D}){if(!(f instanceof yn))throw o.shouldNeverHappen();const K="expanded"in C?C.expanded:void 0,te="picker"in C?C.picker:void 0;return new Qi(G,{axes:[Hi(f.components[0]),Hi(f.components[1]),Hi(f.components[2]),Hi(f.components[3])],assembly:ms,rotationMode:"quaternion",expanded:K??!1,parser:at,pickerLayout:te??"popup",value:_,viewProps:D})}},Gi=[Ai,Pi];t.RotationInputPluginEuler=Ai,t.RotationInputPluginQuaternion=Pi,t.plugins=Gi,Object.defineProperty(t,"__esModule",{value:!0})})})(P_,P_.exports);var T_={exports:{}};(function(h,e){(function(t,n){n(e)})(vh,function(t){const n="tp";function i(M){return(L,R)=>[n,"-",M,"v",L?`_${L}`:"",R?`-${R}`:""].join("")}function o(M,L){return Object.keys(L).reduce((z,V)=>{if(z===void 0)return;const H=L[V],B=H(M[V]);return B.succeeded?Object.assign(Object.assign({},z),{[V]:B.value}):void 0},{})}function a(M,L){return M.reduce((R,z)=>{if(R===void 0)return;const V=L(z);if(!(!V.succeeded||V.value===void 0))return[...R,V.value]},[])}function c(M){return M===null?!1:typeof M=="object"}function u(M){return L=>R=>{if(!L&&R===void 0)return{succeeded:!1,value:void 0};if(L&&R===void 0)return{succeeded:!0,value:void 0};const z=M(R);return z!==void 0?{succeeded:!0,value:z}:{succeeded:!1,value:void 0}}}function d(M){return{custom:L=>u(L)(M),boolean:u(L=>typeof L=="boolean"?L:void 0)(M),number:u(L=>typeof L=="number"?L:void 0)(M),string:u(L=>typeof L=="string"?L:void 0)(M),function:u(L=>typeof L=="function"?L:void 0)(M),constant:L=>u(R=>R===L?L:void 0)(M),raw:u(L=>L)(M),object:L=>u(R=>{if(c(R))return o(R,L)})(M),array:L=>u(R=>{if(Array.isArray(R))return a(R,L)})(M)}}const v={optional:d(!0),required:d(!1)};function g(M,L){const R=v.required.object(L)(M);return R.succeeded?R.value:void 0}const b=i("txtr");class y{constructor(L,R){this.onChange_=this.onChange_.bind(this),this.element=L.createElement("div"),this.element.classList.add(b()),R.viewProps.bindClassModifiers(this.element);const z=L.createElement("textarea");z.rows=R.lineCount,z.cols=22,z.placeholder=R.placeholder,z.classList.add(b("i")),R.viewProps.bindDisabled(z),this.element.appendChild(z),this.inputElement=z,R.value.emitter.on("change",this.onChange_),this.value_=R.value,this.refresh()}refresh(){this.inputElement.value=this.value_.rawValue}onChange_(){this.refresh()}}class S{constructor(L,R){this.onInputChange_=this.onInputChange_.bind(this),this.value=R.value,this.viewProps=R.viewProps,this.lineCount=R.lineCount,this.placeholder=R.placeholder,this.view=new y(L,{value:this.value,viewProps:this.viewProps,lineCount:this.lineCount,placeholder:this.placeholder}),this.view.inputElement.addEventListener("keyup",this.onInputChange_)}onInputChange_(L){const R=L.currentTarget.value;this.value.rawValue=R,this.view.refresh()}}const E=[{id:"input-template",type:"input",css:".tp-txtrv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-txtrv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtrv:hover{background-color:var(--in-bg-h)}.tp-txtrv:focus{background-color:var(--in-bg-f)}.tp-txtrv:active{background-color:var(--in-bg-a)}.tp-txtrv:disabled{opacity:.5}.tp-txtrv{display:block;height:auto;padding-bottom:0;overflow:hidden;position:relative}.tp-txtrv.tp-v-disabled{opacity:.5}.tp-txtrv .tp-txtrv_i{font-family:var(--font-family);background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-size:11px;padding:4px;line-height:16px;min-width:0;width:100%;border:none;height:100%;resize:none;margin-bottom:-8px}.tp-txtrv .tp-txtrv_i:focus{outline:none}",accept(M,L){if(typeof M!="string")return null;const R=v,z=g(L,{view:R.required.constant("textarea"),lineCount:R.optional.number,placeholder:R.optional.string});return z?{initialValue:M,params:z}:null},binding:{reader(M){return L=>typeof L=="string"?L:""},writer(M){return(L,R)=>{L.write(R)}}},controller(M){var L,R;return new S(M.document,{value:M.value,lineCount:(L=M.params.lineCount)!==null&&L!==void 0?L:3,placeholder:(R=M.params.placeholder)!==null&&R!==void 0?R:"Enter text here",viewProps:M.viewProps})}}];t.plugins=E,Object.defineProperty(t,"__esModule",{value:!0})})})(T_,T_.exports);id.NONE,id.ORBIT;Io("three-inspect.controls")??id.NONE;const tL=()=>{const h=document.createElement("canvas");h.width=1,h.height=1;const e=h.getContext("2d");e!==null&&(e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1));const t=document.createElement("img");return t.src=h.toDataURL("image/png"),t},nL=tL(),Ou={axes:!!Io("three-inspect.axes"),background:nL,fogColor:"#000000",grid:!!Io("three-inspect.grid"),gridCellSize:Io("three-inspect.gridCellSize")??1,gridColor:Io("three-inspect.gridColor")??"#ffffff",gridDistance:Io("three-inspect.gridDistance")??100,gridLargeCellSize:Io("three-inspect.largeCellSize")??10};new $e;new pv(1e3),new XT(Ou.gridCellSize,Ou.gridLargeCellSize,Ou.gridColor,Ou.gridDistance);const pw=document.createElement("style");pw.textContent=eL;document.head.append(pw);var zv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fw(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Tm={exports:{}};/*! Tweakpane 3.1.10 (c) 2016 cocopon, licensed under the MIT license. */(function(h,e){(function(t,n){n(e)})(zv,function(t){class n{constructor(s){const[l,p]=s.split("-"),P=l.split(".");this.major=parseInt(P[0],10),this.minor=parseInt(P[1],10),this.patch=parseInt(P[2],10),this.prerelease=p??null}toString(){const s=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[s,this.prerelease].join("-"):s}}class i{constructor(s){this.controller_=s}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(s){this.controller_.viewProps.set("disabled",s)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(s){this.controller_.viewProps.set("hidden",s)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class o{constructor(s){this.target=s}}class a extends o{constructor(s,l,p,P){super(s),this.value=l,this.presetKey=p,this.last=P??!0}}class c extends o{constructor(s,l,p){super(s),this.value=l,this.presetKey=p}}class u extends o{constructor(s,l){super(s),this.expanded=l}}class d extends o{constructor(s,l){super(s),this.index=l}}function v(r){return r}function g(r){return r==null}function b(r,s){if(r.length!==s.length)return!1;for(let l=0;l<r.length;l++)if(r[l]!==s[l])return!1;return!0}function y(r,s){let l=r;do{const p=Object.getOwnPropertyDescriptor(l,s);if(p&&(p.set!==void 0||p.writable===!0))return!0;l=Object.getPrototypeOf(l)}while(l!==null);return!1}const S={alreadydisposed:()=>"View has been already disposed",invalidparams:r=>`Invalid parameters for '${r.name}'`,nomatchingcontroller:r=>`No matching controller for '${r.key}'`,nomatchingview:r=>`No matching view for '${JSON.stringify(r.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:r=>`Property '${r.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class E{static alreadyDisposed(){return new E({type:"alreadydisposed"})}static notBindable(){return new E({type:"notbindable"})}static propertyNotFound(s){return new E({type:"propertynotfound",context:{name:s}})}static shouldNeverHappen(){return new E({type:"shouldneverhappen"})}constructor(s){var l;this.message=(l=S[s.type](s.context))!==null&&l!==void 0?l:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=s.type}}class M{constructor(s,l,p){this.obj_=s,this.key_=l,this.presetKey_=p??l}static isBindable(s){return!(s===null||typeof s!="object"&&typeof s!="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(s){this.obj_[this.key_]=s}writeProperty(s,l){const p=this.read();if(!M.isBindable(p))throw E.notBindable();if(!(s in p))throw E.propertyNotFound(s);p[s]=l}}class L extends i{get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}get title(){var s;return(s=this.controller_.valueController.props.get("title"))!==null&&s!==void 0?s:""}set title(s){this.controller_.valueController.props.set("title",s)}on(s,l){const p=l.bind(this);return this.controller_.valueController.emitter.on(s,()=>{p(new o(this))}),this}}class R{constructor(){this.observers_={}}on(s,l){let p=this.observers_[s];return p||(p=this.observers_[s]=[]),p.push({handler:l}),this}off(s,l){const p=this.observers_[s];return p&&(this.observers_[s]=p.filter(P=>P.handler!==l)),this}emit(s,l){const p=this.observers_[s];p&&p.forEach(P=>{P.handler(l)})}}const z="tp";function V(r){return(l,p)=>[z,"-",r,"v",l?`_${l}`:"",p?`-${p}`:""].join("")}function H(r,s){return l=>s(r(l))}function B(r){return r.rawValue}function j(r,s){r.emitter.on("change",H(B,s)),s(r.rawValue)}function F(r,s,l){j(r.value(s),l)}function W(r,s,l){l?r.classList.add(s):r.classList.remove(s)}function Z(r,s){return l=>{W(r,s,l)}}function se(r,s){j(r,l=>{s.textContent=l??""})}const we=V("btn");class oe{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(we()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("button");p.classList.add(we("b")),l.viewProps.bindDisabled(p),this.element.appendChild(p),this.buttonElement=p;const P=s.createElement("div");P.classList.add(we("t")),se(l.props.value("title"),P),this.buttonElement.appendChild(P)}}class ne{constructor(s,l){this.emitter=new R,this.onClick_=this.onClick_.bind(this),this.props=l.props,this.viewProps=l.viewProps,this.view=new oe(s,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ce{constructor(s,l){var p;this.constraint_=l?.constraint,this.equals_=(p=l?.equals)!==null&&p!==void 0?p:(P,U)=>P===U,this.emitter=new R,this.rawValue_=s}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(s){this.setRawValue(s,{forceEmit:!1,last:!0})}setRawValue(s,l){const p=l??{forceEmit:!1,last:!0},P=this.constraint_?this.constraint_.constrain(s):s,U=this.rawValue_;this.equals_(U,P)&&!p.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=P,this.emitter.emit("change",{options:p,previousRawValue:U,rawValue:P,sender:this}))}}class ve{constructor(s){this.emitter=new R,this.value_=s}get rawValue(){return this.value_}set rawValue(s){this.setRawValue(s,{forceEmit:!1,last:!0})}setRawValue(s,l){const p=l??{forceEmit:!1,last:!0},P=this.value_;P===s&&!p.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=s,this.emitter.emit("change",{options:p,previousRawValue:P,rawValue:this.value_,sender:this}))}}function de(r,s){const l=s?.constraint,p=s?.equals;return!l&&!p?new ve(r):new ce(r,s)}class he{constructor(s){this.emitter=new R,this.valMap_=s;for(const l in this.valMap_)this.valMap_[l].emitter.on("change",()=>{this.emitter.emit("change",{key:l,sender:this})})}static createCore(s){return Object.keys(s).reduce((p,P)=>Object.assign(p,{[P]:de(s[P])}),{})}static fromObject(s){const l=this.createCore(s);return new he(l)}get(s){return this.valMap_[s].rawValue}set(s,l){this.valMap_[s].rawValue=l}value(s){return this.valMap_[s]}}function ue(r,s){const p=Object.keys(s).reduce((P,U)=>{if(P===void 0)return;const ee=s[U],_e=ee(r[U]);return _e.succeeded?Object.assign(Object.assign({},P),{[U]:_e.value}):void 0},{});return p}function me(r,s){return r.reduce((l,p)=>{if(l===void 0)return;const P=s(p);if(!(!P.succeeded||P.value===void 0))return[...l,P.value]},[])}function ze(r){return r===null?!1:typeof r=="object"}function Te(r){return s=>l=>{if(!s&&l===void 0)return{succeeded:!1,value:void 0};if(s&&l===void 0)return{succeeded:!0,value:void 0};const p=r(l);return p!==void 0?{succeeded:!0,value:p}:{succeeded:!1,value:void 0}}}function Re(r){return{custom:s=>Te(s)(r),boolean:Te(s=>typeof s=="boolean"?s:void 0)(r),number:Te(s=>typeof s=="number"?s:void 0)(r),string:Te(s=>typeof s=="string"?s:void 0)(r),function:Te(s=>typeof s=="function"?s:void 0)(r),constant:s=>Te(l=>l===s?s:void 0)(r),raw:Te(s=>s)(r),object:s=>Te(l=>{if(ze(l))return ue(l,s)})(r),array:s=>Te(l=>{if(Array.isArray(l))return me(l,s)})(r)}}const Ie={optional:Re(!0),required:Re(!1)};function rt(r,s){const l=Ie.required.object(s)(r);return l.succeeded?l.value:void 0}function Ae(r){console.warn([`Missing '${r.key}' of ${r.target} in ${r.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function pt(r){return r&&r.parentElement&&r.parentElement.removeChild(r),null}class nt{constructor(s){this.value_=s}static create(s){return[new nt(s),(l,p)=>{s.setRawValue(l,p)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const Et=V("");function He(r,s){return Z(r,Et(void 0,s))}class mt extends he{constructor(s){var l;super(s),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=nt.create(de(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(l=this.get("parent"))===null||l===void 0||l.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(s){var l,p,P;const U=s??{};return new mt(he.createCore({disabled:(l=U.disabled)!==null&&l!==void 0?l:!1,disposed:!1,hidden:(p=U.hidden)!==null&&p!==void 0?p:!1,parent:(P=U.parent)!==null&&P!==void 0?P:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(s){j(this.globalDisabled_,He(s,"disabled")),F(this,"hidden",He(s,"hidden"))}bindDisabled(s){j(this.globalDisabled_,l=>{s.disabled=l})}bindTabIndex(s){j(this.globalDisabled_,l=>{s.tabIndex=l?-1:0})}handleDispose(s){this.value("disposed").emitter.on("change",l=>{l&&s()})}getGlobalDisabled_(){const s=this.get("parent");return(s?s.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(s){var l;const p=s.previousRawValue;p?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(l=this.get("parent"))===null||l===void 0||l.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function ke(){return["veryfirst","first","last","verylast"]}const xe=V(""),Ve={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Ye{constructor(s){this.parent_=null,this.blade=s.blade,this.view=s.view,this.viewProps=s.viewProps;const l=this.view.element;this.blade.value("positions").emitter.on("change",()=>{ke().forEach(p=>{l.classList.remove(xe(void 0,Ve[p]))}),this.blade.get("positions").forEach(p=>{l.classList.add(xe(void 0,Ve[p]))})}),this.viewProps.handleDispose(()=>{pt(l)})}get parent(){return this.parent_}set parent(s){if(this.parent_=s,!("parent"in this.viewProps.valMap_)){Ae({key:"parent",target:mt.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const Oe="http://www.w3.org/2000/svg";function St(r){r.offsetHeight}function vt(r,s){const l=r.style.transition;r.style.transition="none",s(),r.style.transition=l}function dt(r){return r.ontouchstart!==void 0}function en(){return globalThis}function Xt(){return en().document}function Q(r){const s=r.ownerDocument.defaultView;return s&&"document"in s?r.getContext("2d",{willReadFrequently:!0}):null}const q={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function ge(r,s){const l=r.createElementNS(Oe,"svg");return l.innerHTML=q[s],l}function Ne(r,s,l){r.insertBefore(s,r.children[l])}function je(r){r.parentElement&&r.parentElement.removeChild(r)}function Ze(r){for(;r.children.length>0;)r.removeChild(r.children[0])}function wt(r){for(;r.childNodes.length>0;)r.removeChild(r.childNodes[0])}function qe(r){return r.relatedTarget?r.relatedTarget:"explicitOriginalTarget"in r?r.explicitOriginalTarget:null}const Pe=V("lbl");function ct(r,s){const l=r.createDocumentFragment();return s.split(`
`).map(P=>r.createTextNode(P)).forEach((P,U)=>{U>0&&l.appendChild(r.createElement("br")),l.appendChild(P)}),l}class ft{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(Pe()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("div");p.classList.add(Pe("l")),F(l.props,"label",U=>{g(U)?this.element.classList.add(Pe(void 0,"nol")):(this.element.classList.remove(Pe(void 0,"nol")),wt(p),p.appendChild(ct(s,U)))}),this.element.appendChild(p),this.labelElement=p;const P=s.createElement("div");P.classList.add(Pe("v")),this.element.appendChild(P),this.valueElement=P}}class lt extends Ye{constructor(s,l){const p=l.valueController.viewProps;super(Object.assign(Object.assign({},l),{view:new ft(s,{props:l.props,viewProps:p}),viewProps:p})),this.props=l.props,this.valueController=l.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const gt={id:"button",type:"blade",accept(r){const s=Ie,l=rt(r,{title:s.required.string,view:s.required.constant("button"),label:s.optional.string});return l?{params:l}:null},controller(r){return new lt(r.document,{blade:r.blade,props:he.fromObject({label:r.params.label}),valueController:new ne(r.document,{props:he.fromObject({title:r.params.title}),viewProps:r.viewProps})})},api(r){return!(r.controller instanceof lt)||!(r.controller.valueController instanceof ne)?null:new L(r.controller)}};class yt extends Ye{constructor(s){super(s),this.value=s.value}}function Dt(){return new he({positions:de([],{equals:b})})}class ie extends he{constructor(s){super(s)}static create(s){const l={completed:!0,expanded:s,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},p=he.createCore(l);return new ie(p)}get styleExpanded(){var s;return(s=this.get("temporaryExpanded"))!==null&&s!==void 0?s:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const s=this.get("expandedHeight");return this.get("shouldFixHeight")&&!g(s)?`${s}px`:"auto"}bindExpandedClass(s,l){const p=()=>{this.styleExpanded?s.classList.add(l):s.classList.remove(l)};F(this,"expanded",p),F(this,"temporaryExpanded",p)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function at(r,s){let l=0;return vt(s,()=>{r.set("expandedHeight",null),r.set("temporaryExpanded",!0),St(s),l=s.clientHeight,r.set("temporaryExpanded",null),St(s)}),l}function Ge(r,s){s.style.height=r.styleHeight}function Le(r,s){r.value("expanded").emitter.on("beforechange",()=>{if(r.set("completed",!1),g(r.get("expandedHeight"))){const l=at(r,s);l>0&&r.set("expandedHeight",l)}r.set("shouldFixHeight",!0),St(s)}),r.emitter.on("change",()=>{Ge(r,s)}),Ge(r,s),s.addEventListener("transitionend",l=>{l.propertyName==="height"&&r.cleanUpTransition()})}class We extends i{constructor(s,l){super(s),this.rackApi_=l}}function _t(r,s){return r.addBlade(Object.assign(Object.assign({},s),{view:"button"}))}function Yt(r,s){return r.addBlade(Object.assign(Object.assign({},s),{view:"folder"}))}function an(r,s){const l=s??{};return r.addBlade(Object.assign(Object.assign({},l),{view:"separator"}))}function xn(r,s){return r.addBlade(Object.assign(Object.assign({},s),{view:"tab"}))}class Gt{constructor(s){this.emitter=new R,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=s}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(s){for(const l of this.allItems())if(s(l))return l;return null}includes(s){return this.cache_.has(s)}add(s,l){if(this.includes(s))throw E.shouldNeverHappen();const p=l!==void 0?l:this.items_.length;this.items_.splice(p,0,s),this.cache_.add(s);const P=this.extract_(s);P&&(P.emitter.on("add",this.onSubListAdd_),P.emitter.on("remove",this.onSubListRemove_),P.allItems().forEach(U=>{this.cache_.add(U)})),this.emitter.emit("add",{index:p,item:s,root:this,target:this})}remove(s){const l=this.items_.indexOf(s);if(l<0)return;this.items_.splice(l,1),this.cache_.delete(s);const p=this.extract_(s);p&&(p.emitter.off("add",this.onSubListAdd_),p.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:l,item:s,root:this,target:this})}onSubListAdd_(s){this.cache_.add(s.item),this.emitter.emit("add",{index:s.index,item:s.item,root:this,target:s.target})}onSubListRemove_(s){this.cache_.delete(s.item),this.emitter.emit("remove",{index:s.index,item:s.item,root:this,target:s.target})}}class Bt extends i{constructor(s){super(s),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new R,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}on(s,l){const p=l.bind(this);return this.emitter_.on(s,P=>{p(P.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(s){const l=s.sender.target.read();this.emitter_.emit("change",{event:new a(this,l,this.controller_.binding.target.presetKey,s.options.last)})}}class Ft extends lt{constructor(s,l){super(s,l),this.binding=l.binding}}class ln extends i{constructor(s){super(s),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new R,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}on(s,l){const p=l.bind(this);return this.emitter_.on(s,P=>{p(P.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(s){const l=s.sender.target.read();this.emitter_.emit("update",{event:new c(this,l,this.controller_.binding.target.presetKey)})}}class tn extends lt{constructor(s,l){super(s,l),this.binding=l.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function xi(r){return r instanceof yn?r.apiSet_:r instanceof We?r.rackApi_.apiSet_:null}function yi(r,s){const l=r.find(p=>p.controller_===s);if(!l)throw E.shouldNeverHappen();return l}function Nn(r,s,l){if(!M.isBindable(r))throw E.notBindable();return new M(r,s,l)}class yn extends i{constructor(s,l){super(s),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new R,this.apiSet_=new Gt(xi),this.pool_=l;const p=this.controller_.rack;p.emitter.on("add",this.onRackAdd_),p.emitter.on("remove",this.onRackRemove_),p.emitter.on("inputchange",this.onRackInputChange_),p.emitter.on("monitorupdate",this.onRackMonitorUpdate_),p.children.forEach(P=>{this.setUpApi_(P)})}get children(){return this.controller_.rack.children.map(s=>yi(this.apiSet_,s))}addInput(s,l,p){const P=p??{},U=this.controller_.view.element.ownerDocument,ee=this.pool_.createInput(U,Nn(s,l,P.presetKey),P),_e=new Bt(ee);return this.add(_e,P.index)}addMonitor(s,l,p){const P=p??{},U=this.controller_.view.element.ownerDocument,ee=this.pool_.createMonitor(U,Nn(s,l),P),_e=new ln(ee);return this.add(_e,P.index)}addFolder(s){return Yt(this,s)}addButton(s){return _t(this,s)}addSeparator(s){return an(this,s)}addTab(s){return xn(this,s)}add(s,l){this.controller_.rack.add(s.controller_,l);const p=this.apiSet_.find(P=>P.controller_===s.controller_);return p&&this.apiSet_.remove(p),this.apiSet_.add(s),s}remove(s){this.controller_.rack.remove(s.controller_)}addBlade(s){const l=this.controller_.view.element.ownerDocument,p=this.pool_.createBlade(l,s),P=this.pool_.createBladeApi(p);return this.add(P,s.index)}on(s,l){const p=l.bind(this);return this.emitter_.on(s,P=>{p(P.event)}),this}setUpApi_(s){this.apiSet_.find(p=>p.controller_===s)||this.apiSet_.add(this.pool_.createBladeApi(s))}onRackAdd_(s){this.setUpApi_(s.bladeController)}onRackRemove_(s){if(s.isRoot){const l=yi(this.apiSet_,s.bladeController);this.apiSet_.remove(l)}}onRackInputChange_(s){const l=s.bladeController;if(l instanceof Ft){const p=yi(this.apiSet_,l),P=l.binding;this.emitter_.emit("change",{event:new a(p,P.target.read(),P.target.presetKey,s.options.last)})}else if(l instanceof yt){const p=yi(this.apiSet_,l);this.emitter_.emit("change",{event:new a(p,l.value.rawValue,void 0,s.options.last)})}}onRackMonitorUpdate_(s){if(!(s.bladeController instanceof tn))throw E.shouldNeverHappen();const l=yi(this.apiSet_,s.bladeController),p=s.bladeController.binding;this.emitter_.emit("update",{event:new c(l,p.target.read(),p.target.presetKey)})}}class $ extends We{constructor(s,l){super(s,new yn(s.rackController,l)),this.emitter_=new R,this.controller_.foldable.value("expanded").emitter.on("change",p=>{this.emitter_.emit("fold",{event:new u(this,p.sender.rawValue)})}),this.rackApi_.on("change",p=>{this.emitter_.emit("change",{event:p})}),this.rackApi_.on("update",p=>{this.emitter_.emit("update",{event:p})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(s){this.controller_.foldable.set("expanded",s)}get title(){return this.controller_.props.get("title")}set title(s){this.controller_.props.set("title",s)}get children(){return this.rackApi_.children}addInput(s,l,p){return this.rackApi_.addInput(s,l,p)}addMonitor(s,l,p){return this.rackApi_.addMonitor(s,l,p)}addFolder(s){return this.rackApi_.addFolder(s)}addButton(s){return this.rackApi_.addButton(s)}addSeparator(s){return this.rackApi_.addSeparator(s)}addTab(s){return this.rackApi_.addTab(s)}add(s,l){return this.rackApi_.add(s,l)}remove(s){this.rackApi_.remove(s)}addBlade(s){return this.rackApi_.addBlade(s)}on(s,l){const p=l.bind(this);return this.emitter_.on(s,P=>{p(P.event)}),this}}class pe extends Ye{constructor(s){super({blade:s.blade,view:s.view,viewProps:s.rackController.viewProps}),this.rackController=s.rackController}}class Me{constructor(s,l){const p=V(l.viewName);this.element=s.createElement("div"),this.element.classList.add(p()),l.viewProps.bindClassModifiers(this.element)}}function le(r,s){for(let l=0;l<r.length;l++){const p=r[l];if(p instanceof Ft&&p.binding===s)return p}return null}function Se(r,s){for(let l=0;l<r.length;l++){const p=r[l];if(p instanceof tn&&p.binding===s)return p}return null}function ut(r,s){for(let l=0;l<r.length;l++){const p=r[l];if(p instanceof yt&&p.value===s)return p}return null}function At(r){return r instanceof Pt?r.rack:r instanceof pe?r.rackController.rack:null}function zt(r){const s=At(r);return s?s.bcSet_:null}class xt{constructor(s){var l,p;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new R,this.blade_=(l=s.blade)!==null&&l!==void 0?l:null,(p=this.blade_)===null||p===void 0||p.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=s.viewProps,this.bcSet_=new Gt(zt),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(s,l){var p;(p=s.parent)===null||p===void 0||p.remove(s),y(s,"parent")?s.parent=this:(s.parent_=this,Ae({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(s,l)}remove(s){y(s,"parent")?s.parent=null:(s.parent_=null,Ae({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(s)}find(s){return this.bcSet_.allItems().filter(l=>l instanceof s)}onSetAdd_(s){this.updatePositions_();const l=s.target===s.root;if(this.emitter.emit("add",{bladeController:s.item,index:s.index,isRoot:l,sender:this}),!l)return;const p=s.item;if(p.viewProps.emitter.on("change",this.onChildViewPropsChange_),p.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),p.viewProps.handleDispose(this.onChildDispose_),p instanceof Ft)p.binding.emitter.on("change",this.onChildInputChange_);else if(p instanceof tn)p.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(p instanceof yt)p.value.emitter.on("change",this.onChildValueChange_);else{const P=At(p);if(P){const U=P.emitter;U.on("layout",this.onDescendantLayout_),U.on("inputchange",this.onDescendantInputChange_),U.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(s){this.updatePositions_();const l=s.target===s.root;if(this.emitter.emit("remove",{bladeController:s.item,isRoot:l,sender:this}),!l)return;const p=s.item;if(p instanceof Ft)p.binding.emitter.off("change",this.onChildInputChange_);else if(p instanceof tn)p.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(p instanceof yt)p.value.emitter.off("change",this.onChildValueChange_);else{const P=At(p);if(P){const U=P.emitter;U.off("layout",this.onDescendantLayout_),U.off("inputchange",this.onDescendantInputChange_),U.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const s=this.bcSet_.items.filter(P=>!P.viewProps.get("hidden")),l=s[0],p=s[s.length-1];this.bcSet_.items.forEach(P=>{const U=[];P===l&&(U.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&U.push("veryfirst")),P===p&&(U.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&U.push("verylast")),P.blade.set("positions",U)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(s){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(l=>l.viewProps.get("disposed")).forEach(l=>{this.bcSet_.remove(l)})}onChildInputChange_(s){const l=le(this.find(Ft),s.sender);if(!l)throw E.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:l,options:s.options,sender:this})}onChildMonitorUpdate_(s){const l=Se(this.find(tn),s.sender);if(!l)throw E.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:l,sender:this})}onChildValueChange_(s){const l=ut(this.find(yt),s.sender);if(!l)throw E.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:l,options:s.options,sender:this})}onDescendantLayout_(s){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(s){this.emitter.emit("inputchange",{bladeController:s.bladeController,options:s.options,sender:this})}onDescendantMonitorUpdate_(s){this.emitter.emit("monitorupdate",{bladeController:s.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Pt extends Ye{constructor(s,l){super(Object.assign(Object.assign({},l),{view:new Me(s,{viewName:"brk",viewProps:l.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const p=new xt({blade:l.root?void 0:l.blade,viewProps:l.viewProps});p.emitter.on("add",this.onRackAdd_),p.emitter.on("remove",this.onRackRemove_),this.rack=p,this.viewProps.handleDispose(()=>{for(let P=this.rack.children.length-1;P>=0;P--)this.rack.children[P].viewProps.set("disposed",!0)})}onRackAdd_(s){s.isRoot&&Ne(this.view.element,s.bladeController.view.element,s.index)}onRackRemove_(s){s.isRoot&&je(s.bladeController.view.element)}}const Je=V("cnt");class et{constructor(s,l){var p;this.className_=V((p=l.viewName)!==null&&p!==void 0?p:"fld"),this.element=s.createElement("div"),this.element.classList.add(this.className_(),Je()),l.viewProps.bindClassModifiers(this.element),this.foldable_=l.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),F(this.foldable_,"completed",Z(this.element,this.className_(void 0,"cpl")));const P=s.createElement("button");P.classList.add(this.className_("b")),F(l.props,"title",Qe=>{g(Qe)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),l.viewProps.bindDisabled(P),this.element.appendChild(P),this.buttonElement=P;const U=s.createElement("div");U.classList.add(this.className_("i")),this.element.appendChild(U);const ee=s.createElement("div");ee.classList.add(this.className_("t")),se(l.props.value("title"),ee),this.buttonElement.appendChild(ee),this.titleElement=ee;const _e=s.createElement("div");_e.classList.add(this.className_("m")),this.buttonElement.appendChild(_e);const Fe=l.containerElement;Fe.classList.add(this.className_("c")),this.element.appendChild(Fe),this.containerElement=Fe}}class Ct extends pe{constructor(s,l){var p;const P=ie.create((p=l.expanded)!==null&&p!==void 0?p:!0),U=new Pt(s,{blade:l.blade,root:l.root,viewProps:l.viewProps});super(Object.assign(Object.assign({},l),{rackController:U,view:new et(s,{containerElement:U.view.element,foldable:P,props:l.props,viewName:l.root?"rot":void 0,viewProps:l.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=l.props,this.foldable=P,Le(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const it={id:"folder",type:"blade",accept(r){const s=Ie,l=rt(r,{title:s.required.string,view:s.required.constant("folder"),expanded:s.optional.boolean});return l?{params:l}:null},controller(r){return new Ct(r.document,{blade:r.blade,expanded:r.params.expanded,props:he.fromObject({title:r.params.title}),viewProps:r.viewProps})},api(r){return r.controller instanceof Ct?new $(r.controller,r.pool):null}};class ht extends yt{constructor(s,l){const p=l.valueController.viewProps;super(Object.assign(Object.assign({},l),{value:l.valueController.value,view:new ft(s,{props:l.props,viewProps:p}),viewProps:p})),this.props=l.props,this.valueController=l.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Qt extends i{}const ot=V("spr");class Ue{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(ot()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("hr");p.classList.add(ot("r")),this.element.appendChild(p)}}class Cn extends Ye{constructor(s,l){super(Object.assign(Object.assign({},l),{view:new Ue(s,{viewProps:l.viewProps})}))}}const Ht={id:"separator",type:"blade",accept(r){const l=rt(r,{view:Ie.required.constant("separator")});return l?{params:l}:null},controller(r){return new Cn(r.document,{blade:r.blade,viewProps:r.viewProps})},api(r){return r.controller instanceof Cn?new Qt(r.controller):null}},Ut=V("tbi");class fn{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(Ut()),l.viewProps.bindClassModifiers(this.element),F(l.props,"selected",U=>{U?this.element.classList.add(Ut(void 0,"sel")):this.element.classList.remove(Ut(void 0,"sel"))});const p=s.createElement("button");p.classList.add(Ut("b")),l.viewProps.bindDisabled(p),this.element.appendChild(p),this.buttonElement=p;const P=s.createElement("div");P.classList.add(Ut("t")),se(l.props.value("title"),P),this.buttonElement.appendChild(P),this.titleElement=P}}class Mn{constructor(s,l){this.emitter=new R,this.onClick_=this.onClick_.bind(this),this.props=l.props,this.viewProps=l.viewProps,this.view=new fn(s,{props:l.props,viewProps:l.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Ci{constructor(s,l){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Mn(s,{props:l.itemProps,viewProps:mt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Pt(s,{blade:Dt(),viewProps:mt.create()}),this.props=l.props,F(this.props,"selected",p=>{this.itemController.props.set("selected",p),this.contentController.viewProps.set("hidden",!p)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class mn{constructor(s,l){this.controller_=s,this.rackApi_=l}get title(){var s;return(s=this.controller_.itemController.props.get("title"))!==null&&s!==void 0?s:""}set title(s){this.controller_.itemController.props.set("title",s)}get selected(){return this.controller_.props.get("selected")}set selected(s){this.controller_.props.set("selected",s)}get children(){return this.rackApi_.children}addButton(s){return this.rackApi_.addButton(s)}addFolder(s){return this.rackApi_.addFolder(s)}addSeparator(s){return this.rackApi_.addSeparator(s)}addTab(s){return this.rackApi_.addTab(s)}add(s,l){this.rackApi_.add(s,l)}remove(s){this.rackApi_.remove(s)}addInput(s,l,p){return this.rackApi_.addInput(s,l,p)}addMonitor(s,l,p){return this.rackApi_.addMonitor(s,l,p)}addBlade(s){return this.rackApi_.addBlade(s)}}class On extends We{constructor(s,l){super(s,new yn(s.rackController,l)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new R,this.pageApiMap_=new Map,this.rackApi_.on("change",p=>{this.emitter_.emit("change",{event:p})}),this.rackApi_.on("update",p=>{this.emitter_.emit("update",{event:p})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(p=>{this.setUpPageApi_(p)})}get pages(){return this.controller_.pageSet.items.map(s=>{const l=this.pageApiMap_.get(s);if(!l)throw E.shouldNeverHappen();return l})}addPage(s){const l=this.controller_.view.element.ownerDocument,p=new Ci(l,{itemProps:he.fromObject({selected:!1,title:s.title}),props:he.fromObject({selected:!1})});this.controller_.add(p,s.index);const P=this.pageApiMap_.get(p);if(!P)throw E.shouldNeverHappen();return P}removePage(s){this.controller_.remove(s)}on(s,l){const p=l.bind(this);return this.emitter_.on(s,P=>{p(P.event)}),this}setUpPageApi_(s){const l=this.rackApi_.apiSet_.find(P=>P.controller_===s.contentController);if(!l)throw E.shouldNeverHappen();const p=new mn(s,l);this.pageApiMap_.set(s,p)}onPageAdd_(s){this.setUpPageApi_(s.item)}onPageRemove_(s){if(!this.pageApiMap_.get(s.item))throw E.shouldNeverHappen();this.pageApiMap_.delete(s.item)}onSelect_(s){this.emitter_.emit("select",{event:new d(this,s.rawValue)})}}const Un=-1;class un{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=de(!0),this.selectedIndex=de(Un),this.items_=[]}add(s,l){const p=l??this.items_.length;this.items_.splice(p,0,s),s.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(s){const l=this.items_.indexOf(s);l<0||(this.items_.splice(l,1),s.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Un,this.empty.rawValue=!0;return}const s=this.items_.findIndex(l=>l.rawValue);s<0?(this.items_.forEach((l,p)=>{l.rawValue=p===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((l,p)=>{l.rawValue=p===s}),this.selectedIndex.rawValue=s),this.empty.rawValue=!1}onItemSelectedChange_(s){if(s.rawValue){const l=this.items_.findIndex(p=>p===s.sender);this.items_.forEach((p,P)=>{p.rawValue=P===l}),this.selectedIndex.rawValue=l}else this.keepSelection_()}}const Hn=V("tab");class kn{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(Hn(),Je()),l.viewProps.bindClassModifiers(this.element),j(l.empty,Z(this.element,Hn(void 0,"nop")));const p=s.createElement("div");p.classList.add(Hn("t")),this.element.appendChild(p),this.itemsElement=p;const P=s.createElement("div");P.classList.add(Hn("i")),this.element.appendChild(P);const U=l.contentsElement;U.classList.add(Hn("c")),this.element.appendChild(U),this.contentsElement=U}}class Rn extends pe{constructor(s,l){const p=new Pt(s,{blade:l.blade,viewProps:l.viewProps}),P=new un;super({blade:l.blade,rackController:p,view:new kn(s,{contentsElement:p.view.element,empty:P.empty,viewProps:l.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new Gt(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=P}get pageSet(){return this.pageSet_}add(s,l){this.pageSet_.add(s,l)}remove(s){this.pageSet_.remove(this.pageSet_.items[s])}onPageAdd_(s){const l=s.item;Ne(this.view.itemsElement,l.itemController.view.element,s.index),l.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(l.contentController,s.index),this.tab.add(l.props.value("selected"))}onPageRemove_(s){const l=s.item;je(l.itemController.view.element),l.itemController.viewProps.set("parent",null),this.rackController.rack.remove(l.contentController),this.tab.remove(l.props.value("selected"))}}const Yi={id:"tab",type:"blade",accept(r){const s=Ie,l=rt(r,{pages:s.required.array(s.required.object({title:s.required.string})),view:s.required.constant("tab")});return!l||l.pages.length===0?null:{params:l}},controller(r){const s=new Rn(r.document,{blade:r.blade,viewProps:r.viewProps});return r.params.pages.forEach(l=>{const p=new Ci(r.document,{itemProps:he.fromObject({selected:!1,title:l.title}),props:he.fromObject({selected:!1})});s.add(p)}),s},api(r){return r.controller instanceof Rn?new On(r.controller,r.pool):null}};function rs(r,s){const l=r.accept(s.params);if(!l)return null;const p=Ie.optional.boolean(s.params.disabled).value,P=Ie.optional.boolean(s.params.hidden).value;return r.controller({blade:Dt(),document:s.document,params:Object.assign(Object.assign({},l.params),{disabled:p,hidden:P}),viewProps:mt.create({disabled:p,hidden:P})})}class gn{constructor(){this.disabled=!1,this.emitter=new R}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class ni{constructor(s,l){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=s,this.emitter=new R,this.interval_=l,this.setTimer_()}get disabled(){return this.disabled_}set disabled(s){this.disabled_=s,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const s=this.doc_.defaultView;s&&s.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const s=this.doc_.defaultView;s&&(this.timerId_=s.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Pn{constructor(s){this.onValueChange_=this.onValueChange_.bind(this),this.reader=s.reader,this.writer=s.writer,this.emitter=new R,this.value=s.value,this.value.emitter.on("change",this.onValueChange_),this.target=s.target,this.read()}read(){const s=this.target.read();s!==void 0&&(this.value.rawValue=this.reader(s))}write_(s){this.writer(this.target,s)}onValueChange_(s){this.write_(s.rawValue),this.emitter.emit("change",{options:s.options,rawValue:s.rawValue,sender:this})}}function qt(r,s){for(;r.length<s;)r.push(void 0)}function Vs(r){const s=[];return qt(s,r),de(s)}function Zi(r){const s=r.indexOf(void 0);return s<0?r:r.slice(0,s)}function Fn(r,s){const l=[...Zi(r),s];return l.length>r.length?l.splice(0,l.length-r.length):qt(l,r.length),l}class os{constructor(s){this.onTick_=this.onTick_.bind(this),this.reader_=s.reader,this.target=s.target,this.emitter=new R,this.value=s.value,this.ticker=s.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const s=this.target.read();if(s===void 0)return;const l=this.value.rawValue,p=this.reader_(s);this.value.rawValue=Fn(l,p),this.emitter.emit("update",{rawValue:p,sender:this})}onTick_(s){this.read()}}class Gn{constructor(s){this.constraints=s}constrain(s){return this.constraints.reduce((l,p)=>p.constrain(l),s)}}function En(r,s){if(r instanceof s)return r;if(r instanceof Gn){const l=r.constraints.reduce((p,P)=>p||(P instanceof s?P:null),null);if(l)return l}return null}class li{constructor(s){this.values=he.fromObject({max:s.max,min:s.min})}constrain(s){const l=this.values.get("max"),p=this.values.get("min");return Math.min(Math.max(s,p),l)}}class Bi{constructor(s){this.values=he.fromObject({options:s})}get options(){return this.values.get("options")}constrain(s){const l=this.values.get("options");return l.length===0||l.filter(P=>P.value===s).length>0?s:l[0].value}}class qn{constructor(s){this.values=he.fromObject({max:s.max,min:s.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(s){const l=this.values.get("max"),p=this.values.get("min");let P=s;return g(p)||(P=Math.max(P,p)),g(l)||(P=Math.min(P,l)),P}}class Xn{constructor(s,l=0){this.step=s,this.origin=l}constrain(s){const l=this.origin%this.step,p=Math.round((s-l)/this.step);return l+p*this.step}}const Ji=V("lst");class Mi{constructor(s,l){this.onValueChange_=this.onValueChange_.bind(this),this.props_=l.props,this.element=s.createElement("div"),this.element.classList.add(Ji()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("select");p.classList.add(Ji("s")),l.viewProps.bindDisabled(p),this.element.appendChild(p),this.selectElement=p;const P=s.createElement("div");P.classList.add(Ji("m")),P.appendChild(ge(s,"dropdown")),this.element.appendChild(P),l.value.emitter.on("change",this.onValueChange_),this.value_=l.value,F(this.props_,"options",U=>{Ze(this.selectElement),U.forEach(ee=>{const _e=s.createElement("option");_e.textContent=ee.text,this.selectElement.appendChild(_e)}),this.update_()})}update_(){const s=this.props_.get("options").map(l=>l.value);this.selectElement.selectedIndex=s.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ei{constructor(s,l){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=l.props,this.value=l.value,this.viewProps=l.viewProps,this.view=new Mi(s,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(s){const l=s.currentTarget;this.value.rawValue=this.props.get("options")[l.selectedIndex].value}}const Ns=V("pop");class Os{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(Ns()),l.viewProps.bindClassModifiers(this.element),j(l.shows,Z(this.element,Ns(void 0,"v")))}}class ci{constructor(s,l){this.shows=de(!1),this.viewProps=l.viewProps,this.view=new Os(s,{shows:this.shows,viewProps:this.viewProps})}}const Si=V("txt");class Qi{constructor(s,l){this.onChange_=this.onChange_.bind(this),this.element=s.createElement("div"),this.element.classList.add(Si()),l.viewProps.bindClassModifiers(this.element),this.props_=l.props,this.props_.emitter.on("change",this.onChange_);const p=s.createElement("input");p.classList.add(Si("i")),p.type="text",l.viewProps.bindDisabled(p),this.element.appendChild(p),this.inputElement=p,l.value.emitter.on("change",this.onChange_),this.value_=l.value,this.refresh()}refresh(){const s=this.props_.get("formatter");this.inputElement.value=s(this.value_.rawValue)}onChange_(){this.refresh()}}class Ui{constructor(s,l){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=l.parser,this.props=l.props,this.value=l.value,this.viewProps=l.viewProps,this.view=new Qi(s,{props:l.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(s){const p=s.currentTarget.value,P=this.parser_(p);g(P)||(this.value.rawValue=P),this.view.refresh()}}function hi(r){return String(r)}function $n(r){return r==="false"?!1:!!r}function fs(r){return hi(r)}class Fs{constructor(s){this.text=s}evaluate(){return Number(this.text)}toString(){return this.text}}const Zs={"**":(r,s)=>Math.pow(r,s),"*":(r,s)=>r*s,"/":(r,s)=>r/s,"%":(r,s)=>r%s,"+":(r,s)=>r+s,"-":(r,s)=>r-s,"<<":(r,s)=>r<<s,">>":(r,s)=>r>>s,">>>":(r,s)=>r>>>s,"&":(r,s)=>r&s,"^":(r,s)=>r^s,"|":(r,s)=>r|s};class Ai{constructor(s,l,p){this.left=l,this.operator=s,this.right=p}evaluate(){const s=Zs[this.operator];if(!s)throw new Error(`unexpected binary operator: '${this.operator}`);return s(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ms={"+":r=>r,"-":r=>-r,"~":r=>~r};class Hi{constructor(s,l){this.operator=s,this.expression=l}evaluate(){const s=ms[this.operator];if(!s)throw new Error(`unexpected unary operator: '${this.operator}`);return s(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Yn(r){return(s,l)=>{for(let p=0;p<r.length;p++){const P=r[p](s,l);if(P!=="")return P}return""}}function Pi(r,s){var l;const p=r.substr(s).match(/^\s+/);return(l=p&&p[0])!==null&&l!==void 0?l:""}function Gi(r,s){const l=r.substr(s,1);return l.match(/^[1-9]$/)?l:""}function G(r,s){var l;const p=r.substr(s).match(/^[0-9]+/);return(l=p&&p[0])!==null&&l!==void 0?l:""}function _(r,s){const l=G(r,s);if(l!=="")return l;const p=r.substr(s,1);if(s+=1,p!=="-"&&p!=="+")return"";const P=G(r,s);return P===""?"":p+P}function f(r,s){const l=r.substr(s,1);if(s+=1,l.toLowerCase()!=="e")return"";const p=_(r,s);return p===""?"":l+p}function C(r,s){const l=r.substr(s,1);if(l==="0")return l;const p=Gi(r,s);return s+=p.length,p===""?"":p+G(r,s)}function D(r,s){const l=C(r,s);if(s+=l.length,l==="")return"";const p=r.substr(s,1);if(s+=p.length,p!==".")return"";const P=G(r,s);return s+=P.length,l+p+P+f(r,s)}function K(r,s){const l=r.substr(s,1);if(s+=l.length,l!==".")return"";const p=G(r,s);return s+=p.length,p===""?"":l+p+f(r,s)}function te(r,s){const l=C(r,s);return s+=l.length,l===""?"":l+f(r,s)}const fe=Yn([D,K,te]);function be(r,s){var l;const p=r.substr(s).match(/^[01]+/);return(l=p&&p[0])!==null&&l!==void 0?l:""}function Ee(r,s){const l=r.substr(s,2);if(s+=l.length,l.toLowerCase()!=="0b")return"";const p=be(r,s);return p===""?"":l+p}function Be(r,s){var l;const p=r.substr(s).match(/^[0-7]+/);return(l=p&&p[0])!==null&&l!==void 0?l:""}function st(r,s){const l=r.substr(s,2);if(s+=l.length,l.toLowerCase()!=="0o")return"";const p=Be(r,s);return p===""?"":l+p}function Lt(r,s){var l;const p=r.substr(s).match(/^[0-9a-f]+/i);return(l=p&&p[0])!==null&&l!==void 0?l:""}function Ot(r,s){const l=r.substr(s,2);if(s+=l.length,l.toLowerCase()!=="0x")return"";const p=Lt(r,s);return p===""?"":l+p}const $t=Yn([Ee,st,Ot]),dn=Yn([$t,fe]);function kt(r,s){const l=dn(r,s);return s+=l.length,l===""?null:{evaluable:new Fs(l),cursor:s}}function Kt(r,s){const l=r.substr(s,1);if(s+=l.length,l!=="(")return null;const p=Js(r,s);if(!p)return null;s=p.cursor,s+=Pi(r,s).length;const P=r.substr(s,1);return s+=P.length,P!==")"?null:{evaluable:p.evaluable,cursor:s}}function ui(r,s){var l;return(l=kt(r,s))!==null&&l!==void 0?l:Kt(r,s)}function zr(r,s){const l=ui(r,s);if(l)return l;const p=r.substr(s,1);if(s+=p.length,p!=="+"&&p!=="-"&&p!=="~")return null;const P=zr(r,s);return P?(s=P.cursor,{cursor:s,evaluable:new Hi(p,P.evaluable)}):null}function uo(r,s,l){l+=Pi(s,l).length;const p=r.filter(P=>s.startsWith(P,l))[0];return p?(l+=p.length,l+=Pi(s,l).length,{cursor:l,operator:p}):null}function vs(r,s){return(l,p)=>{const P=r(l,p);if(!P)return null;p=P.cursor;let U=P.evaluable;for(;;){const ee=uo(s,l,p);if(!ee)break;p=ee.cursor;const _e=r(l,p);if(!_e)return null;p=_e.cursor,U=new Ai(ee.operator,U,_e.evaluable)}return U?{cursor:p,evaluable:U}:null}}const wr=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((r,s)=>vs(r,s),zr);function Js(r,s){return s+=Pi(r,s).length,wr(r,s)}function ii(r){const s=Js(r,0);return!s||s.cursor+Pi(r,s.cursor).length!==r.length?null:s.evaluable}function Vi(r){var s;const l=ii(r);return(s=l?.evaluate())!==null&&s!==void 0?s:null}function Wi(r){if(typeof r=="number")return r;if(typeof r=="string"){const s=Vi(r);if(!g(s))return s}return 0}function Wn(r){return String(r)}function In(r){return s=>s.toFixed(Math.max(Math.min(r,20),0))}const Bs=In(0);function gs(r){return Bs(r)+"%"}function Qs(r){return String(r)}function Ni(r){return r}function Tn({primary:r,secondary:s,forward:l,backward:p}){let P=!1;function U(ee){P||(P=!0,ee(),P=!1)}r.emitter.on("change",ee=>{U(()=>{s.setRawValue(l(r,s),ee.options)})}),s.emitter.on("change",ee=>{U(()=>{r.setRawValue(p(r,s),ee.options)}),U(()=>{s.setRawValue(l(r,s),ee.options)})}),U(()=>{s.setRawValue(l(r,s),{forceEmit:!1,last:!0})})}function Sn(r,s){const l=r*(s.altKey?.1:1)*(s.shiftKey?10:1);return s.upKey?+l:s.downKey?-l:0}function di(r){return{altKey:r.altKey,downKey:r.key==="ArrowDown",shiftKey:r.shiftKey,upKey:r.key==="ArrowUp"}}function pi(r){return{altKey:r.altKey,downKey:r.key==="ArrowLeft",shiftKey:r.shiftKey,upKey:r.key==="ArrowRight"}}function xr(r){return r==="ArrowUp"||r==="ArrowDown"}function _s(r){return xr(r)||r==="ArrowLeft"||r==="ArrowRight"}function as(r,s){var l,p;const P=s.ownerDocument.defaultView,U=s.getBoundingClientRect();return{x:r.pageX-(((l=P&&P.scrollX)!==null&&l!==void 0?l:0)+U.left),y:r.pageY-(((p=P&&P.scrollY)!==null&&p!==void 0?p:0)+U.top)}}class rn{constructor(s){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=s,this.emitter=new R,s.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),s.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),s.addEventListener("touchend",this.onTouchEnd_),s.addEventListener("mousedown",this.onMouseDown_)}computePosition_(s){const l=this.elem_.getBoundingClientRect();return{bounds:{width:l.width,height:l.height},point:s?{x:s.x,y:s.y}:null}}onMouseDown_(s){var l;s.preventDefault(),(l=s.currentTarget)===null||l===void 0||l.focus();const p=this.elem_.ownerDocument;p.addEventListener("mousemove",this.onDocumentMouseMove_),p.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:s.altKey,data:this.computePosition_(as(s,this.elem_)),sender:this,shiftKey:s.shiftKey})}onDocumentMouseMove_(s){this.emitter.emit("move",{altKey:s.altKey,data:this.computePosition_(as(s,this.elem_)),sender:this,shiftKey:s.shiftKey})}onDocumentMouseUp_(s){const l=this.elem_.ownerDocument;l.removeEventListener("mousemove",this.onDocumentMouseMove_),l.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:s.altKey,data:this.computePosition_(as(s,this.elem_)),sender:this,shiftKey:s.shiftKey})}onTouchStart_(s){s.preventDefault();const l=s.targetTouches.item(0),p=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:s.altKey,data:this.computePosition_(l?{x:l.clientX-p.left,y:l.clientY-p.top}:void 0),sender:this,shiftKey:s.shiftKey}),this.lastTouch_=l}onTouchMove_(s){const l=s.targetTouches.item(0),p=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:s.altKey,data:this.computePosition_(l?{x:l.clientX-p.left,y:l.clientY-p.top}:void 0),sender:this,shiftKey:s.shiftKey}),this.lastTouch_=l}onTouchEnd_(s){var l;const p=(l=s.targetTouches.item(0))!==null&&l!==void 0?l:this.lastTouch_,P=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:s.altKey,data:this.computePosition_(p?{x:p.clientX-P.left,y:p.clientY-P.top}:void 0),sender:this,shiftKey:s.shiftKey})}}function Wt(r,s,l,p,P){const U=(r-s)/(l-s);return p+U*(P-p)}function _n(r){return String(r.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function bn(r,s,l){return Math.min(Math.max(r,s),l)}function Dn(r,s){return(r%s+s)%s}const fi=V("txt");class Ti{constructor(s,l){this.onChange_=this.onChange_.bind(this),this.props_=l.props,this.props_.emitter.on("change",this.onChange_),this.element=s.createElement("div"),this.element.classList.add(fi(),fi(void 0,"num")),l.arrayPosition&&this.element.classList.add(fi(void 0,l.arrayPosition)),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("input");p.classList.add(fi("i")),p.type="text",l.viewProps.bindDisabled(p),this.element.appendChild(p),this.inputElement=p,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=l.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(fi()),this.inputElement.classList.add(fi("i"));const P=s.createElement("div");P.classList.add(fi("k")),this.element.appendChild(P),this.knobElement=P;const U=s.createElementNS(Oe,"svg");U.classList.add(fi("g")),this.knobElement.appendChild(U);const ee=s.createElementNS(Oe,"path");ee.classList.add(fi("gb")),U.appendChild(ee),this.guideBodyElem_=ee;const _e=s.createElementNS(Oe,"path");_e.classList.add(fi("gh")),U.appendChild(_e),this.guideHeadElem_=_e;const Fe=s.createElement("div");Fe.classList.add(V("tt")()),this.knobElement.appendChild(Fe),this.tooltipElem_=Fe,l.value.emitter.on("change",this.onChange_),this.value=l.value,this.refresh()}onDraggingChange_(s){if(s.rawValue===null){this.element.classList.remove(fi(void 0,"drg"));return}this.element.classList.add(fi(void 0,"drg"));const l=s.rawValue/this.props_.get("draggingScale"),p=l+(l>0?-1:l<0?1:0),P=bn(-p,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${p+P},0 L${p},4 L${p+P},8`,`M ${l},-1 L${l},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${l},4`);const U=this.props_.get("formatter");this.tooltipElem_.textContent=U(this.value.rawValue),this.tooltipElem_.style.left=`${l}px`}refresh(){const s=this.props_.get("formatter");this.inputElement.value=s(this.value.rawValue)}onChange_(){this.refresh()}}class bs{constructor(s,l){var p;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=l.baseStep,this.parser_=l.parser,this.props=l.props,this.sliderProps_=(p=l.sliderProps)!==null&&p!==void 0?p:null,this.value=l.value,this.viewProps=l.viewProps,this.dragging_=de(null),this.view=new Ti(s,{arrayPosition:l.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const P=new rn(this.view.knobElement);P.emitter.on("down",this.onPointerDown_),P.emitter.on("move",this.onPointerMove_),P.emitter.on("up",this.onPointerUp_)}constrainValue_(s){var l,p;const P=(l=this.sliderProps_)===null||l===void 0?void 0:l.get("minValue"),U=(p=this.sliderProps_)===null||p===void 0?void 0:p.get("maxValue");let ee=s;return P!==void 0&&(ee=Math.max(ee,P)),U!==void 0&&(ee=Math.min(ee,U)),ee}onInputChange_(s){const p=s.currentTarget.value,P=this.parser_(p);g(P)||(this.value.rawValue=this.constrainValue_(P)),this.view.refresh()}onInputKeyDown_(s){const l=Sn(this.baseStep_,di(s));l!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+l),{forceEmit:!1,last:!1})}onInputKeyUp_(s){Sn(this.baseStep_,di(s))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(s){if(!s.point)return null;const l=s.point.x-s.bounds.width/2;return this.constrainValue_(this.originRawValue_+l*this.props.get("draggingScale"))}onPointerMove_(s){const l=this.computeDraggingValue_(s.data);l!==null&&(this.value.setRawValue(l,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(s){const l=this.computeDraggingValue_(s.data);l!==null&&(this.value.setRawValue(l,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const yr=V("sld");class mi{constructor(s,l){this.onChange_=this.onChange_.bind(this),this.props_=l.props,this.props_.emitter.on("change",this.onChange_),this.element=s.createElement("div"),this.element.classList.add(yr()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("div");p.classList.add(yr("t")),l.viewProps.bindTabIndex(p),this.element.appendChild(p),this.trackElement=p;const P=s.createElement("div");P.classList.add(yr("k")),this.trackElement.appendChild(P),this.knobElement=P,l.value.emitter.on("change",this.onChange_),this.value=l.value,this.update_()}update_(){const s=bn(Wt(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${s}%`}onChange_(){this.update_()}}class er{constructor(s,l){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=l.baseStep,this.value=l.value,this.viewProps=l.viewProps,this.props=l.props,this.view=new mi(s,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(s,l){s.point&&this.value.setRawValue(Wt(bn(s.point.x,0,s.bounds.width),0,s.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),l)}onPointerDownOrMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onKeyDown_(s){const l=Sn(this.baseStep_,pi(s));l!==0&&this.value.setRawValue(this.value.rawValue+l,{forceEmit:!1,last:!1})}onKeyUp_(s){Sn(this.baseStep_,pi(s))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const tr=V("sldtxt");class nr{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(tr());const p=s.createElement("div");p.classList.add(tr("s")),this.sliderView_=l.sliderView,p.appendChild(this.sliderView_.element),this.element.appendChild(p);const P=s.createElement("div");P.classList.add(tr("t")),this.textView_=l.textView,P.appendChild(this.textView_.element),this.element.appendChild(P)}}class ws{constructor(s,l){this.value=l.value,this.viewProps=l.viewProps,this.sliderC_=new er(s,{baseStep:l.baseStep,props:l.sliderProps,value:l.value,viewProps:this.viewProps}),this.textC_=new bs(s,{baseStep:l.baseStep,parser:l.parser,props:l.textProps,sliderProps:l.sliderProps,value:l.value,viewProps:l.viewProps}),this.view=new nr(s,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function si(r,s){r.write(s)}function Es(r){const s=Ie;if(Array.isArray(r))return s.required.array(s.required.object({text:s.required.string,value:s.required.raw}))(r).value;if(typeof r=="object")return s.required.raw(r).value}function ji(r){if(r==="inline"||r==="popup")return r}function vi(r){const s=Ie;return s.required.object({max:s.optional.number,min:s.optional.number,step:s.optional.number})(r).value}function ir(r){if(Array.isArray(r))return r;const s=[];return Object.keys(r).forEach(l=>{s.push({text:l,value:r[l]})}),s}function Cr(r){return g(r)?null:new Bi(ir(r))}function Ss(r){const s=r?En(r,Xn):null;return s?s.step:null}function ls(r,s){const l=r&&En(r,Xn);return l?_n(l.step):Math.max(_n(s),2)}function gi(r){const s=Ss(r);return s??1}function es(r,s){var l;const p=r&&En(r,Xn),P=Math.abs((l=p?.step)!==null&&l!==void 0?l:s);return P===0?.1:Math.pow(10,Math.floor(Math.log10(P))-1)}const sr=V("ckb");class rr{constructor(s,l){this.onValueChange_=this.onValueChange_.bind(this),this.element=s.createElement("div"),this.element.classList.add(sr()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("label");p.classList.add(sr("l")),this.element.appendChild(p);const P=s.createElement("input");P.classList.add(sr("i")),P.type="checkbox",p.appendChild(P),this.inputElement=P,l.viewProps.bindDisabled(this.inputElement);const U=s.createElement("div");U.classList.add(sr("w")),p.appendChild(U);const ee=ge(s,"check");U.appendChild(ee),l.value.emitter.on("change",this.onValueChange_),this.value=l.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class po{constructor(s,l){this.onInputChange_=this.onInputChange_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.view=new rr(s,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(s){const l=s.currentTarget;this.value.rawValue=l.checked}}function I(r){const s=[],l=Cr(r.options);return l&&s.push(l),new Gn(s)}const x={id:"input-bool",type:"input",accept:(r,s)=>{if(typeof r!="boolean")return null;const p=rt(s,{options:Ie.optional.custom(Es)});return p?{initialValue:r,params:p}:null},binding:{reader:r=>$n,constraint:r=>I(r.params),writer:r=>si},controller:r=>{const s=r.document,l=r.value,p=r.constraint,P=p&&En(p,Bi);return P?new Ei(s,{props:new he({options:P.values.value("options")}),value:l,viewProps:r.viewProps}):new po(s,{value:l,viewProps:r.viewProps})}},T=V("col");class O{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(T()),l.foldable.bindExpandedClass(this.element,T(void 0,"expanded")),F(l.foldable,"completed",Z(this.element,T(void 0,"cpl")));const p=s.createElement("div");p.classList.add(T("h")),this.element.appendChild(p);const P=s.createElement("div");P.classList.add(T("s")),p.appendChild(P),this.swatchElement=P;const U=s.createElement("div");if(U.classList.add(T("t")),p.appendChild(U),this.textElement=U,l.pickerLayout==="inline"){const ee=s.createElement("div");ee.classList.add(T("p")),this.element.appendChild(ee),this.pickerElement=ee}else this.pickerElement=null}}function J(r,s,l){const p=bn(r/255,0,1),P=bn(s/255,0,1),U=bn(l/255,0,1),ee=Math.max(p,P,U),_e=Math.min(p,P,U),Fe=ee-_e;let Qe=0,Mt=0;const Zt=(_e+ee)/2;return Fe!==0&&(Mt=Fe/(1-Math.abs(ee+_e-1)),p===ee?Qe=(P-U)/Fe:P===ee?Qe=2+(U-p)/Fe:Qe=4+(p-P)/Fe,Qe=Qe/6+(Qe<0?1:0)),[Qe*360,Mt*100,Zt*100]}function ae(r,s,l){const p=(r%360+360)%360,P=bn(s/100,0,1),U=bn(l/100,0,1),ee=(1-Math.abs(2*U-1))*P,_e=ee*(1-Math.abs(p/60%2-1)),Fe=U-ee/2;let Qe,Mt,Zt;return p>=0&&p<60?[Qe,Mt,Zt]=[ee,_e,0]:p>=60&&p<120?[Qe,Mt,Zt]=[_e,ee,0]:p>=120&&p<180?[Qe,Mt,Zt]=[0,ee,_e]:p>=180&&p<240?[Qe,Mt,Zt]=[0,_e,ee]:p>=240&&p<300?[Qe,Mt,Zt]=[_e,0,ee]:[Qe,Mt,Zt]=[ee,0,_e],[(Qe+Fe)*255,(Mt+Fe)*255,(Zt+Fe)*255]}function ye(r,s,l){const p=bn(r/255,0,1),P=bn(s/255,0,1),U=bn(l/255,0,1),ee=Math.max(p,P,U),_e=Math.min(p,P,U),Fe=ee-_e;let Qe;Fe===0?Qe=0:ee===p?Qe=60*(((P-U)/Fe%6+6)%6):ee===P?Qe=60*((U-p)/Fe+2):Qe=60*((p-P)/Fe+4);const Mt=ee===0?0:Fe/ee,Zt=ee;return[Qe,Mt*100,Zt*100]}function Xe(r,s,l){const p=Dn(r,360),P=bn(s/100,0,1),U=bn(l/100,0,1),ee=U*P,_e=ee*(1-Math.abs(p/60%2-1)),Fe=U-ee;let Qe,Mt,Zt;return p>=0&&p<60?[Qe,Mt,Zt]=[ee,_e,0]:p>=60&&p<120?[Qe,Mt,Zt]=[_e,ee,0]:p>=120&&p<180?[Qe,Mt,Zt]=[0,ee,_e]:p>=180&&p<240?[Qe,Mt,Zt]=[0,_e,ee]:p>=240&&p<300?[Qe,Mt,Zt]=[_e,0,ee]:[Qe,Mt,Zt]=[ee,0,_e],[(Qe+Fe)*255,(Mt+Fe)*255,(Zt+Fe)*255]}function k(r,s,l){const p=l+s*(100-Math.abs(2*l-100))/200;return[r,p!==0?s*(100-Math.abs(2*l-100))/p:0,l+s*(100-Math.abs(2*l-100))/(2*100)]}function w(r,s,l){const p=100-Math.abs(l*(200-s)/100-100);return[r,p!==0?s*l/p:0,l*(200-s)/(2*100)]}function A(r){return[r[0],r[1],r[2]]}function N(r,s){return[r[0],r[1],r[2],s]}const Y={hsl:{hsl:(r,s,l)=>[r,s,l],hsv:k,rgb:ae},hsv:{hsl:w,hsv:(r,s,l)=>[r,s,l],rgb:Xe},rgb:{hsl:J,hsv:ye,rgb:(r,s,l)=>[r,s,l]}};function re(r,s){return[s==="float"?1:r==="rgb"?255:360,s==="float"?1:r==="rgb"?255:100,s==="float"?1:r==="rgb"?255:100]}function Ce(r,s){return r===s?s:Dn(r,s)}function Ke(r,s,l){var p;const P=re(s,l);return[s==="rgb"?bn(r[0],0,P[0]):Ce(r[0],P[0]),bn(r[1],0,P[1]),bn(r[2],0,P[2]),bn((p=r[3])!==null&&p!==void 0?p:1,0,1)]}function nn(r,s,l,p){const P=re(s,l),U=re(s,p);return r.map((ee,_e)=>ee/P[_e]*U[_e])}function Li(r,s,l){const p=nn(r,s.mode,s.type,"int"),P=Y[s.mode][l.mode](...p);return nn(P,l.mode,"int",l.type)}function Rt(r,s){return typeof r!="object"||g(r)?!1:s in r&&typeof r[s]=="number"}class Vt{static black(s="int"){return new Vt([0,0,0],"rgb",s)}static fromObject(s,l="int"){const p="a"in s?[s.r,s.g,s.b,s.a]:[s.r,s.g,s.b];return new Vt(p,"rgb",l)}static toRgbaObject(s,l="int"){return s.toRgbaObject(l)}static isRgbColorObject(s){return Rt(s,"r")&&Rt(s,"g")&&Rt(s,"b")}static isRgbaColorObject(s){return this.isRgbColorObject(s)&&Rt(s,"a")}static isColorObject(s){return this.isRgbColorObject(s)}static equals(s,l){if(s.mode!==l.mode)return!1;const p=s.comps_,P=l.comps_;for(let U=0;U<p.length;U++)if(p[U]!==P[U])return!1;return!0}constructor(s,l,p="int"){this.mode=l,this.type=p,this.comps_=Ke(s,l,p)}getComponents(s,l="int"){return N(Li(A(this.comps_),{mode:this.mode,type:this.type},{mode:s??this.mode,type:l}),this.comps_[3])}toRgbaObject(s="int"){const l=this.getComponents("rgb",s);return{r:l[0],g:l[1],b:l[2],a:l[3]}}}const Us=V("colp");class Al{constructor(s,l){this.alphaViews_=null,this.element=s.createElement("div"),this.element.classList.add(Us()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("div");p.classList.add(Us("hsv"));const P=s.createElement("div");P.classList.add(Us("sv")),this.svPaletteView_=l.svPaletteView,P.appendChild(this.svPaletteView_.element),p.appendChild(P);const U=s.createElement("div");U.classList.add(Us("h")),this.hPaletteView_=l.hPaletteView,U.appendChild(this.hPaletteView_.element),p.appendChild(U),this.element.appendChild(p);const ee=s.createElement("div");if(ee.classList.add(Us("rgb")),this.textView_=l.textView,ee.appendChild(this.textView_.element),this.element.appendChild(ee),l.alphaViews){this.alphaViews_={palette:l.alphaViews.palette,text:l.alphaViews.text};const _e=s.createElement("div");_e.classList.add(Us("a"));const Fe=s.createElement("div");Fe.classList.add(Us("ap")),Fe.appendChild(this.alphaViews_.palette.element),_e.appendChild(Fe);const Qe=s.createElement("div");Qe.classList.add(Us("at")),Qe.appendChild(this.alphaViews_.text.element),_e.appendChild(Qe),this.element.appendChild(_e)}}get allFocusableElements(){const s=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(l=>l.inputElement)];return this.alphaViews_&&s.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),s}}function Pl(r){return r==="int"?"int":r==="float"?"float":void 0}function or(r){const s=Ie;return rt(r,{alpha:s.optional.boolean,color:s.optional.object({alpha:s.optional.boolean,type:s.optional.custom(Pl)}),expanded:s.optional.boolean,picker:s.optional.custom(ji)})}function cs(r){return r?.1:1}function Vr(r){var s;return(s=r.color)===null||s===void 0?void 0:s.type}function xs(r,s){return r.alpha===s.alpha&&r.mode===s.mode&&r.notation===s.notation&&r.type===s.type}function ys(r,s){const l=r.match(/^(.+)%$/);return Math.min(l?parseFloat(l[1])*.01*s:parseFloat(r),s)}const _h={deg:r=>r,grad:r=>r*360/400,rad:r=>r*360/(2*Math.PI),turn:r=>r*360};function Tl(r){const s=r.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!s)return parseFloat(r);const l=parseFloat(s[1]),p=s[2];return _h[p](l)}function Ll(r){const s=r.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!s)return null;const l=[ys(s[1],255),ys(s[2],255),ys(s[3],255)];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])?null:l}function kl(r){return s=>{const l=Ll(s);return l?new Vt(l,"rgb",r):null}}function Rl(r){const s=r.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!s)return null;const l=[ys(s[1],255),ys(s[2],255),ys(s[3],255),ys(s[4],1)];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])||isNaN(l[3])?null:l}function Il(r){return s=>{const l=Rl(s);return l?new Vt(l,"rgb",r):null}}function Dl(r){const s=r.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!s)return null;const l=[Tl(s[1]),ys(s[2],100),ys(s[3],100)];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])?null:l}function zl(r){return s=>{const l=Dl(s);return l?new Vt(l,"hsl",r):null}}function Vl(r){const s=r.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!s)return null;const l=[Tl(s[1]),ys(s[2],100),ys(s[3],100),ys(s[4],1)];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])||isNaN(l[3])?null:l}function Nl(r){return s=>{const l=Vl(s);return l?new Vt(l,"hsl",r):null}}function bh(r){const s=r.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(s)return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)];const l=r.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:null}function wh(r){const s=bh(r);return s?new Vt(s,"rgb","int"):null}function xh(r){const s=r.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(s)return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16),Wt(parseInt(s[4]+s[4],16),0,255,0,1)];const l=r.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16),Wt(parseInt(l[4],16),0,255,0,1)]:null}function yh(r){const s=xh(r);return s?new Vt(s,"rgb","int"):null}function Ol(r){const s=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!s)return null;const l=[parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])?null:l}function Fl(r){return s=>{const l=Ol(s);return l?new Vt(l,"rgb",r):null}}function Bl(r){const s=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!s)return null;const l=[parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]),parseFloat(s[4])];return isNaN(l[0])||isNaN(l[1])||isNaN(l[2])||isNaN(l[3])?null:l}function Ch(r){return s=>{const l=Bl(s);return l?new Vt(l,"rgb",r):null}}const Ud=[{parser:bh,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:xh,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Ll,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Rl,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Dl,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Vl,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Ol,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Bl,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Ul(r){return Ud.reduce((s,{parser:l,result:p})=>s||(l(r)?p:null),null)}function ka(r,s="int"){const l=Ul(r);return l?l.notation==="hex"&&s!=="float"?Object.assign(Object.assign({},l),{type:"int"}):l.notation==="func"?Object.assign(Object.assign({},l),{type:s}):null:null}const Mh={int:[wh,yh,kl("int"),Il("int"),zl("int"),Nl("int"),Fl("int"),Ch("int")],float:[kl("float"),Il("float"),zl("float"),Nl("float"),Fl("float"),Ch("float")]};function Hl(r){const s=Mh[r];return l=>{if(typeof l!="string")return Vt.black(r);const p=s.reduce((P,U)=>P||U(l),null);return p??Vt.black(r)}}function Ra(r){const s=Mh[r];return l=>s.reduce((p,P)=>p||P(l),null)}function Gl(r){const s=bn(Math.floor(r),0,255).toString(16);return s.length===1?`0${s}`:s}function Ia(r,s="#"){const l=A(r.getComponents("rgb")).map(Gl).join("");return`${s}${l}`}function Da(r,s="#"){const l=r.getComponents("rgb"),p=[l[0],l[1],l[2],l[3]*255].map(Gl).join("");return`${s}${p}`}function Eh(r,s){const l=In(s==="float"?2:0);return`rgb(${A(r.getComponents("rgb",s)).map(P=>l(P)).join(", ")})`}function za(r){return s=>Eh(s,r)}function Va(r,s){const l=In(2),p=In(s==="float"?2:0);return`rgba(${r.getComponents("rgb",s).map((U,ee)=>(ee===3?l:p)(U)).join(", ")})`}function Hd(r){return s=>Va(s,r)}function Gd(r){const s=[In(0),gs,gs];return`hsl(${A(r.getComponents("hsl")).map((p,P)=>s[P](p)).join(", ")})`}function Sh(r){const s=[In(0),gs,gs,In(2)];return`hsla(${r.getComponents("hsl").map((p,P)=>s[P](p)).join(", ")})`}function Ah(r,s){const l=In(s==="float"?2:0),p=["r","g","b"];return`{${A(r.getComponents("rgb",s)).map((U,ee)=>`${p[ee]}: ${l(U)}`).join(", ")}}`}function Ph(r){return s=>Ah(s,r)}function Th(r,s){const l=In(2),p=In(s==="float"?2:0),P=["r","g","b","a"];return`{${r.getComponents("rgb",s).map((ee,_e)=>{const Fe=_e===3?l:p;return`${P[_e]}: ${Fe(ee)}`}).join(", ")}}`}function Wd(r){return s=>Th(s,r)}const Wl=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Ia},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Da},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Gd},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Sh},...["int","float"].reduce((r,s)=>[...r,{format:{alpha:!1,mode:"rgb",notation:"func",type:s},stringifier:za(s)},{format:{alpha:!0,mode:"rgb",notation:"func",type:s},stringifier:Hd(s)},{format:{alpha:!1,mode:"rgb",notation:"object",type:s},stringifier:Ph(s)},{format:{alpha:!0,mode:"rgb",notation:"object",type:s},stringifier:Wd(s)}],[])];function Nr(r){return Wl.reduce((s,l)=>s||(xs(l.format,r)?l.stringifier:null),null)}const Ko=V("apl");class jd{constructor(s,l){this.onValueChange_=this.onValueChange_.bind(this),this.value=l.value,this.value.emitter.on("change",this.onValueChange_),this.element=s.createElement("div"),this.element.classList.add(Ko()),l.viewProps.bindClassModifiers(this.element),l.viewProps.bindTabIndex(this.element);const p=s.createElement("div");p.classList.add(Ko("b")),this.element.appendChild(p);const P=s.createElement("div");P.classList.add(Ko("c")),p.appendChild(P),this.colorElem_=P;const U=s.createElement("div");U.classList.add(Ko("m")),this.element.appendChild(U),this.markerElem_=U;const ee=s.createElement("div");ee.classList.add(Ko("p")),this.markerElem_.appendChild(ee),this.previewElem_=ee,this.update_()}update_(){const s=this.value.rawValue,l=s.getComponents("rgb"),p=new Vt([l[0],l[1],l[2],0],"rgb"),P=new Vt([l[0],l[1],l[2],255],"rgb"),U=["to right",Va(p),Va(P)];this.colorElem_.style.background=`linear-gradient(${U.join(",")})`,this.previewElem_.style.backgroundColor=Va(s);const ee=Wt(l[3],0,1,0,100);this.markerElem_.style.left=`${ee}%`}onValueChange_(){this.update_()}}class fo{constructor(s,l){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.view=new jd(s,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(s,l){if(!s.point)return;const p=s.point.x/s.bounds.width,P=this.value.rawValue,[U,ee,_e]=P.getComponents("hsv");this.value.setRawValue(new Vt([U,ee,_e,p],"hsv"),l)}onPointerDown_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onKeyDown_(s){const l=Sn(cs(!0),pi(s));if(l===0)return;const p=this.value.rawValue,[P,U,ee,_e]=p.getComponents("hsv");this.value.setRawValue(new Vt([P,U,ee,_e+l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(s){Sn(cs(!0),pi(s))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const mo=V("coltxt");function Kd(r){const s=r.createElement("select"),l=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return s.appendChild(l.reduce((p,P)=>{const U=r.createElement("option");return U.textContent=P.text,U.value=P.value,p.appendChild(U),p},r.createDocumentFragment())),s}class qd{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(mo()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("div");p.classList.add(mo("m")),this.modeElem_=Kd(s),this.modeElem_.classList.add(mo("ms")),p.appendChild(this.modeSelectElement),l.viewProps.bindDisabled(this.modeElem_);const P=s.createElement("div");P.classList.add(mo("mm")),P.appendChild(ge(s,"dropdown")),p.appendChild(P),this.element.appendChild(p);const U=s.createElement("div");U.classList.add(mo("w")),this.element.appendChild(U),this.textsElem_=U,this.textViews_=l.textViews,this.applyTextViews_(),j(l.colorMode,ee=>{this.modeElem_.value=ee})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(s){this.textViews_=s,this.applyTextViews_()}applyTextViews_(){Ze(this.textsElem_);const s=this.element.ownerDocument;this.textViews_.forEach(l=>{const p=s.createElement("div");p.classList.add(mo("c")),p.appendChild(l.element),this.textsElem_.appendChild(p)})}}function Xd(r){return In(r==="float"?2:0)}function jl(r,s,l){const p=re(r,s)[l];return new li({min:0,max:p})}function Kl(r,s,l){return new bs(r,{arrayPosition:l===0?"fst":l===3-1?"lst":"mid",baseStep:cs(!1),parser:s.parser,props:he.fromObject({draggingScale:s.colorType==="float"?.01:1,formatter:Xd(s.colorType)}),value:de(0,{constraint:jl(s.colorMode,s.colorType,l)}),viewProps:s.viewProps})}class ql{constructor(s,l){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=l.colorType,this.parser_=l.parser,this.value=l.value,this.viewProps=l.viewProps,this.colorMode=de(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(s),this.view=new qd(s,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(s){const l={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},p=[Kl(s,l,0),Kl(s,l,1),Kl(s,l,2)];return p.forEach((P,U)=>{Tn({primary:this.value,secondary:P.value,forward:ee=>ee.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[U],backward:(ee,_e)=>{const Fe=this.colorMode.rawValue,Qe=ee.rawValue.getComponents(Fe,this.colorType_);return Qe[U]=_e.rawValue,new Vt(N(A(Qe),Qe[3]),Fe,this.colorType_)}})}),p}onModeSelectChange_(s){const l=s.currentTarget;this.colorMode.rawValue=l.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Xl=V("hpl");class $d{constructor(s,l){this.onValueChange_=this.onValueChange_.bind(this),this.value=l.value,this.value.emitter.on("change",this.onValueChange_),this.element=s.createElement("div"),this.element.classList.add(Xl()),l.viewProps.bindClassModifiers(this.element),l.viewProps.bindTabIndex(this.element);const p=s.createElement("div");p.classList.add(Xl("c")),this.element.appendChild(p);const P=s.createElement("div");P.classList.add(Xl("m")),this.element.appendChild(P),this.markerElem_=P,this.update_()}update_(){const s=this.value.rawValue,[l]=s.getComponents("hsv");this.markerElem_.style.backgroundColor=Eh(new Vt([l,100,100],"hsv"));const p=Wt(l,0,360,0,100);this.markerElem_.style.left=`${p}%`}onValueChange_(){this.update_()}}class $l{constructor(s,l){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.view=new $d(s,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(s,l){if(!s.point)return;const p=Wt(bn(s.point.x,0,s.bounds.width),0,s.bounds.width,0,360),P=this.value.rawValue,[,U,ee,_e]=P.getComponents("hsv");this.value.setRawValue(new Vt([p,U,ee,_e],"hsv"),l)}onPointerDown_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onKeyDown_(s){const l=Sn(cs(!1),pi(s));if(l===0)return;const p=this.value.rawValue,[P,U,ee,_e]=p.getComponents("hsv");this.value.setRawValue(new Vt([P+l,U,ee,_e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(s){Sn(cs(!1),pi(s))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Na=V("svp"),Lh=64;class Yd{constructor(s,l){this.onValueChange_=this.onValueChange_.bind(this),this.value=l.value,this.value.emitter.on("change",this.onValueChange_),this.element=s.createElement("div"),this.element.classList.add(Na()),l.viewProps.bindClassModifiers(this.element),l.viewProps.bindTabIndex(this.element);const p=s.createElement("canvas");p.height=Lh,p.width=Lh,p.classList.add(Na("c")),this.element.appendChild(p),this.canvasElement=p;const P=s.createElement("div");P.classList.add(Na("m")),this.element.appendChild(P),this.markerElem_=P,this.update_()}update_(){const s=Q(this.canvasElement);if(!s)return;const p=this.value.rawValue.getComponents("hsv"),P=this.canvasElement.width,U=this.canvasElement.height,ee=s.getImageData(0,0,P,U),_e=ee.data;for(let Mt=0;Mt<U;Mt++)for(let Zt=0;Zt<P;Zt++){const hs=Wt(Zt,0,P,0,100),Hs=Wt(Mt,0,U,100,0),pc=Xe(p[0],hs,Hs),$h=(Mt*P+Zt)*4;_e[$h]=pc[0],_e[$h+1]=pc[1],_e[$h+2]=pc[2],_e[$h+3]=255}s.putImageData(ee,0,0);const Fe=Wt(p[1],0,100,0,100);this.markerElem_.style.left=`${Fe}%`;const Qe=Wt(p[2],0,100,100,0);this.markerElem_.style.top=`${Qe}%`}onValueChange_(){this.update_()}}class Zd{constructor(s,l){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.view=new Yd(s,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(s,l){if(!s.point)return;const p=Wt(s.point.x,0,s.bounds.width,0,100),P=Wt(s.point.y,0,s.bounds.height,100,0),[U,,,ee]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Vt([U,p,P,ee],"hsv"),l)}onPointerDown_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onKeyDown_(s){_s(s.key)&&s.preventDefault();const[l,p,P,U]=this.value.rawValue.getComponents("hsv"),ee=cs(!1),_e=Sn(ee,pi(s)),Fe=Sn(ee,di(s));_e===0&&Fe===0||this.value.setRawValue(new Vt([l,p+_e,P+Fe,U],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(s){const l=cs(!1),p=Sn(l,pi(s)),P=Sn(l,di(s));p===0&&P===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Yl{constructor(s,l){this.value=l.value,this.viewProps=l.viewProps,this.hPaletteC_=new $l(s,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Zd(s,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=l.supportsAlpha?{palette:new fo(s,{value:this.value,viewProps:this.viewProps}),text:new bs(s,{parser:Vi,baseStep:.1,props:he.fromObject({draggingScale:.01,formatter:In(2)}),value:de(0,{constraint:new li({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Tn({primary:this.value,secondary:this.alphaIcs_.text.value,forward:p=>p.rawValue.getComponents()[3],backward:(p,P)=>{const U=p.rawValue.getComponents();return U[3]=P.rawValue,new Vt(U,p.rawValue.mode)}}),this.textC_=new ql(s,{colorType:l.colorType,parser:Vi,value:this.value,viewProps:this.viewProps}),this.view=new Al(s,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:l.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Zl=V("colsw");class Jd{constructor(s,l){this.onValueChange_=this.onValueChange_.bind(this),l.value.emitter.on("change",this.onValueChange_),this.value=l.value,this.element=s.createElement("div"),this.element.classList.add(Zl()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("div");p.classList.add(Zl("sw")),this.element.appendChild(p),this.swatchElem_=p;const P=s.createElement("button");P.classList.add(Zl("b")),l.viewProps.bindDisabled(P),this.element.appendChild(P),this.buttonElement=P,this.update_()}update_(){const s=this.value.rawValue;this.swatchElem_.style.backgroundColor=Da(s)}onValueChange_(){this.update_()}}class Jl{constructor(s,l){this.value=l.value,this.viewProps=l.viewProps,this.view=new Jd(s,{value:this.value,viewProps:this.viewProps})}}class Ql{constructor(s,l){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.foldable_=ie.create(l.expanded),this.swatchC_=new Jl(s,{value:this.value,viewProps:this.viewProps});const p=this.swatchC_.view.buttonElement;p.addEventListener("blur",this.onButtonBlur_),p.addEventListener("click",this.onButtonClick_),this.textC_=new Ui(s,{parser:l.parser,props:he.fromObject({formatter:l.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new O(s,{foldable:this.foldable_,pickerLayout:l.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=l.pickerLayout==="popup"?new ci(s,{viewProps:this.viewProps}):null;const P=new Yl(s,{colorType:l.colorType,supportsAlpha:l.supportsAlpha,value:this.value,viewProps:this.viewProps});P.view.allFocusableElements.forEach(U=>{U.addEventListener("blur",this.onPopupChildBlur_),U.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=P,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(P.view.element),Tn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:U=>U.rawValue,backward:(U,ee)=>ee.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Le(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(s){if(!this.popC_)return;const l=this.view.element,p=s.relatedTarget;(!p||!l.contains(p))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(s){if(!this.popC_)return;const l=this.popC_.view.element,p=qe(s);p&&l.contains(p)||p&&p===this.swatchC_.view.buttonElement&&!dt(l.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(s){this.popC_?s.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&s.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Qd(r,s){return Vt.isColorObject(r)?Vt.fromObject(r,s):Vt.black(s)}function ep(r){return A(r.getComponents("rgb")).reduce((s,l)=>s<<8|Math.floor(l)&255,0)}function tp(r){return r.getComponents("rgb").reduce((s,l,p)=>{const P=Math.floor(p===3?l*255:l)&255;return s<<8|P},0)>>>0}function np(r){return new Vt([r>>16&255,r>>8&255,r&255],"rgb")}function ip(r){return new Vt([r>>24&255,r>>16&255,r>>8&255,Wt(r&255,0,255,0,1)],"rgb")}function sp(r){return typeof r!="number"?Vt.black():np(r)}function rp(r){return typeof r!="number"?Vt.black():ip(r)}function op(r){const s=Nr(r);return s?(l,p)=>{si(l,s(p))}:null}function ap(r){const s=r?tp:ep;return(l,p)=>{si(l,s(p))}}function lp(r,s,l){const p=s.toRgbaObject(l);r.writeProperty("r",p.r),r.writeProperty("g",p.g),r.writeProperty("b",p.b),r.writeProperty("a",p.a)}function cp(r,s,l){const p=s.toRgbaObject(l);r.writeProperty("r",p.r),r.writeProperty("g",p.g),r.writeProperty("b",p.b)}function ec(r,s){return(l,p)=>{r?lp(l,p,s):cp(l,p,s)}}function tc(r){var s;return!!(r?.alpha||!((s=r?.color)===null||s===void 0)&&s.alpha)}function hp(r){return r?s=>Da(s,"0x"):s=>Ia(s,"0x")}function up(r){return"color"in r||"view"in r&&r.view==="color"}const dp={id:"input-color-number",type:"input",accept:(r,s)=>{if(typeof r!="number"||!up(s))return null;const l=or(s);return l?{initialValue:r,params:l}:null},binding:{reader:r=>tc(r.params)?rp:sp,equals:Vt.equals,writer:r=>ap(tc(r.params))},controller:r=>{const s=tc(r.params),l="expanded"in r.params?r.params.expanded:void 0,p="picker"in r.params?r.params.picker:void 0;return new Ql(r.document,{colorType:"int",expanded:l??!1,formatter:hp(s),parser:Ra("int"),pickerLayout:p??"popup",supportsAlpha:s,value:r.value,viewProps:r.viewProps})}};function pp(r){return Vt.isRgbaColorObject(r)}function fp(r){return s=>Qd(s,r)}function mp(r,s){return l=>r?Th(l,s):Ah(l,s)}const vp={id:"input-color-object",type:"input",accept:(r,s)=>{if(!Vt.isColorObject(r))return null;const l=or(s);return l?{initialValue:r,params:l}:null},binding:{reader:r=>fp(Vr(r.params)),equals:Vt.equals,writer:r=>ec(pp(r.initialValue),Vr(r.params))},controller:r=>{var s;const l=Vt.isRgbaColorObject(r.initialValue),p="expanded"in r.params?r.params.expanded:void 0,P="picker"in r.params?r.params.picker:void 0,U=(s=Vr(r.params))!==null&&s!==void 0?s:"int";return new Ql(r.document,{colorType:U,expanded:p??!1,formatter:mp(l,U),parser:Ra(U),pickerLayout:P??"popup",supportsAlpha:l,value:r.value,viewProps:r.viewProps})}},Mr={id:"input-color-string",type:"input",accept:(r,s)=>{if(typeof r!="string"||"view"in s&&s.view==="text")return null;const l=ka(r,Vr(s));if(!l||!Nr(l))return null;const P=or(s);return P?{initialValue:r,params:P}:null},binding:{reader:r=>{var s;return Hl((s=Vr(r.params))!==null&&s!==void 0?s:"int")},equals:Vt.equals,writer:r=>{const s=ka(r.initialValue,Vr(r.params));if(!s)throw E.shouldNeverHappen();const l=op(s);if(!l)throw E.notBindable();return l}},controller:r=>{const s=ka(r.initialValue,Vr(r.params));if(!s)throw E.shouldNeverHappen();const l=Nr(s);if(!l)throw E.shouldNeverHappen();const p="expanded"in r.params?r.params.expanded:void 0,P="picker"in r.params?r.params.picker:void 0;return new Ql(r.document,{colorType:s.type,expanded:p??!1,formatter:l,parser:Ra(s.type),pickerLayout:P??"popup",supportsAlpha:s.alpha,value:r.value,viewProps:r.viewProps})}};class ar{constructor(s){this.components=s.components,this.asm_=s.assembly}constrain(s){const l=this.asm_.toComponents(s).map((p,P)=>{var U,ee;return(ee=(U=this.components[P])===null||U===void 0?void 0:U.constrain(p))!==null&&ee!==void 0?ee:p});return this.asm_.fromComponents(l)}}const kh=V("pndtxt");class gp{constructor(s,l){this.textViews=l.textViews,this.element=s.createElement("div"),this.element.classList.add(kh()),this.textViews.forEach(p=>{const P=s.createElement("div");P.classList.add(kh("a")),P.appendChild(p.element),this.element.appendChild(P)})}}function nc(r,s,l){return new bs(r,{arrayPosition:l===0?"fst":l===s.axes.length-1?"lst":"mid",baseStep:s.axes[l].baseStep,parser:s.parser,props:s.axes[l].textProps,value:de(0,{constraint:s.axes[l].constraint}),viewProps:s.viewProps})}class Oa{constructor(s,l){this.value=l.value,this.viewProps=l.viewProps,this.acs_=l.axes.map((p,P)=>nc(s,l,P)),this.acs_.forEach((p,P)=>{Tn({primary:this.value,secondary:p.value,forward:U=>l.assembly.toComponents(U.rawValue)[P],backward:(U,ee)=>{const _e=l.assembly.toComponents(U.rawValue);return _e[P]=ee.rawValue,l.assembly.fromComponents(_e)}})}),this.view=new gp(s,{textViews:this.acs_.map(p=>p.view)})}}function ic(r,s){return"step"in r&&!g(r.step)?new Xn(r.step,s):null}function Rh(r){return!g(r.max)&&!g(r.min)?new li({max:r.max,min:r.min}):!g(r.max)||!g(r.min)?new qn({max:r.max,min:r.min}):null}function _p(r){const s=En(r,li);if(s)return[s.values.get("min"),s.values.get("max")];const l=En(r,qn);return l?[l.minValue,l.maxValue]:[void 0,void 0]}function bp(r,s){const l=[],p=ic(r,s);p&&l.push(p);const P=Rh(r);P&&l.push(P);const U=Cr(r.options);return U&&l.push(U),new Gn(l)}const Er={id:"input-number",type:"input",accept:(r,s)=>{if(typeof r!="number")return null;const l=Ie,p=rt(s,{format:l.optional.function,max:l.optional.number,min:l.optional.number,options:l.optional.custom(Es),step:l.optional.number});return p?{initialValue:r,params:p}:null},binding:{reader:r=>Wi,constraint:r=>bp(r.params,r.initialValue),writer:r=>si},controller:r=>{var s;const l=r.value,p=r.constraint,P=p&&En(p,Bi);if(P)return new Ei(r.document,{props:new he({options:P.values.value("options")}),value:l,viewProps:r.viewProps});const U=(s="format"in r.params?r.params.format:void 0)!==null&&s!==void 0?s:In(ls(p,l.rawValue)),ee=p&&En(p,li);return ee?new ws(r.document,{baseStep:gi(p),parser:Vi,sliderProps:new he({maxValue:ee.values.value("max"),minValue:ee.values.value("min")}),textProps:he.fromObject({draggingScale:es(p,l.rawValue),formatter:U}),value:l,viewProps:r.viewProps}):new bs(r.document,{baseStep:gi(p),parser:Vi,props:he.fromObject({draggingScale:es(p,l.rawValue),formatter:U}),value:l,viewProps:r.viewProps})}};class lr{constructor(s=0,l=0){this.x=s,this.y=l}getComponents(){return[this.x,this.y]}static isObject(s){if(g(s))return!1;const l=s.x,p=s.y;return!(typeof l!="number"||typeof p!="number")}static equals(s,l){return s.x===l.x&&s.y===l.y}toObject(){return{x:this.x,y:this.y}}}const Or={toComponents:r=>r.getComponents(),fromComponents:r=>new lr(...r)},vo=V("p2d");class Sr{constructor(s,l){this.element=s.createElement("div"),this.element.classList.add(vo()),l.viewProps.bindClassModifiers(this.element),j(l.expanded,Z(this.element,vo(void 0,"expanded")));const p=s.createElement("div");p.classList.add(vo("h")),this.element.appendChild(p);const P=s.createElement("button");P.classList.add(vo("b")),P.appendChild(ge(s,"p2dpad")),l.viewProps.bindDisabled(P),p.appendChild(P),this.buttonElement=P;const U=s.createElement("div");if(U.classList.add(vo("t")),p.appendChild(U),this.textElement=U,l.pickerLayout==="inline"){const ee=s.createElement("div");ee.classList.add(vo("p")),this.element.appendChild(ee),this.pickerElement=ee}else this.pickerElement=null}}const Ar=V("p2dp");class Ih{constructor(s,l){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=l.invertsY,this.maxValue_=l.maxValue,this.element=s.createElement("div"),this.element.classList.add(Ar()),l.layout==="popup"&&this.element.classList.add(Ar(void 0,"p")),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("div");p.classList.add(Ar("p")),l.viewProps.bindTabIndex(p),this.element.appendChild(p),this.padElement=p;const P=s.createElementNS(Oe,"svg");P.classList.add(Ar("g")),this.padElement.appendChild(P),this.svgElem_=P;const U=s.createElementNS(Oe,"line");U.classList.add(Ar("ax")),U.setAttributeNS(null,"x1","0"),U.setAttributeNS(null,"y1","50%"),U.setAttributeNS(null,"x2","100%"),U.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(U);const ee=s.createElementNS(Oe,"line");ee.classList.add(Ar("ax")),ee.setAttributeNS(null,"x1","50%"),ee.setAttributeNS(null,"y1","0"),ee.setAttributeNS(null,"x2","50%"),ee.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(ee);const _e=s.createElementNS(Oe,"line");_e.classList.add(Ar("l")),_e.setAttributeNS(null,"x1","50%"),_e.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(_e),this.lineElem_=_e;const Fe=s.createElement("div");Fe.classList.add(Ar("m")),this.padElement.appendChild(Fe),this.markerElem_=Fe,l.value.emitter.on("change",this.onValueChange_),this.value=l.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[s,l]=this.value.rawValue.getComponents(),p=this.maxValue_,P=Wt(s,-p,+p,0,100),U=Wt(l,-p,+p,0,100),ee=this.invertsY_?100-U:U;this.lineElem_.setAttributeNS(null,"x2",`${P}%`),this.lineElem_.setAttributeNS(null,"y2",`${ee}%`),this.markerElem_.style.left=`${P}%`,this.markerElem_.style.top=`${ee}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Dh(r,s,l){return[Sn(s[0],pi(r)),Sn(s[1],di(r))*(l?1:-1)]}class wp{constructor(s,l){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.baseSteps_=l.baseSteps,this.maxValue_=l.maxValue,this.invertsY_=l.invertsY,this.view=new Ih(s,{invertsY:this.invertsY_,layout:l.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(s,l){if(!s.point)return;const p=this.maxValue_,P=Wt(s.point.x,0,s.bounds.width,-p,+p),U=Wt(this.invertsY_?s.bounds.height-s.point.y:s.point.y,0,s.bounds.height,-p,+p);this.value.setRawValue(new lr(P,U),l)}onPointerDown_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onPadKeyDown_(s){_s(s.key)&&s.preventDefault();const[l,p]=Dh(s,this.baseSteps_,this.invertsY_);l===0&&p===0||this.value.setRawValue(new lr(this.value.rawValue.x+l,this.value.rawValue.y+p),{forceEmit:!1,last:!1})}onPadKeyUp_(s){const[l,p]=Dh(s,this.baseSteps_,this.invertsY_);l===0&&p===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class go{constructor(s,l){var p,P;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=l.value,this.viewProps=l.viewProps,this.foldable_=ie.create(l.expanded),this.popC_=l.pickerLayout==="popup"?new ci(s,{viewProps:this.viewProps}):null;const U=new wp(s,{baseSteps:[l.axes[0].baseStep,l.axes[1].baseStep],invertsY:l.invertsY,layout:l.pickerLayout,maxValue:l.maxValue,value:this.value,viewProps:this.viewProps});U.view.allFocusableElements.forEach(ee=>{ee.addEventListener("blur",this.onPopupChildBlur_),ee.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=U,this.textC_=new Oa(s,{assembly:Or,axes:l.axes,parser:l.parser,value:this.value,viewProps:this.viewProps}),this.view=new Sr(s,{expanded:this.foldable_.value("expanded"),pickerLayout:l.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(p=this.view.buttonElement)===null||p===void 0||p.addEventListener("blur",this.onPadButtonBlur_),(P=this.view.buttonElement)===null||P===void 0||P.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Tn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:ee=>ee.rawValue,backward:(ee,_e)=>_e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Le(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(s){if(!this.popC_)return;const l=this.view.element,p=s.relatedTarget;(!p||!l.contains(p))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(s){if(!this.popC_)return;const l=this.popC_.view.element,p=qe(s);p&&l.contains(p)||p&&p===this.view.buttonElement&&!dt(l.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(s){this.popC_?s.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&s.key==="Escape"&&this.view.buttonElement.focus()}}class Fr{constructor(s=0,l=0,p=0){this.x=s,this.y=l,this.z=p}getComponents(){return[this.x,this.y,this.z]}static isObject(s){if(g(s))return!1;const l=s.x,p=s.y,P=s.z;return!(typeof l!="number"||typeof p!="number"||typeof P!="number")}static equals(s,l){return s.x===l.x&&s.y===l.y&&s.z===l.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const zh={toComponents:r=>r.getComponents(),fromComponents:r=>new Fr(...r)};function xp(r){return Fr.isObject(r)?new Fr(r.x,r.y,r.z):new Fr}function yp(r,s){r.writeProperty("x",s.x),r.writeProperty("y",s.y),r.writeProperty("z",s.z)}function sc(r,s){return new ar({assembly:zh,components:[hr("x"in r?r.x:void 0,s.x),hr("y"in r?r.y:void 0,s.y),hr("z"in r?r.z:void 0,s.z)]})}function rc(r,s){return{baseStep:gi(s),constraint:s,textProps:he.fromObject({draggingScale:es(s,r),formatter:In(ls(s,r))})}}const _o={id:"input-point3d",type:"input",accept:(r,s)=>{if(!Fr.isObject(r))return null;const l=Ie,p=rt(s,{x:l.optional.custom(vi),y:l.optional.custom(vi),z:l.optional.custom(vi)});return p?{initialValue:r,params:p}:null},binding:{reader:r=>xp,constraint:r=>sc(r.params,r.initialValue),equals:Fr.equals,writer:r=>yp},controller:r=>{const s=r.value,l=r.constraint;if(!(l instanceof ar))throw E.shouldNeverHappen();return new Oa(r.document,{assembly:zh,axes:[rc(s.rawValue.x,l.components[0]),rc(s.rawValue.y,l.components[1]),rc(s.rawValue.z,l.components[2])],parser:Vi,value:s,viewProps:r.viewProps})}};class Br{constructor(s=0,l=0,p=0,P=0){this.x=s,this.y=l,this.z=p,this.w=P}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(s){if(g(s))return!1;const l=s.x,p=s.y,P=s.z,U=s.w;return!(typeof l!="number"||typeof p!="number"||typeof P!="number"||typeof U!="number")}static equals(s,l){return s.x===l.x&&s.y===l.y&&s.z===l.z&&s.w===l.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Vh={toComponents:r=>r.getComponents(),fromComponents:r=>new Br(...r)};function Cp(r){return Br.isObject(r)?new Br(r.x,r.y,r.z,r.w):new Br}function Mp(r,s){r.writeProperty("x",s.x),r.writeProperty("y",s.y),r.writeProperty("z",s.z),r.writeProperty("w",s.w)}function Ep(r,s){return new ar({assembly:Vh,components:[hr("x"in r?r.x:void 0,s.x),hr("y"in r?r.y:void 0,s.y),hr("z"in r?r.z:void 0,s.z),hr("w"in r?r.w:void 0,s.w)]})}function Sp(r,s){return{baseStep:gi(s),constraint:s,textProps:he.fromObject({draggingScale:es(s,r),formatter:In(ls(s,r))})}}const Ap={id:"input-point4d",type:"input",accept:(r,s)=>{if(!Br.isObject(r))return null;const l=Ie,p=rt(s,{x:l.optional.custom(vi),y:l.optional.custom(vi),z:l.optional.custom(vi),w:l.optional.custom(vi)});return p?{initialValue:r,params:p}:null},binding:{reader:r=>Cp,constraint:r=>Ep(r.params,r.initialValue),equals:Br.equals,writer:r=>Mp},controller:r=>{const s=r.value,l=r.constraint;if(!(l instanceof ar))throw E.shouldNeverHappen();return new Oa(r.document,{assembly:Vh,axes:s.rawValue.getComponents().map((p,P)=>Sp(p,l.components[P])),parser:Vi,value:s,viewProps:r.viewProps})}};function Pp(r){const s=[],l=Cr(r.options);return l&&s.push(l),new Gn(s)}const qo={id:"input-string",type:"input",accept:(r,s)=>{if(typeof r!="string")return null;const p=rt(s,{options:Ie.optional.custom(Es)});return p?{initialValue:r,params:p}:null},binding:{reader:r=>Qs,constraint:r=>Pp(r.params),writer:r=>si},controller:r=>{const s=r.document,l=r.value,p=r.constraint,P=p&&En(p,Bi);return P?new Ei(s,{props:new he({options:P.values.value("options")}),value:l,viewProps:r.viewProps}):new Ui(s,{parser:U=>U,props:he.fromObject({formatter:Ni}),value:l,viewProps:r.viewProps})}},bo={monitor:{defaultInterval:200,defaultLineCount:3}},Nh=V("mll");class oc{constructor(s,l){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=l.formatter,this.element=s.createElement("div"),this.element.classList.add(Nh()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("textarea");p.classList.add(Nh("i")),p.style.height=`calc(var(--bld-us) * ${l.lineCount})`,p.readOnly=!0,l.viewProps.bindDisabled(p),this.element.appendChild(p),this.textareaElem_=p,l.value.emitter.on("change",this.onValueUpdate_),this.value=l.value,this.update_()}update_(){const s=this.textareaElem_,l=s.scrollTop===s.scrollHeight-s.clientHeight,p=[];this.value.rawValue.forEach(P=>{P!==void 0&&p.push(this.formatter_(P))}),s.textContent=p.join(`
`),l&&(s.scrollTop=s.scrollHeight)}onValueUpdate_(){this.update_()}}class Fa{constructor(s,l){this.value=l.value,this.viewProps=l.viewProps,this.view=new oc(s,{formatter:l.formatter,lineCount:l.lineCount,value:this.value,viewProps:this.viewProps})}}const Oh=V("sgl");class ac{constructor(s,l){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=l.formatter,this.element=s.createElement("div"),this.element.classList.add(Oh()),l.viewProps.bindClassModifiers(this.element);const p=s.createElement("input");p.classList.add(Oh("i")),p.readOnly=!0,p.type="text",l.viewProps.bindDisabled(p),this.element.appendChild(p),this.inputElement=p,l.value.emitter.on("change",this.onValueUpdate_),this.value=l.value,this.update_()}update_(){const s=this.value.rawValue,l=s[s.length-1];this.inputElement.value=l!==void 0?this.formatter_(l):""}onValueUpdate_(){this.update_()}}class lc{constructor(s,l){this.value=l.value,this.viewProps=l.viewProps,this.view=new ac(s,{formatter:l.formatter,value:this.value,viewProps:this.viewProps})}}const Pr={id:"monitor-bool",type:"monitor",accept:(r,s)=>{if(typeof r!="boolean")return null;const p=rt(s,{lineCount:Ie.optional.number});return p?{initialValue:r,params:p}:null},binding:{reader:r=>$n},controller:r=>{var s;return r.value.rawValue.length===1?new lc(r.document,{formatter:fs,value:r.value,viewProps:r.viewProps}):new Fa(r.document,{formatter:fs,lineCount:(s=r.params.lineCount)!==null&&s!==void 0?s:bo.monitor.defaultLineCount,value:r.value,viewProps:r.viewProps})}},Tr=V("grl");class Tp{constructor(s,l){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=s.createElement("div"),this.element.classList.add(Tr()),l.viewProps.bindClassModifiers(this.element),this.formatter_=l.formatter,this.props_=l.props,this.cursor_=l.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const p=s.createElementNS(Oe,"svg");p.classList.add(Tr("g")),p.style.height=`calc(var(--bld-us) * ${l.lineCount})`,this.element.appendChild(p),this.svgElem_=p;const P=s.createElementNS(Oe,"polyline");this.svgElem_.appendChild(P),this.lineElem_=P;const U=s.createElement("div");U.classList.add(Tr("t"),V("tt")()),this.element.appendChild(U),this.tooltipElem_=U,l.value.emitter.on("change",this.onValueUpdate_),this.value=l.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const s=this.svgElem_.getBoundingClientRect(),l=this.value.rawValue.length-1,p=this.props_.get("minValue"),P=this.props_.get("maxValue"),U=[];this.value.rawValue.forEach((Mt,Zt)=>{if(Mt===void 0)return;const hs=Wt(Zt,0,l,0,s.width),Hs=Wt(Mt,p,P,s.height,0);U.push([hs,Hs].join(","))}),this.lineElem_.setAttributeNS(null,"points",U.join(" "));const ee=this.tooltipElem_,_e=this.value.rawValue[this.cursor_.rawValue];if(_e===void 0){ee.classList.remove(Tr("t","a"));return}const Fe=Wt(this.cursor_.rawValue,0,l,0,s.width),Qe=Wt(_e,p,P,s.height,0);ee.style.left=`${Fe}px`,ee.style.top=`${Qe}px`,ee.textContent=`${this.formatter_(_e)}`,ee.classList.contains(Tr("t","a"))||(ee.classList.add(Tr("t","a"),Tr("t","in")),St(ee),ee.classList.remove(Tr("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class cc{constructor(s,l){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=l.props,this.value=l.value,this.viewProps=l.viewProps,this.cursor_=de(-1),this.view=new Tp(s,{cursor:this.cursor_,formatter:l.formatter,lineCount:l.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!dt(s))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const p=new rn(this.view.element);p.emitter.on("down",this.onGraphPointerDown_),p.emitter.on("move",this.onGraphPointerMove_),p.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(s){const l=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Wt(s.offsetX,0,l.width,0,this.value.rawValue.length))}onGraphPointerDown_(s){this.onGraphPointerMove_(s)}onGraphPointerMove_(s){if(!s.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Wt(s.data.point.x,0,s.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function hc(r){return"format"in r&&!g(r.format)?r.format:In(2)}function Lp(r){var s;return r.value.rawValue.length===1?new lc(r.document,{formatter:hc(r.params),value:r.value,viewProps:r.viewProps}):new Fa(r.document,{formatter:hc(r.params),lineCount:(s=r.params.lineCount)!==null&&s!==void 0?s:bo.monitor.defaultLineCount,value:r.value,viewProps:r.viewProps})}function Fh(r){var s,l,p;return new cc(r.document,{formatter:hc(r.params),lineCount:(s=r.params.lineCount)!==null&&s!==void 0?s:bo.monitor.defaultLineCount,props:he.fromObject({maxValue:(l="max"in r.params?r.params.max:null)!==null&&l!==void 0?l:100,minValue:(p="min"in r.params?r.params.min:null)!==null&&p!==void 0?p:0}),value:r.value,viewProps:r.viewProps})}function Bh(r){return"view"in r&&r.view==="graph"}const kp={id:"monitor-number",type:"monitor",accept:(r,s)=>{if(typeof r!="number")return null;const l=Ie,p=rt(s,{format:l.optional.function,lineCount:l.optional.number,max:l.optional.number,min:l.optional.number,view:l.optional.string});return p?{initialValue:r,params:p}:null},binding:{defaultBufferSize:r=>Bh(r)?64:1,reader:r=>Wi},controller:r=>Bh(r.params)?Fh(r):Lp(r)},Rp={id:"monitor-string",type:"monitor",accept:(r,s)=>{if(typeof r!="string")return null;const l=Ie,p=rt(s,{lineCount:l.optional.number,multiline:l.optional.boolean});return p?{initialValue:r,params:p}:null},binding:{reader:r=>Qs},controller:r=>{var s;const l=r.value;return l.rawValue.length>1||"multiline"in r.params&&r.params.multiline?new Fa(r.document,{formatter:Ni,lineCount:(s=r.params.lineCount)!==null&&s!==void 0?s:bo.monitor.defaultLineCount,value:l,viewProps:r.viewProps}):new lc(r.document,{formatter:Ni,value:l,viewProps:r.viewProps})}};function Ip(r,s){var l;const p=r.accept(s.target.read(),s.params);if(g(p))return null;const P=Ie,U={target:s.target,initialValue:p.initialValue,params:p.params},ee=r.binding.reader(U),_e=r.binding.constraint?r.binding.constraint(U):void 0,Fe=de(ee(p.initialValue),{constraint:_e,equals:r.binding.equals}),Qe=new Pn({reader:ee,target:s.target,value:Fe,writer:r.binding.writer(U)}),Mt=P.optional.boolean(s.params.disabled).value,Zt=P.optional.boolean(s.params.hidden).value,hs=r.controller({constraint:_e,document:s.document,initialValue:p.initialValue,params:p.params,value:Qe.value,viewProps:mt.create({disabled:Mt,hidden:Zt})});return new Ft(s.document,{binding:Qe,blade:Dt(),props:he.fromObject({label:"label"in s.params?(l=P.optional.string(s.params.label).value)!==null&&l!==void 0?l:null:s.target.key}),valueController:hs})}function Dp(r,s){return s===0?new gn:new ni(r,s??bo.monitor.defaultInterval)}function zp(r,s){var l,p,P;const U=Ie,ee=r.accept(s.target.read(),s.params);if(g(ee))return null;const _e={target:s.target,initialValue:ee.initialValue,params:ee.params},Fe=r.binding.reader(_e),Qe=(p=(l=U.optional.number(s.params.bufferSize).value)!==null&&l!==void 0?l:r.binding.defaultBufferSize&&r.binding.defaultBufferSize(ee.params))!==null&&p!==void 0?p:1,Mt=U.optional.number(s.params.interval).value,Zt=new os({reader:Fe,target:s.target,ticker:Dp(s.document,Mt),value:Vs(Qe)}),hs=U.optional.boolean(s.params.disabled).value,Hs=U.optional.boolean(s.params.hidden).value,pc=r.controller({document:s.document,params:ee.params,value:Zt.value,viewProps:mt.create({disabled:hs,hidden:Hs})});return new tn(s.document,{binding:Zt,blade:Dt(),props:he.fromObject({label:"label"in s.params?(P=U.optional.string(s.params.label).value)!==null&&P!==void 0?P:null:s.target.key}),valueController:pc})}class Vp{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(s){s.type==="blade"?this.pluginsMap_.blades.unshift(s):s.type==="input"?this.pluginsMap_.inputs.unshift(s):s.type==="monitor"&&this.pluginsMap_.monitors.unshift(s)}createInput(s,l,p){const P=l.read();if(g(P))throw new E({context:{key:l.key},type:"nomatchingcontroller"});const U=this.pluginsMap_.inputs.reduce((ee,_e)=>ee??Ip(_e,{document:s,target:l,params:p}),null);if(U)return U;throw new E({context:{key:l.key},type:"nomatchingcontroller"})}createMonitor(s,l,p){const P=this.pluginsMap_.monitors.reduce((U,ee)=>U??zp(ee,{document:s,params:p,target:l}),null);if(P)return P;throw new E({context:{key:l.key},type:"nomatchingcontroller"})}createBlade(s,l){const p=this.pluginsMap_.blades.reduce((P,U)=>P??rs(U,{document:s,params:l}),null);if(!p)throw new E({type:"nomatchingview",context:{params:l}});return p}createBladeApi(s){if(s instanceof Ft)return new Bt(s);if(s instanceof tn)return new ln(s);if(s instanceof Pt)return new yn(s,this);const l=this.pluginsMap_.blades.reduce((p,P)=>p??P.api({controller:s,pool:this}),null);if(!l)throw E.shouldNeverHappen();return l}}function Np(){const r=new Vp;return[jh,_o,Ap,qo,Er,Mr,vp,dp,x,Pr,Rp,kp,gt,it,Ht,Yi].forEach(s=>{r.register(s)}),r}function Op(r){return lr.isObject(r)?new lr(r.x,r.y):new lr}function cr(r,s){r.writeProperty("x",s.x),r.writeProperty("y",s.y)}function hr(r,s){if(!r)return;const l=[],p=ic(r,s);p&&l.push(p);const P=Rh(r);return P&&l.push(P),new Gn(l)}function Uh(r,s){return new ar({assembly:Or,components:[hr("x"in r?r.x:void 0,s.x),hr("y"in r?r.y:void 0,s.y)]})}function Hh(r,s){const[l,p]=r?_p(r):[];if(!g(l)||!g(p))return Math.max(Math.abs(l??0),Math.abs(p??0));const P=gi(r);return Math.max(Math.abs(P)*10,Math.abs(s)*10)}function Gh(r,s){const l=s instanceof ar?s.components[0]:void 0,p=s instanceof ar?s.components[1]:void 0,P=Hh(l,r.x),U=Hh(p,r.y);return Math.max(P,U)}function Wh(r,s){return{baseStep:gi(s),constraint:s,textProps:he.fromObject({draggingScale:es(s,r),formatter:In(ls(s,r))})}}function Fp(r){if(!("y"in r))return!1;const s=r.y;return s&&"inverted"in s?!!s.inverted:!1}const jh={id:"input-point2d",type:"input",accept:(r,s)=>{if(!lr.isObject(r))return null;const l=Ie,p=rt(s,{expanded:l.optional.boolean,picker:l.optional.custom(ji),x:l.optional.custom(vi),y:l.optional.object({inverted:l.optional.boolean,max:l.optional.number,min:l.optional.number,step:l.optional.number})});return p?{initialValue:r,params:p}:null},binding:{reader:r=>Op,constraint:r=>Uh(r.params,r.initialValue),equals:lr.equals,writer:r=>cr},controller:r=>{const s=r.document,l=r.value,p=r.constraint;if(!(p instanceof ar))throw E.shouldNeverHappen();const P="expanded"in r.params?r.params.expanded:void 0,U="picker"in r.params?r.params.picker:void 0;return new go(s,{axes:[Wh(l.rawValue.x,p.components[0]),Wh(l.rawValue.y,p.components[1])],expanded:P??!1,invertsY:Fp(r.params),maxValue:Gh(l.rawValue,p),parser:Vi,pickerLayout:U??"popup",value:l,viewProps:r.viewProps})}};class uc extends i{constructor(s){super(s),this.emitter_=new R,this.controller_.valueController.value.emitter.on("change",l=>{this.emitter_.emit("change",{event:new a(this,l.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}get options(){return this.controller_.valueController.props.get("options")}set options(s){this.controller_.valueController.props.set("options",s)}get value(){return this.controller_.valueController.value.rawValue}set value(s){this.controller_.valueController.value.rawValue=s}on(s,l){const p=l.bind(this);return this.emitter_.on(s,P=>{p(P.event)}),this}}class dc extends i{constructor(s){super(s),this.emitter_=new R,this.controller_.valueController.value.emitter.on("change",l=>{this.emitter_.emit("change",{event:new a(this,l.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(s){this.controller_.valueController.sliderController.props.set("maxValue",s)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(s){this.controller_.valueController.sliderController.props.set("minValue",s)}get value(){return this.controller_.valueController.value.rawValue}set value(s){this.controller_.valueController.value.rawValue=s}on(s,l){const p=l.bind(this);return this.emitter_.on(s,P=>{p(P.event)}),this}}class Kh extends i{constructor(s){super(s),this.emitter_=new R,this.controller_.valueController.value.emitter.on("change",l=>{this.emitter_.emit("change",{event:new a(this,l.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(s){this.controller_.valueController.props.set("formatter",s)}get value(){return this.controller_.valueController.value.rawValue}set value(s){this.controller_.valueController.value.rawValue=s}on(s,l){const p=l.bind(this);return this.emitter_.on(s,P=>{p(P.event)}),this}}const Bp=function(){return{id:"list",type:"blade",accept(r){const s=Ie,l=rt(r,{options:s.required.custom(Es),value:s.required.raw,view:s.required.constant("list"),label:s.optional.string});return l?{params:l}:null},controller(r){const s=new Bi(ir(r.params.options)),l=de(r.params.value,{constraint:s}),p=new Ei(r.document,{props:new he({options:s.values.value("options")}),value:l,viewProps:r.viewProps});return new ht(r.document,{blade:r.blade,props:he.fromObject({label:r.params.label}),valueController:p})},api(r){return!(r.controller instanceof ht)||!(r.controller.valueController instanceof Ei)?null:new uc(r.controller)}}}();function Up(r){return r.reduce((s,l)=>Object.assign(s,{[l.presetKey]:l.read()}),{})}function Hp(r,s){r.forEach(l=>{const p=s[l.target.presetKey];p!==void 0&&l.writer(l.target,l.reader(p))})}class Gp extends ${constructor(s,l){super(s,l)}get element(){return this.controller_.view.element}importPreset(s){const l=this.controller_.rackController.rack.find(Ft).map(p=>p.binding);Hp(l,s),this.refresh()}exportPreset(){const s=this.controller_.rackController.rack.find(Ft).map(l=>l.binding.target);return Up(s)}refresh(){this.controller_.rackController.rack.find(Ft).forEach(s=>{s.binding.read()}),this.controller_.rackController.rack.find(tn).forEach(s=>{s.binding.read()})}}class Wp extends Ct{constructor(s,l){super(s,{expanded:l.expanded,blade:l.blade,props:l.props,root:!0,viewProps:l.viewProps})}}const jp={id:"slider",type:"blade",accept(r){const s=Ie,l=rt(r,{max:s.required.number,min:s.required.number,view:s.required.constant("slider"),format:s.optional.function,label:s.optional.string,value:s.optional.number});return l?{params:l}:null},controller(r){var s,l;const p=(s=r.params.value)!==null&&s!==void 0?s:0,P=new li({max:r.params.max,min:r.params.min}),U=new ws(r.document,{baseStep:1,parser:Vi,sliderProps:new he({maxValue:P.values.value("max"),minValue:P.values.value("min")}),textProps:he.fromObject({draggingScale:es(void 0,p),formatter:(l=r.params.format)!==null&&l!==void 0?l:Wn}),value:de(p,{constraint:P}),viewProps:r.viewProps});return new ht(r.document,{blade:r.blade,props:he.fromObject({label:r.params.label}),valueController:U})},api(r){return!(r.controller instanceof ht)||!(r.controller.valueController instanceof ws)?null:new dc(r.controller)}},Kp=function(){return{id:"text",type:"blade",accept(r){const s=Ie,l=rt(r,{parse:s.required.function,value:s.required.raw,view:s.required.constant("text"),format:s.optional.function,label:s.optional.string});return l?{params:l}:null},controller(r){var s;const l=new Ui(r.document,{parser:r.params.parse,props:he.fromObject({formatter:(s=r.params.format)!==null&&s!==void 0?s:p=>String(p)}),value:de(r.params.value),viewProps:r.viewProps});return new ht(r.document,{blade:r.blade,props:he.fromObject({label:r.params.label}),valueController:l})},api(r){return!(r.controller instanceof ht)||!(r.controller.valueController instanceof Ui)?null:new Kh(r.controller)}}}();function qh(r){const s=r.createElement("div");return s.classList.add(V("dfw")()),r.body&&r.body.appendChild(s),s}function Xh(r,s,l){if(r.querySelector(`style[data-tp-style=${s}]`))return;const p=r.createElement("style");p.dataset.tpStyle=s,p.textContent=l,r.head.appendChild(p)}class qp extends Gp{constructor(s){var l,p;const P=s??{},U=(l=P.document)!==null&&l!==void 0?l:Xt(),ee=Np(),_e=new Wp(U,{expanded:P.expanded,blade:Dt(),props:he.fromObject({title:P.title}),viewProps:mt.create()});super(_e,ee),this.pool_=ee,this.containerElem_=(p=P.container)!==null&&p!==void 0?p:qh(U),this.containerElem_.appendChild(this.element),this.doc_=U,this.usesDefaultWrapper_=!P.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw E.alreadyDisposed();return this.doc_}dispose(){const s=this.containerElem_;if(!s)throw E.alreadyDisposed();if(this.usesDefaultWrapper_){const l=s.parentElement;l&&l.removeChild(s)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(s){("plugin"in s?[s.plugin]:"plugins"in s?s.plugins:[]).forEach(p=>{this.pool_.register(p),this.embedPluginStyle_(p)})}embedPluginStyle_(s){s.css&&Xh(this.document,`plugin-${s.id}`,s.css)}setUpDefaultPlugins_(){Xh(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(s=>{this.embedPluginStyle_(s)}),this.registerPlugin({plugins:[jp,Bp,Yi,Kp]})}}const m=new n("3.1.10");t.BladeApi=i,t.ButtonApi=L,t.FolderApi=$,t.InputBindingApi=Bt,t.ListApi=uc,t.MonitorBindingApi=ln,t.Pane=qp,t.SeparatorApi=Qt,t.SliderApi=dc,t.TabApi=On,t.TabPageApi=mn,t.TextApi=Kh,t.TpChangeEvent=a,t.VERSION=m,Object.defineProperty(t,"__esModule",{value:!0})})})(Tm,Tm.exports);var iL=Tm.exports,Lm={exports:{}};(function(h,e){(function(t,n){n(e)})(zv,function(t){class n{constructor(w){this.controller_=w}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(w){this.controller_.viewProps.set("disabled",w)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(w){this.controller_.viewProps.set("hidden",w)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class i{constructor(w){this.target=w}}class o extends i{constructor(w,A,N,Y){super(w),this.value=A,this.presetKey=N,this.last=Y??!0}}function a(k){return k}function c(k){return k==null}const u={alreadydisposed:()=>"View has been already disposed",invalidparams:k=>`Invalid parameters for '${k.name}'`,nomatchingcontroller:k=>`No matching controller for '${k.key}'`,nomatchingview:k=>`No matching view for '${JSON.stringify(k.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:k=>`Property '${k.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class d{constructor(w){var A;this.message=(A=u[w.type](w.context))!==null&&A!==void 0?A:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=w.type}static alreadyDisposed(){return new d({type:"alreadydisposed"})}static notBindable(){return new d({type:"notbindable"})}static propertyNotFound(w){return new d({type:"propertynotfound",context:{name:w}})}static shouldNeverHappen(){return new d({type:"shouldneverhappen"})}}class v{constructor(){this.observers_={}}on(w,A){let N=this.observers_[w];return N||(N=this.observers_[w]=[]),N.push({handler:A}),this}off(w,A){const N=this.observers_[w];return N&&(this.observers_[w]=N.filter(Y=>Y.handler!==A)),this}emit(w,A){const N=this.observers_[w];N&&N.forEach(Y=>{Y.handler(A)})}}const g="tp";function b(k){return(A,N)=>[g,"-",k,"v",A?`_${A}`:"",N?`-${N}`:""].join("")}function y(k,w){return A=>w(k(A))}function S(k){return k.rawValue}function E(k,w){k.emitter.on("change",y(S,w)),w(k.rawValue)}function M(k,w,A){E(k.value(w),A)}function L(k,w,A){A?k.classList.add(w):k.classList.remove(w)}function R(k,w){return A=>{L(k,w,A)}}function z(k,w){E(k,A=>{w.textContent=A??""})}const V=b("btn");class H{constructor(w,A){this.element=w.createElement("div"),this.element.classList.add(V()),A.viewProps.bindClassModifiers(this.element);const N=w.createElement("button");N.classList.add(V("b")),A.viewProps.bindDisabled(N),this.element.appendChild(N),this.buttonElement=N;const Y=w.createElement("div");Y.classList.add(V("t")),z(A.props.value("title"),Y),this.buttonElement.appendChild(Y)}}class B{constructor(w,A){this.emitter=new v,this.onClick_=this.onClick_.bind(this),this.props=A.props,this.viewProps=A.viewProps,this.view=new H(w,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class j{constructor(w,A){var N;this.constraint_=A?.constraint,this.equals_=(N=A?.equals)!==null&&N!==void 0?N:(Y,re)=>Y===re,this.emitter=new v,this.rawValue_=w}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(w){this.setRawValue(w,{forceEmit:!1,last:!0})}setRawValue(w,A){const N=A??{forceEmit:!1,last:!0},Y=this.constraint_?this.constraint_.constrain(w):w,re=this.rawValue_;this.equals_(re,Y)&&!N.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Y,this.emitter.emit("change",{options:N,previousRawValue:re,rawValue:Y,sender:this}))}}class F{constructor(w){this.emitter=new v,this.value_=w}get rawValue(){return this.value_}set rawValue(w){this.setRawValue(w,{forceEmit:!1,last:!0})}setRawValue(w,A){const N=A??{forceEmit:!1,last:!0},Y=this.value_;Y===w&&!N.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=w,this.emitter.emit("change",{options:N,previousRawValue:Y,rawValue:this.value_,sender:this}))}}function W(k,w){const A=w?.constraint,N=w?.equals;return!A&&!N?new F(k):new j(k,w)}class Z{constructor(w){this.emitter=new v,this.valMap_=w;for(const A in this.valMap_)this.valMap_[A].emitter.on("change",()=>{this.emitter.emit("change",{key:A,sender:this})})}static createCore(w){return Object.keys(w).reduce((N,Y)=>Object.assign(N,{[Y]:W(w[Y])}),{})}static fromObject(w){const A=this.createCore(w);return new Z(A)}get(w){return this.valMap_[w].rawValue}set(w,A){this.valMap_[w].rawValue=A}value(w){return this.valMap_[w]}}function se(k,w){const N=Object.keys(w).reduce((Y,re)=>{if(Y===void 0)return;const Ce=w[re],Ke=Ce(k[re]);return Ke.succeeded?Object.assign(Object.assign({},Y),{[re]:Ke.value}):void 0},{});return N}function we(k,w){return k.reduce((A,N)=>{if(A===void 0)return;const Y=w(N);if(!(!Y.succeeded||Y.value===void 0))return[...A,Y.value]},[])}function oe(k){return k===null?!1:typeof k=="object"}function ne(k){return w=>A=>{if(!w&&A===void 0)return{succeeded:!1,value:void 0};if(w&&A===void 0)return{succeeded:!0,value:void 0};const N=k(A);return N!==void 0?{succeeded:!0,value:N}:{succeeded:!1,value:void 0}}}function ce(k){return{custom:w=>ne(w)(k),boolean:ne(w=>typeof w=="boolean"?w:void 0)(k),number:ne(w=>typeof w=="number"?w:void 0)(k),string:ne(w=>typeof w=="string"?w:void 0)(k),function:ne(w=>typeof w=="function"?w:void 0)(k),constant:w=>ne(A=>A===w?w:void 0)(k),raw:ne(w=>w)(k),object:w=>ne(A=>{if(oe(A))return se(A,w)})(k),array:w=>ne(A=>{if(Array.isArray(A))return we(A,w)})(k)}}const ve={optional:ce(!0),required:ce(!1)};function de(k,w){const A=ve.required.object(w)(k);return A.succeeded?A.value:void 0}function he(k){console.warn([`Missing '${k.key}' of ${k.target} in ${k.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function ue(k){return k&&k.parentElement&&k.parentElement.removeChild(k),null}class me{constructor(w){this.value_=w}static create(w){return[new me(w),(A,N)=>{w.setRawValue(A,N)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const ze=b("");function Te(k,w){return R(k,ze(void 0,w))}class Re extends Z{constructor(w){var A;super(w),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=me.create(W(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(A=this.get("parent"))===null||A===void 0||A.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(w){var A,N,Y;const re=w??{};return new Re(Z.createCore({disabled:(A=re.disabled)!==null&&A!==void 0?A:!1,disposed:!1,hidden:(N=re.hidden)!==null&&N!==void 0?N:!1,parent:(Y=re.parent)!==null&&Y!==void 0?Y:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(w){E(this.globalDisabled_,Te(w,"disabled")),M(this,"hidden",Te(w,"hidden"))}bindDisabled(w){E(this.globalDisabled_,A=>{w.disabled=A})}bindTabIndex(w){E(this.globalDisabled_,A=>{w.tabIndex=A?-1:0})}handleDispose(w){this.value("disposed").emitter.on("change",A=>{A&&w()})}getGlobalDisabled_(){const w=this.get("parent");return(w?w.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(w){var A;const N=w.previousRawValue;N?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(A=this.get("parent"))===null||A===void 0||A.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function Ie(){return["veryfirst","first","last","verylast"]}const rt=b(""),Ae={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class pt{constructor(w){this.parent_=null,this.blade=w.blade,this.view=w.view,this.viewProps=w.viewProps;const A=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Ie().forEach(N=>{A.classList.remove(rt(void 0,Ae[N]))}),this.blade.get("positions").forEach(N=>{A.classList.add(rt(void 0,Ae[N]))})}),this.viewProps.handleDispose(()=>{ue(A)})}get parent(){return this.parent_}set parent(w){if(this.parent_=w,!("parent"in this.viewProps.valMap_)){he({key:"parent",target:Re.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const nt="http://www.w3.org/2000/svg";function Et(k){k.offsetHeight}function He(k,w){const A=k.style.transition;k.style.transition="none",w(),k.style.transition=A}function mt(k){return k.ontouchstart!==void 0}function ke(k){for(;k.childNodes.length>0;)k.removeChild(k.childNodes[0])}function xe(k){return k.relatedTarget?k.relatedTarget:"explicitOriginalTarget"in k?k.explicitOriginalTarget:null}const Ve=b("lbl");function Ye(k,w){const A=k.createDocumentFragment();return w.split(`
`).map(Y=>k.createTextNode(Y)).forEach((Y,re)=>{re>0&&A.appendChild(k.createElement("br")),A.appendChild(Y)}),A}class Oe{constructor(w,A){this.element=w.createElement("div"),this.element.classList.add(Ve()),A.viewProps.bindClassModifiers(this.element);const N=w.createElement("div");N.classList.add(Ve("l")),M(A.props,"label",re=>{c(re)?this.element.classList.add(Ve(void 0,"nol")):(this.element.classList.remove(Ve(void 0,"nol")),ke(N),N.appendChild(Ye(w,re)))}),this.element.appendChild(N),this.labelElement=N;const Y=w.createElement("div");Y.classList.add(Ve("v")),this.element.appendChild(Y),this.valueElement=Y}}class St extends pt{constructor(w,A){const N=A.valueController.viewProps;super(Object.assign(Object.assign({},A),{view:new Oe(w,{props:A.props,viewProps:N}),viewProps:N})),this.props=A.props,this.valueController=A.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class vt extends pt{constructor(w){super(w),this.value=w.value}}class dt extends Z{constructor(w){super(w)}static create(w){const A={completed:!0,expanded:w,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},N=Z.createCore(A);return new dt(N)}get styleExpanded(){var w;return(w=this.get("temporaryExpanded"))!==null&&w!==void 0?w:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const w=this.get("expandedHeight");return this.get("shouldFixHeight")&&!c(w)?`${w}px`:"auto"}bindExpandedClass(w,A){const N=()=>{this.styleExpanded?w.classList.add(A):w.classList.remove(A)};M(this,"expanded",N),M(this,"temporaryExpanded",N)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function en(k){return dt.create(k)}function Xt(k,w){let A=0;return He(w,()=>{k.set("expandedHeight",null),k.set("temporaryExpanded",!0),Et(w),A=w.clientHeight,k.set("temporaryExpanded",null),Et(w)}),A}function Q(k,w){w.style.height=k.styleHeight}function q(k,w){k.value("expanded").emitter.on("beforechange",()=>{k.set("completed",!1),c(k.get("expandedHeight"))&&k.set("expandedHeight",Xt(k,w)),k.set("shouldFixHeight",!0),Et(w)}),k.emitter.on("change",()=>{Q(k,w)}),Q(k,w),w.addEventListener("transitionend",A=>{A.propertyName==="height"&&k.cleanUpTransition()})}class ge{constructor(w,A){const N=b(A.viewName);this.element=w.createElement("div"),this.element.classList.add(N()),A.viewProps.bindClassModifiers(this.element)}}class Ne extends vt{constructor(w,A){const N=A.valueController.viewProps;super(Object.assign(Object.assign({},A),{value:A.valueController.value,view:new Oe(w,{props:A.props,viewProps:N}),viewProps:N})),this.props=A.props,this.valueController=A.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class je{constructor(){this.disabled=!1,this.emitter=new v}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Ze{constructor(w,A){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=w,this.emitter=new v,this.interval_=A,this.setTimer_()}get disabled(){return this.disabled_}set disabled(w){this.disabled_=w,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const w=this.doc_.defaultView;w&&w.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const w=this.doc_.defaultView;w&&(this.timerId_=w.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class wt{constructor(w){this.constraints=w}constrain(w){return this.constraints.reduce((A,N)=>N.constrain(A),w)}}function qe(k,w){if(k instanceof w)return k;if(k instanceof wt){const A=k.constraints.reduce((N,Y)=>N||(Y instanceof w?Y:null),null);if(A)return A}return null}class Pe{constructor(w){this.values=Z.fromObject({max:w.max,min:w.min})}constrain(w){const A=this.values.get("max"),N=this.values.get("min");return Math.min(Math.max(w,N),A)}}class ct{constructor(w){this.values=Z.fromObject({max:w.max,min:w.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(w){const A=this.values.get("max"),N=this.values.get("min");let Y=w;return c(N)||(Y=Math.max(Y,N)),c(A)||(Y=Math.min(Y,A)),Y}}class ft{constructor(w,A=0){this.step=w,this.origin=A}constrain(w){const A=this.origin%this.step,N=Math.round((w-A)/this.step);return A+N*this.step}}const lt=b("pop");class gt{constructor(w,A){this.element=w.createElement("div"),this.element.classList.add(lt()),A.viewProps.bindClassModifiers(this.element),E(A.shows,R(this.element,lt(void 0,"v")))}}class yt{constructor(w,A){this.shows=W(!1),this.viewProps=A.viewProps,this.view=new gt(w,{shows:this.shows,viewProps:this.viewProps})}}const Dt=b("txt");class ie{constructor(w,A){this.onChange_=this.onChange_.bind(this),this.element=w.createElement("div"),this.element.classList.add(Dt()),A.viewProps.bindClassModifiers(this.element),this.props_=A.props,this.props_.emitter.on("change",this.onChange_);const N=w.createElement("input");N.classList.add(Dt("i")),N.type="text",A.viewProps.bindDisabled(N),this.element.appendChild(N),this.inputElement=N,A.value.emitter.on("change",this.onChange_),this.value_=A.value,this.refresh()}refresh(){const w=this.props_.get("formatter");this.inputElement.value=w(this.value_.rawValue)}onChange_(){this.refresh()}}class at{constructor(w,A){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=A.parser,this.props=A.props,this.value=A.value,this.viewProps=A.viewProps,this.view=new ie(w,{props:A.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(w){const N=w.currentTarget.value,Y=this.parser_(N);c(Y)||(this.value.rawValue=Y),this.view.refresh()}}function Ge(k){return k==="false"?!1:!!k}class Le{constructor(w){this.text=w}evaluate(){return Number(this.text)}toString(){return this.text}}const We={"**":(k,w)=>Math.pow(k,w),"*":(k,w)=>k*w,"/":(k,w)=>k/w,"%":(k,w)=>k%w,"+":(k,w)=>k+w,"-":(k,w)=>k-w,"<<":(k,w)=>k<<w,">>":(k,w)=>k>>w,">>>":(k,w)=>k>>>w,"&":(k,w)=>k&w,"^":(k,w)=>k^w,"|":(k,w)=>k|w};class _t{constructor(w,A,N){this.left=A,this.operator=w,this.right=N}evaluate(){const w=We[this.operator];if(!w)throw new Error(`unexpected binary operator: '${this.operator}`);return w(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Yt={"+":k=>k,"-":k=>-k,"~":k=>~k};class an{constructor(w,A){this.operator=w,this.expression=A}evaluate(){const w=Yt[this.operator];if(!w)throw new Error(`unexpected unary operator: '${this.operator}`);return w(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function xn(k){return(w,A)=>{for(let N=0;N<k.length;N++){const Y=k[N](w,A);if(Y!=="")return Y}return""}}function Gt(k,w){var A;const N=k.substr(w).match(/^\s+/);return(A=N&&N[0])!==null&&A!==void 0?A:""}function Bt(k,w){const A=k.substr(w,1);return A.match(/^[1-9]$/)?A:""}function Ft(k,w){var A;const N=k.substr(w).match(/^[0-9]+/);return(A=N&&N[0])!==null&&A!==void 0?A:""}function ln(k,w){const A=Ft(k,w);if(A!=="")return A;const N=k.substr(w,1);if(w+=1,N!=="-"&&N!=="+")return"";const Y=Ft(k,w);return Y===""?"":N+Y}function tn(k,w){const A=k.substr(w,1);if(w+=1,A.toLowerCase()!=="e")return"";const N=ln(k,w);return N===""?"":A+N}function xi(k,w){const A=k.substr(w,1);if(A==="0")return A;const N=Bt(k,w);return w+=N.length,N===""?"":N+Ft(k,w)}function yi(k,w){const A=xi(k,w);if(w+=A.length,A==="")return"";const N=k.substr(w,1);if(w+=N.length,N!==".")return"";const Y=Ft(k,w);return w+=Y.length,A+N+Y+tn(k,w)}function Nn(k,w){const A=k.substr(w,1);if(w+=A.length,A!==".")return"";const N=Ft(k,w);return w+=N.length,N===""?"":A+N+tn(k,w)}function yn(k,w){const A=xi(k,w);return w+=A.length,A===""?"":A+tn(k,w)}const $=xn([yi,Nn,yn]);function pe(k,w){var A;const N=k.substr(w).match(/^[01]+/);return(A=N&&N[0])!==null&&A!==void 0?A:""}function Me(k,w){const A=k.substr(w,2);if(w+=A.length,A.toLowerCase()!=="0b")return"";const N=pe(k,w);return N===""?"":A+N}function le(k,w){var A;const N=k.substr(w).match(/^[0-7]+/);return(A=N&&N[0])!==null&&A!==void 0?A:""}function Se(k,w){const A=k.substr(w,2);if(w+=A.length,A.toLowerCase()!=="0o")return"";const N=le(k,w);return N===""?"":A+N}function ut(k,w){var A;const N=k.substr(w).match(/^[0-9a-f]+/i);return(A=N&&N[0])!==null&&A!==void 0?A:""}function At(k,w){const A=k.substr(w,2);if(w+=A.length,A.toLowerCase()!=="0x")return"";const N=ut(k,w);return N===""?"":A+N}const zt=xn([Me,Se,At]),xt=xn([zt,$]);function Pt(k,w){const A=xt(k,w);return w+=A.length,A===""?null:{evaluable:new Le(A),cursor:w}}function Je(k,w){const A=k.substr(w,1);if(w+=A.length,A!=="(")return null;const N=ot(k,w);if(!N)return null;w=N.cursor,w+=Gt(k,w).length;const Y=k.substr(w,1);return w+=Y.length,Y!==")"?null:{evaluable:N.evaluable,cursor:w}}function et(k,w){var A;return(A=Pt(k,w))!==null&&A!==void 0?A:Je(k,w)}function Ct(k,w){const A=et(k,w);if(A)return A;const N=k.substr(w,1);if(w+=N.length,N!=="+"&&N!=="-"&&N!=="~")return null;const Y=Ct(k,w);return Y?(w=Y.cursor,{cursor:w,evaluable:new an(N,Y.evaluable)}):null}function it(k,w,A){A+=Gt(w,A).length;const N=k.filter(Y=>w.startsWith(Y,A))[0];return N?(A+=N.length,A+=Gt(w,A).length,{cursor:A,operator:N}):null}function ht(k,w){return(A,N)=>{const Y=k(A,N);if(!Y)return null;N=Y.cursor;let re=Y.evaluable;for(;;){const Ce=it(w,A,N);if(!Ce)break;N=Ce.cursor;const Ke=k(A,N);if(!Ke)return null;N=Ke.cursor,re=new _t(Ce.operator,re,Ke.evaluable)}return re?{cursor:N,evaluable:re}:null}}const Qt=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((k,w)=>ht(k,w),Ct);function ot(k,w){return w+=Gt(k,w).length,Qt(k,w)}function Ue(k){const w=ot(k,0);return!w||w.cursor+Gt(k,w.cursor).length!==k.length?null:w.evaluable}function Cn(k){var w;const A=Ue(k);return(w=A?.evaluate())!==null&&w!==void 0?w:null}function Ht(k){if(typeof k=="number")return k;if(typeof k=="string"){const w=Cn(k);if(!c(w))return w}return 0}function Ut(k){return w=>w.toFixed(Math.max(Math.min(k,20),0))}const fn=Ut(0);function Mn(k){return fn(k)+"%"}function Ci(k){return String(k)}function mn(k,w){for(;k.length<w;)k.push(void 0)}function On(k){const w=[];return mn(w,k),W(w)}function Un(k){const w=k.indexOf(void 0);return w<0?k:k.slice(0,w)}function un(k,w){const A=[...Un(k),w];return A.length>k.length?A.splice(0,A.length-k.length):mn(A,k.length),A}function Hn({primary:k,secondary:w,forward:A,backward:N}){let Y=!1;function re(Ce){Y||(Y=!0,Ce(),Y=!1)}k.emitter.on("change",Ce=>{re(()=>{w.setRawValue(A(k,w),Ce.options)})}),w.emitter.on("change",Ce=>{re(()=>{k.setRawValue(N(k,w),Ce.options)}),re(()=>{w.setRawValue(A(k,w),Ce.options)})}),re(()=>{w.setRawValue(A(k,w),{forceEmit:!1,last:!0})})}function kn(k,w){const A=k*(w.altKey?.1:1)*(w.shiftKey?10:1);return w.upKey?+A:w.downKey?-A:0}function Rn(k){return{altKey:k.altKey,downKey:k.key==="ArrowDown",shiftKey:k.shiftKey,upKey:k.key==="ArrowUp"}}function Yi(k){return{altKey:k.altKey,downKey:k.key==="ArrowLeft",shiftKey:k.shiftKey,upKey:k.key==="ArrowRight"}}function rs(k){return k==="ArrowUp"||k==="ArrowDown"}function gn(k){return rs(k)||k==="ArrowLeft"||k==="ArrowRight"}function ni(k,w){var A,N;const Y=w.ownerDocument.defaultView,re=w.getBoundingClientRect();return{x:k.pageX-(((A=Y&&Y.scrollX)!==null&&A!==void 0?A:0)+re.left),y:k.pageY-(((N=Y&&Y.scrollY)!==null&&N!==void 0?N:0)+re.top)}}class Pn{constructor(w){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=w,this.emitter=new v,w.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),w.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),w.addEventListener("touchend",this.onTouchEnd_),w.addEventListener("mousedown",this.onMouseDown_)}computePosition_(w){const A=this.elem_.getBoundingClientRect();return{bounds:{width:A.width,height:A.height},point:w?{x:w.x,y:w.y}:null}}onMouseDown_(w){var A;w.preventDefault(),(A=w.currentTarget)===null||A===void 0||A.focus();const N=this.elem_.ownerDocument;N.addEventListener("mousemove",this.onDocumentMouseMove_),N.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:w.altKey,data:this.computePosition_(ni(w,this.elem_)),sender:this,shiftKey:w.shiftKey})}onDocumentMouseMove_(w){this.emitter.emit("move",{altKey:w.altKey,data:this.computePosition_(ni(w,this.elem_)),sender:this,shiftKey:w.shiftKey})}onDocumentMouseUp_(w){const A=this.elem_.ownerDocument;A.removeEventListener("mousemove",this.onDocumentMouseMove_),A.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:w.altKey,data:this.computePosition_(ni(w,this.elem_)),sender:this,shiftKey:w.shiftKey})}onTouchStart_(w){w.preventDefault();const A=w.targetTouches.item(0),N=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:w.altKey,data:this.computePosition_(A?{x:A.clientX-N.left,y:A.clientY-N.top}:void 0),sender:this,shiftKey:w.shiftKey}),this.lastTouch_=A}onTouchMove_(w){const A=w.targetTouches.item(0),N=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:w.altKey,data:this.computePosition_(A?{x:A.clientX-N.left,y:A.clientY-N.top}:void 0),sender:this,shiftKey:w.shiftKey}),this.lastTouch_=A}onTouchEnd_(w){var A;const N=(A=w.targetTouches.item(0))!==null&&A!==void 0?A:this.lastTouch_,Y=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:w.altKey,data:this.computePosition_(N?{x:N.clientX-Y.left,y:N.clientY-Y.top}:void 0),sender:this,shiftKey:w.shiftKey})}}function qt(k,w,A,N,Y){const re=(k-w)/(A-w);return N+re*(Y-N)}function Vs(k){return String(k.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Zi(k,w,A){return Math.min(Math.max(k,w),A)}const Fn=b("txt");class os{constructor(w,A){this.onChange_=this.onChange_.bind(this),this.props_=A.props,this.props_.emitter.on("change",this.onChange_),this.element=w.createElement("div"),this.element.classList.add(Fn(),Fn(void 0,"num")),A.arrayPosition&&this.element.classList.add(Fn(void 0,A.arrayPosition)),A.viewProps.bindClassModifiers(this.element);const N=w.createElement("input");N.classList.add(Fn("i")),N.type="text",A.viewProps.bindDisabled(N),this.element.appendChild(N),this.inputElement=N,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=A.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Fn()),this.inputElement.classList.add(Fn("i"));const Y=w.createElement("div");Y.classList.add(Fn("k")),this.element.appendChild(Y),this.knobElement=Y;const re=w.createElementNS(nt,"svg");re.classList.add(Fn("g")),this.knobElement.appendChild(re);const Ce=w.createElementNS(nt,"path");Ce.classList.add(Fn("gb")),re.appendChild(Ce),this.guideBodyElem_=Ce;const Ke=w.createElementNS(nt,"path");Ke.classList.add(Fn("gh")),re.appendChild(Ke),this.guideHeadElem_=Ke;const nn=w.createElement("div");nn.classList.add(b("tt")()),this.knobElement.appendChild(nn),this.tooltipElem_=nn,A.value.emitter.on("change",this.onChange_),this.value=A.value,this.refresh()}onDraggingChange_(w){if(w.rawValue===null){this.element.classList.remove(Fn(void 0,"drg"));return}this.element.classList.add(Fn(void 0,"drg"));const A=w.rawValue/this.props_.get("draggingScale"),N=A+(A>0?-1:A<0?1:0),Y=Zi(-N,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${N+Y},0 L${N},4 L${N+Y},8`,`M ${A},-1 L${A},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${A},4`);const re=this.props_.get("formatter");this.tooltipElem_.textContent=re(this.value.rawValue),this.tooltipElem_.style.left=`${A}px`}refresh(){const w=this.props_.get("formatter");this.inputElement.value=w(this.value.rawValue)}onChange_(){this.refresh()}}class Gn{constructor(w,A){var N;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=A.baseStep,this.parser_=A.parser,this.props=A.props,this.sliderProps_=(N=A.sliderProps)!==null&&N!==void 0?N:null,this.value=A.value,this.viewProps=A.viewProps,this.dragging_=W(null),this.view=new os(w,{arrayPosition:A.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Y=new Pn(this.view.knobElement);Y.emitter.on("down",this.onPointerDown_),Y.emitter.on("move",this.onPointerMove_),Y.emitter.on("up",this.onPointerUp_)}constrainValue_(w){var A,N;const Y=(A=this.sliderProps_)===null||A===void 0?void 0:A.get("minValue"),re=(N=this.sliderProps_)===null||N===void 0?void 0:N.get("maxValue");let Ce=w;return Y!==void 0&&(Ce=Math.max(Ce,Y)),re!==void 0&&(Ce=Math.min(Ce,re)),Ce}onInputChange_(w){const N=w.currentTarget.value,Y=this.parser_(N);c(Y)||(this.value.rawValue=this.constrainValue_(Y)),this.view.refresh()}onInputKeyDown_(w){const A=kn(this.baseStep_,Rn(w));A!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+A),{forceEmit:!1,last:!1})}onInputKeyUp_(w){kn(this.baseStep_,Rn(w))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(w){if(!w.point)return null;const A=w.point.x-w.bounds.width/2;return this.constrainValue_(this.originRawValue_+A*this.props.get("draggingScale"))}onPointerMove_(w){const A=this.computeDraggingValue_(w.data);A!==null&&(this.value.setRawValue(A,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(w){const A=this.computeDraggingValue_(w.data);A!==null&&(this.value.setRawValue(A,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function En(k,w){k.write(w)}function li(k){const w=k?qe(k,ft):null;return w?w.step:null}function Bi(k,w){const A=k&&qe(k,ft);return A?Vs(A.step):Math.max(Vs(w),2)}function qn(k){const w=li(k);return w??1}function Xn(k,w){var A;const N=k&&qe(k,ft),Y=Math.abs((A=N?.step)!==null&&A!==void 0?A:w);return Y===0?.1:Math.pow(10,Math.floor(Math.log10(Y))-1)}function Ji(k){return[k[0],k[1],k[2]]}function Mi(k){const w=Zi(Math.floor(k),0,255).toString(16);return w.length===1?`0${w}`:w}function Ei(k,w="#"){const A=Ji(k.getComponents("rgb")).map(Mi).join("");return`${w}${A}`}function Ns(k,w="#"){const A=k.getComponents("rgb"),N=[A[0],A[1],A[2],A[3]*255].map(Mi).join("");return`${w}${N}`}function Os(k,w){const A=Ut(w==="float"?2:0);return`rgb(${Ji(k.getComponents("rgb",w)).map(Y=>A(Y)).join(", ")})`}function ci(k){return w=>Os(w,k)}function Si(k,w){const A=Ut(2),N=Ut(w==="float"?2:0);return`rgba(${k.getComponents("rgb",w).map((re,Ce)=>(Ce===3?A:N)(re)).join(", ")})`}function Qi(k){return w=>Si(w,k)}function Ui(k){const w=[Ut(0),Mn,Mn];return`hsl(${Ji(k.getComponents("hsl")).map((N,Y)=>w[Y](N)).join(", ")})`}function hi(k){const w=[Ut(0),Mn,Mn,Ut(2)];return`hsla(${k.getComponents("hsl").map((N,Y)=>w[Y](N)).join(", ")})`}function $n(k,w){const A=Ut(w==="float"?2:0),N=["r","g","b"];return`{${Ji(k.getComponents("rgb",w)).map((re,Ce)=>`${N[Ce]}: ${A(re)}`).join(", ")}}`}function fs(k){return w=>$n(w,k)}function Fs(k,w){const A=Ut(2),N=Ut(w==="float"?2:0),Y=["r","g","b","a"];return`{${k.getComponents("rgb",w).map((Ce,Ke)=>{const nn=Ke===3?A:N;return`${Y[Ke]}: ${nn(Ce)}`}).join(", ")}}`}function Zs(k){return w=>Fs(w,k)}[...["int","float"].reduce((k,w)=>[...k,{format:{alpha:!1,mode:"rgb",notation:"func",type:w},stringifier:ci(w)},{format:{alpha:!0,mode:"rgb",notation:"func",type:w},stringifier:Qi(w)},{format:{alpha:!1,mode:"rgb",notation:"object",type:w},stringifier:fs(w)},{format:{alpha:!0,mode:"rgb",notation:"object",type:w},stringifier:Zs(w)}],[])];class Ai{constructor(w){this.components=w.components,this.asm_=w.assembly}constrain(w){const A=this.asm_.toComponents(w).map((N,Y)=>{var re,Ce;return(Ce=(re=this.components[Y])===null||re===void 0?void 0:re.constrain(N))!==null&&Ce!==void 0?Ce:N});return this.asm_.fromComponents(A)}}const ms=b("pndtxt");class Hi{constructor(w,A){this.textViews=A.textViews,this.element=w.createElement("div"),this.element.classList.add(ms()),this.textViews.forEach(N=>{const Y=w.createElement("div");Y.classList.add(ms("a")),Y.appendChild(N.element),this.element.appendChild(Y)})}}function Yn(k,w,A){return new Gn(k,{arrayPosition:A===0?"fst":A===w.axes.length-1?"lst":"mid",baseStep:w.axes[A].baseStep,parser:w.parser,props:w.axes[A].textProps,value:W(0,{constraint:w.axes[A].constraint}),viewProps:w.viewProps})}class Pi{constructor(w,A){this.value=A.value,this.viewProps=A.viewProps,this.acs_=A.axes.map((N,Y)=>Yn(w,A,Y)),this.acs_.forEach((N,Y)=>{Hn({primary:this.value,secondary:N.value,forward:re=>A.assembly.toComponents(re.rawValue)[Y],backward:(re,Ce)=>{const Ke=A.assembly.toComponents(re.rawValue);return Ke[Y]=Ce.rawValue,A.assembly.fromComponents(Ke)}})}),this.view=new Hi(w,{textViews:this.acs_.map(N=>N.view)})}}function Gi(k,w){return"step"in k&&!c(k.step)?new ft(k.step,w):null}function G(k){return!c(k.max)&&!c(k.min)?new Pe({max:k.max,min:k.min}):!c(k.max)||!c(k.min)?new ct({max:k.max,min:k.min}):null}const _={monitor:{defaultInterval:200,defaultLineCount:3}},f=b("grl");class C{constructor(w,A){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=w.createElement("div"),this.element.classList.add(f()),A.viewProps.bindClassModifiers(this.element),this.formatter_=A.formatter,this.props_=A.props,this.cursor_=A.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const N=w.createElementNS(nt,"svg");N.classList.add(f("g")),N.style.height=`calc(var(--bld-us) * ${A.lineCount})`,this.element.appendChild(N),this.svgElem_=N;const Y=w.createElementNS(nt,"polyline");this.svgElem_.appendChild(Y),this.lineElem_=Y;const re=w.createElement("div");re.classList.add(f("t"),b("tt")()),this.element.appendChild(re),this.tooltipElem_=re,A.value.emitter.on("change",this.onValueUpdate_),this.value=A.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const w=this.svgElem_.getBoundingClientRect(),A=this.value.rawValue.length-1,N=this.props_.get("minValue"),Y=this.props_.get("maxValue"),re=[];this.value.rawValue.forEach((Rt,Vt)=>{if(Rt===void 0)return;const Us=qt(Vt,0,A,0,w.width),Al=qt(Rt,N,Y,w.height,0);re.push([Us,Al].join(","))}),this.lineElem_.setAttributeNS(null,"points",re.join(" "));const Ce=this.tooltipElem_,Ke=this.value.rawValue[this.cursor_.rawValue];if(Ke===void 0){Ce.classList.remove(f("t","a"));return}const nn=qt(this.cursor_.rawValue,0,A,0,w.width),Li=qt(Ke,N,Y,w.height,0);Ce.style.left=`${nn}px`,Ce.style.top=`${Li}px`,Ce.textContent=`${this.formatter_(Ke)}`,Ce.classList.contains(f("t","a"))||(Ce.classList.add(f("t","a"),f("t","in")),Et(Ce),Ce.classList.remove(f("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class D{constructor(w,A){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=A.props,this.value=A.value,this.viewProps=A.viewProps,this.cursor_=W(-1),this.view=new C(w,{cursor:this.cursor_,formatter:A.formatter,lineCount:A.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!mt(w))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const N=new Pn(this.view.element);N.emitter.on("down",this.onGraphPointerDown_),N.emitter.on("move",this.onGraphPointerMove_),N.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(w){const A=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(qt(w.offsetX,0,A.width,0,this.value.rawValue.length))}onGraphPointerDown_(w){this.onGraphPointerMove_(w)}onGraphPointerMove_(w){if(!w.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(qt(w.data.point.x,0,w.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}class K{constructor(w){this.controller_=w}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(w){this.controller_.viewProps.set("disabled",w)}get title(){var w;return(w=this.controller_.props.get("title"))!==null&&w!==void 0?w:""}set title(w){this.controller_.props.set("title",w)}on(w,A){const N=A.bind(this);return this.controller_.emitter.on(w,()=>{N(new i(this))}),this}}class te extends i{constructor(w,A,N){super(w),this.cell=A,this.index=N}}class fe extends n{constructor(w){super(w),this.cellToApiMap_=new Map,this.emitter_=new v;const A=this.controller_.valueController;A.cellControllers.forEach((N,Y)=>{const re=new K(N);this.cellToApiMap_.set(N,re),N.emitter.on("click",()=>{const Ce=Y%A.size[0],Ke=Math.floor(Y/A.size[0]);this.emitter_.emit("click",{event:new te(this,re,[Ce,Ke])})})})}cell(w,A){const N=this.controller_.valueController,Y=N.cellControllers[A*N.size[0]+w];return this.cellToApiMap_.get(Y)}on(w,A){const N=A.bind(this);return this.emitter_.on(w,Y=>{N(Y.event)}),this}}class be{constructor(w,A){this.size=A.size;const[N,Y]=this.size,re=[];for(let Ce=0;Ce<Y;Ce++)for(let Ke=0;Ke<N;Ke++){const nn=new B(w,{props:Z.fromObject(Object.assign({},A.cellConfig(Ke,Ce))),viewProps:Re.create()});re.push(nn)}this.cellCs_=re,this.viewProps=Re.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(Ce=>{Ce.viewProps.set("disposed",!0)})}),this.view=new ge(w,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${N}, 1fr)`,this.cellCs_.forEach(Ce=>{this.view.element.appendChild(Ce.view.element)})}get cellControllers(){return this.cellCs_}}const Ee={id:"buttongrid",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(k){const w=ve,A=de(k,{cells:w.required.function,size:w.required.array(w.required.number),view:w.required.constant("buttongrid"),label:w.optional.string});return A?{params:A}:null},controller(k){return new St(k.document,{blade:k.blade,props:Z.fromObject({label:k.params.label}),valueController:new be(k.document,{cellConfig:k.params.cells,size:k.params.size})})},api(k){return!(k.controller instanceof St)||!(k.controller.valueController instanceof be)?null:new fe(k.controller)}};class Be extends n{get label(){return this.controller_.props.get("label")}set label(w){this.controller_.props.set("label",w)}get value(){return this.controller_.valueController.value.rawValue}set value(w){this.controller_.valueController.value.rawValue=w}on(w,A){const N=A.bind(this);return this.controller_.valueController.value.emitter.on(w,Y=>{N(new o(this,Y.rawValue,void 0,Y.options.last))}),this}}function st(k,w,A){return k*(1-A)+w*A}const Lt=20,Ot=.001,$t=100;function dn(k,w){let A=.25,N=.5,Y=-1;for(let re=0;re<Lt;re++){const[Ce,Ke]=k.curve(N);if(N+=A*(Ce<w?1:-1),Y=Ke,A*=.5,Math.abs(w-Ce)<Ot)break}return Y}class kt{constructor(w=0,A=0,N=1,Y=1){this.cache_=[],this.comps_=[w,A,N,Y]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(w){return c(w)||!Array.isArray(w)?!1:typeof w[0]=="number"&&typeof w[1]=="number"&&typeof w[2]=="number"&&typeof w[3]=="number"}static equals(w,A){return w.x1===A.x1&&w.y1===A.y1&&w.x2===A.x2&&w.y2===A.y2}curve(w){const A=st(0,this.x1,w),N=st(0,this.y1,w),Y=st(this.x1,this.x2,w),re=st(this.y1,this.y2,w),Ce=st(this.x2,1,w),Ke=st(this.y2,1,w),nn=st(A,Y,w),Li=st(N,re,w),Rt=st(Y,Ce,w),Vt=st(re,Ke,w);return[st(nn,Rt,w),st(Li,Vt,w)]}y(w){if(this.cache_.length===0){const A=[];for(let N=0;N<$t;N++)A.push(dn(this,qt(N,0,$t-1,0,1)));this.cache_=A}return this.cache_[Math.round(qt(Zi(w,0,1),0,1,0,$t-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const Kt={toComponents:k=>k.toObject(),fromComponents:k=>new kt(...k)};function ui(k){const w=Ut(2);return`cubic-bezier(${k.toObject().map(N=>w(N)).join(", ")})`}const zr=[0,.5,.5,1];function uo(k){const w=k.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!w)return new kt(...zr);const A=[w[1],w[2],w[3],w[4]].reduce((N,Y)=>{if(!N)return null;const re=Number(Y);return isNaN(re)?null:[...N,re]},[]);return new kt(...A??zr)}const vs=b("cbz");class wr{constructor(w,A){this.element=w.createElement("div"),this.element.classList.add(vs()),A.viewProps.bindClassModifiers(this.element),A.foldable.bindExpandedClass(this.element,vs(void 0,"expanded")),M(A.foldable,"completed",R(this.element,vs(void 0,"cpl")));const N=w.createElement("div");N.classList.add(vs("h")),this.element.appendChild(N);const Y=w.createElement("button");Y.classList.add(vs("b")),A.viewProps.bindDisabled(Y);const re=w.createElementNS(nt,"svg");re.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',Y.appendChild(re),N.appendChild(Y),this.buttonElement=Y;const Ce=w.createElement("div");if(Ce.classList.add(vs("t")),N.appendChild(Ce),this.textElement=Ce,A.pickerLayout==="inline"){const Ke=w.createElement("div");Ke.classList.add(vs("p")),this.element.appendChild(Ke),this.pickerElement=Ke}else this.pickerElement=null}}const Js=b("cbzp");class ii{constructor(w,A){this.element=w.createElement("div"),this.element.classList.add(Js()),A.viewProps.bindClassModifiers(this.element);const N=w.createElement("div");N.classList.add(Js("g")),this.element.appendChild(N),this.graphElement=N;const Y=w.createElement("div");Y.classList.add(Js("t")),this.element.appendChild(Y),this.textElement=Y}}function Vi(k,w){const A=new MutationObserver(Y=>{for(const re of Y)re.type==="childList"&&re.addedNodes.forEach(Ce=>{Ce.contains(Ce)&&(w(),A.disconnect())})}),N=k.ownerDocument;A.observe(N.body,{attributes:!0,childList:!0,subtree:!0})}const Wi=b("cbzg");function Wn(k,w){return A=>w(k(A))}class In{constructor(w,A){this.element=w.createElement("div"),this.element.classList.add(Wi()),A.viewProps.bindClassModifiers(this.element),A.viewProps.bindTabIndex(this.element);const N=w.createElement("div");N.classList.add(Wi("p")),this.element.appendChild(N),this.previewElement=N;const Y=w.createElementNS(nt,"svg");Y.classList.add(Wi("g")),this.element.appendChild(Y),this.svgElem_=Y;const re=w.createElementNS(nt,"path");re.classList.add(Wi("u")),this.svgElem_.appendChild(re),this.guideElem_=re;const Ce=w.createElementNS(nt,"polyline");Ce.classList.add(Wi("l")),this.svgElem_.appendChild(Ce),this.lineElem_=Ce,this.handleElems_=[w.createElement("div"),w.createElement("div")],this.handleElems_.forEach(Ke=>{Ke.classList.add(Wi("h")),this.element.appendChild(Ke)}),this.vectorElems_=[w.createElementNS(nt,"line"),w.createElementNS(nt,"line")],this.vectorElems_.forEach(Ke=>{Ke.classList.add(Wi("v")),this.svgElem_.appendChild(Ke)}),this.value_=A.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=A.selection,this.handleElems_.forEach((Ke,nn)=>{E(this.sel_,Wn(Li=>Li===nn,R(Ke,Wi("h","sel"))))}),Vi(this.element,()=>{this.refresh()})}getVertMargin_(w){return w*.25}valueToPosition(w,A){const N=this.element.getBoundingClientRect(),Y=N.width,re=N.height,Ce=this.getVertMargin_(re);return{x:qt(w,0,1,0,Y),y:qt(A,0,1,re-Ce,Ce)}}positionToValue(w,A){const N=this.element.getBoundingClientRect(),Y=N.width,re=N.height,Ce=this.getVertMargin_(re);return{x:Zi(qt(w,0,Y,0,1),0,1),y:qt(A,re-Ce,Ce,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(re=>{const Ce=this.valueToPosition(0,re),Ke=this.valueToPosition(1,re);return[`M ${Ce.x},${Ce.y}`,`L ${Ke.x},${Ke.y}`].join(" ")}).join(" "));const w=this.value_.rawValue,A=[];let N=0;for(;;){const re=this.valueToPosition(...w.curve(N));if(A.push([re.x,re.y].join(",")),N>=1)break;N=Math.min(N+.05,1)}this.lineElem_.setAttributeNS(null,"points",A.join(" "));const Y=w.toObject();[0,1].forEach(re=>{const Ce=this.valueToPosition(re,re),Ke=this.valueToPosition(Y[re*2],Y[re*2+1]),nn=this.vectorElems_[re];nn.setAttributeNS(null,"x1",String(Ce.x)),nn.setAttributeNS(null,"y1",String(Ce.y)),nn.setAttributeNS(null,"x2",String(Ke.x)),nn.setAttributeNS(null,"y2",String(Ke.y));const Li=this.handleElems_[re];Li.style.left=`${Ke.x}px`,Li.style.top=`${Ke.y}px`})}onValueChange_(){this.refresh()}}const Bs=24,gs=400,Qs=1e3,Ni=b("cbzprv");class Tn{constructor(w,A){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=w.createElement("div"),this.element.classList.add(Ni()),A.viewProps.bindClassModifiers(this.element);const N=w.createElementNS(nt,"svg");N.classList.add(Ni("g")),this.element.appendChild(N),this.svgElem_=N;const Y=w.createElementNS(nt,"path");Y.classList.add(Ni("t")),this.svgElem_.appendChild(Y),this.ticksElem_=Y;const re=w.createElement("div");re.classList.add(Ni("m")),this.element.appendChild(re),this.markerElem_=re,this.value_=A.value,this.value_.emitter.on("change",this.onValueChange_),A.viewProps.handleDispose(this.onDispose_),Vi(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(Ni("m","a")),this.startTime_=new Date().getTime()+gs,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(Ni("m","a"))}onDispose_(){this.stop()}updateMarker_(w){const A=this.value_.rawValue.y(Zi(w,0,1));this.markerElem_.style.left=`${A*100}%`}refresh(){const w=this.svgElem_.getBoundingClientRect(),A=w.width,N=w.height,Y=[],re=this.value_.rawValue;for(let Ce=0;Ce<Bs;Ce++){const Ke=qt(Ce,0,Bs-1,0,1),nn=qt(re.y(Ke),0,1,0,A);Y.push(`M ${nn},0 v${N}`)}this.ticksElem_.setAttributeNS(null,"d",Y.join(" "))}onTimer_(){if(this.startTime_===null)return;const w=new Date().getTime()-this.startTime_,A=w/Qs;this.updateMarker_(A),w>Qs+gs&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function Sn(k,w,A,N){const Y=A-k,re=N-w;return Math.sqrt(Y*Y+re*re)}function di(k,w,A,N){const Y=Sn(k,w,A,N),re=Math.atan2(N-w,A-k),Ce=Math.round(re/(Math.PI/4))*Math.PI/4;return{x:k+Math.cos(Ce)*Y,y:w+Math.sin(Ce)*Y}}class pi{constructor(w,A){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=A.baseStep,this.value=A.value,this.sel_=W(0),this.viewProps=A.viewProps,this.view=new In(w,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new Tn(w,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",Y=>{Y.stopImmediatePropagation(),Y.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const N=new Pn(this.view.element);N.emitter.on("down",this.onPointerDown_),N.emitter.on("move",this.onPointerMove_),N.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(w,A,N){const Y=this.sel_.rawValue,re=this.value.rawValue.toObject(),Ce=this.view.positionToValue(w.x,w.y),Ke=A?di(Y,Y,Ce.x,Ce.y):Ce;re[Y*2]=Ke.x,re[Y*2+1]=Ke.y,this.value.setRawValue(new kt(...re),N)}onPointerDown_(w){const A=w.data;if(!A.point)return;const N=this.value.rawValue,Y=this.view.valueToPosition(N.x1,N.y1),re=Sn(A.point.x,A.point.y,Y.x,Y.y),Ce=this.view.valueToPosition(N.x2,N.y2),Ke=Sn(A.point.x,A.point.y,Ce.x,Ce.y);this.sel_.rawValue=re<=Ke?0:1,this.updateValue_(A.point,w.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(w){const A=w.data;A.point&&this.updateValue_(A.point,w.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(w){const A=w.data;A.point&&this.updateValue_(A.point,w.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(w){gn(w.key)&&w.preventDefault();const A=this.sel_.rawValue,N=this.value.rawValue.toObject();N[A*2]+=kn(this.baseStep_,Yi(w)),N[A*2+1]+=kn(this.baseStep_,Rn(w)),this.value.setRawValue(new kt(...N),{forceEmit:!1,last:!1})}onKeyUp_(w){gn(w.key)&&w.preventDefault();const A=kn(this.baseStep_,Yi(w)),N=kn(this.baseStep_,Rn(w));A===0&&N===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class xr{constructor(w,A){this.value=A.value,this.viewProps=A.viewProps,this.view=new ii(w,{viewProps:this.viewProps}),this.gc_=new pi(w,{baseStep:A.axis.baseStep,value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const N=Object.assign(Object.assign({},A.axis),{constraint:new ct({max:1,min:0})}),Y=Object.assign(Object.assign({},A.axis),{constraint:void 0});this.tc_=new Pi(w,{assembly:Kt,axes:[N,Y,N,Y],parser:Cn,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(w=>w.inputElement)]}refresh(){this.gc_.refresh()}}class _s{constructor(w,A){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=A.value,this.viewProps=A.viewProps,this.foldable_=en(A.expanded),this.view=new wr(w,{foldable:this.foldable_,pickerLayout:A.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new at(w,{parser:uo,props:Z.fromObject({formatter:ui}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=A.pickerLayout==="popup"?new yt(w,{viewProps:this.viewProps}):null;const N=new xr(w,{axis:A.axis,value:this.value,viewProps:this.viewProps});N.allFocusableElements.forEach(Y=>{Y.addEventListener("blur",this.onPopupChildBlur_),Y.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=N,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),E(this.popC_.shows,Y=>{Y&&N.refresh()}),Hn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Y=>Y.rawValue,backward:(Y,re)=>re.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),q(this.foldable_,this.view.pickerElement))}onButtonBlur_(w){if(!this.popC_)return;const A=w.relatedTarget;(!A||!this.popC_.view.element.contains(A))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(w){if(!this.popC_)return;const A=this.popC_.view.element,N=xe(w);N&&A.contains(N)||N&&N===this.view.buttonElement&&!mt(A.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(w){this.popC_&&w.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function as(){return new Ai({assembly:Kt,components:[0,1,2,3].map(k=>k%2===0?new ct({min:0,max:1}):void 0)})}const rn={id:"cubic-bezier",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(k){const w=ve,A=de(k,{value:w.required.array(w.required.number),view:w.required.constant("cubicbezier"),expanded:w.optional.boolean,label:w.optional.string,picker:w.optional.custom(N=>N==="inline"||N==="popup"?N:void 0)});return A?{params:A}:null},controller(k){var w,A;const N=new kt(...k.params.value),Y=W(N,{constraint:as(),equals:kt.equals}),re=new _s(k.document,{axis:{baseStep:.1,textProps:Z.fromObject({draggingScale:.01,formatter:Ut(2)})},expanded:(w=k.params.expanded)!==null&&w!==void 0?w:!1,pickerLayout:(A=k.params.picker)!==null&&A!==void 0?A:"popup",value:Y,viewProps:k.viewProps});return new Ne(k.document,{blade:k.blade,props:Z.fromObject({label:k.params.label}),valueController:re})},api(k){return!(k.controller instanceof Ne)||!(k.controller.valueController instanceof _s)?null:new Be(k.controller)}};class Wt extends n{begin(){this.controller_.valueController.begin()}end(){this.controller_.valueController.end()}}const _n=20;class bn{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(w){this.start_=w.getTime()}calculateFps_(w){if(this.timestamps_.length===0)return null;const A=this.timestamps_[0];return 1e3*(this.frameCount_-A.frameCount)/(w-A.time)}compactTimestamps_(){if(this.timestamps_.length<=_n)return;const w=this.timestamps_.length-_n;this.timestamps_.splice(0,w);const A=this.timestamps_[0].frameCount;this.timestamps_.forEach(N=>{N.frameCount-=A}),this.frameCount_-=A}end(w){if(this.start_===null)return;const A=w.getTime();this.duration_=A-this.start_,this.start_=null,this.fps_=this.calculateFps_(A),this.timestamps_.push({frameCount:this.frameCount_,time:A}),++this.frameCount_,this.compactTimestamps_()}}const Dn=b("fps");class fi{constructor(w,A){this.element=w.createElement("div"),this.element.classList.add(Dn()),A.viewProps.bindClassModifiers(this.element),this.graphElement=w.createElement("div"),this.graphElement.classList.add(Dn("g")),this.element.appendChild(this.graphElement);const N=w.createElement("div");N.classList.add(Dn("l")),this.element.appendChild(N);const Y=w.createElement("span");Y.classList.add(Dn("v")),Y.textContent="--",N.appendChild(Y),this.valueElement=Y;const re=w.createElement("span");re.classList.add(Dn("u")),re.textContent="FPS",N.appendChild(re)}}class Ti{constructor(w,A){this.stopwatch_=new bn,this.onTick_=this.onTick_.bind(this),this.ticker_=A.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.value_=A.value,this.viewProps=A.viewProps,this.view=new fi(w,{viewProps:this.viewProps}),this.graphC_=new D(w,{formatter:Ut(0),lineCount:A.lineCount,props:Z.fromObject({maxValue:A.maxValue,minValue:A.minValue}),value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker_.dispose()})}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const w=this.stopwatch_.fps;if(w!==null){const A=this.value_.rawValue;this.value_.rawValue=un(A,w),this.view.valueElement.textContent=w.toFixed(0)}}}function bs(k,w){return w===0?new je:new Ze(k,w??_.monitor.defaultInterval)}const yr={id:"fpsgraph",type:"blade",accept(k){const w=ve,A=de(k,{view:w.required.constant("fpsgraph"),interval:w.optional.number,label:w.optional.string,lineCount:w.optional.number,max:w.optional.number,min:w.optional.number});return A?{params:A}:null},controller(k){var w,A,N,Y;const re=(w=k.params.interval)!==null&&w!==void 0?w:500;return new St(k.document,{blade:k.blade,props:Z.fromObject({label:k.params.label}),valueController:new Ti(k.document,{lineCount:(A=k.params.lineCount)!==null&&A!==void 0?A:2,maxValue:(N=k.params.max)!==null&&N!==void 0?N:90,minValue:(Y=k.params.min)!==null&&Y!==void 0?Y:0,ticker:bs(k.document,re),value:On(80),viewProps:k.viewProps})})},api(k){return!(k.controller instanceof St)||!(k.controller.valueController instanceof Ti)?null:new Wt(k.controller)}};class mi{constructor(w,A){this.min=w,this.max=A}static isObject(w){if(typeof w!="object"||w===null)return!1;const A=w.min,N=w.max;return!(typeof A!="number"||typeof N!="number")}static equals(w,A){return w.min===A.min&&w.max===A.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const er={fromComponents:k=>new mi(k[0],k[1]),toComponents:k=>[k.min,k.max]};class tr{constructor(w){this.edge=w}constrain(w){var A,N,Y,re,Ce,Ke,nn,Li;if(w.min<=w.max)return new mi((N=(A=this.edge)===null||A===void 0?void 0:A.constrain(w.min))!==null&&N!==void 0?N:w.min,(re=(Y=this.edge)===null||Y===void 0?void 0:Y.constrain(w.max))!==null&&re!==void 0?re:w.max);const Rt=(w.min+w.max)/2;return new mi((Ke=(Ce=this.edge)===null||Ce===void 0?void 0:Ce.constrain(Rt))!==null&&Ke!==void 0?Ke:Rt,(Li=(nn=this.edge)===null||nn===void 0?void 0:nn.constrain(Rt))!==null&&Li!==void 0?Li:Rt)}}const nr=b("rsltxt");class ws{constructor(w,A){this.sliderView_=A.sliderView,this.textView_=A.textView,this.element=w.createElement("div"),this.element.classList.add(nr());const N=w.createElement("div");N.classList.add(nr("s")),N.appendChild(this.sliderView_.element),this.element.appendChild(N);const Y=w.createElement("div");Y.classList.add(nr("t")),Y.appendChild(this.textView_.element),this.element.appendChild(Y)}}const si=b("rsl");class Es{constructor(w,A){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=A.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=w.createElement("div"),this.element.classList.add(si()),A.viewProps.bindClassModifiers(this.element),this.value_=A.value,this.value_.emitter.on("change",this.onValueChange_);const N=w.createElement("div");N.classList.add(si("t")),this.element.appendChild(N),this.trackElement=N;const Y=w.createElement("div");Y.classList.add(si("b")),N.appendChild(Y),this.barElement=Y;const re=["min","max"].map(Ce=>{const Ke=w.createElement("div");return Ke.classList.add(si("k"),si("k",Ce)),N.appendChild(Ke),Ke});this.knobElements=[re[0],re[1]],this.update_()}valueToX_(w){const A=this.sliderProps_.get("minValue"),N=this.sliderProps_.get("maxValue");return Zi(qt(w,A,N,0,1),0,1)*100}update_(){const w=this.value_.rawValue;w.length===0?this.element.classList.add(si(void 0,"zero")):this.element.classList.remove(si(void 0,"zero"));const A=[this.valueToX_(w.min),this.valueToX_(w.max)];this.barElement.style.left=`${A[0]}%`,this.barElement.style.right=`${100-A[1]}%`,this.knobElements.forEach((N,Y)=>{N.style.left=`${A[Y]}%`})}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class ji{constructor(w,A){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=A.sliderProps,this.viewProps=A.viewProps,this.value=A.value,this.view=new Es(w,{sliderProps:this.sliderProps,value:this.value,viewProps:A.viewProps});const N=new Pn(this.view.trackElement);N.emitter.on("down",this.onPointerDown_),N.emitter.on("move",this.onPointerMove_),N.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(w){if(!w.point)return null;const A=(w.point.x+this.ofs_())/w.bounds.width,N=this.sliderProps.get("minValue"),Y=this.sliderProps.get("maxValue");return qt(A,0,1,N,Y)}onPointerDown_(w){if(!w.data.point)return;const A=w.data.point.x/w.data.bounds.width,N=this.value.rawValue,Y=this.sliderProps.get("minValue"),re=this.sliderProps.get("maxValue"),Ce=qt(N.min,Y,re,0,1),Ke=qt(N.max,Y,re,0,1);Math.abs(Ke-A)<=.025?this.grabbing_="max":Math.abs(Ce-A)<=.025?this.grabbing_="min":A>=Ce&&A<=Ke?(this.grabbing_="length",this.grabOffset_=qt(A-Ce,0,1,0,re-Y)):A<Ce?(this.grabbing_="min",this.onPointerMove_(w)):A>Ke&&(this.grabbing_="max",this.onPointerMove_(w))}applyPointToValue_(w,A){const N=this.valueFromData_(w);if(N===null)return;const Y=this.sliderProps.get("minValue"),re=this.sliderProps.get("maxValue");if(this.grabbing_==="min")this.value.setRawValue(new mi(N,this.value.rawValue.max),A);else if(this.grabbing_==="max")this.value.setRawValue(new mi(this.value.rawValue.min,N),A);else if(this.grabbing_==="length"){const Ce=this.value.rawValue.length;let Ke=N-this.grabOffset_,nn=Ke+Ce;Ke<Y?(Ke=Y,nn=Y+Ce):nn>re&&(Ke=re-Ce,nn=re),this.value.setRawValue(new mi(Ke,nn),A)}}onPointerMove_(w){this.applyPointToValue_(w.data,{forceEmit:!1,last:!1})}onPointerUp_(w){this.applyPointToValue_(w.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class vi{constructor(w,A){this.value=A.value,this.viewProps=A.viewProps,this.sc_=new ji(w,A);const N={baseStep:A.baseStep,constraint:A.constraint,textProps:Z.fromObject({draggingScale:A.draggingScale,formatter:A.formatter})};this.tc_=new Pi(w,{assembly:er,axes:[N,N],parser:A.parser,value:this.value,viewProps:A.viewProps}),this.view=new ws(w,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function ir(k){return mi.isObject(k)?new mi(k.min,k.max):new mi(0,0)}function Cr(k,w){k.writeProperty("max",w.max),k.writeProperty("min",w.min)}function Ss(k){const w=[],A=G(k);A&&w.push(A);const N=Gi(k);return N&&w.push(N),new tr(new wt(w))}const ls={id:"input-interval",type:"input",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept:(k,w)=>{if(!mi.isObject(k))return null;const A=ve,N=de(w,{format:A.optional.function,max:A.optional.number,min:A.optional.number,step:A.optional.number});return N?{initialValue:new mi(k.min,k.max),params:N}:null},binding:{reader:k=>ir,constraint:k=>Ss(k.params),equals:mi.equals,writer:k=>Cr},controller(k){var w;const A=k.value,N=k.constraint;if(!(N instanceof tr))throw d.shouldNeverHappen();const Y=(A.rawValue.min+A.rawValue.max)/2,re=(w=k.params.format)!==null&&w!==void 0?w:Ut(Bi(N.edge,Y)),Ce=N.edge&&qe(N.edge,Pe);if(Ce)return new vi(k.document,{baseStep:qn(N.edge),constraint:N.edge,draggingScale:Xn(N.edge,Y),formatter:re,parser:Cn,sliderProps:new Z({maxValue:Ce.values.value("max"),minValue:Ce.values.value("min")}),value:A,viewProps:k.viewProps});const Ke={baseStep:qn(N.edge),constraint:N.edge,textProps:Z.fromObject({draggingScale:Y,formatter:re})};return new Pi(k.document,{assembly:er,axes:[Ke,Ke],parser:Cn,value:A,viewProps:k.viewProps})}};class gi{constructor(w){this.controller_=w}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(w){this.controller_.viewProps.set("disabled",w)}get title(){var w;return(w=this.controller_.props.get("title"))!==null&&w!==void 0?w:""}set title(w){this.controller_.props.set("title",w)}}class es extends o{constructor(w,A,N,Y,re){super(w,Y,re),this.cell=A,this.index=N}}class sr extends n{constructor(w){super(w),this.cellToApiMap_=new Map,this.controller_.valueController.cellControllers.forEach(N=>{const Y=new gi(N);this.cellToApiMap_.set(N,Y)})}get value(){return this.controller_.value}cell(w,A){const N=this.controller_.valueController,Y=N.cellControllers[A*N.size[0]+w];return this.cellToApiMap_.get(Y)}on(w,A){const N=A.bind(this);this.controller_.value.emitter.on(w,Y=>{const re=this.controller_.valueController,Ce=re.findCellByValue(Y.rawValue);if(!Ce)return;const Ke=this.cellToApiMap_.get(Ce);if(!Ke)return;const nn=re.cellControllers.indexOf(Ce);N(new es(this,Ke,[nn%re.size[0],Math.floor(nn/re.size[0])],Y.rawValue,void 0))})}}const rr=b("rad");class po{constructor(w,A){this.element=w.createElement("div"),this.element.classList.add(rr()),A.viewProps.bindClassModifiers(this.element);const N=w.createElement("label");N.classList.add(rr("l")),this.element.appendChild(N);const Y=w.createElement("input");Y.classList.add(rr("i")),Y.name=A.name,Y.type="radio",A.viewProps.bindDisabled(Y),N.appendChild(Y),this.inputElement=Y;const re=w.createElement("div");re.classList.add(rr("b")),N.appendChild(re);const Ce=w.createElement("div");Ce.classList.add(rr("t")),re.appendChild(Ce),M(A.props,"title",Ke=>{Ce.textContent=Ke})}}class I{constructor(w,A){this.props=A.props,this.viewProps=A.viewProps,this.view=new po(w,{name:A.name,props:this.props,viewProps:this.viewProps})}}class x{constructor(w,A){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=A.size;const[N,Y]=this.size;for(let re=0;re<Y;re++)for(let Ce=0;Ce<N;Ce++){const Ke=new I(w,{name:A.groupName,props:Z.fromObject(Object.assign({},A.cellConfig(Ce,re))),viewProps:Re.create()});this.cellCs_.push(Ke),this.cellValues_.push(A.cellConfig(Ce,re).value)}this.value=A.value,E(this.value,re=>{const Ce=this.findCellByValue(re);Ce&&(Ce.view.inputElement.checked=!0)}),this.viewProps=Re.create(),this.view=new ge(w,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${N}, 1fr)`,this.cellCs_.forEach(re=>{re.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(re.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(w){const A=this.cellValues_.findIndex(N=>N===w);return A<0?null:this.cellCs_[A]}onCellInputChange_(w){const A=w.currentTarget,N=this.cellCs_.findIndex(Y=>Y.view.inputElement===A);N<0||(this.value.rawValue=this.cellValues_[N])}}const T=function(){return{id:"radiogrid",type:"blade",accept(k){const w=ve,A=de(k,{cells:w.required.function,groupName:w.required.string,size:w.required.array(w.required.number),value:w.required.raw,view:w.required.constant("radiogrid"),label:w.optional.string});return A?{params:A}:null},controller(k){return new Ne(k.document,{blade:k.blade,props:Z.fromObject({label:k.params.label}),valueController:new x(k.document,{groupName:k.params.groupName,cellConfig:k.params.cells,size:k.params.size,value:W(k.params.value)})})},api(k){return!(k.controller instanceof Ne)||!(k.controller.valueController instanceof x)?null:new sr(k.controller)}}}();function O(k){return{id:"input-radiogrid",type:"input",accept(w,A){if(!k.isType(w))return null;const N=ve,Y=de(A,{cells:N.required.function,groupName:N.required.string,size:N.required.array(N.required.number),view:N.required.constant("radiogrid")});return Y?{initialValue:w,params:Y}:null},binding:k.binding,controller:w=>new x(w.document,{cellConfig:w.params.cells,groupName:w.params.groupName,size:w.params.size,value:w.value})}}const J=O({isType:k=>typeof k=="number",binding:{reader:k=>Ht,writer:k=>En}}),ae=O({isType:k=>typeof k=="string",binding:{reader:k=>Ci,writer:k=>En}}),ye=O({isType:k=>typeof k=="boolean",binding:{reader:k=>Ge,writer:k=>En}}),Xe=[Ee,rn,yr,ls,T,ye,J,ae];t.ButtonCellApi=K,t.ButtonGridApi=fe,t.ButtonGridController=be,t.CubicBezier=kt,t.CubicBezierApi=Be,t.CubicBezierAssembly=Kt,t.CubicBezierController=_s,t.CubicBezierGraphController=pi,t.CubicBezierGraphView=In,t.CubicBezierPickerController=xr,t.CubicBezierPickerView=ii,t.CubicBezierPreviewView=Tn,t.CubicBezierView=wr,t.FpsGraphBladeApi=Wt,t.FpsGraphController=Ti,t.FpsView=fi,t.Fpswatch=bn,t.Interval=mi,t.IntervalAssembly=er,t.IntervalConstraint=tr,t.RadioCellApi=gi,t.RadioController=I,t.RadioGridApi=sr,t.RadioGridController=x,t.RadioView=po,t.RangeSliderController=ji,t.RangeSliderTextController=vi,t.RangeSliderTextView=ws,t.RangeSliderView=Es,t.TpRadioGridChangeEvent=es,t.plugins=Xe,Object.defineProperty(t,"__esModule",{value:!0})})})(Lm,Lm.exports);var mw=Lm.exports;const sL=fw(mw),rL=R_({__proto__:null,default:sL},[mw]);var km={exports:{}};(function(h,e){(function(t,n){n(e)})(zv,function(t){function n(_){return _}function i(_){return _==null}const o={alreadydisposed:()=>"View has been already disposed",invalidparams:_=>`Invalid parameters for '${_.name}'`,nomatchingcontroller:_=>`No matching controller for '${_.key}'`,nomatchingview:_=>`No matching view for '${JSON.stringify(_.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:_=>`Property '${_.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class a{constructor(f){var C;this.message=(C=o[f.type](f.context))!==null&&C!==void 0?C:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=f.type}static alreadyDisposed(){return new a({type:"alreadydisposed"})}static notBindable(){return new a({type:"notbindable"})}static propertyNotFound(f){return new a({type:"propertynotfound",context:{name:f}})}static shouldNeverHappen(){return new a({type:"shouldneverhappen"})}}class c{constructor(){this.observers_={}}on(f,C){let D=this.observers_[f];return D||(D=this.observers_[f]=[]),D.push({handler:C}),this}off(f,C){const D=this.observers_[f];return D&&(this.observers_[f]=D.filter(K=>K.handler!==C)),this}emit(f,C){const D=this.observers_[f];D&&D.forEach(K=>{K.handler(C)})}}const u="tp";function d(_){return(C,D)=>[u,"-",_,"v",C?`_${C}`:"",D?`-${D}`:""].join("")}function v(_,f){return C=>f(_(C))}function g(_){return _.rawValue}function b(_,f){_.emitter.on("change",v(g,f)),f(_.rawValue)}function y(_,f,C){b(_.value(f),C)}function S(_,f,C){C?_.classList.add(f):_.classList.remove(f)}function E(_,f){return C=>{S(_,f,C)}}class M{constructor(f,C){var D;this.constraint_=C?.constraint,this.equals_=(D=C?.equals)!==null&&D!==void 0?D:(K,te)=>K===te,this.emitter=new c,this.rawValue_=f}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(f){this.setRawValue(f,{forceEmit:!1,last:!0})}setRawValue(f,C){const D=C??{forceEmit:!1,last:!0},K=this.constraint_?this.constraint_.constrain(f):f;this.equals_(this.rawValue_,K)&&!D.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=K,this.emitter.emit("change",{options:D,rawValue:K,sender:this}))}}class L{constructor(f){this.emitter=new c,this.value_=f}get rawValue(){return this.value_}set rawValue(f){this.setRawValue(f,{forceEmit:!1,last:!0})}setRawValue(f,C){const D=C??{forceEmit:!1,last:!0};this.value_===f&&!D.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=f,this.emitter.emit("change",{options:D,rawValue:this.value_,sender:this}))}}function R(_,f){const C=f?.constraint,D=f?.equals;return!C&&!D?new L(_):new M(_,f)}class z{constructor(f){this.emitter=new c,this.valMap_=f;for(const C in this.valMap_)this.valMap_[C].emitter.on("change",()=>{this.emitter.emit("change",{key:C,sender:this})})}static createCore(f){return Object.keys(f).reduce((D,K)=>Object.assign(D,{[K]:R(f[K])}),{})}static fromObject(f){const C=this.createCore(f);return new z(C)}get(f){return this.valMap_[f].rawValue}set(f,C){this.valMap_[f].rawValue=C}value(f){return this.valMap_[f]}}function V(_,f){const D=Object.keys(f).reduce((K,te)=>{if(K===void 0)return;const fe=f[te],be=fe(_[te]);return be.succeeded?Object.assign(Object.assign({},K),{[te]:be.value}):void 0},{});return D}function H(_,f){return _.reduce((C,D)=>{if(C===void 0)return;const K=f(D);if(!(!K.succeeded||K.value===void 0))return[...C,K.value]},[])}function B(_){return _===null?!1:typeof _=="object"}function j(_){return f=>C=>{if(!f&&C===void 0)return{succeeded:!1,value:void 0};if(f&&C===void 0)return{succeeded:!0,value:void 0};const D=_(C);return D!==void 0?{succeeded:!0,value:D}:{succeeded:!1,value:void 0}}}function F(_){return{custom:f=>j(f)(_),boolean:j(f=>typeof f=="boolean"?f:void 0)(_),number:j(f=>typeof f=="number"?f:void 0)(_),string:j(f=>typeof f=="string"?f:void 0)(_),function:j(f=>typeof f=="function"?f:void 0)(_),constant:f=>j(C=>C===f?f:void 0)(_),raw:j(f=>f)(_),object:f=>j(C=>{if(B(C))return V(C,f)})(_),array:f=>j(C=>{if(Array.isArray(C))return H(C,f)})(_)}}const W={optional:F(!0),required:F(!1)};function Z(_,f){const C=W.required.object(f)(_);return C.succeeded?C.value:void 0}const se="http://www.w3.org/2000/svg";function we(_){_.offsetHeight}function oe(_,f){const C=_.style.transition;_.style.transition="none",f(),_.style.transition=C}function ne(_){return _.ontouchstart!==void 0}function ce(_){return _.relatedTarget?_.relatedTarget:"explicitOriginalTarget"in _?_.explicitOriginalTarget:null}class ve extends z{constructor(f){super(f)}static create(f){const C={completed:!0,expanded:f,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},D=z.createCore(C);return new ve(D)}get styleExpanded(){var f;return(f=this.get("temporaryExpanded"))!==null&&f!==void 0?f:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const f=this.get("expandedHeight");return this.get("shouldFixHeight")&&!i(f)?`${f}px`:"auto"}bindExpandedClass(f,C){y(this,"expanded",()=>{this.styleExpanded?f.classList.add(C):f.classList.remove(C)})}}function de(_,f){let C=0;return oe(f,()=>{_.set("expandedHeight",null),_.set("temporaryExpanded",!0),we(f),C=f.clientHeight,_.set("temporaryExpanded",null),we(f)}),C}function he(_,f){f.style.height=_.styleHeight}function ue(_,f){_.value("expanded").emitter.on("beforechange",()=>{_.set("completed",!1),i(_.get("expandedHeight"))&&_.set("expandedHeight",de(_,f)),_.set("shouldFixHeight",!0),we(f)}),_.emitter.on("change",()=>{he(_,f)}),he(_,f),f.addEventListener("transitionend",C=>{C.propertyName==="height"&&(_.set("shouldFixHeight",!1),_.set("expandedHeight",null),_.set("completed",!0))})}class me{constructor(f){this.constraints=f}constrain(f){return this.constraints.reduce((C,D)=>D.constrain(C),f)}}class ze{constructor(f){this.maxValue=f.max,this.minValue=f.min}constrain(f){let C=f;return i(this.minValue)||(C=Math.max(C,this.minValue)),i(this.maxValue)||(C=Math.min(C,this.maxValue)),C}}class Te{constructor(f){this.step=f}constrain(f){return(f<0?-Math.round(-f/this.step):Math.round(f/this.step))*this.step}}const Re=d("pop");class Ie{constructor(f,C){this.element=f.createElement("div"),this.element.classList.add(Re()),C.viewProps.bindClassModifiers(this.element),b(C.shows,E(this.element,Re(void 0,"v")))}}class rt{constructor(f,C){this.shows=R(!1),this.viewProps=C.viewProps,this.view=new Ie(f,{shows:this.shows,viewProps:this.viewProps})}}class Ae{constructor(f){this.text=f}evaluate(){return Number(this.text)}toString(){return this.text}}const pt={"**":(_,f)=>Math.pow(_,f),"*":(_,f)=>_*f,"/":(_,f)=>_/f,"%":(_,f)=>_%f,"+":(_,f)=>_+f,"-":(_,f)=>_-f,"<<":(_,f)=>_<<f,">>":(_,f)=>_>>f,">>>":(_,f)=>_>>>f,"&":(_,f)=>_&f,"^":(_,f)=>_^f,"|":(_,f)=>_|f};class nt{constructor(f,C,D){this.left=C,this.operator=f,this.right=D}evaluate(){const f=pt[this.operator];if(!f)throw new Error(`unexpected binary operator: '${this.operator}`);return f(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Et={"+":_=>_,"-":_=>-_,"~":_=>~_};class He{constructor(f,C){this.operator=f,this.expression=C}evaluate(){const f=Et[this.operator];if(!f)throw new Error(`unexpected unary operator: '${this.operator}`);return f(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function mt(_){return(f,C)=>{for(let D=0;D<_.length;D++){const K=_[D](f,C);if(K!=="")return K}return""}}function ke(_,f){var C;const D=_.substr(f).match(/^\s+/);return(C=D&&D[0])!==null&&C!==void 0?C:""}function xe(_,f){const C=_.substr(f,1);return C.match(/^[1-9]$/)?C:""}function Ve(_,f){var C;const D=_.substr(f).match(/^[0-9]+/);return(C=D&&D[0])!==null&&C!==void 0?C:""}function Ye(_,f){const C=Ve(_,f);if(C!=="")return C;const D=_.substr(f,1);if(f+=1,D!=="-"&&D!=="+")return"";const K=Ve(_,f);return K===""?"":D+K}function Oe(_,f){const C=_.substr(f,1);if(f+=1,C.toLowerCase()!=="e")return"";const D=Ye(_,f);return D===""?"":C+D}function St(_,f){const C=_.substr(f,1);if(C==="0")return C;const D=xe(_,f);return f+=D.length,D===""?"":D+Ve(_,f)}function vt(_,f){const C=St(_,f);if(f+=C.length,C==="")return"";const D=_.substr(f,1);if(f+=D.length,D!==".")return"";const K=Ve(_,f);return f+=K.length,C+D+K+Oe(_,f)}function dt(_,f){const C=_.substr(f,1);if(f+=C.length,C!==".")return"";const D=Ve(_,f);return f+=D.length,D===""?"":C+D+Oe(_,f)}function en(_,f){const C=St(_,f);return f+=C.length,C===""?"":C+Oe(_,f)}const Xt=mt([vt,dt,en]);function Q(_,f){var C;const D=_.substr(f).match(/^[01]+/);return(C=D&&D[0])!==null&&C!==void 0?C:""}function q(_,f){const C=_.substr(f,2);if(f+=C.length,C.toLowerCase()!=="0b")return"";const D=Q(_,f);return D===""?"":C+D}function ge(_,f){var C;const D=_.substr(f).match(/^[0-7]+/);return(C=D&&D[0])!==null&&C!==void 0?C:""}function Ne(_,f){const C=_.substr(f,2);if(f+=C.length,C.toLowerCase()!=="0o")return"";const D=ge(_,f);return D===""?"":C+D}function je(_,f){var C;const D=_.substr(f).match(/^[0-9a-f]+/i);return(C=D&&D[0])!==null&&C!==void 0?C:""}function Ze(_,f){const C=_.substr(f,2);if(f+=C.length,C.toLowerCase()!=="0x")return"";const D=je(_,f);return D===""?"":C+D}const wt=mt([q,Ne,Ze]),qe=mt([wt,Xt]);function Pe(_,f){const C=qe(_,f);return f+=C.length,C===""?null:{evaluable:new Ae(C),cursor:f}}function ct(_,f){const C=_.substr(f,1);if(f+=C.length,C!=="(")return null;const D=ie(_,f);if(!D)return null;f=D.cursor,f+=ke(_,f).length;const K=_.substr(f,1);return f+=K.length,K!==")"?null:{evaluable:D.evaluable,cursor:f}}function ft(_,f){return Pe(_,f)||ct(_,f)}function lt(_,f){const C=ft(_,f);if(C)return C;const D=_.substr(f,1);if(f+=D.length,D!=="+"&&D!=="-"&&D!=="~")return null;const K=lt(_,f);return K?(f=K.cursor,{cursor:f,evaluable:new He(D,K.evaluable)}):null}function gt(_,f,C){C+=ke(f,C).length;const D=_.filter(K=>f.startsWith(K,C))[0];return D?(C+=D.length,C+=ke(f,C).length,{cursor:C,operator:D}):null}function yt(_,f){return(C,D)=>{const K=_(C,D);if(!K)return null;D=K.cursor;let te=K.evaluable;for(;;){const fe=gt(f,C,D);if(!fe)break;D=fe.cursor;const be=_(C,D);if(!be)return null;D=be.cursor,te=new nt(fe.operator,te,be.evaluable)}return te?{cursor:D,evaluable:te}:null}}const Dt=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((_,f)=>yt(_,f),lt);function ie(_,f){return f+=ke(_,f).length,Dt(_,f)}function at(_){const f=ie(_,0);return!f||f.cursor+ke(_,f.cursor).length!==_.length?null:f.evaluable}function Ge(_){var f;const C=at(_);return(f=C?.evaluate())!==null&&f!==void 0?f:null}function Le(_){return f=>f.toFixed(Math.max(Math.min(_,20),0))}function We({primary:_,secondary:f,forward:C,backward:D}){let K=!1;function te(fe){K||(K=!0,fe(),K=!1)}_.emitter.on("change",fe=>{te(()=>{f.setRawValue(C(_,f),fe.options)})}),f.emitter.on("change",fe=>{te(()=>{_.setRawValue(D(_,f),fe.options)}),te(()=>{f.setRawValue(C(_,f),fe.options)})}),te(()=>{f.setRawValue(C(_,f),{forceEmit:!1,last:!0})})}function _t(_,f){const C=_*(f.altKey?.1:1)*(f.shiftKey?10:1);return f.upKey?+C:f.downKey?-C:0}function Yt(_){return{altKey:_.altKey,downKey:_.key==="ArrowDown",shiftKey:_.shiftKey,upKey:_.key==="ArrowUp"}}function an(_){return{altKey:_.altKey,downKey:_.key==="ArrowLeft",shiftKey:_.shiftKey,upKey:_.key==="ArrowRight"}}function xn(_){return _==="ArrowUp"||_==="ArrowDown"}function Gt(_){return xn(_)||_==="ArrowLeft"||_==="ArrowRight"}function Bt(_,f){const C=f.ownerDocument.defaultView,D=f.getBoundingClientRect();return{x:_.pageX-((C&&C.scrollX||0)+D.left),y:_.pageY-((C&&C.scrollY||0)+D.top)}}class Ft{constructor(f){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=f,this.emitter=new c,f.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),f.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),f.addEventListener("touchend",this.onTouchEnd_),f.addEventListener("mousedown",this.onMouseDown_)}computePosition_(f){const C=this.elem_.getBoundingClientRect();return{bounds:{width:C.width,height:C.height},point:f?{x:f.x,y:f.y}:null}}onMouseDown_(f){var C;f.preventDefault(),(C=f.currentTarget)===null||C===void 0||C.focus();const D=this.elem_.ownerDocument;D.addEventListener("mousemove",this.onDocumentMouseMove_),D.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:f.altKey,data:this.computePosition_(Bt(f,this.elem_)),sender:this,shiftKey:f.shiftKey})}onDocumentMouseMove_(f){this.emitter.emit("move",{altKey:f.altKey,data:this.computePosition_(Bt(f,this.elem_)),sender:this,shiftKey:f.shiftKey})}onDocumentMouseUp_(f){const C=this.elem_.ownerDocument;C.removeEventListener("mousemove",this.onDocumentMouseMove_),C.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:f.altKey,data:this.computePosition_(Bt(f,this.elem_)),sender:this,shiftKey:f.shiftKey})}onTouchStart_(f){f.preventDefault();const C=f.targetTouches.item(0),D=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:f.altKey,data:this.computePosition_(C?{x:C.clientX-D.left,y:C.clientY-D.top}:void 0),sender:this,shiftKey:f.shiftKey}),this.lastTouch_=C}onTouchMove_(f){const C=f.targetTouches.item(0),D=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:f.altKey,data:this.computePosition_(C?{x:C.clientX-D.left,y:C.clientY-D.top}:void 0),sender:this,shiftKey:f.shiftKey}),this.lastTouch_=C}onTouchEnd_(f){var C;const D=(C=f.targetTouches.item(0))!==null&&C!==void 0?C:this.lastTouch_,K=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:f.altKey,data:this.computePosition_(D?{x:D.clientX-K.left,y:D.clientY-K.top}:void 0),sender:this,shiftKey:f.shiftKey})}}function ln(_,f,C){return Math.min(Math.max(_,f),C)}const tn=d("txt");class xi{constructor(f,C){this.onChange_=this.onChange_.bind(this),this.props_=C.props,this.props_.emitter.on("change",this.onChange_),this.element=f.createElement("div"),this.element.classList.add(tn(),tn(void 0,"num")),C.arrayPosition&&this.element.classList.add(tn(void 0,C.arrayPosition)),C.viewProps.bindClassModifiers(this.element);const D=f.createElement("input");D.classList.add(tn("i")),D.type="text",C.viewProps.bindDisabled(D),this.element.appendChild(D),this.inputElement=D,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=C.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(tn()),this.inputElement.classList.add(tn("i"));const K=f.createElement("div");K.classList.add(tn("k")),this.element.appendChild(K),this.knobElement=K;const te=f.createElementNS(se,"svg");te.classList.add(tn("g")),this.knobElement.appendChild(te);const fe=f.createElementNS(se,"path");fe.classList.add(tn("gb")),te.appendChild(fe),this.guideBodyElem_=fe;const be=f.createElementNS(se,"path");be.classList.add(tn("gh")),te.appendChild(be),this.guideHeadElem_=be;const Ee=f.createElement("div");Ee.classList.add(d("tt")()),this.knobElement.appendChild(Ee),this.tooltipElem_=Ee,C.value.emitter.on("change",this.onChange_),this.value=C.value,this.refresh()}onDraggingChange_(f){if(f.rawValue===null){this.element.classList.remove(tn(void 0,"drg"));return}this.element.classList.add(tn(void 0,"drg"));const C=f.rawValue/this.props_.get("draggingScale"),D=C+(C>0?-1:C<0?1:0),K=ln(-D,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${D+K},0 L${D},4 L${D+K},8`,`M ${C},-1 L${C},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${C},4`);const te=this.props_.get("formatter");this.tooltipElem_.textContent=te(this.value.rawValue),this.tooltipElem_.style.left=`${C}px`}refresh(){const f=this.props_.get("formatter");this.inputElement.value=f(this.value.rawValue)}onChange_(){this.refresh()}}class yi{constructor(f,C){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=C.baseStep,this.parser_=C.parser,this.props=C.props,this.value=C.value,this.viewProps=C.viewProps,this.dragging_=R(null),this.view=new xi(f,{arrayPosition:C.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const D=new Ft(this.view.knobElement);D.emitter.on("down",this.onPointerDown_),D.emitter.on("move",this.onPointerMove_),D.emitter.on("up",this.onPointerUp_)}onInputChange_(f){const D=f.currentTarget.value,K=this.parser_(D);i(K)||(this.value.rawValue=K),this.view.refresh()}onInputKeyDown_(f){const C=_t(this.baseStep_,Yt(f));C!==0&&this.value.setRawValue(this.value.rawValue+C,{forceEmit:!1,last:!1})}onInputKeyUp_(f){_t(this.baseStep_,Yt(f))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(f){if(!f.point)return null;const C=f.point.x-f.bounds.width/2;return this.originRawValue_+C*this.props.get("draggingScale")}onPointerMove_(f){const C=this.computeDraggingValue_(f.data);C!==null&&(this.value.setRawValue(C,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(f){const C=this.computeDraggingValue_(f.data);C!==null&&(this.value.setRawValue(C,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function Nn(_){if(_==="inline"||_==="popup")return _}function yn(_){const f=W;return f.required.object({max:f.optional.number,min:f.optional.number,step:f.optional.number})(_).value}class ${constructor(f){this.components=f.components,this.asm_=f.assembly}constrain(f){const C=this.asm_.toComponents(f).map((D,K)=>{var te,fe;return(fe=(te=this.components[K])===null||te===void 0?void 0:te.constrain(D))!==null&&fe!==void 0?fe:D});return this.asm_.fromComponents(C)}}const pe=d("pndtxt");class Me{constructor(f,C){this.textViews=C.textViews,this.element=f.createElement("div"),this.element.classList.add(pe()),this.textViews.forEach(D=>{const K=f.createElement("div");K.classList.add(pe("a")),K.appendChild(D.element),this.element.appendChild(K)})}}function le(_,f,C){return new yi(_,{arrayPosition:C===0?"fst":C===f.axes.length-1?"lst":"mid",baseStep:f.axes[C].baseStep,parser:f.parser,props:f.axes[C].textProps,value:R(0,{constraint:f.axes[C].constraint}),viewProps:f.viewProps})}class Se{constructor(f,C){this.value=C.value,this.viewProps=C.viewProps,this.acs_=C.axes.map((D,K)=>le(f,C,K)),this.acs_.forEach((D,K)=>{We({primary:this.value,secondary:D.value,forward:te=>C.assembly.toComponents(te.rawValue)[K],backward:(te,fe)=>{const be=C.assembly.toComponents(te.rawValue);return be[K]=fe.rawValue,C.assembly.fromComponents(be)}})}),this.view=new Me(f,{textViews:this.acs_.map(D=>D.view)})}}class ut{multiply(f){return this.format(this.quat.multiply(f.quat))}premultiply(f){return this.format(f.multiply(this))}slerp(f,C){return this.format(this.quat.slerp(f.quat,C))}}function At(_,f,C){return Math.min(Math.max(_,f),C)}function zt(_,f){return Math.floor(_/f)*f}function xt(_,f){return _-zt(_,f)}function Pt(_){return xt(_+Math.PI,Math.PI*2)-Math.PI}class Je extends ut{constructor(f,C,D,K,te){super(),this.x=f??0,this.y=C??0,this.z=D??0,this.order=K??"XYZ",this.unit=te??"rad"}static fromQuaternion(f,C,D){const K=f.toMat3(),[te,fe,be,Ee]=C==="XYZ"?[0,1,2,1]:C==="XZY"?[0,2,1,-1]:C==="YXZ"?[1,0,2,-1]:C==="YZX"?[1,2,0,1]:C==="ZXY"?[2,0,1,1]:[2,1,0,-1],Be=[0,0,0],st=K[be+te*3];return Be[fe]=-Ee*Math.asin(At(st,-1,1)),Math.abs(st)<.999999?(Be[te]=Ee*Math.atan2(K[be+fe*3],K[be*4]),Be[be]=Ee*Math.atan2(K[fe+te*3],K[te*4])):Be[te]=Ee*Math.atan2(-K[fe+be*3],K[fe*4]),Math.abs(Be[te])+Math.abs(Be[be])>Math.PI&&(Be[te]=Pt(Be[te]+Math.PI),Be[fe]=Pt(Math.PI-Be[fe]),Be[be]=Pt(Be[be]+Math.PI)),new Je(...Be,C).reunit(D)}get quat(){return et.fromEuler(this)}getComponents(){return[this.x,this.y,this.z]}toEuler(f,C){return this.reorder(f).reunit(C)}format(f){return f instanceof Je?f.reorder(this.order):f.toEuler(this.order,this.unit)}reorder(f){return f===this.order?this:this.quat.toEuler(f,this.unit)}reunit(f){const C={deg:Math.PI/180,rad:1,turn:2*Math.PI}[this.unit],D={deg:180/Math.PI,rad:1,turn:.5/Math.PI}[f],K=C*D;return new Je(K*this.x,K*this.y,K*this.z,this.order,f)}}class et extends ut{constructor(f,C,D,K){super(),this.x=f??0,this.y=C??0,this.z=D??0,this.w=K??1}static fromAxisAngle(f,C){const D=C/2,K=Math.sin(D);return new et(f.x*K,f.y*K,f.z*K,Math.cos(D))}static fromEuler(f){const C=f.reunit("rad"),[D,K,te,fe]=C.order==="XYZ"?[0,1,2,1]:C.order==="XZY"?[0,2,1,-1]:C.order==="YXZ"?[1,0,2,-1]:C.order==="YZX"?[1,2,0,1]:C.order==="ZXY"?[2,0,1,1]:[2,1,0,-1],be=C.getComponents(),Ee=.5*be[D],Be=.5*fe*be[K],st=.5*be[te],Lt=Math.cos(Ee),Ot=Math.cos(Be),$t=Math.cos(st),dn=Math.sin(Ee),kt=Math.sin(Be),Kt=Math.sin(st),ui=[0,0,0,$t*Ot*Lt+Kt*kt*dn];return ui[D]=$t*Ot*dn-Kt*kt*Lt,ui[K]=fe*($t*kt*Lt+Kt*Ot*dn),ui[te]=Kt*Ot*Lt-$t*kt*dn,new et(...ui)}static lookRotation(f,C){const{normal:D,tangent:K,binormal:te}=f.orthoNormalize(C),fe=te.x,be=K.x,Ee=D.x,Be=te.y,st=K.y,Lt=D.y,Ot=te.z,$t=K.z,dn=D.z,kt=fe+st+dn;if(kt>0){const Kt=.5/Math.sqrt(kt+1);return new et(($t-Lt)*Kt,(Ee-Ot)*Kt,(Be-be)*Kt,.25/Kt)}else if(fe>st&&fe>dn){const Kt=2*Math.sqrt(1+fe-st-dn);return new et(.25*Kt,(be+Be)/Kt,(Ee+Ot)/Kt,($t-Lt)/Kt)}else if(st>dn){const Kt=2*Math.sqrt(1+st-fe-dn);return new et((be+Be)/Kt,.25*Kt,(Lt+$t)/Kt,(Ee-Ot)/Kt)}else{const Kt=2*Math.sqrt(1+dn-fe-st);return new et((Ee+Ot)/Kt,(Lt+$t)/Kt,.25*Kt,(Be-be)/Kt)}}get quat(){return this}getComponents(){return[this.x,this.y,this.z,this.w]}toEuler(f,C){return Je.fromQuaternion(this,f,C)}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const f=this.length;return f===0?new et:new et(this.x/f,this.y/f,this.z/f,this.w/f)}get negated(){return new et(-this.x,-this.y,-this.z,-this.w)}get ban360s(){return this.w<0?this.negated:this}multiply(f){const C=f.quat;return new et(this.w*C.x+this.x*C.w+this.y*C.z-this.z*C.y,this.w*C.y-this.x*C.z+this.y*C.w+this.z*C.x,this.w*C.z+this.x*C.y-this.y*C.x+this.z*C.w,this.w*C.w-this.x*C.x-this.y*C.y-this.z*C.z)}format(f){return f.quat}slerp(f,C){let D=f.quat;if(C===0)return this;if(C===1)return D;const K=this.ban360s;D=D.ban360s;let te=K.w*D.w+K.x*D.x+K.y*D.y+K.z*D.z;if(te<0&&(D=D.negated,te=-te),te>=1)return K;const fe=1-te*te;if(fe<=Number.EPSILON){const Lt=1-C;return new et(Lt*K.x+C*D.x,Lt*K.y+C*D.y,Lt*K.z+C*D.z,Lt*K.w+C*D.w).normalized}const be=Math.sqrt(fe),Ee=Math.atan2(be,te),Be=Math.sin((1-C)*Ee)/be,st=Math.sin(C*Ee)/be;return new et(K.x*Be+D.x*st,K.y*Be+D.y*st,K.z*Be+D.z*st,K.w*Be+D.w*st)}toMat3(){const{x:f,y:C,z:D,w:K}=this;return[1-2*C*C-2*D*D,2*f*C+2*D*K,2*f*D-2*C*K,2*f*C-2*D*K,1-2*f*f-2*D*D,2*C*D+2*f*K,2*f*D+2*C*K,2*C*D-2*f*K,1-2*f*f-2*C*C]}}class Ct{constructor(){this.offset=[0,0,-5],this.fov=30,this.aspect=1,this.viewport=[0,0,1,1]}project(f){const C=(this.viewport[0]+this.viewport[2])*.5,D=(this.viewport[1]+this.viewport[3])*.5,K=this.viewport[2]-this.viewport[0],te=this.viewport[3]-this.viewport[1],fe=1/Math.tan(this.fov*Math.PI/360),be=-(f.z+this.offset[2]),Ee=C+(f.x+this.offset[0])/be*fe*K*.5/this.aspect,Be=D-(f.y+this.offset[1])/be*fe*te*.5;return[Ee,Be]}}class it{constructor(f,C,D){this.element=f.createElementNS(se,"path"),this.vertices=C,this.projector=D}setRotation(f){let C="";return this.vertices.forEach((D,K)=>{const te=D.applyQuaternion(f),[fe,be]=this.projector.project(te);C+=`${K===0?"M":"L"}${fe} ${be}`}),this.element.setAttributeNS(null,"d",C),this}}class ht{constructor(f,C,D){this.x=f??0,this.y=C??0,this.z=D??0}getComponents(){return[this.x,this.y,this.z]}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const f=this.length;return f===0?new ht:new ht(this.x/f,this.y/f,this.z/f)}get negated(){return new ht(-this.x,-this.y,-this.z)}add(f){return new ht(this.x+f.x,this.y+f.y,this.z+f.z)}sub(f){return new ht(this.x-f.x,this.y-f.y,this.z-f.z)}scale(f){return new ht(this.x*f,this.y*f,this.z*f)}dot(f){return this.x*f.x+this.y*f.y+this.z*f.z}cross(f){return new ht(this.y*f.z-this.z*f.y,this.z*f.x-this.x*f.z,this.x*f.y-this.y*f.x)}orthoNormalize(f){const C=this.normalized;f=f.normalized;let D=C.dot(f);D===1&&(Math.abs(C.y)>Math.abs(C.z)?f=new ht(0,0,1):f=new ht(0,1,0),D=C.dot(f)),f=f.sub(C.scale(D)).normalized;const K=f.cross(C);return{normal:C,tangent:f,binormal:K}}applyQuaternion(f){const C=f.w*this.x+f.y*this.z-f.z*this.y,D=f.w*this.y+f.z*this.x-f.x*this.z,K=f.w*this.z+f.x*this.y-f.y*this.x,te=-f.x*this.x-f.y*this.y-f.z*this.z;return new ht(C*f.w+te*-f.x+D*-f.z-K*-f.y,D*f.w+te*-f.y+K*-f.x-C*-f.z,K*f.w+te*-f.z+C*-f.y-D*-f.x)}}function Qt(_,f){const C=f.z>0?new et(0,0,0,1):new et(0,0,1,0);return Math.abs(_.z)>.9999?C:et.lookRotation(_,f)}function ot(_,f,C,D,K,te=1){const fe=[];for(let be=0;be<C;be++){const Ee=_+f*be/(C-1),Be=new ht;Be[D]=te*Math.cos(Ee),Be[K]=te*Math.sin(Ee),fe.push(Be)}return fe}const Ue=d("rotationgizmo"),Cn=new ht(0,0,0),Ht=new ht(1,0,0),Ut=new ht(0,1,0),fn=new ht(0,0,1),Mn=new ht(0,0,-1),Ci=new ht(.7,0,0),mn=new ht(0,.7,0),On=new ht(0,0,.7),Un=new ht(-.7,0,0),un=new ht(0,-.7,0),Hn=new ht(0,0,-.7),kn=new et(0,0,0,1);function Rn(_,f,C){const D=_.createElementNS(se,"g"),K=_.createElementNS(se,"circle");K.classList.add(Ue(f)),K.setAttributeNS(null,"cx","0"),K.setAttributeNS(null,"cy","0"),K.setAttributeNS(null,"r","8"),D.appendChild(K);const te=_.createElementNS(se,"text");return te.classList.add(Ue("labeltext")),te.setAttributeNS(null,"y","4"),te.setAttributeNS(null,"text-anchor","middle"),te.setAttributeNS(null,"font-size","10"),te.textContent=C,D.appendChild(te),D}class Yi{constructor(f,C){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.onModeChange_=this.onModeChange_.bind(this),this.element=f.createElement("div"),this.element.classList.add(Ue()),C.pickerLayout==="popup"&&this.element.classList.add(Ue(void 0,"p"));const D=f.createElement("div");D.classList.add(Ue("p")),C.viewProps.bindTabIndex(D),this.element.appendChild(D),this.padElement=D;const K=f.createElementNS(se,"svg");K.classList.add(Ue("g")),this.padElement.appendChild(K),this.svgElem_=K,this.projector_=new Ct,this.projector_.viewport=[0,0,136,136];const te=ot(0,Math.PI,33,"x","y"),fe=ot(0,2*Math.PI,65,"x","y",1.1);this.xArcB_=new it(f,te,this.projector_),this.xArcB_.element.classList.add(Ue("arcx")),this.svgElem_.appendChild(this.xArcB_.element),this.yArcB_=new it(f,te,this.projector_),this.yArcB_.element.classList.add(Ue("arcy")),this.svgElem_.appendChild(this.yArcB_.element),this.zArcB_=new it(f,te,this.projector_),this.zArcB_.element.classList.add(Ue("arcz")),this.svgElem_.appendChild(this.zArcB_.element),this.xArcBC_=new it(f,te,this.projector_),this.xArcBC_.element.classList.add(Ue("arcc")),this.svgElem_.appendChild(this.xArcBC_.element),this.yArcBC_=new it(f,te,this.projector_),this.yArcBC_.element.classList.add(Ue("arcc")),this.svgElem_.appendChild(this.yArcBC_.element),this.zArcBC_=new it(f,te,this.projector_),this.zArcBC_.element.classList.add(Ue("arcc")),this.svgElem_.appendChild(this.zArcBC_.element);const be=f.createElementNS(se,"g");K.classList.add(Ue("axes")),this.svgElem_.appendChild(be),this.axesElem_=be,this.xAxis_=new it(f,[Cn,Ci],this.projector_),this.xAxis_.element.classList.add(Ue("axisx")),this.axesElem_.appendChild(this.xAxis_.element),this.yAxis_=new it(f,[Cn,mn],this.projector_),this.yAxis_.element.classList.add(Ue("axisy")),this.axesElem_.appendChild(this.yAxis_.element),this.zAxis_=new it(f,[Cn,On],this.projector_),this.zAxis_.element.classList.add(Ue("axisz")),this.axesElem_.appendChild(this.zAxis_.element),this.xnAxis_=new it(f,[Cn,Un],this.projector_),this.xnAxis_.element.classList.add(Ue("axisn")),this.axesElem_.appendChild(this.xnAxis_.element),this.ynAxis_=new it(f,[Cn,un],this.projector_),this.ynAxis_.element.classList.add(Ue("axisn")),this.axesElem_.appendChild(this.ynAxis_.element),this.znAxis_=new it(f,[Cn,Hn],this.projector_),this.znAxis_.element.classList.add(Ue("axisn")),this.axesElem_.appendChild(this.znAxis_.element),this.xArcF_=new it(f,te,this.projector_),this.xArcF_.element.classList.add(Ue("arcx")),this.svgElem_.appendChild(this.xArcF_.element),this.yArcF_=new it(f,te,this.projector_),this.yArcF_.element.classList.add(Ue("arcy")),this.svgElem_.appendChild(this.yArcF_.element),this.zArcF_=new it(f,te,this.projector_),this.zArcF_.element.classList.add(Ue("arcz")),this.svgElem_.appendChild(this.zArcF_.element),this.xArcFC_=new it(f,te,this.projector_),this.xArcFC_.element.classList.add(Ue("arcc")),this.svgElem_.appendChild(this.xArcFC_.element),this.yArcFC_=new it(f,te,this.projector_),this.yArcFC_.element.classList.add(Ue("arcc")),this.svgElem_.appendChild(this.yArcFC_.element),this.zArcFC_=new it(f,te,this.projector_),this.zArcFC_.element.classList.add(Ue("arcc")),this.svgElem_.appendChild(this.zArcFC_.element),this.rArc_=new it(f,fe,this.projector_),this.rArc_.element.classList.add(Ue("arcr")),this.rArc_.setRotation(kn),this.svgElem_.appendChild(this.rArc_.element),this.rArcC_=new it(f,fe,this.projector_),this.rArcC_.element.classList.add(Ue("arcc")),this.rArcC_.setRotation(kn),this.svgElem_.appendChild(this.rArcC_.element);const Ee=f.createElementNS(se,"g");K.classList.add(Ue("labels")),this.svgElem_.appendChild(Ee),this.labelsElem_=Ee,this.xLabel=Rn(f,"labelcirclex","X"),this.labelsElem_.appendChild(this.xLabel),this.yLabel=Rn(f,"labelcircley","Y"),this.labelsElem_.appendChild(this.yLabel),this.zLabel=Rn(f,"labelcirclez","Z"),this.labelsElem_.appendChild(this.zLabel),this.xnLabel=Rn(f,"labelcirclen","-X"),this.labelsElem_.appendChild(this.xnLabel),this.ynLabel=Rn(f,"labelcirclen","-Y"),this.labelsElem_.appendChild(this.ynLabel),this.znLabel=Rn(f,"labelcirclen","-Z"),this.labelsElem_.appendChild(this.znLabel);const Be=()=>{this.xArcB_.element.classList.add(Ue("arcx_hover")),this.xArcF_.element.classList.add(Ue("arcx_hover"))},st=()=>{this.xArcB_.element.classList.remove(Ue("arcx_hover")),this.xArcF_.element.classList.remove(Ue("arcx_hover"))};this.xArcBC_.element.addEventListener("mouseenter",Be),this.xArcBC_.element.addEventListener("mouseleave",st),this.xArcFC_.element.addEventListener("mouseenter",Be),this.xArcFC_.element.addEventListener("mouseleave",st);const Lt=()=>{this.yArcB_.element.classList.add(Ue("arcy_hover")),this.yArcF_.element.classList.add(Ue("arcy_hover"))},Ot=()=>{this.yArcB_.element.classList.remove(Ue("arcy_hover")),this.yArcF_.element.classList.remove(Ue("arcy_hover"))};this.yArcBC_.element.addEventListener("mouseenter",Lt),this.yArcBC_.element.addEventListener("mouseleave",Ot),this.yArcFC_.element.addEventListener("mouseenter",Lt),this.yArcFC_.element.addEventListener("mouseleave",Ot);const $t=()=>{this.zArcB_.element.classList.add(Ue("arcz_hover")),this.zArcF_.element.classList.add(Ue("arcz_hover"))},dn=()=>{this.zArcB_.element.classList.remove(Ue("arcz_hover")),this.zArcF_.element.classList.remove(Ue("arcz_hover"))};this.zArcBC_.element.addEventListener("mouseenter",$t),this.zArcBC_.element.addEventListener("mouseleave",dn),this.zArcFC_.element.addEventListener("mouseenter",$t),this.zArcFC_.element.addEventListener("mouseleave",dn);const kt=()=>{this.rArc_.element.classList.add(Ue("arcr_hover"))},Kt=()=>{this.rArc_.element.classList.remove(Ue("arcr_hover"))};this.rArcC_.element.addEventListener("mouseenter",kt),this.rArcC_.element.addEventListener("mouseleave",Kt),C.value.emitter.on("change",this.onValueChange_),this.value=C.value,C.mode.emitter.on("change",this.onModeChange_),this.mode_=C.mode,this.update_()}get xArcBElement(){return this.xArcBC_.element}get yArcBElement(){return this.yArcBC_.element}get zArcBElement(){return this.zArcBC_.element}get xArcFElement(){return this.xArcFC_.element}get yArcFElement(){return this.yArcFC_.element}get zArcFElement(){return this.zArcFC_.element}get rArcElement(){return this.rArcC_.element}get allFocusableElements(){return[this.padElement]}update_(){const f=this.value.rawValue.quat.normalized;this.xAxis_.setRotation(f),this.yAxis_.setRotation(f),this.zAxis_.setRotation(f),this.xnAxis_.setRotation(f),this.ynAxis_.setRotation(f),this.znAxis_.setRotation(f);const C=Ht.applyQuaternion(f),D=Ut.applyQuaternion(f),K=fn.applyQuaternion(f),te=C.negated,fe=D.negated,be=K.negated;[{el:this.xAxis_.element,v:C},{el:this.yAxis_.element,v:D},{el:this.zAxis_.element,v:K},{el:this.xnAxis_.element,v:te},{el:this.ynAxis_.element,v:fe},{el:this.znAxis_.element,v:be}].map(({el:Ee,v:Be})=>(this.axesElem_.removeChild(Ee),{el:Ee,v:Be})).sort((Ee,Be)=>Ee.v.z-Be.v.z).forEach(({el:Ee})=>{this.axesElem_.appendChild(Ee)}),this.xArcB_.setRotation(Qt(C,Mn)),this.yArcB_.setRotation(Qt(D,Mn)),this.zArcB_.setRotation(Qt(K,Mn)),this.xArcBC_.setRotation(Qt(C,Mn)),this.yArcBC_.setRotation(Qt(D,Mn)),this.zArcBC_.setRotation(Qt(K,Mn)),this.xArcF_.setRotation(Qt(C,fn)),this.yArcF_.setRotation(Qt(D,fn)),this.zArcF_.setRotation(Qt(K,fn)),this.xArcFC_.setRotation(Qt(C,fn)),this.yArcFC_.setRotation(Qt(D,fn)),this.zArcFC_.setRotation(Qt(K,fn)),[{el:this.xLabel,v:Ci},{el:this.yLabel,v:mn},{el:this.zLabel,v:On},{el:this.xnLabel,v:Un},{el:this.ynLabel,v:un},{el:this.znLabel,v:Hn}].forEach(({el:Ee,v:Be})=>{const[st,Lt]=this.projector_.project(Be.applyQuaternion(f));Ee.setAttributeNS(null,"transform",`translate( ${st}, ${Lt} )`)}),[{el:this.xLabel,v:C},{el:this.yLabel,v:D},{el:this.zLabel,v:K},{el:this.xnLabel,v:te},{el:this.ynLabel,v:fe},{el:this.znLabel,v:be}].map(({el:Ee,v:Be})=>(this.labelsElem_.removeChild(Ee),{el:Ee,v:Be})).sort((Ee,Be)=>Ee.v.z-Be.v.z).forEach(({el:Ee})=>{this.labelsElem_.appendChild(Ee)})}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}onModeChange_(){const f=this.mode_.rawValue,C=f==="angle-x"?"add":"remove",D=f==="angle-y"?"add":"remove",K=f==="angle-z"?"add":"remove",te=f==="angle-r"?"add":"remove";this.xArcB_.element.classList[C](Ue("arcx_active")),this.yArcB_.element.classList[D](Ue("arcy_active")),this.zArcB_.element.classList[K](Ue("arcz_active")),this.xArcF_.element.classList[C](Ue("arcx_active")),this.yArcF_.element.classList[D](Ue("arcy_active")),this.zArcF_.element.classList[K](Ue("arcz_active")),this.rArc_.element.classList[te](Ue("arcr_active"))}}function rs(_){return At(_,0,1)}function gn(_){if(_<=0)return 0;if(_>=1)return 1;const f=1-_,C=f*(f*(f*(f*(f*(f*(f*-6+7))))));return rs(1-C)}function ni(_,f,C){return rs((C-_)/(f-_))}const Pn=1/Math.sqrt(2),qt=new ht(1,0,0),Vs=new ht(0,1,0),Zi=new ht(0,0,1),Fn=new et(0,0,0,1),os=new et(Pn,0,0,Pn),Gn=new et(0,-Pn,0,Pn),En=new et(-Pn,0,0,Pn),li=new et(0,Pn,0,Pn),Bi=new et(0,1,0,0);class qn{constructor(f,C){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=C.value,this.viewProps=C.viewProps,this.mode_=R("free"),this.view=new Yi(f,{value:this.value,mode:this.mode_,viewProps:this.viewProps,pickerLayout:C.pickerLayout}),this.ptHandler_=new Ft(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);const D=new Ft(this.view.xArcBElement);D.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),D.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const K=new Ft(this.view.xArcFElement);K.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),K.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const te=new Ft(this.view.yArcBElement);te.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),te.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const fe=new Ft(this.view.yArcFElement);fe.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),fe.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const be=new Ft(this.view.zArcBElement);be.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),be.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const Ee=new Ft(this.view.zArcFElement);Ee.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),Ee.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const Be=new Ft(this.view.rArcElement);Be.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-r")),Be.emitter.on("up",()=>this.changeModeIfNotAuto_("free")),[{el:this.view.xLabel,q:Gn},{el:this.view.yLabel,q:os},{el:this.view.zLabel,q:Fn},{el:this.view.xnLabel,q:li},{el:this.view.ynLabel,q:En},{el:this.view.znLabel,q:Bi}].forEach(({el:st,q:Lt})=>{new Ft(st).emitter.on("down",()=>this.autoRotate_(Lt))}),this.px_=null,this.py_=null,this.angleState_=null}handlePointerEvent_(f){if(!f.point)return;const C=this.mode_.rawValue,D=f.point.x,K=f.point.y;if(C!=="auto")if(C==="free"){if(this.px_!=null&&this.py_!=null){const te=D-this.px_,fe=K-this.py_,be=Math.sqrt(te*te+fe*fe);if(be===0)return;const Ee=new ht(fe/be,te/be,0),Be=et.fromAxisAngle(Ee,be/68);this.value.rawValue=this.value.rawValue.premultiply(Be)}this.px_=D,this.py_=K}else if(C==="angle-r"){const te=f.bounds.width/2,fe=f.bounds.height/2,be=Math.atan2(K-fe,D-te);if(this.angleState_==null){const Ee=new ht(0,0,1);this.angleState_={initialRotation:this.value.rawValue,initialAngle:be,axis:Ee,reverseAngle:!0}}else{const{initialRotation:Ee,initialAngle:Be,axis:st}=this.angleState_,Lt=-Pt(be-Be),Ot=et.fromAxisAngle(st,Lt);this.value.rawValue=Ee.premultiply(Ot)}}else{const te=f.bounds.width/2,fe=f.bounds.height/2,be=Math.atan2(K-fe,D-te);if(this.angleState_==null){const Ee=C==="angle-x"?qt:C==="angle-y"?Vs:Zi,Be=Ee.applyQuaternion(this.value.rawValue.quat).z>0;this.angleState_={initialRotation:this.value.rawValue,initialAngle:be,axis:Ee,reverseAngle:Be}}else{const{initialRotation:Ee,initialAngle:Be,axis:st,reverseAngle:Lt}=this.angleState_;let Ot=Pt(be-Be);Ot=Lt?-Ot:Ot;const $t=et.fromAxisAngle(st,Ot);this.value.rawValue=Ee.multiply($t)}}}onPointerDown_(f){this.handlePointerEvent_(f.data)}onPointerMove_(f){this.handlePointerEvent_(f.data)}onPointerUp_(){this.px_=null,this.py_=null,this.angleState_=null}onPadKeyDown_(f){Gt(f.key)&&f.preventDefault();const C=_t(1,an(f)),D=_t(1,Yt(f));if(C!==0||D!==0){const K=new ht(-D,C,0),te=et.fromAxisAngle(K,Math.PI/16);this.value.rawValue=this.value.rawValue.premultiply(te)}}changeModeIfNotAuto_(f){this.mode_.rawValue!=="auto"&&(this.mode_.rawValue=f)}autoRotate_(f){this.mode_.rawValue="auto";const C=this.value.rawValue,D=Date.now(),K=()=>{const te=Date.now(),fe=gn(ni(0,300,te-D));if(this.value.rawValue=C.slerp(f,fe),fe===1){this.mode_.rawValue="free";return}requestAnimationFrame(K)};requestAnimationFrame(K)}}const Xn=d("rotationswatch"),Ji=new ht(1,0,0),Mi=new ht(0,1,0),Ei=new ht(0,0,1),Ns=new et(0,0,0,1);class Os{constructor(f,C){this.onValueChange_=this.onValueChange_.bind(this),C.value.emitter.on("change",this.onValueChange_),this.value=C.value,this.element=f.createElement("div"),this.element.classList.add(Xn()),C.viewProps.bindClassModifiers(this.element);const D=f.createElement("button");D.classList.add(Xn("b")),C.viewProps.bindDisabled(D),this.element.appendChild(D),this.buttonElement=D;const K=f.createElementNS(se,"svg");K.classList.add(Xn("g")),D.appendChild(K),this.svgElem_=K,this.projector_=new Ct,this.projector_.viewport=[0,0,20,20];const te=ot(0,Math.PI,33,"x","y"),fe=ot(0,2*Math.PI,65,"x","y");this.rArc_=new it(f,fe,this.projector_),this.rArc_.element.classList.add(Xn("arcr")),K.appendChild(this.rArc_.element),this.rArc_.setRotation(Ns),this.xArc_=new it(f,te,this.projector_),this.xArc_.element.classList.add(Xn("arc")),K.appendChild(this.xArc_.element),this.yArc_=new it(f,te,this.projector_),this.yArc_.element.classList.add(Xn("arc")),K.appendChild(this.yArc_.element),this.zArc_=new it(f,te,this.projector_),this.zArc_.element.classList.add(Xn("arc")),K.appendChild(this.zArc_.element),this.update_()}update_(){const f=this.value.rawValue.quat.normalized,C=Ji.applyQuaternion(f),D=Mi.applyQuaternion(f),K=Ei.applyQuaternion(f);this.xArc_.setRotation(Qt(C,Ei)),this.yArc_.setRotation(Qt(D,Ei)),this.zArc_.setRotation(Qt(K,Ei))}onValueChange_(){this.update_()}}class ci{constructor(f,C){this.value=C.value,this.viewProps=C.viewProps,this.view=new Os(f,{value:this.value,viewProps:this.viewProps})}}const Si=d("rotation");class Qi{constructor(f,C){this.element=f.createElement("div"),this.element.classList.add(Si()),C.foldable.bindExpandedClass(this.element,Si(void 0,"expanded")),y(C.foldable,"completed",E(this.element,Si(void 0,"cpl"))),C.rotationMode==="quaternion"&&this.element.classList.add(Si("quat"));const D=f.createElement("div");D.classList.add(Si("h")),this.element.appendChild(D);const K=f.createElement("div");K.classList.add(Si("s")),D.appendChild(K),this.swatchElement=K;const te=f.createElement("div");if(te.classList.add(Si("t")),D.appendChild(te),this.textElement=te,C.pickerLayout==="inline"){const fe=f.createElement("div");fe.classList.add(Si("g")),this.element.appendChild(fe),this.pickerElement=fe}else this.pickerElement=null}}class Ui{constructor(f,C){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=C.value,this.viewProps=C.viewProps,this.foldable_=ve.create(C.expanded),this.swatchC_=new ci(f,{value:this.value,viewProps:this.viewProps});const D=this.swatchC_.view.buttonElement;D.addEventListener("blur",this.onButtonBlur_),D.addEventListener("click",this.onButtonClick_),this.textC_=new Se(f,{assembly:C.assembly,axes:C.axes,parser:C.parser,value:this.value,viewProps:this.viewProps}),this.view=new Qi(f,{rotationMode:C.rotationMode,foldable:this.foldable_,pickerLayout:C.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=C.pickerLayout==="popup"?new rt(f,{viewProps:this.viewProps}):null;const K=new qn(f,{value:this.value,viewProps:this.viewProps,pickerLayout:C.pickerLayout});K.view.allFocusableElements.forEach(te=>{te.addEventListener("blur",this.onPopupChildBlur_),te.addEventListener("keydown",this.onPopupChildKeydown_)}),this.gizmoC_=K,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(K.view.element),We({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:te=>te.rawValue,backward:(te,fe)=>fe.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.gizmoC_.view.element),ue(this.foldable_,this.view.pickerElement))}onButtonBlur_(f){if(!this.popC_)return;const C=this.view.element,D=f.relatedTarget;(!D||!C.contains(D))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.gizmoC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(f){if(!this.popC_)return;const C=this.popC_.view.element,D=ce(f);D&&C.contains(D)||D&&D===this.swatchC_.view.buttonElement&&!ne(C.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(f){this.popC_?f.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&f.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function hi(_,f){const C=Math.pow(.1,_);return{baseStep:C,constraint:f,textProps:z.fromObject({draggingScale:C,formatter:Le(_)})}}function $n(_){if(!_)return;const f=[];return i(_.step)||f.push(new Te(_.step)),(!i(_.max)||!i(_.min))&&f.push(new ze({max:_.max,min:_.min})),new me(f)}function fs(_,f){return{toComponents:C=>C.getComponents(),fromComponents:C=>new Je(C[0],C[1],C[2],_,f)}}function Fs(_,f,C){var D,K,te;return typeof((D=_)===null||D===void 0?void 0:D.x)=="number"&&typeof((K=_)===null||K===void 0?void 0:K.y)=="number"&&typeof((te=_)===null||te===void 0?void 0:te.z)=="number"?new Je(_.x,_.y,_.z,f,C):new Je(0,0,0,f,C)}function Zs(_){switch(_){case"XYZ":case"XZY":case"YXZ":case"YZX":case"ZXY":case"ZYX":return _;default:return}}function Ai(_){switch(_){case"rad":case"deg":case"turn":return _;default:return}}const ms={id:"rotation",type:"input",css:".tp-rotationswatchv_b,.tp-rotationgizmov_p{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-rotationswatchv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-rotationswatchv_b:hover{background-color:var(--btn-bg-h)}.tp-rotationswatchv_b:focus{background-color:var(--btn-bg-f)}.tp-rotationswatchv_b:active{background-color:var(--btn-bg-a)}.tp-rotationswatchv_b:disabled{opacity:0.5}.tp-rotationgizmov_p{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-rotationgizmov_p:hover{background-color:var(--in-bg-h)}.tp-rotationgizmov_p:focus{background-color:var(--in-bg-f)}.tp-rotationgizmov_p:active{background-color:var(--in-bg-a)}.tp-rotationgizmov_p:disabled{opacity:0.5}.tp-rotationv{position:relative}.tp-rotationv_quat .tp-txtv_i{padding-left:0}.tp-rotationv_root{background-color:var(--mo-bg);width:100%;height:calc( 2.0 * var(--bld-us))}.tp-rotationv_h{display:flex}.tp-rotationv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us);margin-right:4px}.tp-rotationv_g{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-rotationv.tp-rotationv-expanded .tp-rotationv_g{margin-top:var(--bld-s);opacity:1}.tp-rotationv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-rotationswatchv path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationswatchv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-rotationswatchv_arc{fill:none;stroke:var(--btn-bg);stroke-width:1px}.tp-rotationswatchv_arcr{fill:var(--btn-fg);stroke:var(--btn-bg);stroke-width:1px}.tp-rotationgizmov{padding-left:calc(var(--bld-us) + 4px)}.tp-rotationgizmov path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationgizmov_p{cursor:move;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-rotationgizmov_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-rotationgizmov_axisx{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_axisy{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_axisz{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_axisn{stroke:var(--in-fg);stroke-width:2px}.tp-rotationgizmov_arcx{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_hover{stroke:#eb103f}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_active{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_arcy{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_hover{stroke:#4eeb10}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_active{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_arcz{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_hover{stroke:#1068eb}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_active{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_arcr{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_hover{stroke:#ebd510}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_active{stroke:#ebd510;stroke-width:2px}.tp-rotationgizmov_arcc{fill:none;stroke:transparent;stroke-width:5px;pointer-events:auto}.tp-rotationgizmov_labelcirclex{fill:#eb103f;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclex:hover{opacity:0.7}.tp-rotationgizmov_labelcircley{fill:#4eeb10;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcircley:hover{opacity:0.7}.tp-rotationgizmov_labelcirclez{fill:#1068eb;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclez:hover{opacity:0.7}.tp-rotationgizmov_labelcirclen{fill:var(--in-fg);cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclen:hover{opacity:0.7}.tp-rotationgizmov_labeltext{fill:var(--btn-fg);stroke:var(--btn-fg);stroke-width:1px}.tp-rotationgizmov_p:focus .tp-rotationgizmov_m{background-color:var(--in-fg);border-width:0}",accept(_,f){var C,D;const K=W,te=Z(f,{view:K.required.constant("rotation"),label:K.optional.string,picker:K.optional.custom(Nn),expanded:K.optional.boolean,rotationMode:K.required.constant("euler"),x:K.optional.custom(yn),y:K.optional.custom(yn),z:K.optional.custom(yn),order:K.optional.custom(Zs),unit:K.optional.custom(Ai)});return te?{initialValue:Fs(_,(C=te.order)!==null&&C!==void 0?C:"XYZ",(D=te.unit)!==null&&D!==void 0?D:"rad"),params:te}:null},binding:{reader({params:_}){return f=>{var C,D;return Fs(f,(C=_.order)!==null&&C!==void 0?C:"XYZ",(D=_.unit)!==null&&D!==void 0?D:"rad")}},constraint({params:_}){var f,C;return new $({assembly:fs((f=_.order)!==null&&f!==void 0?f:"XYZ",(C=_.unit)!==null&&C!==void 0?C:"rad"),components:[$n("x"in _?_.x:void 0),$n("y"in _?_.y:void 0),$n("z"in _?_.z:void 0)]})},writer(_){return(f,C)=>{f.writeProperty("x",C.x),f.writeProperty("y",C.y),f.writeProperty("z",C.z)}}},controller({document:_,value:f,constraint:C,params:D,viewProps:K}){var te,fe;if(!(C instanceof $))throw a.shouldNeverHappen();const be="expanded"in D?D.expanded:void 0,Ee="picker"in D?D.picker:void 0,Be=(te=D.unit)!==null&&te!==void 0?te:"rad",st={rad:2,deg:0,turn:2}[Be];return new Ui(_,{axes:[hi(st,C.components[0]),hi(st,C.components[1]),hi(st,C.components[2])],assembly:fs((fe=D.order)!==null&&fe!==void 0?fe:"XYZ",Be),rotationMode:"euler",expanded:be??!1,parser:Ge,pickerLayout:Ee??"popup",value:f,viewProps:K})}},Hi={toComponents:_=>[_.x,_.y,_.z,_.w],fromComponents:_=>new et(_[0],_[1],_[2],_[3])};function Yn(_){return{baseStep:.01,constraint:_,textProps:z.fromObject({draggingScale:.01,formatter:f=>Math.abs(f)<.995?f.toFixed(2).replace("0.","."):f.toFixed(1)})}}function Pi(_){var f,C,D,K;return typeof((f=_)===null||f===void 0?void 0:f.x)=="number"&&typeof((C=_)===null||C===void 0?void 0:C.y)=="number"&&typeof((D=_)===null||D===void 0?void 0:D.z)=="number"&&typeof((K=_)===null||K===void 0?void 0:K.w)=="number"?new et(_.x,_.y,_.z,_.w):new et(0,0,0,1)}const Gi={id:"rotation",type:"input",css:".tp-rotationswatchv_b,.tp-rotationgizmov_p{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-rotationswatchv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-rotationswatchv_b:hover{background-color:var(--btn-bg-h)}.tp-rotationswatchv_b:focus{background-color:var(--btn-bg-f)}.tp-rotationswatchv_b:active{background-color:var(--btn-bg-a)}.tp-rotationswatchv_b:disabled{opacity:0.5}.tp-rotationgizmov_p{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-rotationgizmov_p:hover{background-color:var(--in-bg-h)}.tp-rotationgizmov_p:focus{background-color:var(--in-bg-f)}.tp-rotationgizmov_p:active{background-color:var(--in-bg-a)}.tp-rotationgizmov_p:disabled{opacity:0.5}.tp-rotationv{position:relative}.tp-rotationv_quat .tp-txtv_i{padding-left:0}.tp-rotationv_root{background-color:var(--mo-bg);width:100%;height:calc( 2.0 * var(--bld-us))}.tp-rotationv_h{display:flex}.tp-rotationv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us);margin-right:4px}.tp-rotationv_g{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-rotationv.tp-rotationv-expanded .tp-rotationv_g{margin-top:var(--bld-s);opacity:1}.tp-rotationv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-rotationswatchv path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationswatchv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-rotationswatchv_arc{fill:none;stroke:var(--btn-bg);stroke-width:1px}.tp-rotationswatchv_arcr{fill:var(--btn-fg);stroke:var(--btn-bg);stroke-width:1px}.tp-rotationgizmov{padding-left:calc(var(--bld-us) + 4px)}.tp-rotationgizmov path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationgizmov_p{cursor:move;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-rotationgizmov_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-rotationgizmov_axisx{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_axisy{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_axisz{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_axisn{stroke:var(--in-fg);stroke-width:2px}.tp-rotationgizmov_arcx{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_hover{stroke:#eb103f}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_active{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_arcy{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_hover{stroke:#4eeb10}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_active{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_arcz{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_hover{stroke:#1068eb}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_active{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_arcr{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_hover{stroke:#ebd510}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_active{stroke:#ebd510;stroke-width:2px}.tp-rotationgizmov_arcc{fill:none;stroke:transparent;stroke-width:5px;pointer-events:auto}.tp-rotationgizmov_labelcirclex{fill:#eb103f;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclex:hover{opacity:0.7}.tp-rotationgizmov_labelcircley{fill:#4eeb10;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcircley:hover{opacity:0.7}.tp-rotationgizmov_labelcirclez{fill:#1068eb;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclez:hover{opacity:0.7}.tp-rotationgizmov_labelcirclen{fill:var(--in-fg);cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclen:hover{opacity:0.7}.tp-rotationgizmov_labeltext{fill:var(--btn-fg);stroke:var(--btn-fg);stroke-width:1px}.tp-rotationgizmov_p:focus .tp-rotationgizmov_m{background-color:var(--in-fg);border-width:0}",accept(_,f){const C=W,D=Z(f,{view:C.required.constant("rotation"),label:C.optional.string,picker:C.optional.custom(Nn),expanded:C.optional.boolean,rotationMode:C.optional.constant("quaternion"),x:C.optional.custom(yn),y:C.optional.custom(yn),z:C.optional.custom(yn),w:C.optional.custom(yn)});return D?{initialValue:Pi(_),params:D}:null},binding:{reader(_){return f=>Pi(f)},constraint({params:_}){return new $({assembly:Hi,components:[$n("x"in _?_.x:void 0),$n("y"in _?_.y:void 0),$n("z"in _?_.z:void 0),$n("w"in _?_.w:void 0)]})},writer(_){return(f,C)=>{f.writeProperty("x",C.x),f.writeProperty("y",C.y),f.writeProperty("z",C.z),f.writeProperty("w",C.w)}}},controller({document:_,value:f,constraint:C,params:D,viewProps:K}){if(!(C instanceof $))throw a.shouldNeverHappen();const te="expanded"in D?D.expanded:void 0,fe="picker"in D?D.picker:void 0;return new Ui(_,{axes:[Yn(C.components[0]),Yn(C.components[1]),Yn(C.components[2]),Yn(C.components[3])],assembly:Hi,rotationMode:"quaternion",expanded:te??!1,parser:Ge,pickerLayout:fe??"popup",value:f,viewProps:K})}},G=[ms,Gi];t.RotationInputPluginEuler=ms,t.RotationInputPluginQuaternion=Gi,t.plugins=G,Object.defineProperty(t,"__esModule",{value:!0})})})(km,km.exports);var vw=km.exports;const oL=fw(vw),aL=R_({__proto__:null,default:oL},[vw]);var Bd=(h=>(h[h.radians=0]="radians",h[h.degrees=1]="degrees",h))(Bd||{});const lL=["XYZ","YXZ","ZXY","ZYX","YZX","XZY"].map(h=>({text:h.toLowerCase(),value:h})),Nt={ov:{w:0,x:0,y:0,z:0},quaternion:{x:0,y:0,z:0,w:1},euler:{xyz:{x:0,y:0,z:0},order:"XYZ"},matrix:{row1:{x:1,y:0,z:0},row2:{x:0,y:1,z:0},row3:{x:0,y:0,z:1}},axisAngle:{xyz:{x:0,y:0,z:0},angle:0},axisAngleMagnitude:{x:0,y:0,z:0}},Fu=1e-4,cL=new Vn(-1,0,0,0),Sc=new Vn(0,0,1,0),L_=new Vn,hL=new Vn,uL=new Vn,dL=new Vn,pL=new Vn,fL=new X,mL=new X,vL=new X,gL=new X,_L=new X,bL=new X,wL=new X,xL=new X;class gw{isOrientationVector=!0;#e=new X;#t;constructor(e=0,t=0,n=0,i=0){this.#e.set(e,t,n).normalize(),this.th=i}get x(){return this.#e.x}get y(){return this.#e.y}get z(){return this.#e.z}th;_onChange(e){return this.#t=e,this}set(e=0,t=0,n=0,i=0){return this.#e.set(e,t,n).normalize(),this.th=i,this.#t?.(),this}length(){return this.#e.length()}copy(e){return this.#e.set(e.x,e.y,e.z).normalize(),this.th=e.th,this.#t?.(),this}fromArray(e,t=0){return this.#e.set(e[t],e[t+1],e[t+2]),this.th=e[t+3],this.#t?.(),this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.th,e}setFromQuaternion(e){const t=L_.copy(e).conjugate(),n=hL.multiplyQuaternions(e,cL).multiply(t),i=uL.multiplyQuaternions(e,Sc).multiply(t);let o=0;if(1-Math.abs(i.z)>Fu){const a=fL.set(i.x,i.y,i.z),c=mL.set(n.x,n.y,n.z),u=vL.set(Sc.x,Sc.y,Sc.z),d=gL.copy(a).cross(c),v=_L.copy(a).cross(u),g=d.dot(v)/(d.length()*v.length()),b=cd.clamp(g,-1,1),y=Math.acos(b);if(y>Fu){const S=bL.copy(c).normalize(),E=dL.setFromAxisAngle(S,-1*y),M=pL.copy(E).conjugate(),L=E.multiplyQuaternions(E.multiply(Sc),M),R=wL.copy(a).cross(xL.set(L.x,L.y,L.z));o=1-d.dot(R)/(d.length()*R.length())<Fu**2?-y:y}else o=0}else i.z<0?o=-Math.atan2(n.y,n.x):o=-Math.atan2(n.y,-n.x);return this.set(i.x,i.y,i.z,o),this.#t?.(),this}toQuaternion(e){const t=Math.acos(this.z),n=1-Math.abs(this.z)>Fu?Math.atan2(this.y,this.x):0,i=Math.sin(n/2),o=Math.cos(n/2),a=Math.sin(t/2),c=Math.cos(t/2),u=Math.sin(this.th/2),d=Math.cos(this.th/2);return e.set(o*a*u-i*a*d,o*a*d+i*a*u,i*c*d+o*c*u,o*c*d-i*c*u)}toEuler(e){return e.setFromQuaternion(this.toQuaternion(L_),"ZYX")}}window.THREE=pA;window.OrientationVector=gw;const k_=new X,zn=new Vn,zf=new Ho,Ac=new It,ia=new gw,sl=(h,e)=>e===Bd.degrees?h/180*Math.PI:h,ko=(h,e)=>e===Bd.degrees?h*180/Math.PI:h,Cs=h=>!Number.isNaN(h)&&Number.isFinite(h)?Number.parseFloat(h.toFixed(7)):h,Xr=h=>{if(!Number.isNaN(h)&&Number.isFinite(h)){let e=h.toFixed(7);return h>=0&&(e=" "+e),Number.parseFloat(e)}else return h},yL=(h,e)=>{if(h==="ov")ia.set(Nt.ov.x,Nt.ov.y,Nt.ov.z,sl(Nt.ov.w,e)),zn.copy(ia.toQuaternion(zn));else if(h==="matrix"){const{row1:i,row2:o,row3:a}=Nt.matrix;Ac.set(i.x,i.y,i.z,1,o.x,o.y,o.z,1,a.x,a.y,a.z,1,0,0,0,1),zn.setFromRotationMatrix(Ac)}else if(h==="quaternion")zn.set(Nt.quaternion.x,Nt.quaternion.y,Nt.quaternion.z,Nt.quaternion.w);else if(h==="axis angle"){const i=Nt.axisAngle,o=k_;o.set(i.xyz.x,i.xyz.y,i.xyz.z),o.normalize(),zn.setFromAxisAngle(o,sl(i.angle,e))}else if(h==="axis with angle magnitude"){const i=Nt.axisAngleMagnitude,o=k_;o.set(i.x,i.y,i.z);const a=sl(o.length(),e);o.normalize(),zn.setFromAxisAngle(o,a)}else if(h==="euler"){const i=Nt.euler;zn.setFromEuler(zf.set(sl(i.xyz.x,e),sl(i.xyz.y,e),sl(i.xyz.z,e),i.order))}zn.normalize(),Nt.quaternion.x=Cs(zn.x),Nt.quaternion.y=Cs(zn.y),Nt.quaternion.z=Cs(zn.z),Nt.quaternion.w=Cs(zn.w),ia.setFromQuaternion(zn),Nt.ov.w=ko(ia.th,e),Nt.ov.x=ia.x,Nt.ov.y=ia.y,Nt.ov.z=ia.z,Ac.makeRotationFromQuaternion(zn);{const i=Ac.elements;Nt.matrix.row1.x=Xr(i[0]),Nt.matrix.row1.y=Xr(i[4]),Nt.matrix.row1.z=Xr(i[8]),Nt.matrix.row2.x=Xr(i[1]),Nt.matrix.row2.y=Xr(i[5]),Nt.matrix.row2.z=Xr(i[9]),Nt.matrix.row3.x=Xr(i[2]),Nt.matrix.row3.y=Xr(i[6]),Nt.matrix.row3.z=Xr(i[10])}const t=[0,0,0],n=2*Math.acos(zn.w);if(1-zn.w*zn.w<1e-6)t[0]=zn.x,t[1]=zn.y,t[2]=zn.z;else{const i=Math.sqrt(1-zn.w*zn.w);t[0]=zn.x/i,t[1]=zn.y/i,t[2]=zn.z/i}Nt.axisAngle.xyz.x=Cs(t[0]),Nt.axisAngle.xyz.y=Cs(t[1]),Nt.axisAngle.xyz.z=Cs(t[2]),Nt.axisAngle.angle=Cs(ko(n,e)),Nt.axisAngleMagnitude.x=Cs(ko(t[0]*n,e)),Nt.axisAngleMagnitude.y=Cs(ko(t[1]*n,e)),Nt.axisAngleMagnitude.z=Cs(ko(t[2]*n,e));{zf.setFromRotationMatrix(Ac,Nt.euler.order);const[i,o,a]=zf.toArray();Nt.euler.xyz.x=Cs(ko(i,e)),Nt.euler.xyz.y=Cs(ko(o,e)),Nt.euler.xyz.z=Cs(ko(a,e))}},CL=new fv,gh=new Jt;gh.rotateY(-Math.PI/2);gh.rotateX(-Math.PI/2);El.add(gh);const ML=new T0(.75,5);El.add(ML);const EL=new pv(5);gh.add(EL);const SL=await CL.loadAsync("teapot.glb"),Sl=SL.scene;Sl.children[0].rotateY(-Math.PI/2);Sl.children[0].rotateX(Math.PI/2);const AL=new L0(void 0,void 0,.25);Sl.add(AL);El.add(PP(16777215,1));El.add(ow());La.position.set(.5,.5,-.5);La.lookAt(0,0,0);gh.add(Sl);const zi=new iL.Pane;zi.registerPlugin(rL);zi.registerPlugin(aL);const Ir=[],_w={units:Bd.radians};let Vf=!1;const Dr=(h,e)=>{if(!Vf){yL(h,_w.units);{const t=Nt.quaternion;Sl.quaternion.set(t.x,t.y,t.z,t.w)}Vf=!0;for(const t of Ir)t!==e.target&&t.refresh();Vf=!1}};zi.addInput(Sl,"position");zi.addSeparator();zi.addInput(_w,"units",{view:"radiogrid",groupName:"units",size:[2,1],cells:h=>({title:h===0?"radians":"degrees",value:h}),label:"units"}).on("change",h=>Dr("quaternion",h));zi.addSeparator();Ir.push(zi.addInput(Nt,"ov",{label:"orientation vector (th / xyz)"}).on("change",h=>Dr("ov",h)));zi.addSeparator();Ir.push(zi.addInput(Nt,"quaternion",{label:"quaternion (xyz / w)"}).on("change",h=>Dr("quaternion",h)));zi.addSeparator();Ir.push(zi.addInput(Nt.euler,"xyz",{label:"euler"}).on("change",h=>Dr("euler",h)));Ir.push(zi.addInput(Nt.euler,"order",{label:"",options:lL}).on("change",h=>Dr("euler",h)));zi.addSeparator();Ir.push(zi.addInput(Nt.matrix,"row1",{label:"matrix"}).on("change",h=>Dr("matrix",h)));Ir.push(zi.addInput(Nt.matrix,"row2",{label:""}).on("change",h=>Dr("matrix",h)));Ir.push(zi.addInput(Nt.matrix,"row3",{label:""}).on("change",h=>Dr("matrix",h)));zi.addSeparator();Ir.push(zi.addInput(Nt.axisAngle,"xyz",{label:"axis angle"}).on("change",h=>Dr("axis angle",h)));Ir.push(zi.addInput(Nt.axisAngle,"angle",{label:""}).on("change",h=>Dr("axis angle",h)));DP();
